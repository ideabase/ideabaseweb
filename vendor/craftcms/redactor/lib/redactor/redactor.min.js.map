{"version":3,"sources":["redactor.js"],"names":["Ajax","settings","post","options","AjaxRequest","get","method","defaults","url","before","success","error","data","async","headers","this","p","extend","toUpperCase","prepareData","xhr","XMLHttpRequest","open","setHeaders","send","prototype","obj1","obj2","name","isFormData","toParams","setRequestHeader","window","FormData","isComplete","status","onload","loaded","bind","call","response","json","parseJson","statusText","str","o","JSON","parse","e","obj","Object","keys","map","k","encodeURIComponent","join","DomCache","DomExpando","Date","DomDisplayCache","Dom","selector","context","ready","fn","document","readyState","addEventListener","dom","length","nodes","nodeType","childNodes","test","create","_query","_slice","html","createElement","RegExp","$1","elements","container","children","innerHTML","i","l","push","add","concat","_toArray","index","getAll","eq","first","last","contents","each","callback","len","is","filter","undefined","node","Node","indexOf","matches","msMatchesSelector","webkitMatchesSelector","not","find","ns","parent","parentNode","parents","_getContext","closest","isNode","next","_getSibling","nextElement","prev","prevElement","css","value","_getHeightOrWidth","getComputedStyle","key","style","attr","checked","_getBooleanFromStr","getAttribute","setAttribute","reDataAttr","attrs","attributes","replacer","g","nodeName","dataName","match","val","replace","_isObjectString","_toObject","_isNumber","parseFloat","el","type","removeAttr","split","forEach","removeAttribute","removeData","dataset","dataindex","dataget","cacheIndex","nextCacheIndex","addClass","_eachClass","removeClass","toggleClass","hasClass","some","classList","contains","empty","append","text","textContent","after","_inject","frag","insertAdjacentHTML","elms","reverse","insertBefore","nextSibling","appendChild","prepend","firstChild","wrap","wrapper","unwrap","$node","replaceWith","docFrag","createDocumentFragment","result","replaceChild","remove","removeChild","clone","events","copy","_clone","_cloneEvents","show","_getRealDisplay","old","display","body","testElem","hide","scrollTop","isWindow","isDocument","scrollingElement","documentElement","pageYOffset","scrollTo","offset","_getDim","position","width","adjust","_getSize","height","outerWidth","_getInnerOrOuter","outerHeight","innerWidth","innerHeight","click","_triggerEvent","focus","trigger","names","ev","CustomEvent","bubbles","cancelable","createEvent","initCustomEvent","dispatchEvent","on","handler","one","event","_getEventName","namespace","_getEventNamespace","_getOneHandler","_e","off","testEvent","testNamespace","testEventNamespace","testPositive","_offEvent","serialize","asObject","disabled","z","opt","selected","_toParams","ajax","_queryContext","querySelectorAll","element","getElementById","slice","getElementsByClassName","getElementsByTagName","querySelector","res","_events","cloneNode","self","apply","arguments","arr","condition","handlers","toString","removeEventListener","splice","_getDocSize","Math","max","captype","round","_adjustResultHeightOrWidth","charAt","$el","$targets","fixStyle","tmp","thisStyle","fix","isBorderBox","boxSizing","borderTopWidth","borderBottomWidth","marginTop","marginBottom","borderLeftWidth","borderRightWidth","marginLeft","marginRight","top","left","_getPosition","offsetTop","offsetLeft","_getOffset","rect","getBoundingClientRect","doc","ownerDocument","docElem","win","defaultView","clientTop","pageXOffset","clientLeft","sibling","NodeList","params","_encodeUri","Function","isNaN","search","elem","currentStyle","getPropertyValue","uuid","$R","RedactorApp","version","modules","services","classes","plugins","mixins","modals","lang","keycodes","BACKSPACE","DELETE","UP","DOWN","ENTER","SPACE","ESC","TAB","CTRL","META","SHIFT","ALT","RIGHT","LEFT","env","plugin","module","service","class","mixin","jQuery","redactor","toArray","args","instance","Array","isArray","isApi","App","methodValue","isDestroy","unshift","api","translations","F","inherit","addLang","init","current","f","prop","__lookupGetter__","__defineGetter__","super","exception","extended","deep","merge","hasOwnProperty","opts","animation","direction","spellcheck","structure","scrollTarget","styles","stylesClass","placeholder","source","showSource","inline","breakline","markup","enterKey","clickToEdit","clickToSave","clickToCancel","focusEnd","minHeight","maxHeight","maxWidth","callbacks","preClass","preSpaces","tabindex","tabAsSpaces","tabKey","autosave","autosaveName","autosaveData","toolbar","toolbarFixed","toolbarFixedTarget","toolbarFixedTopOffset","toolbarExternal","toolbarContext","air","formatting","formattingAdd","formattingHide","buttons","buttonsTextLabeled","buttonsAdd","buttonsAddFirst","buttonsAddAfter","buttonsAddBefore","buttonsHide","buttonsHideOnMobile","imageUpload","imageUploadParam","imageData","imageEditable","imageCaption","imagePosition","imageResizable","imageFloatMargin","imageFigure","fileUpload","fileUploadParam","fileData","fileAttachment","uploadData","dragUpload","multipleUpload","clipboardUpload","uploadBase64","linkTarget","linkTitle","linkNewTab","linkNofollow","linkSize","linkValidation","cleanOnEnter","cleanInlineOnEnter","paragraphize","removeScript","removeNewLines","removeComments","replaceTags","b","strike","pastePlainText","pasteLinkTarget","pasteImages","pasteLinks","pasteClean","pasteKeepStyle","pasteKeepClass","pasteKeepAttrs","pasteBlockTags","pasteInlineTags","activeButtons","strong","em","del","u","activeButtonsAdd","activeButtonsObservers","autoparse","autoparseStart","autoparsePaste","autoparseLinks","autoparseImages","autoparseVideo","shortcodes","p.","format","quote.","pre.","h1.","h2.","h3.","h4.","h5.","h6.","1.","*.","shortcodesAdd","shortcuts","ctrl+shift+m, meta+shift+m","ctrl+b, meta+b","ctrl+i, meta+i","ctrl+u, meta+u","ctrl+h, meta+h","ctrl+l, meta+l","ctrl+k, meta+k","ctrl+alt+0, meta+alt+0","ctrl+alt+1, meta+alt+1","ctrl+alt+2, meta+alt+2","ctrl+alt+3, meta+alt+3","ctrl+alt+4, meta+alt+4","ctrl+alt+5, meta+alt+5","ctrl+alt+6, meta+alt+6","ctrl+shift+7, meta+shift+7","ctrl+shift+8, meta+shift+8","shortcutsAdd","grammarly","bufferLimit","emptyHtml","markerChar","imageTypes","inlineTags","blockTags","regex","youtube","vimeo","imageurl","input","zindex","modes","original","image","file","link","bold","italic","deleted","underline","superscript","subscript","bold-abbr","italic-abbr","deleted-abbr","underline-abbr","superscript-abbr","subscript-abbr","lists","link-insert","link-edit","link-in-new-tab","unlink","cancel","close","insert","save","delete","edit","title","paragraph","quote","code","heading1","heading2","heading3","heading4","heading5","heading6","filename","optional","unorderedlist","orderedlist","outdent","indent","horizontalrule","upload","upload-label","accessibility-help-label","caption","bulletslist","numberslist","image-position","none","right","center","undo","redo","icon","dropdown","tag","blockquote","pre","h1","h2","h3","h4","h5","h6","tooltip","sup","sub","observe","ul","ol","line","instances","started","stopped","rootElement","rootOpts","dragInside","dragComponentInside","$win","$doc","$body","editorReadOnly","buildServices","buildModules","buildPlugins","start","broadcast","stop","isStarted","isStopped","core","bindable","inj","isDragInside","setDragInside","isDragComponentInside","setDragComponentInside","getDragComponentInside","isReadOnly","enableReadOnly","component","clearActive","disableButtons","disableReadOnly","enableButtons","callMessageHandler","func","utils","checkProperty","moduleName","isApp","isCallback","isService","isPlugin","isModule","callInstanceMethod","isInstanceExists","Error","buildArgs","applyArgs","selection","_clearAll","clearClass","tags","$elements","getElements","_unwrapSpanWithoutAttr","restore","clearStyle","clearAttr","_removeAllAttr","set","toggle","className","newVal","oldVal","isRgb","rgb2hex","hex2long","toLowerCase","_convertStyleQuotes","removeEmptyAttr","nodeAttr","removeAttributeNode","finalNodes","tagName","cmnt","app","vars","_build","rebuild","_set","_loop","path","animationOpt","duration","iterate","delay","timing","prefix","AnimatePlay","effect","hidableEffects","prefixes","buildAnimationOff","isInanimate","inanimate","animate","isHidable","buildHideClass","isAnimated","setTimeout","complete","clean","setStart","_setCaret","setEnd","setBefore","setAfter","isStart","_isStartOrEnd","isEnd","setAtEnd","inspector","getTag","range","createRange","_isInPage","textNode","createInvisibleChar","setStartBefore","collapse","selectNodeContents","setRange","setAtStart","isInline","isEmpty","insertNode","setAtBefore","setAtAfter","setStartAfter","setAtPrev","previousSibling","_isEmptyTextNode","previousElementSibling","setAtNext","nextElementSibling","getNode","_setStart","isText","editor","findFirstNode","item","getFirstElement","dataItem","isComponent","getComponent","isComponentType","isFigcaption","findLastNode","table","getTable","tableData","setActive","_setInline","_setEnd","getLastElement","_setBefore","isFirstTableCell","isFirstListItem","getList","isBlock","_setAfter","isLastTableCell","_hasInlineChild","_getStartEndNode","trimSpaces","isComponentEditable","end","size","pos","getFirstNode","getLastNode","isInlineTag","trim","removeInvisibleChars","getFigcaption","isTable","isList","sel","anchorNode","isInEditor","isEditor","isCollapsed","getRange","isBackwards","backwards","anchorOffset","focusNode","focusOffset","collapsed","detach","isIn","getCurrent","block","getBlock","blocks","getBlocks","isTableCellTag","isAll","isNonEditable","isActive","output","getElement","getHtml","getText","hasNonEditable","$wrapper","getSelection","removeAllRanges","addRange","setAll","saveScroll","disableNonEditables","marker","build","restoreMarkers","getComponentCodeElement","enableNonEditables","restoreScroll","rangeCount","getRangeAt","getTextBeforeCaret","num","cloneRange","getTextAfterCaret","clonedRange","endContainer","endOffset","getPosition","startOffset","startContainer","bottom","getActive","getParent","isElement","getInline","_isInlineNode","getInlineFirst","getInlineAll","inlines","isBlockTag","getInlinesAllSelected","getInlines","all","textNodes","getNodes","textnodes","_isTextSelected","_filterNodesByTags","filteredNodes","_isInNodesArray","inside","_filterInlinesInside","_filterBlocksFirst","activeComponent","_getNodesComponent","_getRangeSelectedNodes","_filterServicesNodes","_filterEditor","_filterNodesTexts","_filterNodesElements","cloneContents","cleaner","clear","collapseToStart","collapseToEnd","saveActiveComponent","savedComponent","restoreActiveComponent","_clearSaved","saved","savedElement","caret","saveMarkers","_getNextNode","hasChildNodes","startNode","endNode","$editor","getChildNodes","commonAncestorContainer","skip","keepbr","passtexts","nodeTag","isFirst","isCellParent","containsNode","$element","_buildType","isType","getType","scrolltop","pasting","isFocus","_isContenteditableFocus","startFocus","endFocus","isPasting","enablePasting","disablePasting","_getScrollTarget","$noneditables","isSourceMode","keeplists","isEmptyHtml","$active","activeElement","setEmpty","editableElement","$container","$source","content","_buildName","_buildStartedContent","getCode","getName","getStartedContent","setCode","insertion","isNameGenerated","sourceElement","$statusbar","items","update","$item","getItems","removeItems","dropdownOpened","buttonsObservers","_extendActiveButtons","stopObservers","$toolbar","button","observer","setButtonsInactive","getButton","_inlinesToTags","detector","isMobile","isAir","isFixed","isContextBar","isTarget","getWrapper","getDropdown","getTargetElement","$btn","_findButton","getButtonByIndex","getButtons","_findButtons","getButtonsKeys","addButton","btnObj","_getButtonIndex","$button","$elm","addButtonFirst","addButtonAfter","addButtonBefore","addButtonObserver","setButtons","setDropdown","$buttons","setInactive","setButtonsActive","disable","enable","_init","isDisabled","hasIcon","message","setMessage","setApi","setTitle","alt","aria-label","setTooltip","setIcon","$icon","_buildTooltip","hideTooltip","preventDefault","_parseTitle","_parseTooltip","_buildCallback","_buildAttributes","_buildObserver","_buildIcon","href","rel","role","isHtml","isDesktop","created","$items","isOpened","$dropdown","getItem","getItemsByClass","classname","_closeAll","_observe","_handleKeyboard","updatePosition","target","_isButton","_close","btnHeight","btnWidth","leftFix","_buildDom","_buildItems","_buildFormattingItems","which","$span","getTitle","storedComponents","storedImages","storedLinks","deniedTags","convertRules","unconvertRules","reComments","reSpacedEmpty","reScriptTag","addConvertRules","addUnconvertRules","encodePreCode","convert","storeComponents","_setSpanAttr","_setStyleCache","removeTags","_removeScriptTag","_replaceScriptTag","_isSpacedEmpty","restoreComponents","_cleanWrapped","removeMarkers","removeInvisibleSpaces","_isParagraphEmpty","removeServiceTagsAndAttrs","removeSpanWithoutAttributes","removeFirstBlockBreaklineInHtml","_unreplaceScriptTag","_setPreClass","_setLinkNofollow","cleanNewLines","unconvert","removeEmptyAttributes","cleanSpacesInPre","tidy","paste","isMsWord","_isHtmlMsWord","_cleanGDocs","_cleanMsWord","exceptedTags","removeTagsExcept","buildWrapper","$elms","filterStyle","filterClass","filterAttrs","$li","getWrapperHtml","storeLinks","storeImages","getPlainText","_replaceNlToBr","restoreLinks","restoreImages","getFlatText","$div","innerText","replaceToTag","replaceNbspToSpaces","replaceBlocksToBr","removeNl","removeBrAtEnd","denied","re","$0","except","encodeHtml","encodeEntities","matched","_encodeOuter","_encodePreCodeLine","_decodeMarkers","decodeEntities","encodePhpCode","String","getElementsFromHtml","_storeMatched","_restoreMatched","spaces","floor","exec","parseInt","_parseWordLists","hasAttribute","lines","space","lastLevel","pnt","currentLevel","txt","listTag","$list","stored","outerHTML","encoded","rules","_convertImage","_convertLine","_convertIframe","_convertTable","_convertForm","_convertCode","_convertWidget","_setContenteditableCode","_acceptExtraRules","_unconvertWidget","_unconvertForm","_unconvertTable","_unconvertImages","_removeTypes","lastChild","_isNonEditable","getRandomId","$link","$figure","_setFigure","_wrapFigure","src","isVideo","encodeURI","decodeURI","hasFigcaption","hasStyle","$code","remStart","remEnd","paragraphizeTags","_isConverted","_convert","markupTag","_storeTags","_trimEmptyLines","_restoreTags","replacement","createTextNode","_isDisabled","_isEmptyHtml","userAgent","navigator","isWebkit","isFirefox","isIe","v","documentMode","ie","isIpad","trimmed","newline","_getString","_setComponentOffset","charIndex","nodeStack","foundStart","pop","nextCharIndex","isNewLineStr","nodeValue","_isFigcaptionNext","_extendTags","_isTag","isHeadingTag","$component","getComponentType","isComponentActive","isPre","getPre","isCode","$parent","_getLastOrFirstListItem","isLastListItem","_getLastOrFirstTableCell","isHeading","getHeading","isBlockquote","getBlockquote","isDl","getDl","isParagraph","getParagraph","isLink","getLink","isFile","getFile","hasParent","_getClosestNode","getParentList","_getClosestUpNode","getListItem","getTableCell","$td","getImageElement","_getClosestElement","list","id","_getPos","buildHtml","side","atStart","cloned","setEndBefore","$context","$marker","_restoreInject","activeClass","findSiblings","cell","_find","$caret","_buildCaret","setOnEvent","contextmenu","executeScripts","scripts","$script","head","eval","fragment","isFragment","createFragment","_collapseSelection","_insertFragment","_sendNodes","insertBreakLine","insertNewline","insertText","insertHtml","insertChar","charhtml","insertRaw","insertToEnd","lastNode","$lastNode","$newNode","insertPoint","markerInserted","x","clientX","y","clientY","caretPositionFromPoint","offsetNode","caretRangeFromPoint","insertToPoint","point","insertToOffset","parsedInput","parseHtml","_insertToAllSelected","dataCurrent","_getCleanedInput","isFigure","_isFigure","isComponentSpan","_isComponentSpan","isInsertedText","_insertToEmptyEditor","_insertToWidget","_insertToInline","splitNode","_insertToCode","_insertToPre","_hasBlocksAndImages","_isPlainHtml","_containsTags","_buildList","insertedHtml","dataInserted","normalizeTextNodes","deleteContents","isLastInline","_isLastInline","ucfirst","isPreformatted","_getContainer","createTmpContainer","parentListTag","_hasFigureOrTable","_hasBlocks","_isHtmlString","_prepareTag","_format","_getTags","_wrapInsideTable","clearFormat","replacedTag","_getTextNodesData","_replaceBlocks","_getReplacedTag","nextBr","_getChildTextNodes","_combinePre","_cleanBlocks","_isToggleFormatType","firstNode","count","combinedNodes","$current","$next","headings","_isFormat","arrangeTag","formatCollapsed","formatUncollapsed","replaced","$secondPart","extractedContent","$inline","dataInline","hasSameArgs","insertInline","extractHtmlFromCaret","cloneAttributes","$breaked","$last","same","nodeAttrValue","origRules","styleToObj","innerCount","ruleName","ruleValue","_convertTags","_convertToStrike","execCommand","_clearDecoration","_revertToInlines","_clearEmptyStyle","_normalizeBlocks","_revertTags","_replaceToStrike","_forceRemoveClass","removeFromArrayByValue","textDecoration","textDecorationLine","_clearEmptyStyleAttr","escapeRegExp","$objects","$object","_isKey","reTags","imagesMatches","$video","_formatLinks","_restoreReplaced","enter","_convertToRegExp","$img","setSrc","$cloned","linkProtocol","regexB","substring","decodeURIComponent","observeImages","_addImage","observeFiles","_addFile","setStatus","getChanges","searchInvisibleChars","trimInvisibleChars","n","div","extractContents","createMarkup","exclude","elems","thisArg","newArr","recursive","nestedNodes","getChildElements","_getFirst","_getLast","$replaced","ax","a","elFrom","elTo","rule","extendData","serializedData","_setData","normalize","rgb","s","possible","random","$box","$bar","_is","_destroy","onstart","_startStop","onstop","onenable","ondisable","_buildModes","_buildMarkup","_redefineOptions","_isRootOption","autoparser","onenablefocus","_enableFocus","oncontextmenu","onclick","onkeyup","onenablereadonly","_enableReadOnly","ondisablereadonly","_disableReadOnly","onautoparseobserve","onplaceholder","_buildPlaceholder","_togglePlacehodler","_buildEvents","_buildOptions","_buildAccesibility","classesEditor","_destroyEvents","contenteditable","_disableBrowsersEditing","max-width","margin","aria-labelledby","_enableFocusSource","_enableFocusEditor","setSelectionRange","attachEvent","returnValue","destroy","_getEditables","blurNamespace","eventsList","isFocused","isBlured","blur","$target","targets","stopBlur","cut","_passSelectionToClipboard","drop","originalEvent","stopPropagation","_removeOverClass","$dragComponent","dataTransfer","getData","dragenter","dragstart","_setDragData","dragover","dragleave","detail","pad","pageY","keydown","keyup","mouseup","touchstart","_passAllToClipboard","clipboard","clipboardData","setData","dt","effectAllowed","$label","aria-hidden","syncedHtml","onstartcode","sourceContent","startContent","syncContent","onstartcodeshow","ontrytosync","sync","_buildClasses","sourceSelection","editorHtml","insertMarkersToEditor","editorHeight","_onChangedSource","_onTabKey","_onFocus","setSelectionOffsetSource","_disableButtons","_setActiveSourceButton","insertMarkersToSource","_enableButtons","_setInactiveSourceButton","isOffset","isOffsetEnd","_isSync","timeout","clearTimeout","_syncing","keyCode","selectionStart","selectionEnd","markersOffset","markersOffsetEnd","_getHtmlAndRemoveMarkers","startMarker","endMarker","_strpos","markerStart","markerEnd","markerLength","_enlargeOffset","substr","haystack","needle","htmlLength","c","observerUnit","MutationObserver","subtree","childList","characterData","characterDataOldValue","disconnect","mutations","mutation","onstartclicktoedit","_isEnabled","buttonSave","buttonCancel","_setFocus","objected","enabled","statusbar","oncontextbar","$contextbar","_buildPosition","barWidth","barHeight","docScrollTop","targetOffset","topFix","_buildTitle","_buildMessage","_toggle","toolbarModule","onsource","resetPosition","opened","createSourceHelper","destroySourceHelper","closed","openSelected","onobserve","onfocus","_setExternalOnFocus","onsourcefocus","onempty","_buildButtons","_initToolbar","_initButtons","_buildImageButton","_buildFileButton","_buildSourceButton","_buildAdditionalButtons","_buildHiddenButtons","btns","_removeExistButtons","setExternal","clicks","$airHelper","_isSelection","_open","_openCmd","_isOpened","dataTarget","isModalTarget","isButtonCall","_doOpen","containerOffset","winWidth","toolbarWidth","isDropdownCall","$fixedTarget","reset","_doFixed","isHeight","toolbarHeight","boxOffset","boxEnd","scrollOffset","fixedScrollTimeout","isExternalMultiple","_findToolbars","$toolbars","$external","_buildExternal","_buildFixed","_initExternal","_hideToolbarsExceptFirst","contextbar","_buildWrapper","_buildElement","_initWrapper","data-redactor-type","isCurrentLink","currentText","onmodal","$modal","$form","_setFormData","_setFormFocus","_validateData","_update","_insert","_unlink","onbutton","_observeButton","ondropdown","_observeUnlink","_observeEdit","_getCurrent","$point","_truncateText","_buildCurrent","_getModalData","_getLinks","_resetCurrent","_setLinkData","links","_insertSingle","_removeInSelection","_insertMultiple","$clonedLink","_isCurrentTextChanged","_deleteContents","textContext","isTextChanged","linkData","commands","_isLink","handle","currentLink","setError","getField","reUrl","_get","_get_target","_get_url","_get_title","_get_text","_findDeepestChild","_set_target","_set_text","_set_title","_set_url","_cleanUrl","_isMailto","_isUrl","depth","child","childResult","selectionMarkers","$overlay","resize","setWidth","_buildDefaults","_openUrl","_openTemplate","template","_createModal","_buildModalBox","_buildOverlay","_buildModal","_buildModalForm","_buildModalCommands","_broadcast","_buildModalTabs","_opened","_handleEscape","getBody","_handleEnter","_needToClose","_closed","$modalForm","setHeight","$footer","getFooter","_handleCommand","$tabs","_showTab","getForm","isCloseNode","command","getHeader","$modalHeader","$modalBody","$modalFooter","margin-left","windowHeight","$modalClose","_buildClose","_buildHeader","_buildBody","_buildFooter","_buildTemplate","_getFieldEventName","_clearError","clearformat","clearstyle","clearclass","clearattr","onsynced","_send","_complete","lastShiftKey","onpaste","onkeydown","ctrlKey","metaKey","altKey","_selectAll","isKeys","isXKey","isAlphaKeys","shiftKey","_isArrowKey","_isDeleteKey","_isRightLeftKey","_isExitVariable","_isRightDownKey","_isExitOnDownRight","_selectComponent","_isLeftUpKey","_isExitOnUpLeft","isEndEditor","_exitNextElement","isNext","siblingBlock","_selectComponentItem","_removeActiveComponent","_removeAllSelectedTable","_detectVariableOrNonEditable","_traverseBackspace","_traverseDelete","_removeUnwantedStyles","_removeEmptySpans","_removeSpanTagsInHeadings","_removeInlineTagsInPre","isBlockStart","isBlockEnd","isCurrentStart","isCurrentEnd","isCurrentStartSpace","isCurrentEndSpace","_isVariable","_getBlock","dataNext","isNextBlock","$currentList","$first","$lists","$prev","dataPrev","isPrevBlock","$newnode","_replaceBlock","$block","_isNeedToReplaceBlock","_insertBreak","_isExit","_traverse","_disable","isParagraphExit","_isExitableBlock","isBreaklineExit","_isExitableDblBreak","_exitFromElement","blockTag","_traverseDl","nextDd","nextDt","dd","_clearBlock","_isNeedToCleanBlockStyle","pasteHtml","pointInserted","dropPasted","isRawCode","_isPlainText","files","getAsFile","_insertFiles","_restoreSelection","returned","isImage","isClipboard","worked","hotkeys","8","9","10","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","59","61","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","173","186","187","188","189","190","191","192","219","220","221","222","hotkeysShiftNums","`","1","2","3","4","5","6","7","0","-","=",";","'",",",".","/","\\","_handler","special","character","fromCharCode","modif","cmdKeys","specialKey","_insertHardTab","_tabCode","progress","paramName","_buildInput","_buildBox","$uploadbox","box","_onDropBox","_onDragOver","_onDragLeave","$placeholder","_onChange","_onClick","_onDrop","_clear","_setStatusDrop","_setStatusHover","_removeStatusHover","_setStatusError","_setStatusSuccess","_getUploadParam","_buildData","_sendData","Promise","$pre","_initElement","onform","_remove","imageedit","storage","justResized","oninsert","_observeImages","onstarted","resizer","ondropimage","onbottomclick","onimageresizer","onupload","_uploadError","_change","imagedrop","imagereplace","_setUpload","$image","_save","onimage","resized","_isImage","_createImageAndStore","inserted","_removeSpaceBeforeFigure","img","_removeInvisibleSpace","align","modal","changeImage","$previewBox","_setReplaceUpload","_buildPreview","_buildPreviewUpload","$preview","$previewImg","$desc","_set_src","_set_id","_set_caption","$figcaption","_set_align","imageFloat","imageMargin","textAlign","positions","alignClass","float","text-align","_set_link","_findLink","_get_src","_get_id","_get_caption","_get_align","_get_link","_setResizerPosition","$resizableBox","$resizableImage","$resizer","topOffset","leftOffset","resizerWidth","resizerHeight","resizeHandle","pageX","ratio","h","targetTouches","_start","_move","_stop","_getResizableBoxWidth","ondropfile","filedrop","$file","_createFileAndStore","_insertAsAttachment","wrapAttachment","modalFormData","_truncateUrl","$remover","removeAttachment","$a","state","passed","keyPressed","savedHtml","savedOffset","undoStorage","redoStorage","_listen","onsyncing","onstate","_isUndo","_isRedo","_saveState","_getUndo","_getRedo","_setUndo","ctrl","cmd","_hasUndo","_removeOverStorage","_setRedo","buffer","_hasRedo","_observeDropdown","_getBlocks","_isUnformat","_unformat","$prevChild","$newList","nextItems","nextList","$listItem","$liItem","isTop","isMiddle","isBottom","_getAllNext","_createUnformatContainer","$childList","countLists","_uniteBlocks","_createList","_createListItem","$oldList","lastcell","$cell","_isUniteBlock","selectedItems","_unformatEntire","_getItemsPosition","_unformatAtSide","ci","$secondList","$innerLists","sFirst","sLast","_observeButtonsList","itemOutdent","itemIndent","_observeIndent","isIndent","param","Redactor"],"mappings":"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","file":"redactor.min.js","sourcesContent":["/*\n    Redactor\n    Version 3.1.1\n    Updated: August 12, 2018\n\n    http://imperavi.com/redactor/\n\n    Copyright (c) 2009-2018, Imperavi Ltd.\n    License: http://imperavi.com/redactor/license/\n*/\n(function() {\nvar Ajax = {};\n\nAjax.settings = {};\nAjax.post = function(options) { return new AjaxRequest('post', options); };\nAjax.get = function(options) { return new AjaxRequest('get', options); };\n\nvar AjaxRequest = function(method, options)\n{\n    var defaults = {\n        method: method,\n        url: '',\n        before: function() {},\n        success: function() {},\n        error: function() {},\n        data: false,\n        async: true,\n        headers: {}\n    };\n\n    this.p = this.extend(defaults, options);\n    this.p = this.extend(this.p, Ajax.settings);\n    this.p.method = this.p.method.toUpperCase();\n\n    this.prepareData();\n\n    this.xhr = new XMLHttpRequest();\n    this.xhr.open(this.p.method, this.p.url, this.p.async);\n\n    this.setHeaders();\n\n    var before = (typeof this.p.before === 'function') ? this.p.before(this.xhr) : true;\n    if (before !== false)\n    {\n        this.send();\n    }\n};\n\nAjaxRequest.prototype = {\n    extend: function(obj1, obj2)\n    {\n        if (obj2) for (var name in obj2) { obj1[name] = obj2[name]; }\n        return obj1;\n    },\n    prepareData: function()\n    {\n        if (this.p.method === 'POST' && !this.isFormData()) this.p.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        if (typeof this.p.data === 'object' && !this.isFormData()) this.p.data = this.toParams(this.p.data);\n        if (this.p.method === 'GET') this.p.url = (this.p.data) ? this.p.url + '?' + this.p.data : this.p.url;\n    },\n    setHeaders: function()\n    {\n        this.xhr.setRequestHeader('X-Requested-With', this.p.headers['X-Requested-With'] || 'XMLHttpRequest');\n        for (var name in this.p.headers)\n        {\n            this.xhr.setRequestHeader(name, this.p.headers[name]);\n        }\n    },\n    isFormData: function()\n    {\n        return (typeof window.FormData !== 'undefined' && this.p.data instanceof window.FormData);\n    },\n    isComplete: function()\n    {\n        return !(this.xhr.status < 200 || this.xhr.status >= 300 && this.xhr.status !== 304);\n    },\n    send: function()\n    {\n        if (this.p.async)\n        {\n            this.xhr.onload = this.loaded.bind(this);\n            this.xhr.send(this.p.data);\n        }\n        else\n        {\n            this.xhr.send(this.p.data);\n            this.loaded.call(this);\n        }\n    },\n    loaded: function()\n    {\n        if (this.isComplete())\n        {\n            var response = this.xhr.response;\n            var json = this.parseJson(response);\n            response = (json) ? json : response;\n\n            if (typeof this.p.success === 'function') this.p.success(response, this.xhr);\n        }\n        else\n        {\n            if (typeof this.p.error === 'function') this.p.error(this.xhr.statusText);\n        }\n    },\n    parseJson: function(str)\n    {\n        try {\n            var o = JSON.parse(str);\n            if (o && typeof o === 'object')\n            {\n                return o;\n            }\n\n        } catch (e) {}\n\n        return false;\n    },\n    toParams: function (obj)\n    {\n        return Object.keys(obj).map(\n            function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]); }\n        ).join('&');\n    }\n};\nvar DomCache = [0];\nvar DomExpando = 'data' + new Date();\nvar DomDisplayCache = {};\n\nvar Dom = function(selector, context)\n{\n    return this.parse(selector, context);\n};\n\nDom.ready = function(fn)\n{\n    if (document.readyState != 'loading') fn();\n    else document.addEventListener('DOMContentLoaded', fn);\n};\n\nDom.prototype = {\n    get dom()\n    {\n        return true;\n    },\n    get length()\n    {\n        return this.nodes.length;\n    },\n    parse: function(selector, context)\n    {\n        var nodes;\n        var reHtmlTest = /^\\s*<(\\w+|!)[^>]*>/;\n\n        if (!selector)\n        {\n            nodes = [];\n        }\n        else if (selector.dom)\n        {\n            this.nodes = selector.nodes;\n            return selector;\n        }\n        else if (typeof selector !== 'string')\n        {\n            if (selector.nodeType && selector.nodeType === 11)\n            {\n                nodes = selector.childNodes;\n            }\n            else\n            {\n                nodes = (selector.nodeType || selector === window) ? [selector] : selector;\n            }\n        }\n        else if (reHtmlTest.test(selector))\n        {\n            nodes = this.create(selector);\n        }\n        else\n        {\n            nodes = this._query(selector, context);\n        }\n\n        this.nodes = this._slice(nodes);\n    },\n    create: function(html)\n    {\n        if (/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/.test(html))\n        {\n            return [document.createElement(RegExp.$1)];\n        }\n\n        var elements = [];\n        var container = document.createElement('div');\n        var children = container.childNodes;\n\n        container.innerHTML = html;\n\n        for (var i = 0, l = children.length; i < l; i++)\n        {\n            elements.push(children[i]);\n        }\n\n        return elements;\n    },\n\n    // add\n    add: function(nodes)\n    {\n        this.nodes = this.nodes.concat(this._toArray(nodes));\n    },\n\n    // get\n    get: function(index)\n    {\n        return this.nodes[(index || 0)] || false;\n    },\n    getAll: function()\n    {\n        return this.nodes;\n    },\n    eq: function(index)\n    {\n        return new Dom(this.nodes[index]);\n    },\n    first: function()\n    {\n        return new Dom(this.nodes[0]);\n    },\n    last: function()\n    {\n        return new Dom(this.nodes[this.nodes.length - 1]);\n    },\n    contents: function()\n    {\n        return this.get().childNodes;\n    },\n\n    // loop\n    each: function(callback)\n    {\n        var len = this.nodes.length;\n        for (var i = 0; i < len; i++)\n        {\n            callback.call(this, (this.nodes[i].dom) ? this.nodes[i].get() : this.nodes[i], i);\n        }\n\n        return this;\n    },\n\n    // traversing\n    is: function(selector)\n    {\n        return (this.filter(selector).length > 0);\n    },\n    filter: function (selector)\n    {\n        var callback;\n        if (selector === undefined)\n        {\n            return this;\n        }\n        else if (typeof selector === 'function')\n        {\n            callback = selector;\n        }\n        else\n        {\n            callback = function(node)\n            {\n                if (selector instanceof Node)\n                {\n                    return (selector === node);\n                }\n                else if (selector && selector.dom)\n                {\n                    return ((selector.nodes).indexOf(node) !== -1);\n                }\n                else\n                {\n                    node.matches = node.matches || node.msMatchesSelector || node.webkitMatchesSelector;\n                    return (node.nodeType === 1) ? node.matches(selector || '*') : false;\n                }\n            };\n        }\n\n        return new Dom(this.nodes.filter(callback));\n    },\n    not: function(filter)\n    {\n        return this.filter(function(node)\n        {\n            return !new Dom(node).is(filter || true);\n        });\n    },\n    find: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var ns = this._query(selector || '*', node);\n            for (var i = 0; i < ns.length; i++)\n            {\n                nodes.push(ns[i]);\n            }\n        });\n\n        return new Dom(nodes);\n    },\n    children: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.children)\n            {\n                var ns = node.children;\n                for (var i = 0; i < ns.length; i++)\n                {\n                    nodes.push(ns[i]);\n                }\n            }\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parent: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.parentNode) nodes.push(node.parentNode);\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parents: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        var nodes = [];\n        this.each(function(node)\n        {\n            var parent = node.parentNode;\n            while (parent && parent !== context)\n            {\n                if (selector)\n                {\n                    if (new Dom(parent).is(selector)) { nodes.push(parent); }\n                }\n                else\n                {\n                    nodes.push(parent);\n                }\n\n                parent = parent.parentNode;\n            }\n        });\n\n        return new Dom(nodes);\n    },\n    closest: function(selector, context)\n    {\n        context = this._getContext(context);\n        selector = (selector.dom) ? selector.get() : selector;\n\n        var nodes = [];\n        var isNode = (selector && selector.nodeType);\n        this.each(function(node)\n        {\n            do {\n                if ((isNode && node === selector) || new Dom(node).is(selector)) return nodes.push(node);\n            } while ((node = node.parentNode) && node !== context);\n        });\n\n        return new Dom(nodes);\n    },\n    next: function(selector)\n    {\n         return this._getSibling(selector, 'nextSibling');\n    },\n    nextElement: function(selector)\n    {\n        return this._getSibling(selector, 'nextElementSibling');\n    },\n    prev: function(selector)\n    {\n        return this._getSibling(selector, 'previousSibling');\n    },\n    prevElement: function(selector)\n    {\n        return this._getSibling(selector, 'previousElementSibling');\n    },\n\n    // css\n    css: function(name, value)\n    {\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            var node = this.get();\n            if (name === 'width' || name === 'height')\n            {\n                return (node.style) ? this._getHeightOrWidth(name, node, false) + 'px' : undefined;\n            }\n            else\n            {\n                return (node.style) ? getComputedStyle(node, null)[name] : undefined;\n            }\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.style) node.style[key] = obj[key];\n            }\n        });\n    },\n\n    // attr\n    attr: function(name, value, data)\n    {\n        data = (data) ? 'data-' : '';\n\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            var node = this.get();\n            if (node && node.nodeType !== 3)\n            {\n                return (name === 'checked') ? node.checked : this._getBooleanFromStr(node.getAttribute(data + name));\n            }\n            else return;\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.nodeType !== 3)\n                {\n                    if (key === 'checked') node.checked = obj[key];\n                    else node.setAttribute(data + key, obj[key]);\n                }\n            }\n        });\n    },\n    data: function(name, value)\n    {\n        if (name === undefined)\n        {\n            var reDataAttr = /^data\\-(.+)$/;\n            var attrs = this.get().attributes;\n\n            var data = {};\n            var replacer = function (g) { return g[1].toUpperCase(); };\n\n            for (var key in attrs)\n            {\n                if (reDataAttr.test(attrs[key].nodeName))\n                {\n                    var dataName = attrs[key].nodeName.match(reDataAttr)[1];\n                    var val = attrs[key].value;\n                    dataName = dataName.replace(/-([a-z])/g, replacer);\n\n                    if (this._isObjectString(val)) val = this._toObject(val);\n                    else val = (this._isNumber(val)) ? parseFloat(val) : this._getBooleanFromStr(val);\n\n                    data[dataName] = val;\n                }\n            }\n\n            return data;\n        }\n\n        return this.attr(name, value, true);\n    },\n    val: function(value)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.type && el.type === 'checkbox') return el.checked;\n            else return el.value;\n        }\n\n        return this.each(function(node)\n        {\n            node.value = value;\n        });\n    },\n    removeAttr: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmAttr = function(name) { if (node.nodeType !== 3) node.removeAttribute(name); };\n            value.split(' ').forEach(rmAttr);\n        });\n    },\n    removeData: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmData = function(name) { if (node.nodeType !== 3) node.removeAttribute('data-' + name); };\n            value.split(' ').forEach(rmData);\n        });\n    },\n\n    // dataset/dataget\n    dataset: function(key, value)\n    {\n        return this.each(function(node)\n        {\n            DomCache[this.dataindex(node)][key] = value;\n        });\n    },\n    dataget: function(key)\n    {\n        return DomCache[this.dataindex(this.get())][key];\n    },\n    dataindex: function(el)\n    {\n        var cacheIndex = el[DomExpando];\n        var nextCacheIndex = DomCache.length;\n\n        if (!cacheIndex)\n        {\n            cacheIndex = el[DomExpando] = nextCacheIndex;\n            DomCache[cacheIndex] = {};\n        }\n\n        return cacheIndex;\n    },\n\n    // class\n    addClass: function(value)\n    {\n        return this._eachClass(value, 'add');\n    },\n    removeClass: function(value)\n    {\n        return this._eachClass(value, 'remove');\n    },\n    toggleClass: function(value)\n    {\n        return this._eachClass(value, 'toggle');\n    },\n    hasClass: function(value)\n    {\n        return this.nodes.some(function(node)\n        {\n            return (node.classList) ? node.classList.contains(value) : false;\n        });\n    },\n\n    // html & text\n    empty: function()\n    {\n        return this.each(function(node)\n        {\n            node.innerHTML = '';\n        });\n    },\n    html: function(html)\n    {\n        return (html === undefined) ? (this.get().innerHTML || '') : this.empty().append(html);\n    },\n    text: function(text)\n    {\n        return (text === undefined) ? (this.get().textContent || '') : this.each(function(node) { node.textContent = text; });\n    },\n\n    // manipulation\n    after: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('afterend', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag).reverse();\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.parentNode.insertBefore(elms[i], node.nextSibling);\n                }\n            }\n\n            return node;\n\n        });\n    },\n    before: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('beforebegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.parentNode.insertBefore(elms[i], node);\n                }\n            }\n\n            return node;\n        });\n    },\n    append: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string' || typeof frag === 'number')\n            {\n                node.insertAdjacentHTML('beforeend', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.appendChild(elms[i]);\n                }\n            }\n\n            return node;\n        });\n    },\n    prepend: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string' || typeof frag === 'number')\n            {\n                node.insertAdjacentHTML('afterbegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag).reverse();\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.insertBefore(elms[i], node.firstChild);\n                }\n            }\n\n            return node;\n        });\n    },\n    wrap: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var wrapper = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag)[0] : (frag instanceof Node) ? frag : this._toArray(frag)[0];\n\n            if (node.parentNode)\n            {\n                node.parentNode.insertBefore(wrapper, node);\n            }\n\n            wrapper.appendChild(node);\n\n            return new Dom(wrapper);\n\n        });\n    },\n    unwrap: function()\n    {\n        return this.each(function(node)\n        {\n            var $node = new Dom(node);\n\n            return $node.replaceWith($node.contents());\n        });\n    },\n    replaceWith: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var docFrag = document.createDocumentFragment();\n            var elms = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag) : (frag instanceof Node) ? [frag] : this._toArray(frag);\n\n            for (var i = 0; i < elms.length; i++)\n            {\n                docFrag.appendChild(elms[i]);\n            }\n\n            var result = docFrag.childNodes[0];\n            node.parentNode.replaceChild(docFrag, node);\n\n            return result;\n\n        });\n    },\n    remove: function()\n    {\n        return this.each(function(node)\n        {\n            if (node.parentNode) node.parentNode.removeChild(node);\n        });\n    },\n    clone: function(events)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var copy = this._clone(node);\n            if (events) copy = this._cloneEvents(node, copy);\n            nodes.push(copy);\n        });\n\n        return new Dom(nodes);\n    },\n\n    // show/hide\n    show: function()\n    {\n        return this.each(function(node)\n        {\n            if (node.style)\n            {\n                if (this._getRealDisplay(node) !== 'none') return;\n\n                var old = node.getAttribute('displayOld');\n                node.style.display = old || '';\n\n                if (this._getRealDisplay(node) === 'none')\n                {\n                    var nodeName = node.nodeName, body = document.body, display;\n\n                    if (DomDisplayCache[nodeName])\n                    {\n                        display = DomDisplayCache[nodeName];\n                    }\n                    else\n                    {\n                        var testElem = document.createElement(nodeName);\n                        body.appendChild(testElem);\n                        display = this._getRealDisplay(testElem);\n\n                        if (display === 'none') display = 'block';\n\n                        body.removeChild(testElem);\n                        DomDisplayCache[nodeName] = display;\n                    }\n\n                    node.setAttribute('displayOld', display);\n                    node.style.display = display;\n                }\n            }\n        }.bind(this));\n    },\n    hide: function()\n    {\n        return this.each(function(node)\n        {\n            if (node.style)\n            {\n                if (!node.getAttribute('displayOld') && node.style.display !== '')\n                {\n                    node.setAttribute(\"displayOld\", node.style.display);\n                }\n\n                node.style.display = 'none';\n            }\n        });\n    },\n\n    // dimensions\n    scrollTop: function(value)\n    {\n        var node = this.get();\n        var isWindow = (node === window);\n        var isDocument = (node.nodeType === 9);\n        var el = (isDocument) ? (document.scrollingElement || document.body.parentNode || document.body || document.documentElement) : node;\n\n        if (value !== undefined)\n        {\n            if (isWindow) window.scrollTo(0, value);\n            else el.scrollTop = value;\n            return;\n        }\n\n        if (isDocument)\n        {\n            return (typeof window.pageYOffset != 'undefined') ? window.pageYOffset : ((document.documentElement.scrollTop) ? document.documentElement.scrollTop : ((document.body.scrollTop) ? document.body.scrollTop : 0));\n        }\n        else\n        {\n            return (isWindow) ? window.pageYOffset : el.scrollTop;\n        }\n    },\n    offset: function()\n    {\n        return this._getDim('Offset');\n    },\n    position: function()\n    {\n        return this._getDim('Position');\n    },\n    width: function(value, adjust)\n    {\n        return this._getSize('width', 'Width', value, adjust);\n    },\n    height: function(value, adjust)\n    {\n        return this._getSize('height', 'Height', value, adjust);\n    },\n    outerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'outer');\n    },\n    outerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'outer');\n    },\n    innerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'inner');\n    },\n    innerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'inner');\n    },\n\n    // events\n    click: function()\n    {\n        return this._triggerEvent('click');\n    },\n    focus: function()\n    {\n        return this._triggerEvent('focus');\n    },\n    trigger: function(names)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var ev;\n                var opts = { bubbles: true, cancelable: true };\n\n                try {\n                    ev = new window.CustomEvent(events[i], opts);\n                } catch(e) {\n                    ev = document.createEvent('CustomEvent');\n                    ev.initCustomEvent(events[i], true, true);\n                }\n\n                node.dispatchEvent(ev);\n            }\n        });\n    },\n    on: function(names, handler, one)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                handler = (one) ? this._getOneHandler(handler, names) : handler;\n                node.addEventListener(event, handler);\n\n                node._e = node._e || {};\n                node._e[namespace] = node._e[namespace] || {};\n                node._e[namespace][event] = node._e[namespace][event] || [];\n                node._e[namespace][event].push(handler);\n            }\n\n        });\n    },\n    one: function(events, handler)\n    {\n        return this.on(events, handler, true);\n    },\n    off: function(names, handler)\n    {\n        var testEvent = function(name, key, event) { return (name === event); };\n        var testNamespace = function(name, key, event, namespace) { return (key === namespace); };\n        var testEventNamespace = function(name, key, event, namespace) { return (name === event && key === namespace); };\n        var testPositive = function() { return true; };\n\n        if (names === undefined)\n        {\n            // ALL\n            return this.each(function(node)\n            {\n                this._offEvent(node, false, false, handler, testPositive);\n            });\n        }\n\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                // 1) event without namespace\n                if (namespace === '_events') this._offEvent(node, event, namespace, handler, testEvent);\n                // 2) only namespace\n                else if (!event && namespace !== '_events') this._offEvent(node, event, namespace, handler, testNamespace);\n                // 3) event + namespace\n                else this._offEvent(node, event, namespace, handler, testEventNamespace);\n            }\n        });\n    },\n\n    // form\n    serialize: function(asObject)\n    {\n        var obj = {};\n        var elms = this.get().elements;\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = elms[i];\n            if (/(checkbox|radio)/.test(el.type) && !el.checked) continue;\n            if (!el.name || el.disabled || el.type === 'file') continue;\n\n            if (el.type === 'select-multiple')\n            {\n                for (var z = 0; z < el.options.length; z++)\n                {\n                    var opt = el.options[z];\n                    if (opt.selected) obj[el.name] = opt.value;\n                }\n            }\n\n            obj[el.name] = el.value;\n        }\n\n        return (asObject) ? obj : this._toParams(obj);\n    },\n    ajax: function(success, error)\n    {\n        if (typeof AjaxRequest !== 'undefined')\n        {\n            var method = this.attr('method') || 'post';\n            var options = {\n                url: this.attr('action'),\n                data: this.serialize(),\n                success: success,\n                error: error\n            };\n\n            return new AjaxRequest(method, options);\n        }\n    },\n\n    // private\n    _queryContext: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        return (context.nodeType !== 3 && typeof context.querySelectorAll === 'function') ? context.querySelectorAll(selector) : [];\n    },\n    _query: function(selector, context)\n    {\n        if (context)\n        {\n            return this._queryContext(selector, context);\n        }\n        else if (/^[.#]?[\\w-]*$/.test(selector))\n        {\n            if (selector[0] === '#')\n            {\n                var element = document.getElementById(selector.slice(1));\n                return element ? [element] : [];\n            }\n\n            if (selector[0] === '.')\n            {\n                return document.getElementsByClassName(selector.slice(1));\n            }\n\n            return document.getElementsByTagName(selector);\n        }\n\n        return document.querySelectorAll(selector);\n    },\n    _getContext: function(context)\n    {\n        context = (typeof context === 'string') ? document.querySelector(context) : context;\n\n        return (context && context.dom) ? context.get() : (context || document);\n    },\n    _inject: function(html, fn)\n    {\n        var len = this.nodes.length;\n        var nodes = [];\n        while (len--)\n        {\n            var res = (typeof html === 'function') ? html.call(this, this.nodes[len]) : html;\n            var el = (len === 0) ? res : this._clone(res);\n            var node = fn.call(this, el, this.nodes[len]);\n\n            if (node)\n            {\n                if (node.dom) nodes.push(node.get());\n                else nodes.push(node);\n            }\n        }\n\n        return new Dom(nodes);\n    },\n    _cloneEvents: function(node, copy)\n    {\n        var events = node._e;\n        if (events)\n        {\n            copy._e = events;\n            for (var name in events._events)\n            {\n                for (var i = 0; i < events._events[name].length; i++)\n                {\n                    copy.addEventListener(name, events._events[name][i]);\n                }\n            }\n        }\n\n        return copy;\n    },\n    _clone: function(node)\n    {\n        if (typeof node === 'undefined') return;\n        if (typeof node === 'string') return node;\n        else if (node instanceof Node) return node.cloneNode(true);\n        else if ('length' in node)\n        {\n            return [].map.call(this._toArray(node), function(el) { return el.cloneNode(true); });\n        }\n\n        return node;\n    },\n    _slice: function(obj)\n    {\n        return (!obj || obj.length === 0) ? [] : (obj.length) ? [].slice.call(obj.nodes || obj) : [obj];\n    },\n    _eachClass: function(value, type)\n    {\n        return this.each(function(node)\n        {\n            if (value)\n            {\n                var setClass = function(name) { if (node.classList) node.classList[type](name); };\n                value.split(' ').forEach(setClass);\n            }\n        });\n    },\n    _triggerEvent: function(name)\n    {\n        var node = this.get();\n        if (node && node.nodeType !== 3) node[name]();\n        return this;\n    },\n    _getOneHandler: function(handler, events)\n    {\n        var self = this;\n        return function()\n        {\n            handler.apply(this, arguments);\n            self.off(events);\n        };\n    },\n    _getEventNamespace: function(event)\n    {\n        var arr = event.split('.');\n        var namespace = (arr[1]) ? arr[1] : '_events';\n        return (arr[2]) ? namespace + arr[2] : namespace;\n    },\n    _getEventName: function(event)\n    {\n        return event.split('.')[0];\n    },\n    _offEvent: function(node, event, namespace, handler, condition)\n    {\n        for (var key in node._e)\n        {\n            for (var name in node._e[key])\n            {\n                if (condition(name, key, event, namespace))\n                {\n                    var handlers = node._e[key][name];\n                    for (var i = 0; i < handlers.length; i++)\n                    {\n                        if (typeof handler !== 'undefined' && handlers[i].toString() !== handler.toString())\n                        {\n                            continue;\n                        }\n\n                        node.removeEventListener(name, handlers[i]);\n                        node._e[key][name].splice(i, 1);\n\n                        if (node._e[key][name].length === 0) delete node._e[key][name];\n                        if (Object.keys(node._e[key]).length === 0) delete node._e[key];\n                    }\n                }\n            }\n        }\n    },\n    _getInnerOrOuter: function(method, type)\n    {\n        return this[method](undefined, type);\n    },\n    _getDocSize: function(node, type)\n    {\n        var body = node.body, html = node.documentElement;\n        return Math.max(body['scroll' + type], body['offset' + type], html['client' + type], html['scroll' + type], html['offset' + type]);\n    },\n    _getSize: function(type, captype, value, adjust)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.nodeType === 3)      value = 0;\n            else if (el.nodeType === 9) value = this._getDocSize(el, captype);\n            else if (el === window)     value = window['inner' + captype];\n            else                        value = this._getHeightOrWidth(type, el, adjust || 'normal');\n\n            return Math.round(value);\n        }\n\n        return this.each(function(node)\n        {\n            value = parseFloat(value);\n            value = value + this._adjustResultHeightOrWidth(type, node, adjust || 'normal');\n\n            new Dom(node).css(type, value + 'px');\n\n        }.bind(this));\n    },\n    _getHeightOrWidth: function(type, el, adjust)\n    {\n        var name = type.charAt(0).toUpperCase() + type.slice(1);\n        var style = getComputedStyle(el, null);\n        var $el = new Dom(el);\n        var result = 0;\n        var $targets = $el.parents().filter(function(node)\n        {\n            return (getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        if (style.display === 'none') $targets.add(el);\n        if ($targets.length !== 0)\n        {\n            var fixStyle = 'visibility: hidden !important; display: block !important;';\n            var tmp = [];\n\n            $targets.each(function(node)\n            {\n                var $node = new Dom(node);\n                var thisStyle = $node.attr('style');\n                if (thisStyle !== null) tmp.push(thisStyle);\n                $node.attr('style', (thisStyle !== null) ? thisStyle + ';' + fixStyle : fixStyle);\n            });\n\n            result = $el.get()['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n\n            $targets.each(function(node, i)\n            {\n                var $node = new Dom(node);\n                if (tmp[i] === undefined) $node.removeAttr('style');\n                else $node.attr('style', tmp[i]);\n            });\n        }\n        else\n        {\n            result = el['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n        }\n\n        return result;\n    },\n    _adjustResultHeightOrWidth: function(type, el, adjust)\n    {\n        if (!el || adjust === false) return 0;\n\n        var fix = 0;\n        var style = getComputedStyle(el, null);\n        var isBorderBox = (style.boxSizing === \"border-box\");\n\n        if (type === 'height')\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderTopWidth) || 0) + (parseFloat(style.borderBottomWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginTop) || 0) + (parseFloat(style.marginBottom) || 0);\n        }\n        else\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderLeftWidth) || 0) + (parseFloat(style.borderRightWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginLeft) || 0) + (parseFloat(style.marginRight) || 0);\n        }\n\n        return fix;\n    },\n    _getDim: function(type)\n    {\n        var node = this.get();\n        return (node.nodeType === 3) ? { top: 0, left: 0 } : this['_get' + type](node);\n    },\n    _getPosition: function(node)\n    {\n        return { top: node.offsetTop, left: node.offsetLeft };\n    },\n    _getOffset: function(node)\n    {\n        var rect = node.getBoundingClientRect();\n        var doc = node.ownerDocument;\n\t\tvar docElem = doc.documentElement;\n\t\tvar win = doc.defaultView;\n\n\t\treturn {\n\t\t\ttop: rect.top + win.pageYOffset - docElem.clientTop,\n\t\t\tleft: rect.left + win.pageXOffset - docElem.clientLeft\n\t\t};\n    },\n    _getSibling: function(selector, method)\n    {\n        selector = (selector && selector.dom) ? selector.get() : selector;\n\n        var isNode = (selector && selector.nodeType);\n        var sibling;\n\n        this.each(function(node)\n        {\n            while (node = node[method])\n            {\n                if ((isNode && node === selector) || new Dom(node).is(selector))\n                {\n                    sibling = node;\n                    return;\n                }\n            }\n        });\n\n        return new Dom(sibling);\n    },\n    _toArray: function(obj)\n    {\n        if (obj instanceof NodeList)\n        {\n            var arr = [];\n            for (var i = 0; i < obj.length; i++)\n            {\n                arr[i] = obj[i];\n            }\n\n            return arr;\n        }\n        else if (obj === undefined) return [];\n        else\n        {\n            return (obj.dom) ? obj.nodes : obj;\n        }\n    },\n    _toParams: function(obj)\n    {\n        var params = '';\n        for (var key in obj)\n        {\n            params += '&' + this._encodeUri(key) + '=' + this._encodeUri(obj[key]);\n        }\n\n        return params.replace(/^&/, '');\n    },\n    _toObject: function(str)\n    {\n        return (new Function(\"return \" + str))();\n    },\n    _encodeUri: function(str)\n    {\n        return encodeURIComponent(str).replace(/!/g, '%21').replace(/'/g, '%27').replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/\\*/g, '%2A').replace(/%20/g, '+');\n    },\n    _isNumber: function(str)\n    {\n        return !isNaN(str) && !isNaN(parseFloat(str));\n    },\n    _isObjectString: function(str)\n    {\n        return (str.search(/^{/) !== -1);\n    },\n    _getBooleanFromStr: function(str)\n    {\n        if (str === 'true') return true;\n        else if (str === 'false') return false;\n\n        return str;\n    },\n    _getRealDisplay: function(elem)\n    {\n        if (elem.currentStyle) return elem.currentStyle.display;\n        else if (window.getComputedStyle)\n        {\n            var computedStyle = window.getComputedStyle(elem, null);\n            return computedStyle.getPropertyValue('display');\n        }\n    }\n};\n// Unique ID\nvar uuid = 0;\n\n// Wrapper\nvar $R = function(selector, options)\n{\n    return RedactorApp(selector, options, [].slice.call(arguments, 2));\n};\n\n// Globals\n$R.version = '3.1.1';\n$R.options = {};\n$R.modules = {};\n$R.services = {};\n$R.classes = {};\n$R.plugins = {};\n$R.mixins = {};\n$R.modals = {};\n$R.lang = {};\n$R.dom = function(selector, context) { return new Dom(selector, context); };\n$R.ajax = Ajax;\n$R.Dom = Dom;\n$R.keycodes = {\n\tBACKSPACE: 8,\n\tDELETE: 46,\n\tUP: 38,\n\tDOWN: 40,\n\tENTER: 13,\n\tSPACE: 32,\n\tESC: 27,\n\tTAB: 9,\n\tCTRL: 17,\n\tMETA: 91,\n\tSHIFT: 16,\n\tALT: 18,\n\tRIGHT: 39,\n\tLEFT: 37\n};\n$R.env = {\n    'plugin': 'plugins',\n    'module': 'modules',\n    'service': 'services',\n    'class': 'classes',\n    'mixin': 'mixins'\n};\n\n// jQuery Wrapper\n/*eslint-env jquery*/\nif (typeof jQuery !== 'undefined')\n{\n    (function($) { $.fn.redactor = function(options) { return RedactorApp(this.toArray(), options, [].slice.call(arguments, 1)); }; })(jQuery);\n}\n\n// Class\nvar RedactorApp = function(selector, options, args)\n{\n    var namespace = 'redactor';\n    var nodes = (Array.isArray(selector)) ? selector : (selector && selector.nodeType) ? [selector] : document.querySelectorAll(selector);\n    var isApi = (typeof options === 'string' || typeof options === 'function');\n    var value = [];\n    var instance;\n\n    for (var i = 0; i < nodes.length; i++)\n    {\n        var el = nodes[i];\n        var $el = $R.dom(el);\n\n        instance = $el.dataget(namespace);\n        if (!instance && !isApi)\n        {\n            // Initialization\n            $el.dataset(namespace, (instance = new App(el, options, uuid)));\n            uuid++;\n        }\n\n        // API\n        if (instance && isApi)\n        {\n            var isDestroy = (options === 'destroy');\n            options = (isDestroy) ? 'stop' : options;\n\n            var methodValue;\n            if (typeof options === 'function')\n            {\n                methodValue = options.apply(instance, args);\n            }\n            else\n            {\n                args.unshift(options);\n                methodValue = instance.api.apply(instance, args);\n            }\n            if (methodValue !== undefined) value.push(methodValue);\n\n            if (isDestroy) $el.dataset(namespace, false);\n        }\n    }\n\n    return (value.length === 0 || value.length === 1) ? ((value.length === 0) ? instance : value[0]) : value;\n};\n\n// add\n$R.add = function(type, name, obj)\n{\n    if (typeof $R.env[type] === 'undefined') return;\n\n    // translations\n    if (obj.translations)\n    {\n        $R.lang = $R.extend(true, {}, $R.lang, obj.translations);\n    }\n\n    // modals\n    if (obj.modals)\n    {\n        $R.modals = $R.extend(true, {}, $R.modals, obj.modals);\n    }\n\n    // mixin\n    if (type === 'mixin')\n    {\n        $R[$R.env[type]][name] = obj;\n    }\n    else\n    {\n        // prototype\n        var F = function() {};\n        F.prototype = obj;\n\n        // mixins\n        if (obj.mixins)\n        {\n            for (var i = 0; i < obj.mixins.length; i++)\n            {\n                $R.inherit(F, $R.mixins[obj.mixins[i]]);\n            }\n        }\n\n        $R[$R.env[type]][name] = F;\n    }\n};\n\n// add lang\n$R.addLang = function(lang, obj)\n{\n    if (typeof $R.lang[lang] === 'undefined')\n    {\n        $R.lang[lang] = {};\n    }\n\n    $R.lang[lang] = $R.extend($R.lang[lang], obj);\n};\n\n// create\n$R.create = function(name)\n{\n    var arr = name.split('.');\n    var args = [].slice.call(arguments, 1);\n\n    var type = 'classes';\n    if (typeof $R.env[arr[0]] !== 'undefined')\n    {\n        type = $R.env[arr[0]];\n        name = arr.slice(1).join('.');\n    }\n\n    // construct\n    var instance = new $R[type][name]();\n\n    // init\n    if (instance.init)\n    {\n        var res = instance.init.apply(instance, args);\n\n        return (res) ? res : instance;\n    }\n\n    return instance;\n};\n\n// inherit\n$R.inherit = function(current, parent)\n{\n    var F = function () {};\n    F.prototype = parent;\n    var f = new F();\n\n    for (var prop in current.prototype)\n    {\n        if (current.prototype.__lookupGetter__(prop)) f.__defineGetter__(prop, current.prototype.__lookupGetter__(prop));\n        else f[prop] = current.prototype[prop];\n    }\n\n    current.prototype = f;\n    current.prototype.super = parent;\n\n    return current;\n};\n\n// error\n$R.error = function(exception)\n{\n    throw exception;\n};\n\n// extend\n$R.extend = function()\n{\n    var extended = {};\n    var deep = false;\n    var i = 0;\n    var length = arguments.length;\n\n    if (Object.prototype.toString.call( arguments[0] ) === '[object Boolean]')\n    {\n        deep = arguments[0];\n        i++;\n    }\n\n    var merge = function(obj)\n    {\n        for (var prop in obj)\n        {\n            if (Object.prototype.hasOwnProperty.call(obj, prop))\n            {\n                if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') extended[prop] = $R.extend(true, extended[prop], obj[prop]);\n                else extended[prop] = obj[prop];\n            }\n        }\n    };\n\n    for (; i < length; i++ )\n    {\n        var obj = arguments[i];\n        merge(obj);\n    }\n\n    return extended;\n};\n$R.opts = {\n    animation: true,\n    lang: 'en',\n    direction: 'ltr',\n    spellcheck: true,\n    structure: false,\n    scrollTarget: false,\n    styles: true,\n    stylesClass: 'redactor-styles',\n    placeholder: false,\n\n    source: true,\n    showSource: false,\n\n    inline: false,\n\n    breakline: false,\n    markup: 'p',\n    enterKey: true,\n\n    clickToEdit: false,\n    clickToSave: false,\n    clickToCancel: false,\n\n    focus: false,\n    focusEnd: false,\n\n    minHeight: false, // string, '100px'\n    maxHeight: false, // string, '100px'\n    maxWidth: false, // string, '700px'\n\n    plugins: [], // array\n    callbacks: {},\n\n    // pre & tab\n    preClass: false, // string\n    preSpaces: 4, // or false\n    tabindex: false, // int\n    tabAsSpaces: false, // true or number of spaces\n    tabKey: true,\n\n    // autosave\n    autosave: false, // false or url\n    autosaveName: false,\n    autosaveData: false,\n\n    // toolbar\n    toolbar: true,\n    toolbarFixed: true,\n    toolbarFixedTarget: document,\n    toolbarFixedTopOffset: 0, // pixels\n    toolbarExternal: false, // ID selector\n    toolbarContext: true,\n\n    // air\n    air: false,\n\n    // formatting\n    formatting: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n    formattingAdd: false,\n    formattingHide: false,\n\n    // buttons\n    buttons: ['html', 'format', 'bold', 'italic', 'deleted', 'lists', 'image', 'file', 'link'],\n    // + 'line', 'redo', 'undo', 'underline', 'ol', 'ul', 'indent', 'outdent'\n    buttonsTextLabeled: false,\n    buttonsAdd: [],\n    buttonsAddFirst: [],\n    buttonsAddAfter: false,\n    buttonsAddBefore: false,\n    buttonsHide: [],\n    buttonsHideOnMobile: [],\n\n    // image\n    imageUpload: false,\n    imageUploadParam: 'file',\n    imageData: false,\n    imageEditable: true,\n    imageCaption: true,\n    imagePosition: false,\n    imageResizable: false,\n    imageFloatMargin: '10px',\n    imageFigure: true,\n\n    // file\n    fileUpload: false,\n    fileUploadParam: 'file',\n    fileData: false,\n    fileAttachment: false,\n\n    // upload opts\n    uploadData: false,\n    dragUpload: true,\n    multipleUpload: true,\n    clipboardUpload: true,\n    uploadBase64: false,\n\n    // link\n    linkTarget: false,\n    linkTitle: false,\n    linkNewTab: false,\n    linkNofollow: false,\n    linkSize: 30,\n    linkValidation: true,\n\n    // clean\n    cleanOnEnter: true,\n    cleanInlineOnEnter: false,\n    paragraphize: true,\n    removeScript: true,\n    removeNewLines: false,\n    removeComments: true,\n    replaceTags: {\n        'b': 'strong',\n        'i': 'em',\n        'strike': 'del'\n    },\n\n    // paste\n    pastePlainText: false,\n    pasteLinkTarget: false,\n    pasteImages: true,\n    pasteLinks: true,\n    pasteClean: true,\n    pasteKeepStyle: [],\n    pasteKeepClass: [],\n    pasteKeepAttrs: ['td', 'th'],\n    pasteBlockTags: ['pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'ul', 'ol', 'li', 'blockquote', 'p', 'figure', 'figcaption'],\n    pasteInlineTags: ['a', 'img', 'br', 'strong', 'ins', 'code', 'del', 'span', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'b', 'u', 'em', 'i', 'abbr'],\n\n    // active buttons\n    activeButtons: {\n        b: 'bold',\n        strong: 'bold',\n        i: 'italic',\n        em: 'italic',\n        del: 'deleted',\n        strike: 'deleted',\n        u: 'underline'\n    },\n    activeButtonsAdd: {},\n    activeButtonsObservers: {},\n\n    // autoparser\n    autoparse: true,\n    autoparseStart: true,\n    autoparsePaste: true,\n    autoparseLinks: true,\n    autoparseImages: true,\n    autoparseVideo: true,\n\n    // shortcodes\n    shortcodes: {\n        'p.': { format: 'p' },\n        'quote.': { format: 'blockquote' },\n        'pre.': { format: 'pre' },\n        'h1.': { format: 'h1' },\n        'h2.': { format: 'h2' },\n        'h3.': { format: 'h3' },\n        'h4.': { format: 'h4' },\n        'h5.': { format: 'h5' },\n        'h6.': { format: 'h6' },\n        '1.': { format: 'ol' },\n        '*.': { format: 'ul' }\n    },\n    shortcodesAdd: false, // object\n\n    // shortcuts\n    shortcuts: {\n        'ctrl+shift+m, meta+shift+m': { api: 'module.inline.clearformat' },\n        'ctrl+b, meta+b': { api: 'module.inline.format', args: 'b' },\n        'ctrl+i, meta+i': { api: 'module.inline.format', args: 'i' },\n        'ctrl+u, meta+u': { api: 'module.inline.format', args: 'u' },\n        'ctrl+h, meta+h': { api: 'module.inline.format', args: 'sup' },\n        'ctrl+l, meta+l': { api: 'module.inline.format', args: 'sub' },\n        'ctrl+k, meta+k': { api: 'module.link.open' },\n        'ctrl+alt+0, meta+alt+0': { api: 'module.block.format', args: 'p' },\n        'ctrl+alt+1, meta+alt+1': { api: 'module.block.format', args: 'h1' },\n        'ctrl+alt+2, meta+alt+2': { api: 'module.block.format', args: 'h2' },\n        'ctrl+alt+3, meta+alt+3': { api: 'module.block.format', args: 'h3' },\n        'ctrl+alt+4, meta+alt+4': { api: 'module.block.format', args: 'h4' },\n        'ctrl+alt+5, meta+alt+5': { api: 'module.block.format', args: 'h5' },\n        'ctrl+alt+6, meta+alt+6': { api: 'module.block.format', args: 'h6' },\n        'ctrl+shift+7, meta+shift+7': { api: 'module.list.toggle', args: 'ol' },\n        'ctrl+shift+8, meta+shift+8': { api: 'module.list.toggle', args: 'ul' }\n    },\n    shortcutsAdd: false, // object\n\n    // misc\n    grammarly: true,\n\n    // private\n    bufferLimit: 100,\n    emptyHtml: '<p></p>',\n    markerChar: '\\ufeff',\n    imageTypes: ['image/png', 'image/jpeg', 'image/gif'],\n    inlineTags: ['a', 'span', 'strong', 'strike', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'abbr'],\n    blockTags: ['pre', 'ul', 'ol', 'li', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',  'dl', 'dt', 'dd', 'div', 'table', 'tbody', 'thead', 'tfoot', 'tr', 'th', 'td', 'blockquote', 'output', 'figcaption', 'figure', 'address', 'section', 'header', 'footer', 'aside', 'article', 'iframe'],\n    regex: {\n        youtube: /https?:\\/\\/(?:[0-9A-Z-]+\\.)?(?:youtu\\.be\\/|youtube\\.com\\S*[^\\w\\-\\s])([\\w\\-]{11})(?=[^\\w\\-]|$)(?![?=&+%\\w.-]*(?:['\"][^<>]*>|<\\/a>))[?=&+%\\w.-]*/gi,\n        vimeo: /(http|https)?:\\/\\/(?:www.|player.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/(?:[^\\/]*)\\/videos\\/|album\\/(?:\\d+)\\/video\\/|video\\/|)(\\d+)(?:[a-zA-Z0-9_-]+)?/gi,\n        imageurl: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/gi,\n        url: /(https?:\\/\\/(?:www\\.|(?!www))[^\\s\\.]+\\.[^\\s]{2,}|www\\.[^\\s]+\\.[^\\s]{2,})/gi\n    },\n    input: true,\n    zindex: false,\n    modes: {\n        \"inline\": {\n            pastePlainText: true,\n            pasteImages: false,\n            enterKey: false,\n            toolbar: false,\n            autoparse: false,\n            source: false,\n            showSource: false,\n            styles: false,\n            air: false\n        },\n        \"original\": {\n            styles: false\n        }\n    }\n};\n$R.lang['en'] = {\n    \"format\": \"Format\",\n    \"image\": \"Image\",\n    \"file\": \"File\",\n    \"link\": \"Link\",\n    \"bold\": \"Bold\",\n    \"italic\": \"Italic\",\n    \"deleted\": \"Strikethrough\",\n    \"underline\": \"Underline\",\n    \"superscript\": \"Superscript\",\n    \"subscript\": \"Subscript\",\n    \"bold-abbr\": \"B\",\n    \"italic-abbr\": \"I\",\n    \"deleted-abbr\": \"S\",\n    \"underline-abbr\": \"U\",\n    \"superscript-abbr\": \"Sup\",\n    \"subscript-abbr\": \"Sub\",\n    \"lists\": \"Lists\",\n    \"link-insert\": \"Insert Link\",\n    \"link-edit\": \"Edit Link\",\n    \"link-in-new-tab\": \"Open link in new tab\",\n    \"unlink\": \"Unlink\",\n    \"cancel\": \"Cancel\",\n    \"close\": \"Close\",\n    \"insert\": \"Insert\",\n    \"save\": \"Save\",\n    \"delete\": \"Delete\",\n    \"text\": \"Text\",\n    \"edit\": \"Edit\",\n    \"title\": \"Title\",\n    \"paragraph\": \"Normal text\",\n    \"quote\": \"Quote\",\n    \"code\": \"Code\",\n    \"heading1\": \"Heading 1\",\n    \"heading2\": \"Heading 2\",\n    \"heading3\": \"Heading 3\",\n    \"heading4\": \"Heading 4\",\n    \"heading5\": \"Heading 5\",\n    \"heading6\": \"Heading 6\",\n    \"filename\": \"Name\",\n    \"optional\": \"optional\",\n    \"unorderedlist\": \"Unordered List\",\n    \"orderedlist\": \"Ordered List\",\n    \"outdent\": \"Outdent\",\n    \"indent\": \"Indent\",\n    \"horizontalrule\": \"Line\",\n    \"upload\": \"Upload\",\n    \"upload-label\": \"Drop files here or click to upload\",\n    \"accessibility-help-label\": \"Rich text editor\",\n    \"caption\": \"Caption\",\n    \"bulletslist\": \"Bullets\",\n    \"numberslist\": \"Numbers\",\n    \"image-position\": \"Position\",\n    \"none\": \"None\",\n    \"left\": \"Left\",\n    \"right\": \"Right\",\n    \"center\": \"Center\",\n    \"undo\": \"Undo\",\n    \"redo\": \"Redo\"\n};\n$R.buttons = {\n    html: {\n        title: 'HTML',\n        icon: true,\n        api: 'module.source.toggle'\n    },\n    undo: {\n        title: '## undo ##',\n        icon: true,\n        api: 'module.buffer.undo'\n    },\n    redo: {\n        title: '## redo ##',\n        icon: true,\n        api: 'module.buffer.redo'\n    },\n    format: {\n        title: '## format ##',\n        icon: true,\n        dropdown: {\n            p: {\n                title: '## paragraph ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'p'\n                }\n            },\n            blockquote: {\n                title: '## quote ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'blockquote'\n                }\n            },\n            pre: {\n                title: '## code ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'pre'\n                }\n            },\n            h1: {\n                title: '## heading1 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h1'\n                }\n            },\n            h2: {\n                title: '## heading2 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h2'\n                }\n            },\n            h3: {\n                title: '## heading3 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h3'\n                }\n            },\n            h4: {\n                title: '## heading4 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h4'\n                }\n            },\n            h5: {\n                title: '## heading5 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h5'\n                }\n            },\n            h6: {\n                title: '## heading6 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h6'\n                }\n            }\n        }\n    },\n    bold: {\n        title: '## bold-abbr ##',\n        icon: true,\n        tooltip: '## bold ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'b'\n        }\n    },\n    italic: {\n        title: '## italic-abbr ##',\n        icon: true,\n        tooltip: '## italic ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'i'\n        }\n    },\n    deleted: {\n        title: '## deleted-abbr ##',\n        icon: true,\n        tooltip: '## deleted ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'del'\n        }\n    },\n    underline: {\n        title: '## underline-abbr ##',\n        icon: true,\n        tooltip: '## underline ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'u'\n        }\n    },\n    sup: {\n        title: '## superscript-abbr ##',\n        icon: true,\n        tooltip: '## superscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sup'\n        }\n    },\n    sub: {\n        title: '## subscript-abbr ##',\n        icon: true,\n        tooltip: '## subscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sub'\n        }\n    },\n    lists: {\n        title: '## lists ##',\n        icon: true,\n        observe: 'list',\n        dropdown: {\n            observe: 'list',\n            unorderedlist: {\n                title: '&bull; ## unorderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ul'\n            },\n            orderedlist: {\n                title: '1. ## orderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ol'\n            },\n            outdent: {\n                title: '< ## outdent ##',\n                api: 'module.list.outdent'\n            },\n            indent: {\n                title: '> ## indent ##',\n                api: 'module.list.indent'\n            }\n        }\n    },\n    ul: {\n        title: '&bull; ## bulletslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ul'\n    },\n    ol: {\n        title: '1. ## numberslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ol'\n    },\n    outdent: {\n        title: '## outdent ##',\n        icon: true,\n        api: 'module.list.outdent',\n        observe: 'list'\n    },\n    indent: {\n        title: '## indent ##',\n        icon: true,\n        api: 'module.list.indent',\n        observe: 'list'\n    },\n    image: {\n        title: '## image ##',\n        icon: true,\n        api: 'module.image.open'\n    },\n    file: {\n        title: '## file ##',\n        icon: true,\n        api: 'module.file.open'\n    },\n    link: {\n        title: '## link ##',\n        icon: true,\n        observe: 'link',\n        dropdown: {\n            observe: 'link',\n            link: {\n                title: '## link-insert ##',\n                api: 'module.link.open'\n            },\n            unlink: {\n                title: '## unlink ##',\n                api: 'module.link.unlink'\n            }\n        }\n    },\n    line: {\n        title: '## horizontalrule ##',\n        icon: true,\n        api: 'module.line.insert'\n    }\n};\nvar App = function(element, options, uuid)\n{\n    this.module = {};\n    this.plugin = {};\n    this.instances = {};\n\n    // start/stop\n    this.started = false;\n    this.stopped = false;\n\n    // environment\n    this.uuid = uuid;\n    this.rootElement = element;\n    this.rootOpts = options;\n    this.dragInside = false;\n    this.dragComponentInside = false;\n    this.keycodes = $R.keycodes;\n    this.namespace = 'redactor';\n    this.$win = $R.dom(window);\n    this.$doc = $R.dom(document);\n    this.$body = $R.dom('body');\n    this.editorReadOnly = false;\n\n    // core services\n    this.opts = $R.create('service.options', options, element);\n    this.lang = $R.create('service.lang', this);\n\n    // build\n    this.buildServices();\n    this.buildModules();\n    this.buildPlugins();\n\n    // start\n    this.start();\n};\n\nApp.prototype = {\n    start: function()\n    {\n        // start\n        this.stopped = false;\n        this.broadcast('start');\n        this.broadcast('startcode');\n\n        if (this.opts.clickToEdit)\n        {\n            this.broadcast('startclicktoedit');\n        }\n        else\n        {\n            this.broadcast('enable');\n            if (this.opts.showSource) this.broadcast('startcodeshow');\n            this.broadcast('enablefocus');\n        }\n\n        // started\n        this.broadcast('started');\n        this.started = true;\n    },\n    stop: function()\n    {\n        this.started = false;\n        this.stopped = true;\n\n        this.broadcast('stop');\n        this.broadcast('disable');\n        this.broadcast('stopped');\n    },\n\n    // started & stopped\n    isStarted: function()\n    {\n        return this.started;\n    },\n    isStopped: function()\n    {\n        return this.stopped;\n    },\n\n    // build\n    buildServices: function()\n    {\n        var core = ['options', 'lang'];\n        var bindable = ['uuid', 'keycodes', 'opts', 'lang', '$win', '$doc', '$body'];\n        var services = [];\n        for (var name in $R.services)\n        {\n            if (core.indexOf(name) === -1)\n            {\n                this[name] = $R.create('service.' + name, this);\n                services.push(name);\n                bindable.push(name);\n            }\n        }\n\n        // binding\n        for (var i = 0; i < services.length; i++)\n        {\n            var service = services[i];\n            for (var z = 0; z < bindable.length; z++)\n            {\n                var inj = bindable[z];\n                if (service !== inj)\n                {\n                    this[service][inj] = this[inj];\n                }\n            }\n        }\n    },\n    buildModules: function()\n    {\n        for (var name in $R.modules)\n        {\n            this.module[name] = $R.create('module.' + name, this);\n            this.instances[name] = this.module[name];\n        }\n    },\n    buildPlugins: function()\n    {\n        var plugins = this.opts.plugins;\n        for (var i = 0; i < plugins.length; i++)\n        {\n            var name = plugins[i];\n            if (typeof $R.plugins[name] !== 'undefined')\n            {\n                this.plugin[name] = $R.create('plugin.' + name, this);\n                this.instances[name] = this.plugin[name];\n            }\n        }\n    },\n\n    // draginside\n    isDragInside: function()\n    {\n        return this.dragInside;\n    },\n    setDragInside: function(dragInside)\n    {\n        this.dragInside = dragInside;\n    },\n    isDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n    setDragComponentInside: function(dragInside)\n    {\n        this.dragComponentInside = dragInside;\n    },\n    getDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n\n    // readonly\n    isReadOnly: function()\n    {\n        return this.editorReadOnly;\n    },\n    enableReadOnly: function()\n    {\n        this.editorReadOnly = true;\n        this.broadcast('enablereadonly');\n        this.component.clearActive();\n        this.toolbar.disableButtons();\n    },\n    disableReadOnly: function()\n    {\n        this.editorReadOnly = false;\n        this.broadcast('disablereadonly');\n        this.toolbar.enableButtons();\n    },\n\n    // messaging\n    callMessageHandler: function(instance, name, args)\n    {\n        var arr = name.split('.');\n        if (arr.length === 1)\n        {\n            if (typeof instance['on' + name] === 'function')\n            {\n                instance['on' + name].apply(instance, args);\n            }\n        }\n        else\n        {\n            arr[0] = 'on' + arr[0];\n\n            var func = this.utils.checkProperty(instance, arr);\n            if (typeof func === 'function')\n            {\n                func.apply(instance, args);\n            }\n        }\n    },\n    broadcast: function(name)\n    {\n        var args = [].slice.call(arguments, 1);\n        for (var moduleName in this.instances)\n        {\n            this.callMessageHandler(this.instances[moduleName], name, args);\n        }\n\n        // callback\n        return this.callback.trigger(name, args);\n    },\n\n    // callback\n    on: function(name, func)\n    {\n        this.callback.add(name, func);\n    },\n    off: function(name, func)\n    {\n        this.callback.remove(name, func);\n    },\n\n    // api\n    api: function(name)\n    {\n        if (!this.isStarted() && name !== 'start') return;\n        if (this.isReadOnly() && name !== 'disableReadOnly') return;\n\n        this.broadcast('state');\n\n        var args = [].slice.call(arguments, 1);\n        var arr = name.split('.');\n\n        var isApp = (arr.length === 1);\n        var isCallback = (arr[0] === 'on' || arr[0] === 'off');\n        var isService = (!isCallback && arr.length === 2);\n        var isPlugin = (arr[0] === 'plugin');\n        var isModule = (arr[0] === 'module');\n\n        // app\n        if (isApp)\n        {\n            if (typeof this[arr[0]] === 'function')\n            {\n                return this.callInstanceMethod(this, arr[0], args);\n            }\n        }\n        // callback\n        else if (isCallback)\n        {\n            return (arr[0] === 'on') ? this.on(arr[1], args[0]) : this.off(arr[1], args[0] || undefined);\n        }\n        // service\n        else if (isService)\n        {\n            if (this.isInstanceExists(this, arr[0]))\n            {\n                return this.callInstanceMethod(this[arr[0]], arr[1], args);\n            }\n            else\n            {\n                $R.error(new Error('Service \"' + arr[0] + '\" not found'));\n            }\n        }\n        // plugin\n        else if (isPlugin)\n        {\n            if (this.isInstanceExists(this.plugin, arr[1]))\n            {\n                return this.callInstanceMethod(this.plugin[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Plugin \"' + arr[1] + '\" not found'));\n            }\n        }\n        // module\n        else if (isModule)\n        {\n            if (this.isInstanceExists(this.module, arr[1]))\n            {\n                return this.callInstanceMethod(this.module[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Module \"' + arr[1] + '\" not found'));\n            }\n        }\n\n    },\n    isInstanceExists: function(obj, name)\n    {\n        return (typeof obj[name] !== 'undefined');\n    },\n    callInstanceMethod: function(instance, method, args)\n    {\n        if (typeof instance[method] === 'function')\n        {\n            return instance[method].apply(instance, args);\n        }\n    }\n};\n$R.add('mixin', 'formatter', {\n\n    // public\n    buildArgs: function(args)\n    {\n        this.args = {\n            'class': args['class'] || false,\n            'style': args['style'] || false,\n            'attr': args['attr'] || false\n        };\n\n        if (!this.args['class'] && !this.args['style'] && !this.args['attr'])\n        {\n            this.args = false;\n        }\n    },\n    applyArgs: function(nodes, selection)\n    {\n        if (this.args)\n        {\n            nodes = this[this.type](this.args, false, nodes, selection);\n        }\n        else\n        {\n            nodes = this._clearAll(nodes, selection);\n        }\n\n        return nodes;\n    },\n    clearClass: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('class');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearStyle: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('style');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearAttr: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        this._removeAllAttr($elements);\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    set: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeAttr('class');\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            $elements.removeAttr('style');\n            $elements.css(args['style']);\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n            });\n        }\n\n        if (args['attr'])\n        {\n            this._removeAllAttr($elements);\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    toggle: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.toggleClass(args['class']);\n            $elements.each(function(node)\n            {\n                if (node.className === '') node.removeAttribute('class');\n            });\n        }\n\n        var params;\n        if (args['style'])\n        {\n            params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    var newVal = params[key];\n                    var oldVal = $node.css(key);\n\n                    oldVal = (this.utils.isRgb(oldVal)) ? this.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                    newVal = (this.utils.isRgb(newVal)) ? this.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                    oldVal = this.utils.hex2long(oldVal);\n                    newVal = this.utils.hex2long(newVal);\n\n                    var compareNew = (typeof newVal === 'string') ? newVal.toLowerCase() : newVal;\n                    var compareOld = (typeof oldVal === 'string') ? oldVal.toLowerCase() : oldVal;\n\n                    if (compareNew === compareOld) $node.css(key, '');\n                    else $node.css(key, newVal);\n                }\n\n                this._convertStyleQuotes($node);\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            params = args['attr'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    if ($node.attr(key)) $node.removeAttr(key);\n                    else $node.attr(key, params[key]);\n                }\n            });\n\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    add: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            var params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(params);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n\n                this._convertStyleQuotes($node);\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    remove: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeClass(args['class']);\n            $elements.each(function(node)\n            {\n                if (node.className === '') node.removeAttribute('class');\n            });\n        }\n\n        if (args['style'])\n        {\n            var name = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(name, '');\n\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.removeAttr(args['attr']);\n        }\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n\n    // private\n    _removeAllAttr: function($elements)\n    {\n        $elements.each(function(node)\n        {\n            for (var i = node.attributes.length; i-->0;)\n            {\n                var nodeAttr = node.attributes[i];\n                var name = nodeAttr.name;\n                if (name !== 'style' && name !== 'class')\n                {\n                    node.removeAttributeNode(nodeAttr);\n                }\n            }\n        });\n    },\n    _convertStyleQuotes: function($node)\n    {\n        var style = $node.attr('style');\n        if (style) $node.attr('style', style.replace(/\"/g, '\\''));\n    },\n    _clearAll: function(nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            while (node.attributes.length > 0)\n            {\n                node.removeAttribute(node.attributes[0].name);\n            }\n        }\n\n        nodes = this._unwrapSpanWithoutAttr(nodes);\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n    _unwrapSpanWithoutAttr: function(nodes)\n    {\n        var finalNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            var len = node.attributes.length;\n            if (len <= 0 && node.nodeType !== 3 && node.tagName === 'SPAN')\n            {\n                $R.dom(node).unwrap();\n            }\n            else\n            {\n                finalNodes.push(node);\n            }\n        }\n\n        return finalNodes;\n    }\n});\n$R.add('mixin', 'dom', $R.Dom.prototype);\n$R.add('mixin', 'component', {\n    get cmnt()\n    {\n        return true;\n    }\n});\n$R.add('service', 'options', {\n    init: function(options, element)\n    {\n        var $el = $R.dom(element);\n        var opts = $R.extend({}, $R.opts, (element) ? $el.data() : {}, $R.options);\n        opts = $R.extend(true, opts, options);\n\n        return opts;\n    }\n});\n$R.add('service', 'lang', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // build\n        this.vars = this._build(this.opts.lang);\n    },\n\n    // public\n    rebuild: function(lang)\n    {\n        this.opts.lang = lang;\n        this.vars = this._build(lang);\n    },\n    extend: function(obj)\n    {\n        this.vars = $R.extend(this.vars, obj);\n    },\n    parse: function(str)\n    {\n        if (str === undefined)\n        {\n            return '';\n        }\n\n        var matches = str.match(/## (.*?) ##/g);\n        if (matches)\n        {\n            for (var i = 0; i < matches.length; i++)\n            {\n                var key = matches[i].replace(/^##\\s/g, '').replace(/\\s##$/g, '');\n                str = str.replace(matches[i], this.get(key));\n            }\n        }\n\n        return str;\n    },\n    get: function(name)\n    {\n        var str = '';\n        if (typeof this.vars[name] !== 'undefined')\n        {\n            str = this.vars[name];\n        }\n        else if (this.opts.lang !== 'en' && typeof $R.lang['en'][name] !== 'undefined')\n        {\n            str = $R.lang['en'][name];\n        }\n\n        return str;\n    },\n\n    // private\n    _build: function(lang)\n    {\n        var vars = $R.lang['en'];\n        if (lang !== 'en')\n        {\n            vars = ($R.lang[lang] !== undefined) ? $R.lang[lang] : vars;\n        }\n\n        return vars;\n    }\n});\n$R.add('service', 'callback', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.callbacks = {};\n\n        // build\n        if (this.opts.callbacks)\n        {\n            this._set(this.opts.callbacks, '');\n        }\n    },\n    stop: function()\n    {\n        this.callbacks = {};\n    },\n    add: function(name, handler)\n    {\n        if (!this.callbacks[name]) this.callbacks[name] = [];\n        this.callbacks[name].push(handler);\n    },\n    remove: function(name, handler)\n    {\n        if (handler === undefined)\n        {\n            delete this.callbacks[name];\n        }\n        else\n        {\n            for (var i = 0; i < this.callbacks[name].length; i++)\n            {\n                this.callbacks[name].splice(i, 1);\n            }\n\n            if (Object.keys(this.callbacks[name]).length === 0) delete this.callbacks[name];\n        }\n    },\n    trigger: function(name, args)\n    {\n        var value = this._loop(name, args, this.callbacks);\n        return (typeof value === 'undefined' && args && args[0] !== false) ? args[0] : value;\n    },\n\n    // private\n    _set: function(obj, name)\n    {\n        for (var key in obj)\n        {\n            var path = (name === '') ? key : name + '.' + key;\n            if (typeof obj[key] === 'object')\n            {\n                this._set(obj[key], path);\n            }\n            else\n            {\n                this.callbacks[path] = [];\n                this.callbacks[path].push(obj[key]);\n            }\n        }\n    },\n    _loop: function(name, args, obj)\n    {\n        var value;\n        for (var key in obj)\n        {\n            if (name === key)\n            {\n                for (var i = 0; i < obj[key].length; i++)\n                {\n                    value = obj[key][i].apply(this.app, args);\n                }\n            }\n        }\n\n        return value;\n    }\n});\n$R.add('service', 'animate', {\n    init: function(app)\n    {\n        this.animationOpt = app.opts.animation;\n    },\n    start: function(element, animation, options, callback)\n    {\n        var defaults = {\n            duration: false,\n            iterate: false,\n            delay: false,\n            timing: false,\n            prefix: 'redactor-'\n        };\n\n        defaults = (typeof options === 'function') ? defaults : $R.extend(defaults, options);\n        callback = (typeof options === 'function') ? options : callback;\n\n        // play\n        return new $R.AnimatePlay(element, animation, defaults, callback, this.animationOpt);\n    },\n    stop: function(element)\n    {\n        this.$el = $R.dom(element);\n        this.$el.removeClass('redactor-animated');\n\n        var effect = this.$el.attr('redactor-animate-effect');\n        this.$el.removeClass(effect);\n\n        this.$el.removeAttr('redactor-animate-effect');\n        var hide = this.$el.attr('redactor-animate-hide');\n        if (hide)\n        {\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        this.$el.off('animationend webkitAnimationEnd');\n    }\n});\n\n$R.AnimatePlay = function(element, animation, defaults, callback, animationOpt)\n{\n    this.hidableEffects = ['fadeOut', 'flipOut', 'slideUp', 'zoomOut', 'slideOutUp', 'slideOutRight', 'slideOutLeft'];\n    this.prefixes = ['', '-webkit-'];\n\n    this.$el = $R.dom(element);\n    this.$body = $R.dom('body');\n    this.callback = callback;\n    this.animation = (!animationOpt) ? this.buildAnimationOff(animation) : animation;\n    this.defaults = defaults;\n\n    if (this.animation === 'slideUp')\n    {\n        this.$el.height(this.$el.height());\n    }\n\n    // animate\n    return (this.isInanimate()) ? this.inanimate() : this.animate();\n};\n\n$R.AnimatePlay.prototype = {\n    buildAnimationOff: function(animation)\n    {\n        return (this.isHidable(animation)) ? 'hide' : 'show';\n    },\n    buildHideClass: function()\n    {\n        return 'redactor-animate-hide';\n    },\n    isInanimate: function()\n    {\n        return (this.animation === 'show' || this.animation === 'hide');\n    },\n    isAnimated: function()\n    {\n        return this.$el.hasClass('redactor-animated');\n    },\n    isHidable: function(effect)\n    {\n        return (this.hidableEffects.indexOf(effect) !== -1);\n    },\n    inanimate: function()\n    {\n        this.defaults.timing = 'linear';\n\n        var hide;\n        if (this.animation === 'show')\n        {\n            hide = this.buildHideClass();\n            this.$el.attr('redactor-animate-hide', hide);\n            this.$el.removeClass(hide);\n        }\n        else\n        {\n            hide = this.$el.attr('redactor-animate-hide');\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        if (typeof this.callback === 'function') this.callback(this);\n\n        return this;\n    },\n    animate: function()\n    {\n        var delay = (this.defaults.delay) ? this.defaults.delay : 0;\n        setTimeout(function()\n        {\n            this.$body.addClass('no-scroll-x');\n            this.$el.addClass('redactor-animated');\n            if (!this.$el.attr('redactor-animate-hide'))\n            {\n                var hide = this.buildHideClass();\n                this.$el.attr('redactor-animate-hide', hide);\n                this.$el.removeClass(hide);\n            }\n\n            this.$el.addClass(this.defaults.prefix + this.animation);\n            this.$el.attr('redactor-animate-effect', this.defaults.prefix + this.animation);\n\n            this.set(this.defaults.duration + 's', this.defaults.iterate, this.defaults.timing);\n            this.complete();\n\n        }.bind(this), delay * 1000);\n\n        return this;\n    },\n    set: function(duration, iterate, timing)\n    {\n        var len = this.prefixes.length;\n\n        while (len--)\n        {\n            if (duration !== false || duration === '') this.$el.css(this.prefixes[len] + 'animation-duration', duration);\n            if (iterate !== false || iterate === '') this.$el.css(this.prefixes[len] + 'animation-iteration-count', iterate);\n            if (timing !== false || timing === '') this.$el.css(this.prefixes[len] + 'animation-timing-function', timing);\n        }\n    },\n    clean: function()\n    {\n        this.$body.removeClass('no-scroll-x');\n        this.$el.removeClass('redactor-animated');\n        this.$el.removeClass(this.defaults.prefix + this.animation);\n        this.$el.removeAttr('redactor-animate-effect');\n\n        this.set('', '', '');\n    },\n    complete: function()\n    {\n        this.$el.one('animationend webkitAnimationEnd', function()\n        {\n            if (this.$el.hasClass(this.defaults.prefix + this.animation)) this.clean();\n            if (this.isHidable(this.animation))\n            {\n                var hide = this.$el.attr('redactor-animate-hide');\n                this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n            }\n\n            if (this.animation === 'slideUp') this.$el.height('');\n            if (typeof this.callback === 'function') this.callback(this.$el);\n\n        }.bind(this));\n    }\n};\n$R.add('service', 'caret', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n\n    // set\n    setStart: function(el)\n    {\n        this._setCaret('Start', el);\n    },\n    setEnd: function(el)\n    {\n        this._setCaret('End', el);\n    },\n    setBefore: function(el)\n    {\n        this._setCaret('Before', el);\n    },\n    setAfter: function(el)\n    {\n        this._setCaret('After', el);\n    },\n\n    // is\n    isStart: function(el)\n    {\n        return this._isStartOrEnd(el, 'First');\n    },\n    isEnd: function(el)\n    {\n        return this._isStartOrEnd(el, 'Last');\n    },\n\n    // set side\n    setAtEnd: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var tag = data.getTag();\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            if (tag === 'a')\n            {\n                var textNode = this.utils.createInvisibleChar();\n                node.appendChild(textNode);\n\n                range.setStartBefore(textNode);\n                range.collapse(true);\n            }\n            else\n            {\n                range.selectNodeContents(node);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtStart: function(node)\n    {\n\t\tvar range = document.createRange();\n\t\tvar data = this.inspector.parse(node);\n        if (this._isInPage(node))\n        {\n            range.setStart(node, 0);\n            range.collapse(true);\n\n            if (data.isInline() || this.utils.isEmpty(node))\n            {\n                var textNode = this.utils.createInvisibleChar();\n                range.insertNode(textNode);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtBefore: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartBefore(node);\n            range.collapse(true);\n\n            if (data.isInline())\n            {\n                var textNode = this.utils.createInvisibleChar();\n                node.parentNode.insertBefore(textNode, node);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtAfter: function(node)\n    {\n\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartAfter(node);\n            range.collapse(true);\n\n            var textNode = this.utils.createInvisibleChar();\n            range.insertNode(textNode);\n            range.selectNodeContents(textNode);\n            range.collapse(false);\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtPrev: function(node)\n    {\n        var prev = node.previousSibling;\n        if (prev)\n        {\n            prev = (prev.nodeType === 3 && this._isEmptyTextNode(prev)) ? prev.previousElementSibling : prev;\n            if (prev) this.setEnd(prev);\n        }\n    },\n    setAtNext: function(node)\n    {\n        var next = node.nextSibling;\n        if (next)\n        {\n            next = (next.nodeType === 3 && this._isEmptyTextNode(next)) ? next.nextElementSibling : next;\n            if (next) this.setStart(next);\n        }\n    },\n\n    // private\n    _setCaret: function(type, el)\n    {\n        var data = this.inspector.parse(el);\n        var node = data.getNode();\n\n        if (node)\n        {\n            this.component.clearActive();\n            this['_set' + type](node, data, data.getTag());\n        }\n    },\n    _setStart: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtStart(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findFirstNode('li');\n\n            var item = this.utils.getFirstElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setStart(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findFirstNode('dt');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setBefore(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getFirstElement(node);\n            if (el)\n            {\n                return this.setStart(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setStart(data.findFirstNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtStart(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setStart(tableData.findFirstNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'Start'))\n        {\n            this.setAtStart(node);\n        }\n    },\n    _setEnd: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtEnd(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findLastNode('li');\n\n            var item = this.utils.getLastElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setEnd(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findLastNode('dd');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setAfter(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getLastElement();\n            if (el)\n            {\n                return this.setEnd(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setEnd(data.findLastNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtEnd(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setEnd(tableData.findLastNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'End'))\n        {\n            // is element empty\n            if (this.utils.isEmpty(node))\n            {\n                return this.setStart(node);\n            }\n\n            this.setAtEnd(node);\n        }\n    },\n    _setBefore: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtBefore(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtBefore(node);\n        }\n        // td / th\n        else if (data.isFirstTableCell())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtPrev(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtPrev(data.getList());\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            return this.setStart(data.getComponent());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtPrev(node);\n        }\n\n        this.editor.focus();\n        this.setAtBefore(node);\n\n    },\n    _setAfter: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtAfter(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtAfter(node);\n        }\n        // td / th\n        else if (data.isLastTableCell())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtNext(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtNext(data.getList());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtNext(node);\n        }\n\n        this.editor.focus();\n        this.setAtAfter(node);\n    },\n    _setInline: function(node, type)\n    {\n        // is first element inline (FF only)\n        var inline = this._hasInlineChild(node, (type === 'Start') ? 'first' : 'last');\n        if (inline)\n        {\n            if (type === 'Start')\n            {\n                this.setStart(inline);\n            }\n            else\n            {\n                this.setEnd(inline);\n            }\n\n            return true;\n        }\n    },\n    _isStartOrEnd: function(el, type)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var data = this.inspector.parse(node);\n        node = this._getStartEndNode(node, data, type);\n\n        if (node && (node.nodeType !== 3 && node.tagName !== 'LI'))\n        {\n            var html = (node.nodeType === 3) ? node.textContent : node.innerHTML;\n            html = this.utils.trimSpaces(html);\n            if (html === '') return true;\n        }\n\n        if (!data.isFigcaption() && data.isComponent() && !data.isComponentEditable())\n        {\n            return true;\n        }\n\n        var offset = this.offset.get(node, true);\n        if (offset)\n        {\n            return (type === 'First') ? (offset.start === 0) : (offset.end === this.offset.size(node, true));\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _isInPage: function(node)\n    {\n        if (node && node.nodeType)\n        {\n            return (node === document.body) ? false : document.body.contains(node);\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _hasInlineChild: function(el, pos)\n    {\n        var data = this.inspector.parse(el);\n        var node = (pos === 'first') ? data.getFirstNode() : data.getLastNode();\n        var $node = $R.dom(node);\n\n        if (node && node.nodeType !== 3\n            && this.inspector.isInlineTag(node.tagName)\n            && !$node.hasClass('redactor-component')\n             && !$node.hasClass('non-editable'))\n        {\n            return node;\n        }\n    },\n    _isEmptyTextNode: function(node)\n    {\n        var text = node.textContent.trim().replace(/\\n/, '');\n        text = this.utils.removeInvisibleChars(text);\n\n        return (text === '');\n    },\n    _getStartEndNode: function(node, data, type)\n    {\n        if (data.isFigcaption())\n        {\n            node = data.getFigcaption();\n        }\n        else if (data.isTable())\n        {\n            node = data['find' + type + 'Node']('th, td');\n        }\n        else if (data.isList())\n        {\n            node = data['find' + type + 'Node']('li');\n        }\n        else if (data.isComponentType('code'))\n        {\n            node = data.findLastNode('pre, code');\n        }\n\n        return node;\n    }\n});\n$R.add('service', 'selection', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // is\n    is: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var node = sel.anchorNode;\n            var data = this.inspector.parse(node);\n\n            return (data.isInEditor() || data.isEditor());\n        }\n\n        return false;\n    },\n    isCollapsed: function()\n    {\n        var sel = this.get();\n        var range = this.getRange();\n\n        if (sel && sel.isCollapsed) return true;\n        else if (range && range.toString().length === 0) return true;\n\n        return false;\n    },\n    isBackwards: function()\n    {\n        var backwards = false;\n        var sel = this.get();\n\n        if (sel && !sel.isCollapsed)\n        {\n            var range = document.createRange();\n            range.setStart(sel.anchorNode, sel.anchorOffset);\n            range.setEnd(sel.focusNode, sel.focusOffset);\n            backwards = range.collapsed;\n            range.detach();\n        }\n\n        return backwards;\n    },\n    isIn: function(el)\n    {\n        var node = $R.dom(el).get();\n        var current = this.getCurrent();\n\n        return (current && node) ? node.contains(current) : false;\n    },\n    isText: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var el = sel.anchorNode;\n            var block = this.getBlock(el);\n            var blocks = this.getBlocks();\n\n            // td, th or hasn't block\n            if ((block && this.inspector.isTableCellTag(block.tagName)) || (block === false && blocks.length === 0))\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    isAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var data = this.inspector.parse(node);\n\n        // component\n        if (!data.isFigcaption() && this.component.isNonEditable(node) && this.component.isActive(node))\n        {\n            return true;\n        }\n\n        if (isEditor)\n        {\n            var $editor = this.editor.getElement();\n            var output = $editor.html().replace(/<p><\\/p>$/i, '');\n            var htmlLen = this.getHtml(false).length;\n            var outputLen = output.length;\n\n            if (htmlLen !== outputLen)\n            {\n                return false;\n            }\n        }\n\n        // editor empty or collapsed\n        if ((isEditor && this.editor.isEmpty()) || this.isCollapsed())\n        {\n            return false;\n        }\n\n        // all\n        var offset = this.offset.get(node, true);\n        var size = this.offset.size(node, true);\n\n        // pre, table, or pre/code in figure\n        if (!isEditor && data.isComponentType('code'))\n        {\n            size = this.getText().trim().length;\n        }\n\n        if (offset && offset.start === 0 && offset.end === size)\n        {\n            return true;\n        }\n\n        return false;\n    },\n\n    // has\n    hasNonEditable: function()\n    {\n        var selected = this.getHtml();\n        var $wrapper = $R.dom('<div>').html(selected);\n\n        return (!this.isCollapsed() && $wrapper.find('.non-editable').length !== 0);\n    },\n\n    // set\n    setRange: function(range)\n    {\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n    },\n    setAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var data = this.inspector.parse(node);\n\n        this.component.clearActive();\n\n        this.editor.focus();\n        this.editor.saveScroll();\n        this.editor.disableNonEditables();\n\n        if (node && node.tagName === 'TABLE')\n        {\n            var first = data.findFirstNode('td, th');\n            var last = data.findLastNode('td, th');\n\n            $R.dom(first).prepend(this.marker.build('start'));\n            $R.dom(last).append(this.marker.build('end'));\n\n            this.restoreMarkers();\n        }\n        else if (!data.isFigcaption() && this.component.isNonEditable(node))\n        {\n            this.component.setActive(node);\n        }\n        else\n        {\n            if (data.isComponentType('code'))\n            {\n                node = data.getComponentCodeElement();\n                node.focus();\n            }\n\n            var range = document.createRange();\n            range.selectNodeContents(node);\n\n            this.setRange(range);\n        }\n\n        this.editor.enableNonEditables();\n        this.editor.restoreScroll();\n    },\n\n    // get\n    get: function()\n    {\n        var sel = window.getSelection();\n        return (sel.rangeCount > 0) ? sel : null;\n    },\n    getRange: function()\n    {\n        var sel = this.get();\n        return (sel) ? ((sel.getRangeAt(0)) ? sel.getRangeAt(0) : null) : null;\n    },\n    getTextBeforeCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            range = range.cloneRange();\n            range.collapse(true);\n            range.setStart(el, 0);\n            text = range.toString().slice(-num);\n        }\n\n        return text;\n    },\n    getTextAfterCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(el);\n            clonedRange.setStart(range.endContainer, range.endOffset);\n\n            text = clonedRange.toString().slice(0, num);\n        }\n\n        return text;\n    },\n    getPosition: function()\n    {\n        var range = this.getRange();\n        var pos = { top: 0, left: 0, width: 0, height: 0 };\n        if (window.getSelection && range.getBoundingClientRect)\n        {\n            range = range.cloneRange();\n            var offset = (range.startOffset-1);\n            range.setStart(range.startContainer, (offset < 0) ? 0 : offset);\n            var rect = range.getBoundingClientRect();\n            pos = { top: rect.top, left: rect.left, width: (rect.right - rect.left) , height: (rect.bottom - rect.top) };\n        }\n\n        return pos;\n    },\n    getCurrent: function()\n    {\n        var node = false;\n        var sel = this.get();\n        var component = this.component.getActive();\n\n        if (component)\n        {\n            node = component;\n        }\n        else if (sel && this.is())\n        {\n            var data = this.inspector.parse(sel.anchorNode);\n            node = (!data.isEditor()) ? sel.anchorNode : false;\n        }\n\n        return node;\n    },\n    getParent: function()\n    {\n        var node = false;\n        var current = this.getCurrent();\n        if (current)\n        {\n            var parent = current.parentNode;\n            var data = this.inspector.parse(parent);\n\n            node = (!data.isEditor()) ? parent : false;\n        }\n\n        return node;\n    },\n    getElement: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            if (data.isElement() && data.isInEditor())\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInline: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inline = false;\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inline = node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return inline;\n    },\n    getInlineFirst: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlineAll: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inlines = [];\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inlines.push(node);\n            }\n\n            node = node.parentNode;\n        }\n\n        return inlines;\n    },\n    getBlock: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            var isBlock = this.inspector.isBlockTag(node.tagName);\n\n            if (isBlock && data.isInEditor(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlinesAllSelected: function(options)\n    {\n        if (this.isAll()) return [];\n\n        var inlines = this.getInlines({ all: true });\n        var textNodes = this.getNodes({ textnodes: true, inline: false });\n        var selected = this.getText().replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n        var finalNodes = [];\n\n        if (textNodes.length !== 0)\n        {\n            return finalNodes;\n        }\n\n        if (selected === '')\n        {\n            finalNodes = inlines;\n        }\n        else if (inlines.length > 1)\n        {\n            for (var i = 0; i < inlines.length; i++)\n            {\n                if (this._isTextSelected(inlines[i], selected))\n                {\n                    finalNodes.push(inlines[i]);\n                }\n            }\n        }\n        else if (inlines.length === 1)\n        {\n            if (this._isTextSelected(inlines[0], selected))\n            {\n                finalNodes = inlines;\n            }\n        }\n\n        finalNodes = (options && options.tags) ? this._filterNodesByTags(finalNodes, options.tags) : finalNodes;\n\n        return finalNodes;\n    },\n    getInlines: function(options)\n    {\n        var nodes = this.getNodes();\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node;\n            if (options && options.all)\n            {\n                node = nodes[i];\n                while (node)\n                {\n                    if (this._isInlineNode(node) && !this._isInNodesArray(filteredNodes, node))\n                    {\n                        filteredNodes.push(node);\n                    }\n\n                    node = node.parentNode;\n                }\n            }\n            else\n            {\n                node = this.getInline(nodes[i]);\n                if (node && !this._isInNodesArray(filteredNodes, node))\n                {\n                    filteredNodes.push(node);\n                }\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.inside) ? this._filterInlinesInside(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getBlocks: function(options)\n    {\n        var nodes = this.getNodes();\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = this.getBlock(nodes[i]);\n            if (node && !this._isInNodesArray(filteredNodes, node))\n            {\n                filteredNodes.push(node);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.first) ? this._filterBlocksFirst(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getElements: function(options)\n    {\n        var nodes = this.getNodes({ textnodes: false });\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (!this._isInNodesArray(filteredNodes, nodes[i]))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getNodes: function(options)\n    {\n        var nodes = [];\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            nodes = this._getNodesComponent(activeComponent);\n        }\n        else if (this.isCollapsed())\n        {\n            var current = this.getCurrent();\n            nodes = (current) ? [current] : [];\n        }\n        else if (this.is() && !activeComponent)\n        {\n            nodes = this._getRangeSelectedNodes();\n        }\n\n        // filter\n        nodes = this._filterServicesNodes(nodes);\n        nodes = this._filterEditor(nodes);\n\n        // options\n        nodes = (options && options.tags) ? this._filterNodesByTags(nodes, options.tags) : nodes;\n        nodes = (options && options.textnodes) ? this._filterNodesTexts(nodes, options) : nodes;\n        nodes = (options && !options.textnodes) ? this._filterNodesElements(nodes) : nodes;\n\n        return nodes;\n    },\n\n    // text & html\n    getText: function()\n    {\n        var sel = this.get();\n        return (sel) ? this.utils.removeInvisibleChars(sel.toString()) : '';\n    },\n    getHtml: function(clean)\n    {\n        var html = '';\n        var sel = this.get();\n        if (sel)\n        {\n            var container = document.createElement('div');\n            var len = sel.rangeCount;\n            for (var i = 0; i < len; ++i)\n            {\n                container.appendChild(sel.getRangeAt(i).cloneContents());\n            }\n\n            html = container.innerHTML;\n            html = (clean !== false) ? this.cleaner.output(html) : html;\n            html = html.replace(/<p><\\/p>$/i, '');\n        }\n\n        return html;\n    },\n\n    // clear\n    clear: function()\n    {\n        this.component.clearActive();\n        this.get().removeAllRanges();\n    },\n\n    // collapse\n    collapseToStart: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToStart();\n    },\n    collapseToEnd: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToEnd();\n    },\n\n    // save\n    saveActiveComponent: function()\n    {\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            this.savedComponent = activeComponent;\n            return true;\n        }\n\n        return false;\n    },\n    restoreActiveComponent: function()\n    {\n        if (this.savedComponent)\n        {\n            this.component.setActive(this.savedComponent);\n            return true;\n        }\n\n        return false;\n    },\n    save: function()\n    {\n        this._clearSaved();\n\n        var el = this.getElement();\n        if (el && (el.tagName === 'TD' || el.tagName === 'TH') && el.innerHTML === '')\n        {\n            this.savedElement = el;\n        }\n        else if (!this.saveActiveComponent())\n        {\n            this.saved = this.offset.get();\n        }\n    },\n    restore: function()\n    {\n        if (!this.saved && !this.savedComponent && !this.savedElement) return;\n\n        this.editor.saveScroll();\n\n        if (this.savedElement)\n        {\n            this.caret.setStart(this.savedElement);\n        }\n        else if (!this.restoreActiveComponent())\n        {\n            this.offset.set(this.saved);\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n    saveMarkers: function()\n    {\n        this._clearSaved();\n\n        if (!this.saveActiveComponent())\n        {\n            this.marker.insert();\n        }\n    },\n    restoreMarkers: function()\n    {\n        this.editor.saveScroll();\n\n        if (!this.restoreActiveComponent())\n        {\n            this.marker.restore();\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n\n    // private\n    _getNextNode: function(node)\n    {\n        if (node.hasChildNodes()) return node.firstChild;\n\n        while (node && !node.nextSibling)\n        {\n            node = node.parentNode;\n        }\n\n        if (!node) return null;\n\n        return node.nextSibling;\n    },\n    _getNodesComponent: function(component)\n    {\n        var current = this.getCurrent();\n        var data = this.inspector.parse(current);\n\n        return (data.isFigcaption()) ? [data.getFigcaption()] : [component];\n    },\n    _getRangeSelectedNodes: function()\n    {\n        var nodes = [];\n        var range = this.getRange();\n        var node = range.startContainer;\n        var startNode = range.startContainer;\n        var endNode = range.endContainer;\n        var $editor = this.editor.getElement();\n\n        // editor\n        if (startNode === $editor.get() && this.isAll())\n        {\n            nodes = this.utils.getChildNodes($editor);\n        }\n        // single node\n        else if (node == endNode)\n        {\n            nodes = [node];\n        }\n        else\n        {\n            while (node && node != endNode)\n            {\n                nodes.push(node = this._getNextNode(node));\n            }\n\n            node = range.startContainer;\n            while (node && node != range.commonAncestorContainer)\n            {\n                nodes.unshift(node);\n                node = node.parentNode;\n            }\n        }\n\n        return nodes;\n    },\n    _isInNodesArray: function(nodes, node)\n    {\n        return (nodes.indexOf(node) !== -1);\n    },\n    _filterEditor: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var data = this.inspector.parse(nodes[i]);\n            if (data.isInEditor())\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterServicesNodes: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var skip = false;\n\n            if (nodes[i] && nodes[i].nodeType === 3 && this.utils.isEmpty(nodes[i])) skip = true;\n            if ($el.hasClass('redactor-script-tag')\n                || $el.hasClass('redactor-component-caret')\n                || $el.hasClass('redactor-selection-marker')\n                || $el.hasClass('non-editable')) skip = true;\n\n            if (!skip)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesTexts: function(nodes, options)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType === 3 || (options.keepbr && nodes[i].tagName === 'BR'))\n            {\n                var inline = this.getInline(nodes[i]);\n                var isInline = (inline && options && options.inline === false);\n                if (!isInline)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesElements: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesByTags: function(nodes, tags, passtexts)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (passtexts && nodes[i].nodeType === 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n            else if (nodes[i].nodeType !== 3)\n            {\n                var nodeTag = nodes[i].tagName.toLowerCase();\n                if (tags.indexOf(nodeTag.toLowerCase()) !== -1)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterBlocksFirst: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var parent = $node.parent().get();\n            var isFirst = ($node.parent().hasClass('redactor-in'));\n            var isCellParent = (parent && (parent.tagName === 'TD' || parent.tagName === 'TH'));\n            if (isFirst || isCellParent)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterInlinesInside: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (window.getSelection().containsNode(nodes[i], true))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _isTextSelected: function(node, selected)\n    {\n        var text = this.utils.removeInvisibleChars(node.textContent);\n\n        return (\n            selected === text\n            || text.search(selected) !== -1\n            || selected.search(new RegExp('^' + text)) !== -1\n            || selected.search(new RegExp(text + '$')) !== -1\n        );\n    },\n    _isInlineNode: function(node)\n    {\n        var data = this.inspector.parse(node);\n\n        return (this.inspector.isInlineTag(node.tagName) && data.isInEditor());\n    },\n    _clearSaved: function()\n    {\n        this.saved = false;\n        this.savedComponent = false;\n        this.savedElement = false;\n    }\n});\n$R.add('service', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.rootElement = app.rootElement;\n\n        // local\n        this.$element = {};\n        this.type = 'inline';\n    },\n    start: function()\n    {\n        this._build();\n        this._buildType();\n    },\n\n    // public\n    isType: function(type)\n    {\n        return (type === this.type);\n    },\n    getType: function()\n    {\n        return this.type;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n\n    // private\n    _build: function()\n    {\n        this.$element = $R.dom(this.rootElement);\n    },\n    _buildType: function()\n    {\n        var tag = this.$element.get().tagName;\n\n        this.type = (tag === 'TEXTAREA') ? 'textarea' : this.type;\n        this.type = (tag === 'DIV') ? 'div' : this.type;\n        this.type = (this.opts.inline) ? 'inline' : this.type;\n    }\n});\n$R.add('service', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.scrolltop = false;\n        this.pasting = false;\n    },\n\n    // start\n    start: function()\n    {\n        this._build();\n    },\n\n    // focus\n    focus: function()\n    {\n        if (!this.isFocus() && !this._isContenteditableFocus())\n        {\n            this.saveScroll();\n            this.$editor.focus();\n            this.restoreScroll();\n        }\n    },\n    startFocus: function()\n    {\n        this.caret.setStart(this.getFirstNode());\n    },\n    endFocus: function()\n    {\n        this.caret.setEnd(this.getLastNode());\n    },\n\n    // pasting\n    isPasting: function()\n    {\n        return this.pasting;\n    },\n    enablePasting: function()\n    {\n        this.pasting = true;\n    },\n    disablePasting: function()\n    {\n        this.pasting = false;\n    },\n\n    // scroll\n    saveScroll: function()\n    {\n        this.scrolltop = this._getScrollTarget().scrollTop();\n    },\n    restoreScroll: function()\n    {\n        if (this.scrolltop !== false)\n        {\n            this._getScrollTarget().scrollTop(this.scrolltop);\n            this.scrolltop = false;\n        }\n    },\n\n    // non editables\n    disableNonEditables: function()\n    {\n        this.$noneditables = this.$editor.find('[contenteditable=false]');\n        this.$noneditables.attr('contenteditable', true);\n    },\n    enableNonEditables: function()\n    {\n        if (this.$noneditables)\n        {\n            setTimeout(function() { this.$noneditables.attr('contenteditable', false); }.bind(this), 1);\n        }\n    },\n\n    // nodes\n    getFirstNode: function()\n    {\n        return this.$editor.contents()[0];\n    },\n    getLastNode: function()\n    {\n        var nodes = this.$editor.contents();\n\n        return nodes[nodes.length-1];\n    },\n\n    // utils\n    isSourceMode: function()\n    {\n        var $source = this.source.getElement();\n\n        return $source.hasClass('redactor-source-open');\n    },\n    isEditor: function(el)\n    {\n        var node = $R.dom(el).get();\n\n        return (node === this.$editor.get());\n    },\n    isEmpty: function(keeplists)\n    {\n        return this.utils.isEmptyHtml(this.$editor.html(), false, keeplists);\n    },\n    isFocus: function()\n    {\n        var $active = $R.dom(document.activeElement);\n        var isComponentSelected = (this.$editor.find('.redactor-component-active').length !== 0);\n\n        return (isComponentSelected || $active.closest('.redactor-in-' + this.uuid).length !== 0);\n    },\n    setEmpty: function()\n    {\n        this.$editor.html(this.opts.emptyHtml);\n    },\n\n    // element\n    getElement: function()\n    {\n        return this.$editor;\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var editableElement = (this.element.isType('textarea')) ? '<div>' : $element.get();\n\n        this.$editor = $R.dom(editableElement);\n    },\n    _getScrollTarget: function()\n    {\n        return (this.opts.scrollTarget) ? $R.dom(this.opts.scrollTarget) : this.$doc;\n    },\n    _isContenteditableFocus: function()\n    {\n        var block = this.selection.getBlock();\n        var $blockParent = (block) ? $R.dom(block).closest('[contenteditable=true]').not('.redactor-in') : [];\n\n        return ($blockParent.length !== 0);\n    }\n});\n$R.add('service', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    getElement: function()\n    {\n        return this.$container;\n    },\n\n    // private\n    _build: function()\n    {\n        var tag = (this.element.isType('inline')) ? '<span>' : '<div>';\n        this.$container = $R.dom(tag);\n    }\n});\n$R.add('service', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$source = {};\n        this.content = '';\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildName();\n        this._buildStartedContent();\n    },\n    getElement: function()\n    {\n        return this.$source;\n    },\n    getCode: function()\n    {\n        return this.$source.val();\n    },\n    getName: function()\n    {\n        return this.$source.attr('name');\n    },\n    getStartedContent: function()\n    {\n        return this.content;\n    },\n    setCode: function(html)\n    {\n        return this.insertion.set(html, true, false);\n    },\n    isNameGenerated: function()\n    {\n        return (this.name);\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var isTextarea = this.element.isType('textarea');\n        var sourceElement = (isTextarea) ? $element.get() : '<textarea>';\n\n        this.$source = $R.dom(sourceElement);\n    },\n    _buildName: function()\n    {\n        var $element = this.element.getElement();\n\n        this.name = $element.attr('name');\n        this.$source.attr('name', (this.name) ? this.name : 'content-' + this.uuid);\n    },\n    _buildStartedContent: function()\n    {\n        var $element = this.element.getElement();\n        var content = (this.element.isType('textarea')) ? $element.val() : $element.html();\n\n        this.content = content.trim();\n    }\n});\n$R.add('service', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$statusbar = {};\n        this.items = [];\n    },\n    // public\n    start: function()\n    {\n        this.$statusbar = $R.dom('<ul>');\n        this.$statusbar.attr('dir', this.opts.direction);\n    },\n    add: function(name, html)\n    {\n        return this.update(name, html);\n    },\n    update: function(name, html)\n    {\n        var $item;\n        if (typeof this.items[name] !== 'undefined')\n        {\n            $item = this.items[name];\n        }\n        else\n        {\n            $item = $R.dom('<li>');\n            this.$statusbar.append($item);\n            this.items[name] = $item;\n        }\n\n        return $item.html(html);\n    },\n    get: function(name)\n    {\n        return (this.items[name]) ? this.items[name] : false;\n    },\n    remove: function(name)\n    {\n        if (this.items[name])\n        {\n            this.items[name].remove();\n            delete this.items[name];\n        }\n    },\n    getItems: function()\n    {\n        return this.items;\n    },\n    removeItems: function()\n    {\n        this.items = {};\n        this.$statusbar.html('');\n    },\n    getElement: function()\n    {\n        return this.$statusbar;\n    }\n});\n$R.add('service', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.buttons = [];\n        this.dropdownOpened = false;\n        this.buttonsObservers = {};\n    },\n    // public\n    start: function()\n    {\n        if (this.is())\n        {\n            this.opts.activeButtons = (this.opts.activeButtonsAdd) ? this._extendActiveButtons() : this.opts.activeButtons;\n            this.create();\n        }\n    },\n    stopObservers: function()\n    {\n        this.buttonsObservers = {};\n    },\n    create: function()\n    {\n        this.$wrapper = $R.dom('<div>');\n        this.$toolbar = $R.dom('<div>');\n    },\n    observe: function()\n    {\n        if (!this.is()) return;\n\n        this.setButtonsInactive();\n\n        var button, observer;\n\n        // observers\n        for (var name in this.buttonsObservers)\n        {\n            observer = this.buttonsObservers[name];\n            button = this.getButton(name);\n            this.app.broadcast('button.' + observer + '.observe', button);\n        }\n\n        // inline buttons\n        var buttons = this.opts.activeButtons;\n        var inlines = this.selection.getInlinesAllSelected();\n        var current = this.selection.getInline();\n        if (this.selection.isCollapsed() && current)\n        {\n            inlines.push(current);\n        }\n\n        var tags = this._inlinesToTags(inlines);\n        for (var key in buttons)\n        {\n            if (tags.indexOf(key) !== -1)\n            {\n                button = this.getButton(buttons[key]);\n                button.setActive();\n            }\n\n        }\n    },\n\n    // is\n    is: function()\n    {\n        return !(!this.opts.toolbar || (this.detector.isMobile() && this.opts.air));\n    },\n    isAir: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-air') : false;\n    },\n    isFixed: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-toolbar-fixed') : false;\n    },\n    isContextBar: function()\n    {\n        var $bar = this.$body.find('#redactor-context-toolbar-' + this.uuid);\n        return $bar.hasClass('open');\n    },\n    isTarget: function()\n    {\n        return (this.opts.toolbarFixedTarget !== document);\n    },\n\n    // get\n    getElement: function()\n    {\n        return this.$toolbar;\n    },\n    getWrapper: function()\n    {\n        return this.$wrapper;\n    },\n    getDropdown: function()\n    {\n        return this.dropdownOpened;\n    },\n    getTargetElement: function()\n    {\n        return $R.dom(this.opts.toolbarFixedTarget);\n    },\n    getButton: function(name)\n    {\n        var $btn = this._findButton('.re-' + name);\n\n        return ($btn.length !== 0) ? $btn.dataget('data-button-instance') : false;\n    },\n    getButtonByIndex: function(index)\n    {\n        var $btn = this.$toolbar.find('.re-button').eq(index);\n\n        return ($btn.length !== 0) ? $btn.dataget('data-button-instance') : false;\n    },\n    getButtons: function()\n    {\n        var buttons = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            buttons.push($node.dataget('data-button-instance'));\n        });\n\n        return buttons;\n    },\n    getButtonsKeys: function()\n    {\n        var keys = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            keys.push($node.attr('data-re-name'));\n        });\n\n        return keys;\n    },\n\n    // add\n    addButton: function(name, btnObj, position, $el, start)\n    {\n        position = position || 'end';\n\n        var index = this._getButtonIndex(name);\n        var $button = $R.create('toolbar.button', this.app, name, btnObj);\n\n        if (btnObj.observe)\n        {\n            this.opts.activeButtonsObservers[name] = { observe: btnObj.observe, button: $button };\n        }\n\n        // api added\n        if (start !== true)\n        {\n            if (index === 0) position = 'first';\n            else if (index !== -1)\n            {\n                var $elm = this.getButtonByIndex(index-1);\n                if ($elm)\n                {\n                    position = 'after';\n                    $el = $elm;\n                }\n            }\n        }\n\n        if (this.is())\n        {\n            if (position === 'first') this.$toolbar.prepend($button);\n            else if (position === 'after') $el.after($button);\n            else if (position === 'before') $el.before($button);\n            else this.$toolbar.append($button);\n        }\n\n        return $button;\n    },\n    addButtonFirst: function(name, btnObj)\n    {\n        return this.addButton(name, btnObj, 'first');\n    },\n    addButtonAfter: function(after, name, btnObj)\n    {\n        var $btn = this.getButton(after);\n\n        return ($btn) ? this.addButton(name, btnObj, 'after', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonBefore: function(before, name, btnObj)\n    {\n        var $btn = this.getButton(before);\n\n        return ($btn) ? this.addButton(name, btnObj, 'before', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonObserver: function(name, observer)\n    {\n        this.buttonsObservers[name] = observer;\n    },\n\n    // set\n    setButtons: function(buttons)\n    {\n        this.buttons = buttons;\n    },\n    setDropdown: function(dropdown)\n    {\n        this.dropdownOpened = dropdown;\n    },\n    setButtonsInactive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setInactive();\n        }\n    },\n    setButtonsActive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setActive();\n        }\n    },\n\n    // disable & enable\n    disableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].disable();\n        }\n    },\n    enableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].enable();\n        }\n\n    },\n\n    // private\n    _getButtonIndex: function(name)\n    {\n        var index = this.buttons.indexOf(name);\n\n        return (index === -1) ? false : index;\n    },\n    _findButton: function(selector)\n    {\n        return (this.is()) ? this.$toolbar.find(selector) : $R.dom();\n    },\n    _findButtons: function()\n    {\n        return (this.is()) ? this.$toolbar.find('.re-button') : $R.dom();\n    },\n    _extendActiveButtons: function()\n    {\n        return $R.extend({}, this.opts.activeButtons, this.opts.activeButtonsAdd);\n    },\n    _inlinesToTags: function(inlines)\n    {\n        var tags = [];\n        for (var i = 0; i < inlines.length; i++)\n        {\n            tags.push(inlines[i].tagName.toLowerCase());\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'toolbar.button', {\n    mixins: ['dom'],\n    init: function(app, name, btnObj)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.obj = btnObj;\n        this.name = name;\n        this.dropdown = false;\n        this.tooltip = false;\n\n        // init\n        this._init();\n    },\n    // is\n    isActive: function()\n    {\n        return this.hasClass('redactor-button-active');\n    },\n    isDisabled: function()\n    {\n        return this.hasClass('redactor-button-disabled');\n    },\n\n    // has\n    hasIcon: function()\n    {\n        return (this.obj.icon && !this.opts.buttonsTextLabeled);\n    },\n\n    // set\n    setDropdown: function(dropdown)\n    {\n        this.obj.dropdown = dropdown;\n        this.obj.message = false;\n        this.dropdown = $R.create('toolbar.dropdown', this.app, this.name, this.obj.dropdown);\n        this.attr('data-dropdown', true);\n    },\n    setMessage: function(message, args)\n    {\n        this.obj.message = message;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setApi: function(api, args)\n    {\n        this.obj.api = api;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setTitle: function(title)\n    {\n        this.obj.title = this.lang.parse(title);\n        this.obj.tooltip = this.obj.title;\n\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n        if (!this.attr('data-re-icon')) this.html(this.obj.title);\n    },\n    setTooltip: function(tooltip)\n    {\n        this.obj.tooltip = this.lang.parse(tooltip);\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n    },\n    setIcon: function(icon)\n    {\n        if (this.opts.buttonsTextLabeled) return;\n\n        this.obj.icon = true;\n        this.$icon = $R.dom(icon);\n\n        this.html('');\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n        this.setTooltip(this.obj.title);\n        this._buildTooltip();\n    },\n    setActive: function()\n    {\n        this.addClass('redactor-button-active');\n    },\n    setInactive: function()\n    {\n        this.removeClass('redactor-button-active');\n    },\n\n    // hide\n    hideTooltip: function()\n    {\n        this.$body.find('.re-button-tooltip').remove();\n    },\n\n    // get\n    getDropdown: function()\n    {\n        return this.dropdown;\n    },\n\n    // enable & disable\n    disable: function()\n    {\n        this.addClass('redactor-button-disabled');\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-button-disabled');\n    },\n\n    // toggle\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.isDisabled()) return;\n\n        if (this.obj.dropdown)\n        {\n            this.dropdown.toggle(e);\n        }\n        else if (this.obj.api)\n        {\n            // broadcast\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n        else if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n\n        this.hideTooltip();\n    },\n\n    // private\n    _init: function()\n    {\n        // parse\n        this._parseTitle();\n        this._parseTooltip();\n\n        // build\n        this._build();\n        this._buildCallback();\n        this._buildAttributes();\n        this._buildObserver();\n\n        if (this.hasIcon())\n        {\n            this._buildIcon();\n            this._buildTooltip();\n        }\n        else\n        {\n            this.html(this.obj.title);\n        }\n    },\n    _parseTooltip: function()\n    {\n        this.obj.tooltip = (this.obj.tooltip) ? this.lang.parse(this.obj.tooltip) : this.obj.title;\n    },\n    _parseTitle: function()\n    {\n        this.obj.title = this.lang.parse(this.obj.title);\n    },\n    _build: function()\n    {\n        this.parse('<a>');\n        this.addClass('re-button re-' + this.name);\n        this.attr('data-re-name', this.name);\n        this.dataset('data-button-instance', this);\n\n        if (this.obj.dropdown) this.setDropdown(this.obj.dropdown);\n    },\n    _buildCallback: function()\n    {\n        this.on('click', this.toggle.bind(this));\n    },\n    _buildAttributes: function()\n    {\n        var attrs = {\n            'href': '#',\n            'alt': this.obj.tooltip,\n            'rel': this.name,\n            'role': 'button',\n            'aria-label': this.obj.tooltip,\n            'tabindex': '-1'\n        };\n\n        this.attr(attrs);\n    },\n    _buildObserver: function()\n    {\n        if (typeof this.obj.observe !== 'undefined')\n        {\n            this.toolbar.addButtonObserver(this.name, this.obj.observe);\n        }\n    },\n    _buildIcon: function()\n    {\n        var icon = this.obj.icon;\n        var isHtml = (/(<([^>]+)>)/ig.test(icon));\n\n        this.$icon = (isHtml) ? $R.dom(icon) : $R.dom('<i>');\n        if (!isHtml) this.$icon.addClass('re-icon-' + this.name);\n\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n    },\n    _buildTooltip: function()\n    {\n        if (this.detector.isDesktop())\n        {\n            this.tooltip = $R.create('toolbar.button.tooltip', this.app, this);\n        }\n    }\n});\n$R.add('class', 'toolbar.button.tooltip', {\n    mixins: ['dom'],\n    init: function(app, $button)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.$button = $button;\n        this.created = false;\n\n        // init\n        this._init();\n    },\n    open: function()\n    {\n        if (this.$button.hasClass('redactor-button-disabled') || this.$button.hasClass('redactor-button-active')) return;\n\n        this.created = true;\n        this.parse('<span>');\n        this.addClass('re-button-tooltip');\n        this.$body.append(this);\n        this.html(this.$button.attr('alt'));\n\n        var offset = this.$button.offset();\n        var position = 'absolute';\n        var height = this.$button.height();\n        var width = this.$button.width();\n        var arrowOffset = 4;\n\n        this.css({\n            top: (offset.top + height + arrowOffset) + 'px',\n            left: (offset.left + width/2 - this.width()/2) + 'px',\n            position: position\n        });\n\n        this.show();\n    },\n    close: function()\n    {\n        if (!this.created || this.$button.hasClass('redactor-button-disabled')) return;\n\n        this.remove();\n        this.created = false;\n    },\n\n    // private\n    _init: function()\n    {\n        this.$button.on('mouseover', this.open.bind(this));\n        this.$button.on('mouseout', this.close.bind(this));\n    }\n});\n$R.add('class', 'toolbar.dropdown', {\n    mixins: ['dom'],\n    init: function(app, name, items)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.name = name;\n        this.started = false;\n        this.items = items;\n        this.$items = [];\n    },\n    // public\n    toggle: function(e)\n    {\n        if (!this.started)\n        {\n            this._build();\n        }\n\n        // toggle\n        if (this.isOpened() && this.isActive())\n        {\n            this.close(false);\n        }\n        else\n        {\n            this.open(e);\n        }\n    },\n    isOpened: function()\n    {\n        var $dropdown = this.$body.find('.redactor-dropdown-' + this.uuid + '.open');\n\n        return ($dropdown.length !== 0 && $dropdown.attr('data-re-name') === this.name);\n    },\n    isActive: function()\n    {\n        var $dropdown = this.$body.find('#redactor-dropdown-' + this.uuid + '-' + this.name + '.open');\n        return ($dropdown.length !== 0);\n    },\n    getName: function()\n    {\n        return this.attr('data-re-name');\n    },\n    getItem: function(name)\n    {\n        return this.$items[name];\n    },\n    getItemsByClass: function(classname)\n    {\n        var result = [];\n        for (var key in this.$items)\n        {\n            if (typeof this.$items[key] === 'object' && this.$items[key].hasClass(classname))\n            {\n                result.push(this.$items[key]);\n            }\n        }\n\n        return result;\n    },\n    open: function(e)\n    {\n        this._closeAll();\n\n        this.$btn = this.toolbar.getButton(this.name);\n        this.app.broadcast('dropdown.open', e, this, this.$btn);\n        this.toolbar.setDropdown(this);\n\n        this.show();\n        this.removeClass('redactor-animate-hide');\n        this.addClass('open');\n        this._observe();\n\n        this.$btn.hideTooltip();\n        this.$btn.setActive();\n\n        this.$doc.on('keyup.redactor.dropdown-' + this.uuid, this._handleKeyboard.bind(this));\n        this.$doc.on('click.redactor.dropdown-' + this.uuid + ' touchstart.redactor.dropdown-' + this.uuid, this.close.bind(this));\n\n        this.updatePosition();\n        this.app.broadcast('dropdown.opened', e, this, this.$btn);\n\n    },\n    close: function(e, animate)\n    {\n        if (e)\n        {\n            var $el = $R.dom(e.target);\n            if (this._isButton(e) || $el.hasClass('redactor-dropdown-not-close') || $el.hasClass('redactor-dropdown-item-disabled'))\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        this.app.broadcast('dropdown.close', this, this.$btn);\n        this.toolbar.setDropdown(false);\n\n        this.$btn.setInactive();\n        if (animate === false)\n        {\n            this._close();\n        }\n        else\n        {\n            this.animate.start(this, 'fadeOut', this._close.bind(this));\n        }\n    },\n    updatePosition: function()\n    {\n        var isFixed = this.toolbar.isFixed();\n        var pos = this.$btn.offset();\n        pos.top = (isFixed) ? this.$btn.position().top : pos.top;\n\n        var btnHeight = this.$btn.height();\n        var btnWidth = this.$btn.width();\n        var position = (isFixed) ? 'fixed' : 'absolute';\n        var topOffset = 2;\n        var leftOffset = 0;\n        var left = (pos.left + leftOffset);\n        var width = parseFloat(this.css('width'));\n        var leftFix = (this.$win.width() < (left + width)) ? (width - btnWidth) : 0;\n\n        this.css({ position: position, top: (pos.top + btnHeight + topOffset) + 'px', left: (left - leftFix) + 'px' });\n    },\n\n    // private\n    _build: function()\n    {\n        this.parse('<div>');\n        this.attr('dir', this.opts.direction);\n        this.attr('id', 'redactor-dropdown-' + this.uuid + '-' + this.name);\n        this.attr('data-re-name', this.name);\n\n        this.addClass('redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-' + this.name);\n        this.dataset('data-dropdown-instance', this);\n        var isDom = (this.items.dom || typeof this.items === 'string');\n\n        if (isDom) this._buildDom();\n        else this._buildItems();\n\n        this.$body.append(this);\n        this.started = true;\n    },\n    _buildDom: function()\n    {\n        this.html('').append($R.dom(this.items));\n    },\n    _buildItems: function()\n    {\n        this.items = (this.name === 'format') ? this._buildFormattingItems() : this.items;\n\n        for (var key in this.items)\n        {\n            var obj = this.items[key];\n\n            if (key === 'observe')\n            {\n                this.attr('data-observe', this.items[key]);\n            }\n            else\n            {\n                var $item = $R.create('toolbar.dropdown.item', this.app, key, obj, this);\n\n                this.$items[key] = $item;\n                this.append($item);\n            }\n        }\n    },\n    _buildFormattingItems: function()\n    {\n        // build the format set\n        for (var key in this.items)\n        {\n            if (this.opts.formatting.indexOf(key) === -1) delete this.items[key];\n        }\n\n        // remove from the format set\n        if (this.opts.formattingHide)\n        {\n            for (var key in this.items)\n            {\n                if (this.opts.formattingHide.indexOf(key) !== -1) delete this.items[key];\n            }\n        }\n\n        // add to the format set\n        if (this.opts.formattingAdd)\n        {\n            for (var key in this.opts.formattingAdd)\n            {\n                this.items[key] = this.opts.formattingAdd[key];\n            }\n        }\n\n        return this.items;\n    },\n    _handleKeyboard: function(e)\n    {\n        if (e.which === 27) this.close();\n    },\n    _isButton: function(e)\n    {\n        var $el = $R.dom(e.target);\n        var $btn = $el.closest('.re-button');\n\n        return ($btn.get() === this.$btn.get());\n    },\n    _close: function()\n    {\n        this.$btn.setInactive();\n        this.$doc.off('.redactor.dropdown-' + this.uuid);\n        this.removeClass('open');\n        this.addClass('redactor-animate-hide');\n        this.app.broadcast('dropdown.closed', this, this.$btn);\n    },\n    _closeAll: function()\n    {\n        this.$body.find('.redactor-dropdown-' + this.uuid + '.open').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var instance =  $node.dataget('data-dropdown-instance');\n            instance._close();\n        });\n    },\n    _observe: function()\n    {\n        var observer = this.attr('data-observe');\n        if (observer)\n        {\n            this.app.broadcast('dropdown.' + observer + '.observe', this);\n        }\n    }\n});\n$R.add('class', 'toolbar.dropdown.item', {\n    mixins: ['dom'],\n    init: function(app, name, obj, dropdown)\n    {\n        this.app = app;\n        this.lang = app.lang;\n\n        // local\n        this.dropdown = dropdown;\n        this.name = name;\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    setTitle: function(html)\n    {\n        this.$span.html(html);\n    },\n    getTitle: function()\n    {\n        return this.$span.html();\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-dropdown-item-disabled');\n    },\n    disable: function()\n    {\n        this.addClass('redactor-dropdown-item-disabled');\n    },\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.hasClass('redactor-dropdown-item-disabled')) return;\n\n        if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n    },\n\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n        this.attr('href', '#');\n        this.addClass('redactor-dropdown-item-' + this.name);\n\n        if (this.obj.classname)\n        {\n            this.addClass(this.obj.classname);\n        }\n\n        this.attr('data-re-name', this.name);\n        this.on('click', this.toggle.bind(this));\n\n        this.$span = $R.dom('<span>');\n        this.append(this.$span);\n        this.setTitle(this.lang.parse(this.obj.title));\n    }\n});\n$R.add('service', 'cleaner', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.storedComponents = [];\n        this.storedImages = [];\n        this.storedLinks = [];\n        this.deniedTags = ['font', 'html', 'head', 'link', 'title', 'body', 'meta', 'applet'];\n        this.convertRules = {};\n        this.unconvertRules = {};\n\n        // regex\n        this.reComments = /<!--[\\s\\S]*?-->/g;\n        this.reSpacedEmpty = /^(||\\s||<br\\s?\\/?>||&nbsp;)$/i;\n        this.reScriptTag = /<script(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi;\n    },\n    // public\n    addConvertRules: function(name, func)\n    {\n        this.convertRules[name] = func;\n    },\n    addUnconvertRules: function(name, func)\n    {\n        this.unconvertRules[name] = func;\n    },\n    input: function(html, paragraphize, started)\n    {\n        // pre/code\n        html = this.encodePreCode(html);\n\n        // converting entity\n        html = html.replace(/\\$/g, '&#36;');\n        html = html.replace(/&amp;/g, '&');\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.convert(html, this.convertRules);\n\n        // store components\n        html = this.storeComponents(html);\n\n        // clean\n        html = this.replaceTags(html, this.opts.replaceTags);\n        html = this._setSpanAttr(html);\n        html = this._setStyleCache(html);\n        html = this.removeTags(html, this.deniedTags);\n        html = (this.opts.removeScript) ? this._removeScriptTag(html) : this._replaceScriptTag(html);\n        html = (this.opts.removeComments) ? this.removeComments(html) : html;\n        html = (this._isSpacedEmpty(html)) ? this.opts.emptyHtml : html;\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        // clear wrapped components\n        html = this._cleanWrapped(html);\n\n        // paragraphize\n        html = (paragraphize) ? this.paragraphize(html) : html;\n\n        return html;\n    },\n    output: function(html, removeMarkers)\n    {\n        html = this.removeInvisibleSpaces(html);\n\n        // empty\n        if (this._isSpacedEmpty(html)) return '';\n        if (this._isParagraphEmpty(html)) return '';\n\n        html = this.removeServiceTagsAndAttrs(html, removeMarkers);\n\n        // store components\n        html = this.storeComponents(html);\n\n        html = this.removeSpanWithoutAttributes(html);\n        html = this.removeFirstBlockBreaklineInHtml(html);\n\n        html = (this.opts.removeScript) ? html : this._unreplaceScriptTag(html);\n        html = (this.opts.preClass) ? this._setPreClass(html) : html;\n        html = (this.opts.linkNofollow) ? this._setLinkNofollow(html) : html;\n        html = (this.opts.removeNewLines) ? this.cleanNewLines(html) : html;\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.unconvert(html, this.unconvertRules);\n\n        // final clean up\n        html = this.removeEmptyAttributes(html, ['style', 'class', 'rel', 'alt', 'title']);\n        html = this.cleanSpacesInPre(html);\n        html = this.tidy(html);\n\n        // converting entity\n        html = html.replace(/&amp;/g, '&');\n\n        // check whitespaces\n        html = (html.replace(/\\n/g, '') === '') ? '' : html;\n\n        return html;\n    },\n    paste: function(html)\n    {\n        // store components\n        html = this.storeComponents(html);\n\n        // remove tags\n        var deniedTags = this.deniedTags.concat(['iframe']);\n        html = this.removeTags(html, deniedTags);\n\n        // remove doctype tag\n        html = html.replace(new RegExp(\"<\\!doctype([\\\\s\\\\S]+?)>\", 'gi'), '');\n\n        // remove style tag\n        html = html.replace(new RegExp(\"<style([\\\\s\\\\S]+?)</style>\", 'gi'), '');\n\n        // remove br between\n        html = html.replace(new RegExp(\"</p><br /><p\", 'gi'), '</p><p');\n\n        // gdocs & word\n        var isMsWord = this._isHtmlMsWord(html);\n\n        html = this._cleanGDocs(html);\n        html = (isMsWord) ? this._cleanMsWord(html) : html;\n\n        // do not clean\n        if (!this.opts.pasteClean)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return html;\n        }\n\n        // plain text\n        if (this.opts.pastePlainText)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return this.pastePlainText(html);\n        }\n\n        // remove tags\n        var exceptedTags = this.opts.pasteBlockTags.concat(this.opts.pasteInlineTags);\n        html = this.removeTagsExcept(html, exceptedTags);\n\n\n        // links & images\n        html = (this.opts.pasteLinks) ? html : this.removeTags(html, ['a']);\n        html = (this.opts.pasteImages) ? html : this.removeTags(html, ['img']);\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // clean attrs\n        var $elms = $wrapper.find('*');\n\n        // remove style\n        var filterStyle = (this.opts.pasteKeepStyle.length !== 0) ? ',' + this.opts.pasteKeepStyle.join(',') : '';\n        $elms.not('[data-redactor-style-cache]' + filterStyle).removeAttr('style');\n\n        // remove class\n        var filterClass = (this.opts.pasteKeepClass.length !== 0) ? ',' + this.opts.pasteKeepClass.join(',') : '';\n        $elms.not('[data-redactor-style-cache]' + filterClass).removeAttr('class');\n\n        // remove attrs\n        var filterAttrs = (this.opts.pasteKeepAttrs.length !== 0) ? ',' + this.opts.pasteKeepAttrs.join(',') : '';\n        $elms.not('img, a, [data-redactor-style-cache]' + filterAttrs).each(function(node)\n        {\n            while(node.attributes.length > 0)\n            {\n                node.removeAttribute(node.attributes[0].name);\n            }\n        });\n\n        // paste link target\n        if (this.opts.pasteLinks && this.opts.pasteLinkTarget !== false)\n        {\n            $wrapper.find('a').attr('target', this.opts.pasteLinkTarget);\n        }\n\n        // keep style\n        $wrapper.find('[data-redactor-style-cache]').each(function(node)\n        {\n            var style = node.getAttribute('data-redactor-style-cache');\n            node.setAttribute('style', style);\n        });\n\n        // remove empty span\n        $wrapper.find('span').each(function(node)\n        {\n            if (node.attributes.length === 0)\n            {\n                $R.dom(node).unwrap();\n            }\n        });\n\n        // remove empty inline\n        $wrapper.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.attributes.length === 0 && this.utils.isEmptyHtml(node.innerHTML))\n            {\n                $R.dom(node).unwrap();\n            }\n\n        }.bind(this));\n\n        // place ul/ol into li\n        $wrapper.find('ul, ol').each(function(node)\n        {\n            var prev = node.previousSibling;\n            if (prev && prev.tagName === 'LI')\n            {\n                var $li = $R.dom(prev);\n                $li.find('p').unwrap();\n                $li.append(node);\n            }\n        });\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // remove paragraphs form lists (google docs bug)\n        html = html.replace(/<li><p>/gi, '<li>');\n        html = html.replace(/<\\/p><\\/li>/gi, '</li>');\n\n        // clean empty p\n        html = html.replace(/<p>&nbsp;<\\/p>/gi, '<p></p>');\n        html = html.replace(/<p><br\\s?\\/?><\\/p>/gi, '<p></p>');\n\n        if (isMsWord)\n        {\n            html = html.replace(/<p><\\/p>/gi, '');\n            html = html.replace(/<p>\\s<\\/p>/gi, '');\n        }\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        return html;\n    },\n    pastePlainText: function(html)\n    {\n        html = (this.opts.pasteLinks) ? this.storeLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.storeImages(html) : html;\n\n        html = this.getPlainText(html);\n        html = this._replaceNlToBr(html);\n\n        html = (this.opts.pasteLinks) ? this.restoreLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.restoreImages(html) : html;\n\n        return html;\n    },\n    tidy: function(html)\n    {\n        return html;\n    },\n    paragraphize: function(html)\n    {\n        var paragraphize = $R.create('cleaner.paragraphize', this.app);\n\n        return paragraphize.convert(html);\n    },\n\n    // get\n    getFlatText: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (!html.nodeType && !html.dom)\n        {\n            html = html.toString();\n            html = html.trim();\n            $div.html(html);\n        }\n        else\n        {\n            $div.append(html);\n        }\n\n        html = $div.get().textContent || $div.get().innerText || '';\n\n        return (html === undefined) ? '' : html;\n    },\n\tgetPlainText: function(html)\n\t{\n\t\thtml = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\thtml = html.replace(/<style[\\s\\S]*?style>/gi, '');\n        html = html.replace(/<p><\\/p>/g, '');\n\t\thtml = html.replace(/<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\thtml = html.replace(/<\\/p>/gi, '\\n\\n');\n\t\thtml = html.replace(/<\\/H[1-6]>/gi, '\\n\\n');\n\n\t\tvar tmp = document.createElement('div');\n\t\ttmp.innerHTML = html;\n\n\t\thtml = tmp.textContent || tmp.innerText;\n\n\t\treturn html.trim();\n\t},\n\n    // replace\n    replaceTags: function(html, tags)\n    {\n        if (tags)\n        {\n            var self = this;\n            var keys = Object.keys(tags);\n            var $wrapper = this.utils.buildWrapper(html);\n            $wrapper.find(keys.join(',')).each(function(node)\n            {\n                self.utils.replaceToTag(node, tags[node.tagName.toLowerCase()]);\n            });\n\n            html = this.utils.getWrapperHtml($wrapper);\n        }\n\n        return html;\n    },\n    replaceNbspToSpaces: function(html)\n    {\n        return html.replace('&nbsp;', ' ');\n    },\n    replaceBlocksToBr: function(html)\n    {\n        html = html.replace(/<\\/div>|<\\/li>|<\\/td>|<\\/p>|<\\/H[1-6]>/gi, '<br>');\n\n        return html;\n    },\n\n    // clean\n    cleanNewLines: function(html)\n    {\n        return html.replace(/\\r?\\n/g, \"\");\n    },\n    cleanSpacesInPre: function(html)\n    {\n        return html.replace('&nbsp;&nbsp;&nbsp;&nbsp;', '    ');\n    },\n\n    // remove\n    removeInvisibleSpaces: function(html)\n    {\n        html = this.utils.removeInvisibleChars(html);\n        html = html.replace(/&#65279;/gi, '');\n\n        return html;\n    },\n    removeNl: function(html)\n    {\n        html = html.replace(/\\n/g, \" \");\n        html = html.replace(/\\s+/g, \"\\s\");\n\n        return html;\n    },\n    removeBrAtEnd: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>$/gi, ' ');\n        html = html.replace(/<br\\s?\\/?><li/gi, '<li');\n\n        return html;\n    },\n    removeTags: function(input, denied)\n    {\n        var re = (denied) ? /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi : /(<([^>]+)>)/gi;\n        var replacer = (!denied) ? '' : function ($0, $1)\n        {\n            return denied.indexOf($1.toLowerCase()) === -1 ? $0 : '';\n        };\n\n        return input.replace(re, replacer);\n    },\n    removeTagsExcept: function(input, except)\n    {\n        if (except === undefined) return input.replace(/(<([^>]+)>)/gi, '');\n\n        var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n        return input.replace(tags, function($0, $1)\n        {\n            return except.indexOf($1.toLowerCase()) === -1 ? '' : $0;\n        });\n    },\n    removeComments: function(html)\n    {\n        return html.replace(this.reComments, '');\n    },\n    removeServiceTagsAndAttrs: function(html, removeMarkers)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        var self = this;\n        if (removeMarkers !== false)\n        {\n            $wrapper.find('.redactor-selection-marker').each(function(node)\n            {\n                var $el = $R.dom(node);\n                var text = self.utils.removeInvisibleChars($el.text());\n\n                return (text === '') ? $el.remove() : $el.unwrap();\n            });\n        }\n\n        $wrapper.find('[data-redactor-style-cache]').removeAttr('data-redactor-style-cache');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeSpanWithoutAttributes: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').removeAttr('data-redactor-span data-redactor-style-cache').each(function(node)\n        {\n            if (node.attributes.length === 0) $R.dom(node).unwrap();\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeFirstBlockBreaklineInHtml: function(html)\n    {\n        return html.replace(new RegExp('</li><br\\\\s?/?>', 'gi'), '</li>');\n    },\n    removeEmptyAttributes: function(html, attrs)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        for (var i = 0; i < attrs.length; i++)\n        {\n            $wrapper.find('[' + attrs[i] + '=\"\"]').removeAttr(attrs[i]);\n        }\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // encode / decode\n    encodeHtml: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>/g, \"\\n\");\n        html = html.replace(/&nbsp;/g, ' ');\n        html = html.replace(/”/g, '\"');\n        html = html.replace(/“/g, '\"');\n        html = html.replace(/‘/g, '\\'');\n        html = html.replace(/’/g, '\\'');\n        html = this.encodeEntities(html);\n        html = html.replace(/\\$/g, '&#36;');\n\n        if (this.opts.preSpaces)\n        {\n            html = html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n        }\n\n        return html;\n    },\n    encodePreCode: function(html)\n    {\n        var matched = html.match(new RegExp('<code(.*?)>(.*?)<pre(.*?)>(.*?)</pre>(.*?)</code>', 'gi'));\n        if (matched !== null)\n        {\n            for (var i = 0; i < matched.length; i++)\n            {\n                var arr = matched[i].match(new RegExp('<pre(.*?)>([\\\\w\\\\W]*?)</pre>', 'i'));\n                html = html.replace(arr[0], this.encodeEntities(arr[0]));\n            }\n        }\n\n        var $wrapper = this.utils.buildWrapper(html);\n\n        $wrapper.find('code code').replaceWith(this._encodeOuter.bind(this));\n        $wrapper.find('code pre').replaceWith(this._encodeOuter.bind(this));\n        $wrapper.find('pre pre').replaceWith(this._encodeOuter.bind(this));\n        $wrapper.find('code, pre').each(this._encodePreCodeLine.bind(this));\n\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // restore markers\n        html = this._decodeMarkers(html);\n\n        return html;\n    },\n    encodeEntities: function(str)\n    {\n        str = this.decodeEntities(str);\n        str = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n        return str;\n    },\n    encodePhpCode: function(html)\n    {\n        html = html.replace('<?php', '&lt;?php');\n        html = html.replace('<?', '&lt;?');\n        html = html.replace('?>', '?&gt;');\n\n        return html;\n    },\n    decodeEntities: function(str)\n    {\n        return String(str).replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&amp;/g, '&');\n    },\n\n    // store / restore\n    storeComponents: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'figure', 'table');\n\n        return this._storeMatched(html, matched, 'Components', 'figure');\n    },\n    restoreComponents: function(html)\n    {\n        return this._restoreMatched(html, 'Components', 'figure');\n    },\n    storeLinks: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'a');\n\n        return this._storeMatched(html, matched, 'Links', 'a');\n    },\n    storeImages: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'img');\n\n        return this._storeMatched(html, matched, 'Images', 'img');\n    },\n    restoreLinks: function(html)\n    {\n        return this._restoreMatched(html, 'Links', 'a');\n    },\n    restoreImages: function(html)\n    {\n        return this._restoreMatched(html, 'Images', 'img');\n    },\n\n    // PRIVATE\n\n    // clean\n    _cleanWrapped: function(html)\n    {\n        html = html.replace(new RegExp('<p><figure([\\\\w\\\\W]*?)</figure></p>', 'gi'), '<figure$1</figure>');\n\n        return html;\n    },\n    _cleanGDocs: function(html)\n    {\n        // remove google docs markers\n        html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n        html = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n\n        html = html.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*font-style: italic[^>]*>([\\w\\W]*?)<\\/span>/gi, '<i>$1</i>');\n        html = html.replace(/<span[^>]*font-weight: bold[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n        html = html.replace(/<span[^>]*font-weight: 700[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n\n        return html;\n    },\n    _cleanMsWord: function(html)\n    {\n        html = html.replace(/<!--[\\s\\S]+?-->/gi, '');\n        html = html.replace(/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|img|meta|link|style|\\w:\\w+)(?=[\\s\\/>]))[^>]*>/gi, '');\n        html = html.replace(/<(\\/?)s>/gi, \"<$1strike>\");\n        html = html.replace(/&nbsp;/gi, ' ');\n        html = html.replace(/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi, function(str, spaces) {\n            return (spaces.length > 0) ? spaces.replace(/./, \" \").slice(Math.floor(spaces.length/2)).split(\"\").join(\"\\u00a0\") : '';\n        });\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        $wrapper.find('p').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var str = $node.attr('style');\n            var matches = /mso-list:\\w+ \\w+([0-9]+)/.exec(str);\n            if (matches)\n            {\n                $node.data('_listLevel',  parseInt(matches[1], 10));\n            }\n        });\n\n        // parse Lists\n        this._parseWordLists($wrapper);\n\n        $wrapper.find('[style]').removeAttr('style');\n        $wrapper.find('[align]').removeAttr('align');\n        $wrapper.find('[name]').removeAttr('name');\n        $wrapper.find('span').unwrap();\n        $wrapper.find(\"[class^='Mso']\").removeAttr('class');\n        $wrapper.find('a').filter(function(node) { return !node.hasAttribute('href'); }).unwrap();\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<p[^>]*><\\/p>/gi, '');\n        html = html.replace(/<li>·/gi, '<li>');\n        html = html.trim();\n\n        // remove spaces between\n        html = html.replace(/\\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi, '/$1>\\n<$2');\n\n        var result = '';\n        var lines = html.split(/\\n/);\n        for (var i = 0; i < lines.length; i++)\n        {\n            var space = (lines[i] !== '' && lines[i].search(/>$/) === -1) ? ' ' : '\\n';\n\n            result += lines[i] + space;\n        }\n\n        return result;\n    },\n    _parseWordLists: function($wrapper)\n    {\n        var lastLevel = 0;\n        var pnt = null;\n\n        $wrapper.find('p').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var currentLevel = $node.data('_listLevel');\n            if (currentLevel !== null)\n            {\n                var txt = $node.text();\n                var listTag = '<ul></ul>';\n                if (/^\\s*\\w+\\./.test(txt))\n                {\n                    var matches = /([0-9])\\./.exec(txt);\n                    if (matches)\n                    {\n                        var start = parseInt(matches[1], 10);\n                        listTag = (start > 1) ? '<ol start=\"' + start + '\"></ol>' : '<ol></ol>';\n                    }\n                    else\n                    {\n                        listTag = '<ol></ol>';\n                    }\n                }\n\n                if (currentLevel > lastLevel)\n                {\n                    if (lastLevel === 0)\n                    {\n                        $node.before(listTag);\n                        pnt = $node.prev();\n                    }\n                    else\n                    {\n                        var $list = $R.dom(listTag);\n                        pnt.append($list);\n                    }\n                }\n\n                if (currentLevel < lastLevel)\n                {\n                    for (var i = 0; i < (lastLevel - currentLevel); i++)\n                    {\n                        pnt = pnt.parent();\n                    }\n                }\n\n                $node.find('span').first().unwrap();\n                pnt.append('<li>' + $node.html() + '</li>');\n                $node.remove();\n                lastLevel = currentLevel;\n            }\n            else\n            {\n                lastLevel = 0;\n            }\n        });\n    },\n\n    // is\n    _isSpacedEmpty: function(html)\n    {\n        return (html.search(this.reSpacedEmpty) !== -1);\n    },\n    _isParagraphEmpty: function(html)\n    {\n        return (html.search(/^<p><\\/p>$/i) !== -1);\n    },\n    _isHtmlMsWord: function(html)\n    {\n        return html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n    },\n\n    // set\n    _setSpanAttr: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').attr('data-redactor-span', true);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setStyleCache: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('[style]').each(function(node)\n        {\n            var $el = $R.dom(node);\n            $el.attr('data-redactor-style-cache', $el.attr('style'));\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setPreClass: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('pre').addClass(this.opts.preClass);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setLinkNofollow: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a').attr('rel', 'nofollow');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // replace\n    _replaceScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '<pre class=\"redactor-script-tag\" $1>$2</pre>');\n    },\n    _unreplaceScriptTag: function(html)\n    {\n        return html.replace(/<pre class=\"redactor-script-tag\"(.*?[^>]?)>([\\w\\W]*?)<\\/pre>/gi, '<script$1>$2</script>');\n    },\n\t_replaceNlToBr: function(html)\n\t{\n\t\treturn html.replace(/\\n/g, '<br />');\n\t},\n\n    // remove\n    _removeScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '');\n    },\n\n    // private\n    _storeMatched: function(html, matched, stored, name)\n    {\n        this['stored' + stored] = [];\n        if (matched)\n        {\n            for (var i = 0; i < matched.length; i++)\n            {\n                this['stored' + stored][i] = matched[i];\n                html = html.replace(matched[i], '####' + name + i + '####');\n            }\n        }\n\n        return html;\n    },\n    _restoreMatched: function(html, stored, name)\n    {\n        if (this['stored' + stored])\n        {\n            for (var i = 0; i < this['stored' + stored].length; i++)\n            {\n                html = html.replace('####' + name + i + '####', this['stored' + stored][i]);\n            }\n        }\n\n        return html;\n    },\n    _decodeMarkers: function(html)\n    {\n        var decodedMarkers = '<span id=\"selection-marker-$1\" class=\"redactor-selection-marker\">​</span>';\n        return html.replace(/&lt;span\\sid=\"selection-marker-(start|end)\"\\sclass=\"redactor-selection-marker\"&gt;(.*?[^>]?)&lt;\\/span&gt;/g, decodedMarkers);\n    },\n    _encodeOuter: function(node)\n    {\n        return this.encodeEntities(node.outerHTML);\n    },\n    _encodePreCodeLine: function(node)\n    {\n        var first = node.firstChild;\n        if (node.tagName == 'PRE' && (first && first.tagName === 'CODE')) return;\n\n        var encoded = this.decodeEntities(node.innerHTML);\n        encoded = encoded.replace(/&nbsp;/g, ' ').replace(/<br\\s?\\/?>/g, '\\n');\n        encoded = (this.opts.preSpaces) ? encoded.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' ')) : encoded;\n\n        node.textContent = encoded;\n    }\n});\n$R.add('class', 'cleaner.figure', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n    },\n    // public\n    convert: function(html, rules)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // convert\n        $wrapper.find('img').each(this._convertImage.bind(this));\n        $wrapper.find('hr').each(this._convertLine.bind(this));\n        $wrapper.find('iframe').each(this._convertIframe.bind(this));\n        $wrapper.find('table').each(this._convertTable.bind(this));\n        $wrapper.find('form').each(this._convertForm.bind(this));\n        $wrapper.find('figure pre').each(this._convertCode.bind(this));\n\n        // variables\n        $wrapper.find('[data-redactor-type=variable]').addClass('redactor-component');\n\n        // widgets\n        $wrapper.find('figure').not('.redactor-component, .redactor-figure-code').each(this._convertWidget.bind(this));\n\n        // contenteditable\n        $wrapper.find('figure pre').each(this._setContenteditableCode.bind(this));\n        $wrapper.find('.redactor-component, .non-editable').attr('contenteditable', false);\n\n        $wrapper.find('figcaption, td, th').attr('contenteditable', true);\n        $wrapper.find('.redactor-component, figcaption').attr('tabindex', '-1');\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    unconvert: function(html, rules)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // contenteditable\n        $wrapper.find('th, td, figcaption, figure, pre, code, .redactor-component').removeAttr('contenteditable tabindex');\n\n        // remove class\n        $wrapper.find('figure').removeClass('redactor-component redactor-component-active redactor-uploaded-figure');\n\n        // unconvert\n        $wrapper.find('[data-redactor-type=variable]').removeClass('redactor-component');\n        $wrapper.find('figure[data-redactor-type=line]').unwrap();\n        $wrapper.find('figure[data-redactor-type=widget]').each(this._unconvertWidget.bind(this));\n        $wrapper.find('figure[data-redactor-type=form]').each(this._unconvertForm.bind(this));\n        $wrapper.find('figure[data-redactor-type=table]').each(this._unconvertTable.bind(this));\n        $wrapper.find('figure[data-redactor-type=image]').removeAttr('rel').each(this._unconvertImages.bind(this));\n\n        $wrapper.find('img').removeAttr('data-redactor-type').removeClass('redactor-component');\n        $wrapper.find('.non-editable').removeAttr('contenteditable');\n\n        // remove types\n        $wrapper.find('figure').each(this._removeTypes.bind(this));\n\n        // remove caret\n        $wrapper.find('span.redactor-component-caret').remove();\n\n        if (this.opts.breakline)\n        {\n            $wrapper.find('[data-redactor-tag=\"br\"]').each(function(node)\n            {\n                if (node.lastChild && node.lastChild.tagName !== 'BR')\n                {\n                    node.appendChild(document.createElement('br'));\n                }\n            }).unwrap();\n        }\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<br\\s?\\/?>$/, '');\n\n        return html;\n    },\n\n    // private\n    _convertImage: function(node)\n    {\n        var $node = $R.dom(node);\n        if (this._isNonEditable($node)) return;\n\n        // set id\n        if (!$node.attr('data-image'))\n        {\n            $node.attr('data-image', this.utils.getRandomId());\n        }\n\n        var $link = $node.closest('a');\n        var $figure = $node.closest('figure');\n        var isImage = ($figure.children().not('a, img, br, figcaption').length === 0);\n        if (!isImage) return;\n\n        if ($figure.length === 0)\n        {\n            $figure = ($link.length !== 0) ? $link.wrap('<figure>') : $node.wrap('<figure>');\n        }\n        else\n        {\n            if ($figure.hasClass('redactor-uploaded-figure'))\n            {\n                $figure.removeClass('redactor-uploaded-figure');\n            }\n            else\n            {\n                $figure.addClass('redactor-keep-figure');\n            }\n        }\n\n        this._setFigure($figure, 'image');\n    },\n    _convertTable: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'table');\n    },\n    _convertLine: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'line');\n    },\n    _convertForm: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this.utils.replaceToTag(node, 'figure');\n        this._setFigure($figure, 'form');\n    },\n    _convertIframe: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var src = node.getAttribute('src');\n        var isVideo = (src && (src.match(this.opts.regex.youtube) || src.match(this.opts.regex.vimeo)));\n        var $figure = this._wrapFigure(node);\n\n        if (isVideo)\n        {\n            this._setFigure($figure, 'video');\n        }\n    },\n    _convertCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'code');\n    },\n    _convertWidget: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        $node.addClass('redactor-component');\n        $node.attr('data-redactor-type', 'widget');\n        $node.attr('data-widget-code', encodeURI(node.innerHTML.trim()));\n    },\n\n    // unconvert\n    _unconvertForm: function(node)\n    {\n        this.utils.replaceToTag(node, 'form');\n    },\n    _unconvertTable: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.unwrap();\n    },\n    _unconvertWidget: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.html(decodeURI($node.attr('data-widget-code')));\n        $node.removeAttr('data-widget-code');\n    },\n    _unconvertImages: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.removeClass('redactor-component');\n\n        var isList = ($node.closest('li').length !== 0);\n        var isTable = ($node.closest('table').length !== 0);\n        var hasFigcaption = ($node.find('figcaption').length !== 0);\n\n        var style = $node.attr('style');\n        var hasStyle = !(style === null || style === '');\n        var hasClass = ($node.attr('class') !== '');\n\n        if (isList || (isTable && !hasFigcaption && !hasStyle && !hasClass))\n        {\n            $node.unwrap();\n        }\n    },\n    _removeTypes: function(node)\n    {\n        var $node = $R.dom(node);\n        var type = $node.attr('data-redactor-type');\n        var removed = ['image', 'widget', 'line', 'video', 'code', 'form', 'table'];\n        if (type && removed.indexOf(type) !== -1)\n        {\n            $node.removeAttr('data-redactor-type');\n        }\n\n        // keep figure\n        if ($node.hasClass('redactor-keep-figure'))\n        {\n            $node.removeClass('redactor-keep-figure');\n        }\n        // unwrap figure\n        else if (this.opts.imageFigure === false)\n        {\n            var hasFigcaption = ($node.find('figcaption').length !== 0);\n            if (!hasFigcaption)\n            {\n                $node.unwrap();\n            }\n        }\n    },\n\n    // wrap\n    _wrapFigure: function(node)\n    {\n        var $node = $R.dom(node);\n        var $figure = $node.closest('figure');\n\n        return ($figure.length === 0) ? $node.wrap('<figure>') : $figure;\n    },\n\n    // set\n    _setFigure: function($figure, type)\n    {\n        $figure.addClass('redactor-component');\n        $figure.attr('data-redactor-type', type);\n    },\n    _setContenteditableCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        var $code = $node.children('code').first();\n\n        var $el = ($code.length !== 0) ? $code : $node;\n        $el.attr('contenteditable', true).attr('tabindex', '-1');\n    },\n\n    // utils\n    _acceptExtraRules: function($wrapper, rules)\n    {\n        for (var key in rules)\n        {\n            if (typeof rules[key] === 'function')\n            {\n                rules[key]($wrapper);\n            }\n        }\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    }\n});\n$R.add('class', 'cleaner.paragraphize', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.element = app.element;\n\n        // local\n        this.stored = [];\n        this.remStart = '#####replace';\n        this.remEnd = '#####';\n        this.paragraphizeTags = ['table', 'div', 'pre', 'form', 'ul', 'ol', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'dl', 'blockquote', 'figcaption',\n                'address', 'section', 'header', 'footer', 'aside', 'article', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n                'button', 'option', 'map', 'area', 'math', 'hr', 'fieldset', 'legend', 'hgroup', 'nav', 'figure', 'details', 'menu', 'summary', 'p'];\n    },\n    // public\n    convert: function(html)\n    {\n        var value = this._isConverted(html);\n\n        return (value === true) ? this._convert(html) : value;\n    },\n\n    // private\n    _convert: function(html)\n    {\n        // build markup tag\n        var markupTag = (this.opts.breakline) ? 'sdivtag' : this.opts.markup;\n\n        // store tags\n        html = this._storeTags(html);\n\n        // remove new lines\n        html = html.trim();\n\n        if (this.opts.breakline)\n        {\n            html = html.replace(new RegExp('\\\\n#####', 'gi'), 'xnonbreakmarkerz#####');\n            html = html.replace(new RegExp('#####\\\\n\\\\n', 'gi'), \"#####\\nxnonbreakmarkerz\");\n            html = html.replace(new RegExp('#####\\\\n', 'gi'), \"#####xnonbreakmarkerz\");\n            html = html.replace(/<br\\s?\\/?>\\n/gi, \"<br>\");\n            html = html.replace(/\\n/g, \"<br>\");\n            html = html.replace(/xnonbreakmarkerz/gi, \"\\n\");\n        }\n        else\n        {\n            html = html.replace(/[\\n]+/g, \"\\n\");\n        }\n\n        html = this._trimEmptyLines(html);\n\n        // paragraph and break markers\n        html = (this.opts.breakline) ? html : html.replace(/<br\\s?\\/?>\\n/gi, \"xbreakmarkerz\\n\");\n        html = html.replace(/(?:\\r\\n|\\r|\\n)/g, \"xparagraphmarkerz\");\n\n        // replace markers\n        html = html.replace(/xparagraphmarkerz/gi, \"</\" + markupTag + \">\\n<\" + markupTag + \">\");\n        html = (this.opts.breakline) ? html : html.replace(/xbreakmarkerz/gi, \"<br>\");\n\n        // wrap all\n        html = '<' + markupTag + '>' + html + '</' + markupTag + '>';\n\n        // clean\n        html = html.replace(new RegExp('<' + markupTag + '>#####', 'gi'), '#####');\n        html = html.replace(new RegExp('#####</' + markupTag + '>', 'gi'), '#####');\n\n        // restore tags\n        html = this._restoreTags(html);\n\n        // clean restored\n        html = (this.opts.breakline) ? html : html.replace(new RegExp('<' + markupTag + '><br\\\\s?/?></' + markupTag + '>', 'gi'), '<' + markupTag + '></' + markupTag + '>');\n        html = html.replace(new RegExp('<sdivtag>', 'gi'), '<div data-redactor-tag=\"br\">');\n        html = html.replace(new RegExp('sdivtag', 'gi'), 'div');\n\n        return html;\n    },\n    _storeTags: function(html)\n    {\n        var self = this;\n        var $wrapper = this.utils.buildWrapper(html);\n\n        if (this.opts.breakline)\n        {\n            $wrapper.find('p').each(function(node)\n            {\n                var $node = $R.dom(node);\n                var isUnwrap = ($node.closest('figure[data-redactor-type=widget],figure[data-redactor-type=form],.non-editable').length === 0);\n\n                if (isUnwrap)\n                {\n                    $node.append('<br><br>');\n                    $node.unwrap();\n                }\n            });\n        }\n\n        $wrapper.find(this.paragraphizeTags.join(', ')).each(function(node, i)\n        {\n            var replacement = document.createTextNode(\"\\n\" + self.remStart + i + self.remEnd + \"\\n\");\n            self.stored.push(node.outerHTML);\n            node.parentNode.replaceChild(replacement, node);\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _restoreTags: function(html)\n    {\n        for (var i = 0; i < this.stored.length; i++)\n        {\n            this.stored[i] = this.stored[i].replace(/\\$/g, '&#36;');\n            html = html.replace(this.remStart + i + this.remEnd, this.stored[i]);\n        }\n\n        return html;\n    },\n    _trimEmptyLines: function(html)\n    {\n        var str = '';\n        var arr = html.split(\"\\n\");\n        for (var i = 0; i < arr.length; i++)\n        {\n            if (arr[i].trim() !== '')\n            {\n                str += arr[i] + \"\\n\";\n            }\n        }\n\n        return str.replace(/\\n$/, '');\n    },\n    _isConverted: function(html)\n    {\n        if (this._isDisabled(html)) return html;\n        else if (this._isEmptyHtml(html)) return this.opts.emptyHtml;\n        else return true;\n    },\n    _isDisabled: function()\n    {\n        return (this.opts.paragraphize === false || this.element.isType('inline'));\n    },\n    _isEmptyHtml: function(html)\n    {\n        return (html === '' || html === '<p></p>' || html === '<div></div>');\n    }\n});\n$R.add('service', 'detector', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.userAgent = navigator.userAgent.toLowerCase();\n    },\n\tisWebkit: function()\n\t{\n\t\treturn /webkit/.test(this.userAgent);\n\t},\n\tisFirefox: function()\n\t{\n\t\treturn (this.userAgent.indexOf('firefox') > -1);\n\t},\n\tisIe: function(v)\n\t{\n        if (document.documentMode || /Edge/.test(navigator.userAgent)) return 'edge';\n\n\t\tvar ie;\n\t\tie = RegExp('msie' + (!isNaN(v)?('\\\\s'+v):''), 'i').test(navigator.userAgent);\n\t\tif (!ie) ie = !!navigator.userAgent.match(/Trident.*rv[ :]*11\\./);\n\n\t\treturn ie;\n\t},\n\tisMobile: function()\n\t{\n\t\treturn /(iPhone|iPod|Android)/.test(navigator.userAgent);\n\t},\n\tisDesktop: function()\n\t{\n\t\treturn !/(iPhone|iPod|iPad|Android)/.test(navigator.userAgent);\n\t},\n\tisIpad: function()\n\t{\n\t\treturn /iPad/.test(navigator.userAgent);\n\t}\n});\n$R.add('service', 'offset', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    get: function(el, trimmed)\n    {\n        var offset = { start: 0, end: 0, newline: false };\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var isIn = (isEditor) ? true : this.selection.isIn(node);\n        var range = this.selection.getRange();\n\n        if (!isEditor && !isIn)\n        {\n            offset = false;\n        }\n        else if (this.selection.is() && isIn)\n        {\n            var $startNode = $R.dom(range.startContainer);\n            var fix = ($startNode.hasClass('redactor-component')) ? range.startOffset : 0;\n            var clonedRange = range.cloneRange();\n\n            clonedRange.selectNodeContents(node);\n            clonedRange.setEnd(range.startContainer, range.startOffset);\n\n            var selection = this._getString(range, trimmed);\n\n            offset.newline = (selection.search(/^\\n/) !== -1 && selection.trim() === '');\n            offset.start = this._getString(clonedRange, trimmed).length - fix;\n            offset.end = offset.start + selection.length + fix;\n        }\n\n        return offset;\n    },\n    set: function(offset, el)\n    {\n        if (this._setComponentOffset(el)) return;\n\n        this.component.clearActive();\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var size = this.size(node);\n        var charIndex = 0, range = document.createRange();\n\n        offset.newline = (typeof offset.newline === 'undefined') ? false : offset.newline;\n        offset.end = (offset.end > size) ? size : offset.end;\n\n        range.setStart(node, 0);\n        range.collapse(true);\n\n        var nodeStack = [node], foundStart = false, stop = false;\n        while (!stop && (node = nodeStack.pop()))\n        {\n            if (node.nodeType == 3)\n            {\n                var nextCharIndex = charIndex + node.length;\n                var isNewLineStr = (node.nodeValue.search(/^\\n/) !== -1 && node.nodeValue.trim() === '');\n\n                if (!foundStart && !this._isFigcaptionNext(node)\n                    && (offset.newline === false && !isNewLineStr)\n                    && offset.start >= charIndex && offset.start <= nextCharIndex)\n                {\n                    range.setStart(node, offset.start - charIndex);\n                    foundStart = true;\n                }\n\n                if (foundStart && offset.end >= charIndex && offset.end <= nextCharIndex)\n                {\n                    range.setEnd(node, offset.end - charIndex);\n                    stop = true;\n                }\n\n                charIndex = nextCharIndex;\n            }\n            else\n            {\n                var i = node.childNodes.length;\n                while (i--)\n                {\n                    nodeStack.push(node.childNodes[i]);\n                }\n            }\n        }\n\n        this.selection.setRange(range);\n    },\n    size: function(el, trimmed)\n    {\n        var node = this.utils.getNode(el);\n        if (node)\n        {\n            var range = document.createRange();\n\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(node);\n\n            return this._getString(clonedRange, trimmed).length;\n        }\n\n        return 0;\n    },\n\n    // private\n    _getString: function(obj, trimmed)\n    {\n        var str = obj.toString();\n        str = (this.editor.isEmpty()) ? str.replace(/\\uFEFF/g, '') : str;\n        str = (trimmed) ? str.trim() : str;\n\n        return str;\n    },\n    _setComponentOffset: function(el)\n    {\n        return (this.component.isNonEditable(el)) ? this.component.setActive(el) : false;\n    },\n    _isFigcaptionNext: function(node)\n    {\n        var next = node.nextSibling;\n        return (node.nodeValue.trim() === '' && next && next.tagName === 'FIGCAPTION');\n    }\n});\n$R.add('service', 'inspector', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // parse\n    parse: function(el)\n    {\n        return $R.create('inspector.parser', this.app, this, el);\n    },\n\n    // text detection\n    isText: function(el)\n    {\n        if (typeof el === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(el))\n        {\n            return true;\n        }\n\n        var node = $R.dom(el).get();\n        return (node && node.nodeType === 3); //  && !this.selection.getBlock(el)\n    },\n\n    // tag detection\n    isInlineTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.inlineTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isBlockTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.blockTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isTableCellTag: function(tag)\n    {\n        return (['td', 'th'].indexOf(tag.toLowerCase()) !== -1);\n    },\n    isHeadingTag: function(tag)\n    {\n        return (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(tag.toLowerCase()) !== -1);\n    },\n\n\n    _isTag: function(tag)\n    {\n        return (tag !== undefined && tag);\n    },\n    _extendTags: function(tags, extend)\n    {\n        tags = tags.concat(tags);\n\n        if (extend)\n        {\n            for (var i = 0 ; i < extend.length; i++)\n            {\n                tags.push(extend[i]);\n            }\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'inspector.parser', {\n    init: function(app, inspector, el)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.selection = app.selection;\n        this.inspector = inspector;\n\n        // local\n        this.el = el;\n        this.$el = $R.dom(this.el);\n        this.node = this.$el.get();\n        this.$component = this.$el.closest('.redactor-component', '.redactor-in');\n    },\n    // is\n    isEditor: function()\n    {\n        return (this.node === this.editor.getElement().get());\n    },\n    isInEditor: function()\n    {\n        return (this.$el.parents('.redactor-in-' + this.uuid).length !== 0);\n    },\n    isComponent: function()\n    {\n        return (this.$component.length !== 0);\n    },\n    isComponentType: function(type)\n    {\n        return (this.getComponentType() === type);\n    },\n    isComponentActive: function()\n    {\n        return (this.isComponent() && this.$component.hasClass('redactor-component-active'));\n    },\n    isComponentEditable: function()\n    {\n        var types = ['code', 'table'];\n        var type = this.getComponentType();\n\n        return (this.isComponent() && types.indexOf(type) !== -1);\n    },\n    isFigcaption: function()\n    {\n        return this.getFigcaption();\n    },\n    isPre: function()\n    {\n        return this.getPre();\n    },\n    isCode: function()\n    {\n        var $code = this.$el.closest('code');\n        var $parent = $code.parent('pre');\n\n        return ($code.length !== 0 && $parent.length === 0);\n    },\n    isList: function()\n    {\n        return this.getList();\n    },\n    isFirstListItem: function()\n    {\n        return this._getLastOrFirstListItem('first');\n    },\n    isLastListItem: function()\n    {\n        return this._getLastOrFirstListItem('last');\n    },\n    isFirstTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('first');\n    },\n    isLastTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('last');\n    },\n    isTable: function()\n    {\n        return (this.isComponentType('table') || this.getTable());\n    },\n    isHeading: function()\n    {\n        return this.getHeading();\n    },\n    isBlockquote: function()\n    {\n        return this.getBlockquote();\n    },\n    isDl: function()\n    {\n        return this.getDl();\n    },\n    isParagraph: function()\n    {\n        return this.getParagraph();\n    },\n    isLink: function()\n    {\n        return this.getLink();\n    },\n    isFile: function()\n    {\n        return this.getFile();\n    },\n    isText: function()\n    {\n        return this.inspector.isText(this.el);\n    },\n    isInline: function()\n    {\n        var tags = this.opts.inlineTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isBlock: function()\n    {\n        var tags = this.opts.blockTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isElement: function()\n    {\n        return (this.node && this.node.nodeType && this.node.nodeType !== 3);\n    },\n\n    // has\n    hasParent: function(tags)\n    {\n        return (this.$el.closest(tags.join(',')).length !== 0);\n    },\n\n    // get\n    getNode: function()\n    {\n        return this.node;\n    },\n    getTag: function()\n    {\n        return (this.isElement()) ? this.node.tagName.toLowerCase() : false;\n    },\n    getComponent: function()\n    {\n        return (this.isComponent()) ? this.$component.get() : false;\n    },\n    getComponentType: function()\n    {\n        return (this.isComponent()) ? this.$component.attr('data-redactor-type') : false;\n    },\n    getFirstNode: function()\n    {\n        return this.utils.getFirstNode(this.node);\n    },\n    getLastNode: function()\n    {\n        return this.utils.getLastNode(this.node);\n    },\n    getFirstElement: function()\n    {\n        return this.utils.getFirstElement(this.node);\n    },\n    getLastElement: function()\n    {\n        return this.utils.getLastElement(this.node);\n    },\n    getFigcaption: function()\n    {\n        return this._getClosestNode('figcaption');\n    },\n    getPre: function()\n    {\n        return this._getClosestNode('pre');\n    },\n    getCode: function()\n    {\n        return this._getClosestNode('code');\n    },\n    getList: function()\n    {\n        return this._getClosestNode('ul, ol');\n    },\n    getParentList: function()\n    {\n        return this._getClosestUpNode('ul, ol');\n    },\n    getListItem: function()\n    {\n        return this._getClosestNode('li');\n    },\n    getTable: function()\n    {\n        if (this.getComponentType('table'))\n        {\n            return this.$component.find('table').get();\n        }\n        else\n        {\n            return this._getClosestNode('table');\n        }\n    },\n    getTableCell: function()\n    {\n        var $td = this.$el.closest('td, th');\n\n        return ($td.length !== 0) ? $td.get() : false;\n    },\n    getComponentCodeElement: function()\n    {\n        return (this.isComponentType('code')) ? this.$component.find('pre code, pre').last().get() : false;\n    },\n    getImageElement: function()\n    {\n        return (this.isComponentType('image')) ? this.$component.find('img').get() : false;\n    },\n    getParagraph: function()\n    {\n        return this._getClosestNode('p');\n    },\n    getHeading: function()\n    {\n        return this._getClosestNode('h1, h2, h3, h4, h5, h6');\n    },\n    getDl: function()\n    {\n        return this._getClosestNode('dl');\n    },\n    getBlockquote: function()\n    {\n        return this._getClosestNode('blockquote');\n    },\n    getLink: function()\n    {\n        var isComponent = (this.isComponent() && !this.isFigcaption());\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && !$el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n    getFile: function()\n    {\n        var isComponent = this.isComponent();\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && $el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n\n    // find\n    findFirstNode: function(selector)\n    {\n        return this.$el.find(selector).first().get();\n    },\n    findLastNode: function(selector)\n    {\n        return this.$el.find(selector).last().get();\n    },\n\n    // private\n    _getLastOrFirstListItem: function(type)\n    {\n        var list = this.getList();\n        var tag = this.getTag();\n        if (list && tag === 'li')\n        {\n            var item = $R.dom(list).find('li')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getLastOrFirstTableCell: function(type)\n    {\n        var table = this.getTable();\n        var tag = this.getTag();\n        if (table && (tag === 'td' || tag === 'th'))\n        {\n            var item = $R.dom(table).find('td, th')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getClosestUpNode: function(selector)\n    {\n        var $el = this.$el.parents(selector, '.redactor-in').last();\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestNode: function(selector)\n    {\n        var $el = this.$el.closest(selector, '.redactor-in');\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestElement: function(selector)\n    {\n        var $el = this.$el.closest(selector, '.redactor-in');\n\n        return ($el.length !== 0) ? $el : false;\n    }\n});\n$R.add('service', 'marker', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    build: function(pos, html)\n    {\n        var marker = document.createElement('span');\n\n        marker.id = 'selection-marker-' + this._getPos(pos);\n        marker.className = 'redactor-selection-marker';\n        marker.innerHTML = this.opts.markerChar;\n\n        return (html) ? marker.outerHTML : marker;\n    },\n    buildHtml: function(pos)\n    {\n        return this.build(pos, true);\n    },\n    insert: function(side)\n    {\n        this.remove();\n\n        var atStart = (side !== 'both' && (side === 'start' || this.selection.isCollapsed()));\n\n        if (!this.selection.is()) this.editor.focus();\n\n        var range = this.selection.getRange();\n        if (range)\n        {\n            var start = this.build('start');\n            var end = this.build('end');\n\n            var cloned = range.cloneRange();\n\n            if (!atStart)\n            {\n                cloned.collapse(false);\n                cloned.insertNode(end);\n            }\n\n            cloned.setStart(range.startContainer, range.startOffset);\n            cloned.collapse(true);\n            cloned.insertNode(start);\n\n            range.setStartAfter(start);\n\n            if (!atStart)\n            {\n                range.setEndBefore(end);\n            }\n\n            this.selection.setRange(range);\n\n            return start;\n        }\n    },\n    find: function(pos, $context)\n    {\n        var $editor = this.editor.getElement();\n        var $marker = ($context || $editor).find('span#selection-marker-' + this._getPos(pos));\n\n        return ($marker.length !== 0) ? $marker.get() : false;\n    },\n    restore: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        var range = this.selection.getRange();\n        if (!range || !this.selection.is())\n        {\n            this.editor.focus();\n            range = document.createRange();\n        }\n\n        if (start)\n        {\n            var prev = (end) ? end.previousSibling : false;\n            var next = start.nextSibling;\n            next = (next && next.nodeType === 3 && next.textContent.replace(/[\\n\\t]/g, '') === '') ? false : next;\n\n            if (!end)\n            {\n                if (next)\n                {\n                    range.selectNodeContents(next);\n                    range.collapse(true);\n                }\n                else\n                {\n                    this._restoreInject(range, start);\n                }\n            }\n            else if (next && next.id === 'selection-marker-end')\n            {\n                this._restoreInject(range, start);\n            }\n            else\n            {\n                if (prev && next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStart(next, 0);\n                }\n                else if (prev && !next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStartAfter(start);\n                }\n                else\n                {\n                    range.setStartAfter(start);\n                    range.setEndBefore(end);\n                }\n            }\n\n            this.selection.setRange(range);\n\n            if (start) start.parentNode.removeChild(start);\n            if (end) end.parentNode.removeChild(end);\n        }\n    },\n    remove: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        if (start) start.parentNode.removeChild(start);\n        if (end) end.parentNode.removeChild(end);\n    },\n\n    // private\n    _getPos: function(pos)\n    {\n        return (pos === undefined) ? 'start' : pos;\n    },\n    _restoreInject: function(range, start)\n    {\n        var textNode = this.utils.createInvisibleChar();\n        $R.dom(start).after(textNode);\n\n        range.selectNodeContents(textNode);\n        range.collapse(false);\n    }\n});\n$R.add('service', 'component', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.activeClass = 'redactor-component-active';\n    },\n    create: function(type, el)\n    {\n        return $R.create(type + '.component', this.app, el);\n    },\n    build: function(el)\n    {\n        var $el = $R.dom(el);\n        var component;\n        var type = $el.attr('data-redactor-type');\n        if (type)\n        {\n            component = this.create(type, el);\n        }\n\n        return (component) ? component : el;\n    },\n    remove: function(el, caret)\n    {\n        var $component = $R.dom(el).closest('.redactor-component');\n        var type = $component.attr('data-redactor-type');\n        var current = $component.parent();\n        var data = this.inspector.parse(current);\n        var prev = this.utils.findSiblings($component, 'prev');\n        var next = this.utils.findSiblings($component, 'next');\n        var stop = this.app.broadcast(type + '.delete', $component);\n        if (stop !== false)\n        {\n            $component.remove();\n\n            // callback\n            this.app.broadcast(type + '.deleted', $component);\n            this.app.broadcast('contextbar.close');\n            this.app.broadcast('imageresizer.stop');\n\n            if (caret !== false)\n            {\n                var cell = data.getTableCell();\n                if (cell && this.utils.isEmptyHtml(cell.innerHTML))\n                {\n                    this.caret.setStart(cell);\n                }\n                else if (next) this.caret.setStart(next);\n                else if (prev) this.caret.setEnd(prev);\n                else\n                {\n                    this.editor.startFocus();\n                }\n            }\n\n            // is empty\n            if (this.editor.isEmpty())\n            {\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                this.app.broadcast('empty');\n            }\n        }\n    },\n    isNonEditable: function(el)\n    {\n        var data = this.inspector.parse(el);\n        return (data.isComponent() && !data.isComponentEditable());\n    },\n    isActive: function(el)\n    {\n        var $component;\n        if (el)\n        {\n            var data = this.inspector.parse(el);\n            $component = $R.dom(data.getComponent());\n\n            return $component.hasClass(this.activeClass);\n        }\n        else\n        {\n            $component = this._find();\n\n            return ($component.length !== 0);\n        }\n    },\n    getActive: function(dom)\n    {\n        var $component = this._find();\n\n        return ($component.length !== 0) ? ((dom) ? $component : $component.get()) : false;\n    },\n    setActive: function(el)\n    {\n        this.clearActive();\n        this.editor.focus();\n\n        var data = this.inspector.parse(el);\n        var component = data.getComponent();\n        var $component = $R.dom(component);\n\n        if (!data.isFigcaption())\n        {\n            var $caret = $component.find('.redactor-component-caret');\n            if ($caret.length === 0)\n            {\n                $caret = this._buildCaret();\n                $component.prepend($caret);\n            }\n\n            this.caret.setAtStart($caret.get());\n        }\n\n        $component.addClass(this.activeClass);\n    },\n    clearActive: function()\n    {\n        var $component = this._find();\n\n        $component.removeClass(this.activeClass);\n        $component.find('.redactor-component-caret').remove();\n\n        this.app.broadcast('imageresizer.stop');\n    },\n    setOnEvent: function(e, contextmenu)\n    {\n        this.clearActive();\n\n        var data = this.inspector.parse(e.target);\n        if (data.isFigcaption() || data.isComponentEditable())\n        {\n            return;\n        }\n\n        // component\n        if (data.isComponent())\n        {\n            this.setActive(e.target);\n            if (contextmenu !== true) e.preventDefault();\n        }\n    },\n    executeScripts: function()\n    {\n        var $editor = this.editor.getElement();\n        var scripts = $editor.find('[data-redactor-type]').find(\"script\").getAll();\n\n        for (var i = 0; i < scripts.length; i++)\n        {\n            if (scripts[i].src !== '')\n            {\n                var src = scripts[i].src;\n                this.$doc.find('head script[src=\"' + src + '\"]').remove();\n\n                var $script = $R.dom('<script>');\n                $script.attr('src', src);\n                $script.attr('async defer');\n\n                if (src.search('instagram') !== -1) $script.attr('onload', 'window.instgrm.Embeds.process()');\n\n                var head = document.getElementsByTagName('head')[0];\n                if (head) head.appendChild($script.get());\n            }\n            else\n            {\n                eval(scripts[i].innerHTML);\n            }\n        }\n    },\n\n    // private\n    _find: function()\n    {\n        return this.editor.getElement().find('.' + this.activeClass);\n    },\n    _buildCaret: function()\n    {\n        var $caret = $R.dom('<span>');\n        $caret.addClass('redactor-component-caret');\n        $caret.attr('contenteditable', true);\n\n        return $caret;\n    }\n});\n$R.add('service', 'insertion', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    set: function(html, clean, focus)\n    {\n        html = (clean !== false) ? this.cleaner.input(html) : html;\n        html = (clean !== false) ? this.cleaner.paragraphize(html) : html;\n\n        // set html\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        // set focus at the end\n        if (focus !== false) this.editor.endFocus();\n\n        return html;\n    },\n    insertNode: function(node, caret)\n    {\n        this.editor.focus();\n        var fragment = (this.utils.isFragment(node)) ? node : this.utils.createFragment(node);\n\n        this._collapseSelection();\n        this._insertFragment(fragment);\n        this._setCaret(caret, fragment);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    insertBreakLine: function()\n    {\n        return this.insertNode(document.createElement('br'), 'after');\n    },\n    insertNewline: function()\n    {\n        return this.insertNode(document.createTextNode('\\n'), 'after');\n    },\n    insertText: function(text)\n    {\n        return this.insertHtml(this.cleaner.getFlatText(text));\n    },\n    insertChar: function(charhtml)\n    {\n        return this.insertNode(charhtml, 'after');\n    },\n    insertRaw: function(html)\n    {\n        return this.insertHtml(html, false);\n    },\n    insertToEnd: function(lastNode, type)\n    {\n        if (!lastNode) return;\n        if (lastNode.nodeType === 3 && lastNode.nodeValue.search(/^\\n/) !== -1)\n        {\n            lastNode = lastNode.previousElementSibling;\n        }\n\n        var $lastNode = $R.dom(lastNode);\n        if ($lastNode.attr('data-redactor-type') === type)\n        {\n            var tag = (this.opts.breakline) ? '<br>' : '<p>';\n            var $newNode = $R.dom(tag);\n\n            $lastNode.after($newNode);\n            this.caret.setStart($newNode);\n        }\n    },\n    insertPoint: function(e)\n    {\n        var range, data;\n        var marker = this.marker.build('start');\n        var markerInserted = false;\n        var x = e.clientX, y = e.clientY;\n\n        if (document.caretPositionFromPoint)\n        {\n            var pos = document.caretPositionFromPoint(x, y);\n            var sel = document.getSelection();\n\n            data = this.inspector.parse(pos.offsetNode);\n            if (data.isInEditor())\n            {\n                range = sel.getRangeAt(0);\n                range.setStart(pos.offsetNode, pos.offset);\n                range.collapse(true);\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n        else if (document.caretRangeFromPoint)\n        {\n            range = document.caretRangeFromPoint(x, y);\n\n            data = this.inspector.parse(range.startContainer);\n            if (data.isInEditor())\n            {\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n\n        return markerInserted;\n    },\n    insertToPoint: function(e, html, point)\n    {\n        var pointInserted = (point === true) ? true : this.insertPoint(e);\n        if (!pointInserted)\n        {\n            var lastNode = this.editor.getLastNode();\n            $R.dom(lastNode).after(this.marker.build('start'));\n        }\n\n        this.component.clearActive();\n        this.selection.restoreMarkers();\n\n        return this.insertHtml(html);\n    },\n    insertToOffset: function(start, html)\n    {\n        this.offset.set({ start: start, end: start });\n\n        return this.insertHtml(html);\n    },\n    insertHtml: function(html, clean)\n    {\n        if (!this.opts.input) return;\n\n        // parse\n        var parsedInput = this.utils.parseHtml(html);\n\n        // all selection\n        if (this.selection.isAll())\n        {\n            return this._insertToAllSelected(parsedInput);\n        }\n\n        // there is no selection\n        if (!this.selection.is())\n        {\n            var $el = $R.dom('<p>');\n            var $editor = this.editor.getElement();\n\n            $editor.append($el);\n            this.caret.setStart($el);\n        }\n\n        // environment\n        var isCollapsed = this.selection.isCollapsed();\n        var isText = this.selection.isText();\n        var current = this.selection.getCurrent();\n        var dataCurrent = this.inspector.parse(current);\n\n        // collapse air\n        this._collapseSelection();\n\n        // clean\n        parsedInput = this._getCleanedInput(parsedInput, dataCurrent, clean);\n\n        // input is figure or component span\n        var isFigure = this._isFigure(parsedInput.html);\n        var isComponentSpan = this._isComponentSpan(parsedInput.html);\n        var isInsertedText = this.inspector.isText(parsedInput.html);\n        var fragment, except;\n\n        // empty editor\n        if (this.editor.isEmpty())\n        {\n            return this._insertToEmptyEditor(parsedInput.html);\n        }\n        // to component\n        else if (dataCurrent.isComponent() && !dataCurrent.isComponentEditable())\n        {\n            return this._insertToWidget(current, dataCurrent, parsedInput.html);\n        }\n        // component span\n        else if (isComponentSpan)\n        {\n            return this.insertNode(parsedInput.nodes, 'end');\n        }\n        // inserting figure & split node\n        else if (isFigure && !isText && !dataCurrent.isList())\n        {\n            if (dataCurrent.isInline())\n            {\n                return this._insertToInline(current, parsedInput);\n            }\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to code\n        else if (dataCurrent.isCode())\n        {\n            return this._insertToCode(parsedInput, current, clean);\n        }\n        // to pre\n        else if (dataCurrent.isPre())\n        {\n            return this._insertToPre(parsedInput, clean);\n        }\n        // to h1-h6 & figcaption\n        else if (dataCurrent.isHeading() || dataCurrent.isFigcaption())\n        {\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, ['a']) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceNbspToSpaces(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // text inserting\n        else if (isInsertedText)\n        {\n            if (!isText && this.opts.markup !== 'br' && this._hasBlocksAndImages(parsedInput.nodes))\n            {\n                parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n                fragment = this.utils.createFragment(parsedInput.html);\n\n                this.utils.splitNode(current, fragment);\n                this.caret.setEnd(fragment.last);\n\n                return this._sendNodes(fragment.nodes);\n            }\n\n            parsedInput.html = (clean !== false) ? parsedInput.html.replace(/\\n/g, '<br>') : parsedInput.html;\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment.nodes, 'end');\n        }\n        // uncollapsed\n        else if (!isCollapsed && !isFigure)\n        {\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to inline tag\n        else if (dataCurrent.isInline() && !this._isPlainHtml(parsedInput.html))\n        {\n            return this._insertToInline(current, parsedInput);\n        }\n        // to blockquote or dt, dd\n        else if (dataCurrent.isBlockquote() || dataCurrent.isDl())\n        {\n            except = this.opts.inlineTags;\n            except.concat(['br']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to p\n        else if (dataCurrent.isParagraph())\n        {\n            if (this._isPlainHtml(parsedInput.html))\n            {\n                return this.insertNode(parsedInput.nodes, 'end');\n            }\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to li\n        else if (dataCurrent.isList())\n        {\n            except = this.opts.inlineTags;\n            except = except.concat(['br', 'li', 'ul', 'ol', 'img']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeBrAtEnd(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n            parsedInput.nodes = fragment.nodes;\n\n            if (this._containsTags(parsedInput.html, ['ul', 'ol', 'li']))\n            {\n                var element = this.selection.getElement(current);\n                if (element && element.tagName === 'LI' && this.caret.isStart(element))\n                {\n                    parsedInput.nodes = $R.dom(fragment.nodes).unwrap('ul, ol').getAll();\n                    $R.dom(element).before(parsedInput.nodes);\n\n                    var lastNode = parsedInput.nodes[parsedInput.nodes.length-1];\n                    this.caret.setEnd(lastNode);\n\n                    return this._sendNodes(parsedInput.nodes);\n                }\n                else if (this._isPlainHtml(parsedInput.html))\n                {\n                    return this.insertNode(fragment, 'end');\n                }\n                else\n                {\n                    fragment = this._buildList(parsedInput, element, fragment);\n\n                    this.utils.splitNode(current, fragment, true);\n                    this.caret.setEnd(fragment.last);\n\n                    return this._sendNodes(fragment.nodes);\n                }\n            }\n        }\n\n        // other cases\n        return this.insertNode(parsedInput.nodes, 'end');\n    },\n\n    // private\n    _insertToAllSelected: function(parsedInput)\n    {\n        var insertedHtml = this.set(parsedInput.html);\n        var dataInserted = this.utils.parseHtml(insertedHtml);\n\n        return this._sendNodes(dataInserted.nodes);\n    },\n    _insertToEmptyEditor: function(html)\n    {\n        html = this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var $editor = this.editor.getElement();\n\n        $editor.html('');\n        $editor.append(fragment.frag);\n\n        this.caret.setEnd($editor);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToInline: function(current, parsedInput)\n    {\n        var fragment = this.utils.createFragment(parsedInput.html);\n        this.utils.splitNode(current, fragment, false, true);\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToCode: function(parsedInput, current, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n        parsedInput.html = (clean !== false) ? this.cleaner.removeNl(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n        var nodes = this.insertNode(fragment, 'end');\n\n        this.utils.normalizeTextNodes(current);\n\n        return nodes;\n    },\n    _insertToPre: function(parsedInput, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n\n        return this.insertNode(fragment, 'end');\n    },\n    _insertToWidget: function(current, dataCurrent, html)\n    {\n        html = (this._isComponentSpan(html)) ? html : this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var component = dataCurrent.getComponent();\n        var $component = $R.dom(component);\n\n        $component.after(fragment.frag);\n        $component.remove();\n\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertFragment: function(fragment)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            if (this.selection.isCollapsed())\n            {\n                var startNode = range.startContainer;\n                if (startNode.nodeType !== 3 && startNode.tagName === 'BR')\n                {\n                    this.caret.setAfter(startNode);\n                    startNode.parentNode.removeChild(startNode);\n                }\n            }\n            else\n            {\n                range.deleteContents();\n            }\n\n            range.insertNode(fragment.frag);\n        }\n    },\n    _sendNodes: function(nodes)\n    {\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var el = nodes[i];\n            var type = (el.nodeType !== 3 && typeof el.getAttribute === 'function') ? el.getAttribute('data-redactor-type') : false;\n            if (type)\n            {\n                this.app.broadcast(type + '.inserted', this.component.build(el));\n            }\n        }\n\n        // callback\n        this.app.broadcast('inserted', nodes);\n\n        // widget's scripts\n        this.component.executeScripts();\n\n        return nodes;\n    },\n    _setCaret: function(caret, fragment)\n    {\n        var isLastInline = this._isLastInline(fragment);\n\n        if (caret)\n        {\n            caret = (isLastInline && caret === 'end') ? 'after' : caret;\n            this.caret['set' + this.utils.ucfirst(caret)](fragment.last);\n        }\n        else if (caret !== false)\n        {\n            if (isLastInline) this.caret.setAfter(fragment.last);\n        }\n    },\n    _isLastInline: function(fragment)\n    {\n        if (fragment.last)\n        {\n            var data = this.inspector.parse(fragment.last);\n\n            return data.isInline();\n        }\n\n        return false;\n    },\n    _getCleanedInput: function(parsedInput, dataCurrent, clean)\n    {\n        var isPreformatted = (dataCurrent.isCode() || dataCurrent.isPre());\n\n        parsedInput.html = (!isPreformatted && clean !== false) ? this.cleaner.input(parsedInput.html) : parsedInput.html;\n        parsedInput = (!isPreformatted && clean !== false) ? this.utils.parseHtml(parsedInput.html) : parsedInput;\n\n        return parsedInput;\n    },\n    _getContainer: function(nodes)\n    {\n        return $R.dom(this.utils.createTmpContainer(nodes));\n    },\n    _buildList: function(parsedInput, list, fragment)\n    {\n        var nodes = parsedInput.nodes;\n        var first = nodes[0];\n\n        if (first && first.nodeType !== 3 && first.tagName === 'li')\n        {\n            var $parent = $R.dom(list);\n            var parentListTag = $parent.get().tagName.toLowerCase();\n            var $list = $R.dom('<' + parentListTag + ' />');\n            $list.append(fragment.nodes);\n\n            return this.utils.createFragment($list.get().outerHTML);\n        }\n\n        return fragment;\n    },\n    _containsTags: function(html, tags)\n    {\n        return (this._getContainer(html).find(tags.join(',')).length !== 0);\n    },\n    _collapseSelection: function()\n    {\n        //if (this.app.isAirToolbar()) this.selection.collapseToEnd();\n    },\n    _hasFigureOrTable: function(nodes)\n    {\n        return (this._getContainer(nodes).find('figure, table').length !== 0);\n    },\n    _hasBlocks: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',')).length !== 0);\n    },\n    _hasBlocksAndImages: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',') + ',img').length !== 0);\n    },\n    _isPlainHtml: function(html)\n    {\n        return (this._getContainer(html).find(this.opts.blockTags.join(',') + ', img').length === 0);\n    },\n    _isFigure: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('figure').length !== 0);\n        }\n    },\n    _isComponentSpan: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('span.redactor-component').length !== 0);\n        }\n    },\n    _isHtmlString: function(html)\n    {\n        return !(typeof html === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(html));\n    }\n});\n$R.add('service', 'block', {\n    mixins: ['formatter'],\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // public\n    format: function(args)\n    {\n        // type of applying styles and attributes\n        this.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n\n        // tag\n        this.tag = (typeof args === 'string') ? args : args.tag;\n        this.tag = this._prepareTag(this.tag);\n        this.tag = this.tag.toLowerCase();\n\n        if (typeof args === 'string') this.args = false;\n        else this.buildArgs(args);\n\n        // format\n        return this._format();\n    },\n    getBlocks: function(tags)\n    {\n        return this.selection.getBlocks({ tags: tags || this._getTags(), first: true });\n    },\n    getElements: function(tags)\n    {\n        var block = this.selection.getBlock();\n        if (!this.selection.isCollapsed() && block && (block.tagName === 'TD' || block.tagName === 'TH'))\n        {\n            return this._wrapInsideTable('div');\n        }\n        else\n        {\n            return $R.dom(this.getBlocks(tags));\n        }\n    },\n    clearFormat: function(tags)\n\t{\n\t\tthis.selection.save();\n\n        var $elements = this.getElements(tags || this._getTags());\n        $elements.each(function(node)\n        {\n            while(node.attributes.length > 0)\n            {\n                node.removeAttribute(node.attributes[0].name);\n            }\n        });\n\n\t\tthis.selection.restore();\n\n        return $elements.getAll();\n\t},\n\n    // private\n    _format: function()\n    {\n        this.selection.save();\n        var blocks = this.getBlocks();\n        var block = this.selection.getBlock();\n        var nodes = [];\n        var data, replacedTag, $wrapper, nextBr;\n\n        // div break format\n        if (blocks.length === 1 && blocks[0].tagName === 'DIV')\n        {\n            data = this._getTextNodesData();\n            if (!data || data.nodes.length === 0)\n            {\n                nodes = this._replaceBlocks(blocks);\n                nodes = this._sendNodes(nodes);\n\n                setTimeout(function() { this.selection.restore(); }.bind(this), 0);\n\n                return nodes;\n            }\n\n            replacedTag = this._getReplacedTag('set');\n            $wrapper = $R.dom('<' + replacedTag + '>');\n\n            nextBr = data.last.nextSibling;\n            if (nextBr && nextBr.tagName === 'BR')\n            {\n                $R.dom(nextBr).remove();\n            }\n\n            for (var i = 0; i < data.nodes.length; i++)\n            {\n                $wrapper.append(data.nodes[i]);\n            }\n\n            this.utils.splitNode(blocks[0], [$wrapper.get()]);\n            nodes = this._sendNodes([$wrapper.get()]);\n\n            if (this.utils.isEmptyHtml($wrapper.html()))\n            {\n                this.caret.setStart($wrapper);\n            }\n            else\n            {\n                setTimeout(function() { this.selection.restore(); }.bind(this), 0);\n            }\n\n            return nodes;\n        }\n        // standard format\n        else if (blocks.length > 0)\n        {\n            nodes = this._replaceBlocks(blocks);\n            nodes = this._sendNodes(nodes);\n\n            setTimeout(function() { this.selection.restore(); }.bind(this), 0);\n\n            return nodes;\n        }\n        // td/th format uncollapsed\n        else if (!this.selection.isCollapsed() && block && (block.tagName === 'TD' || block.tagName === 'TH'))\n        {\n            replacedTag = this._getReplacedTag('set');\n\n            $wrapper = this._wrapInsideTable(replacedTag);\n\n            this.selection.setAll($wrapper);\n\n            return this._sendNodes([$wrapper.get()]);\n        }\n        // td/th format collapsed\n        else if (this.selection.isCollapsed() && block && (block.tagName === 'TD' || block.tagName === 'TH'))\n        {\n            var textnodes = this._getChildTextNodes(block);\n\n            replacedTag = this._getReplacedTag('set');\n            var $wrapper = $R.dom('<' + replacedTag + '>');\n\n            $R.dom(textnodes.first).before($wrapper);\n\n            for (var i = 0; i < textnodes.nodes.length; i++)\n            {\n                $wrapper.append(textnodes.nodes[i]);\n            }\n\n            var nextBr = $wrapper.get().nextSibling;\n            if (nextBr && nextBr.tagName === 'BR')\n            {\n                $R.dom(nextBr).remove();\n            }\n\n            return this._sendNodes([$wrapper.get()]);\n        }\n\n        return nodes;\n    },\n    _wrapInsideTable: function(replacedTag)\n    {\n        var data = this._getTextNodesData();\n        var $wrapper = $R.dom('<' + replacedTag + '>');\n\n        $R.dom(data.first).before($wrapper);\n\n        for (var i = 0; i < data.nodes.length; i++)\n        {\n            $wrapper.append(data.nodes[i]);\n        }\n\n        var nextBr = $wrapper.get().nextSibling;\n        if (nextBr && nextBr.tagName === 'BR')\n        {\n            $R.dom(nextBr).remove();\n        }\n\n        return $wrapper;\n    },\n    _prepareTag: function(tag)\n    {\n        return (typeof tag === 'undefined') ? this.opts.markup : tag;\n    },\n    _sendNodes: function(nodes)\n    {\n        if (nodes.length > 0)\n        {\n            // clean & appliyng styles and attributes\n            nodes = this.applyArgs(nodes, false);\n            nodes = this._combinePre(nodes);\n            nodes = this._cleanBlocks(nodes);\n        }\n\n        return nodes;\n    },\n    _getTags: function()\n    {\n        return ['div', 'p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n    },\n    _replaceBlocks: function(blocks)\n    {\n        var nodes = [];\n        var type = (this._isToggleFormatType(blocks)) ? 'toggle' : 'set';\n        var replacedTag = this._getReplacedTag(type);\n\n        for (var i = 0; i < blocks.length; i++)\n        {\n            var $node = this.utils.replaceToTag(blocks[i], replacedTag);\n            nodes.push($node.get());\n        }\n\n        return nodes;\n    },\n    _getReplacedTag: function(type)\n    {\n        var replacedTag = (type === 'toggle') ? this.opts.markup : this.tag;\n\n        return (this.opts.breakline && replacedTag === 'p') ? 'div' : replacedTag;\n    },\n    _getChildTextNodes: function(el)\n    {\n        var nodes = el.childNodes;\n        var firstNode = nodes[0];\n        var finalNodes = [];\n        for (var i = 0; i <= nodes.length; i++)\n        {\n            var node = nodes[i];\n            if (node && node.nodeType !== 3 && this.inspector.isBlockTag(node.tagName))\n            {\n                break;\n            }\n\n            finalNodes.push(node);\n        }\n\n        return {\n            nodes: finalNodes,\n            first: firstNode\n        };\n    },\n    _getTextNodesData: function()\n    {\n        var nodes = this.selection.getNodes({ textnodes: true, keepbr: true });\n        if (nodes.length === 0) return false;\n\n        var firstNode = nodes[0];\n        var lastNode = nodes[nodes.length-1];\n        var node = lastNode;\n        var stop = false;\n\n        while (!stop)\n        {\n            var inline = this.selection.getInline(node);\n            node = (inline) ? inline.nextSibling : node.nextSibling;\n            if (!node)\n            {\n                stop = true;\n            }\n            else if (node.nodeType !== 3 && (node.tagName === 'BR' || this.inspector.isBlockTag(node.tagName)))\n            {\n                stop = true;\n            }\n            else\n            {\n                nodes.push(node);\n            }\n        }\n\n        return {\n            nodes: nodes,\n            first: firstNode,\n            last: lastNode\n        };\n    },\n    _isToggleFormatType: function(blocks)\n    {\n        var count = 0;\n        var len = blocks.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (blocks[i] && this.tag === blocks[i].tagName.toLowerCase()) count++;\n        }\n\n        return (count === len);\n    },\n    _combinePre: function(nodes)\n    {\n        var combinedNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var next = nodes[i].nextElementSibling;\n            if (next && nodes[i].tagName === 'PRE' && next.tagName === 'PRE')\n            {\n                var $current = $R.dom(nodes[i]);\n                var $next = $R.dom(next);\n                var newline = document.createTextNode('\\n');\n\n                $current.append(newline);\n                $current.append($next);\n                $next.unwrap('pre');\n            }\n\n            combinedNodes.push(nodes[i]);\n        }\n\n        return combinedNodes;\n    },\n    _cleanBlocks: function(nodes)\n    {\n        var headings = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n        var tags = this.opts.inlineTags;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var tag = nodes[i].tagName.toLowerCase();\n            var $node = $R.dom(nodes[i]);\n\n            if (headings.indexOf(tag) !== - 1)\n            {\n                $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker').unwrap();\n            }\n            else if (tag === 'pre')\n            {\n                $node.find(tags.join(',')).not('.redactor-selection-marker').unwrap();\n            }\n\n            // breakline attr\n            if (this.opts.breakline && tag === 'div')\n            {\n                $node.attr('data-redactor-tag', 'br');\n            }\n            else\n            {\n                $node.removeAttr('data-redactor-tag');\n            }\n\n            this.utils.normalizeTextNodes(nodes[i]);\n        }\n\n        return nodes;\n    }\n});\n$R.add('service', 'inline', {\n    mixins: ['formatter'],\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // public\n    format: function(args)\n    {\n        if (!this._isFormat()) return [];\n\n        // type of applying styles and attributes\n        this.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n\n        // tag\n        this.tag = (typeof args === 'string') ? args : args.tag;\n        this.tag = this.tag.toLowerCase();\n        this.tag = this.arrangeTag(this.tag);\n\n        if (typeof args === 'string') this.args = false;\n        else this.buildArgs(args);\n\n        // format\n        var nodes = (this.selection.isCollapsed()) ? this.formatCollapsed() : this.formatUncollapsed();\n\n        return nodes;\n    },\n\n    // private\n    _isFormat: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isComponent = (data.isComponent() && !data.isComponentType('table') && !data.isFigcaption());\n\n        if (!current || data.isPre() || data.isCode() || isComponent)\n        {\n            return false;\n        }\n\n        return true;\n    },\n    arrangeTag: function(tag)\n    {\n        var replaced = this.opts.replaceTags;\n        for (var key in replaced)\n        {\n            if (tag === key) tag = replaced[key];\n        }\n\n        return tag;\n    },\n    formatCollapsed: function()\n    {\n        var nodes = [];\n        var inline = this.selection.getInlineFirst();\n        var inlines = this.selection.getInlines({ all: true });\n        var $inline = $R.dom(inline);\n        var $parent, parent, $secondPart, extractedContent;\n\n        // 1) not inline\n        if (!inline)\n        {\n            nodes = this.insertInline(nodes);\n        }\n        else\n        {\n            var dataInline = this.inspector.parse(inline);\n            var isEmpty = this.utils.isEmptyHtml(inline.innerHTML);\n\n            // 2) inline is empty\n            if (isEmpty)\n            {\n                // 2.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 2.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        this.caret.setAfter(inline);\n                        $inline.remove();\n\n                        var el = this.selection.getElement();\n                        this.utils.normalizeTextNodes(el);\n                    }\n                    // 2.1.2) has different args and it is span tag\n                    else if (this.tag === 'span')\n                    {\n                        nodes = this.applyArgs([inline], false);\n                        this.caret.setStart(inline);\n                    }\n                    // 2.1.3) has different args and it is not span tag\n                    else\n                    {\n                       nodes = this.insertInline(nodes);\n                    }\n\n                }\n                // 2.2) has another tag\n                else\n                {\n                    // 2.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            $parent.unwrap();\n                            this.caret.setStart(inline);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 2.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n            // 3) inline isn't empty\n            else\n            {\n                // 3.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 3.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        // insert break\n                        extractedContent = this.utils.extractHtmlFromCaret(inline);\n                        $secondPart = $R.dom('<' + this.tag + ' />');\n                        $secondPart = this.utils.cloneAttributes(inline, $secondPart);\n\n                        $inline.after($secondPart.append(extractedContent));\n\n                        this.caret.setAfter(inline);\n                    }\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n                // 3.2) has another tag\n                else\n                {\n                    // 3.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            // insert break\n                            extractedContent = this.utils.extractHtmlFromCaret(parent, parent);\n                            $secondPart = $R.dom('<' + this.tag + ' />');\n                            $secondPart = this.utils.cloneAttributes(parent, $secondPart);\n\n                            var $breaked, $last;\n                            var z = 0;\n                            inlines = inlines.reverse();\n                            for (var i = 0; i < inlines.length; i++)\n                            {\n                                if (inlines[i] !== parent)\n                                {\n                                    $last = $R.dom('<' + inlines[i].tagName.toLowerCase() + '>');\n                                    if (z === 0)\n                                    {\n                                        $breaked = $last;\n                                    }\n                                    else\n                                    {\n                                        $breaked.append($last);\n                                    }\n\n                                    z++;\n                                }\n                            }\n\n                            $parent.after($secondPart.append(extractedContent));\n                            $parent.after($breaked);\n\n                            this.caret.setStart($last);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 3.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n        }\n\n        return nodes;\n    },\n    insertInline: function(nodes)\n    {\n        var node = document.createElement(this.tag);\n        nodes = this.insertion.insertNode(node, 'start');\n\n        return this.applyArgs(nodes, false);\n    },\n    hasSameArgs: function(inline)\n    {\n        if (inline.attributes.length === 0 && this.args === false)\n        {\n            return true;\n        }\n        else\n        {\n            var same = true;\n            if (this.args)\n            {\n                var count = 0;\n                for (var key in this.args)\n                {\n                    var $node = $R.dom(inline);\n                    var args = (this.args[key]);\n                    var value = this.utils.toParams(args);\n                    var nodeAttrValue = $node.attr(key);\n\n                    if (args)\n                    {\n                        if (key === 'style')\n                        {\n                            value = value.trim().replace(/;$/, '');\n\n                            var origRules = this.utils.styleToObj($node.attr('style'));\n                            var rules = value.split(';');\n                            var innerCount = 0;\n\n                            for (var i = 0; i < rules.length; i++)\n                            {\n                                var arr = rules[i].split(':');\n                                var ruleName = arr[0].trim();\n                                var ruleValue = arr[1].trim();\n\n                                if (ruleName.search(/color/) !== -1)\n                                {\n                                    var val = $node.css(ruleName);\n                                    if (val && (val === ruleValue || this.utils.rgb2hex(val) === ruleValue))\n                                    {\n                                        innerCount++;\n                                    }\n                                }\n                                else if ($node.css(ruleName) === ruleValue)\n                                {\n                                    innerCount++;\n                                }\n                            }\n\n                            if (innerCount === rules.length && Object.keys(origRules).length === rules.length)\n                            {\n                                count++;\n                            }\n                        }\n                        else\n                        {\n                            if (nodeAttrValue === value)\n                            {\n                                count++;\n                            }\n                        }\n                    }\n                    else\n                    {\n                        if (!nodeAttrValue || nodeAttrValue === '')\n                        {\n                            count++;\n                        }\n                    }\n                }\n\n                same = (count === Object.keys(this.args).length);\n            }\n\n            return same;\n        }\n    },\n    formatUncollapsed: function()\n    {\n        var inlines = this.selection.getInlines({ all: true, inside: true });\n\n        this.selection.save();\n\n        // convert del / u\n        this._convertTags('u');\n        this._convertTags('del');\n\n        // convert target tags\n        this._convertToStrike(inlines);\n\n        this.selection.restore();\n\n        // apply strike\n        document.execCommand('strikethrough');\n\n        // clear decoration\n        this._clearDecoration();\n\n        this.selection.save();\n\n        // revert and set style\n        var nodes = this._revertToInlines();\n        nodes = this.applyArgs(nodes, false);\n\n        // unwrap if attributes was removed\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            var tag = node.tagName.toLowerCase();\n            var len = node.attributes.length;\n\n            if (tag === this.tag && len === 0 && this.args)\n            {\n                $R.dom(node).unwrap();\n                nodes.splice(i, 1);\n            }\n        }\n\n        this.selection.restore();\n\n        // clear and normalize\n        this._clearEmptyStyle();\n        nodes = this._normalizeBlocks(nodes);\n\n        return nodes;\n    },\n    _convertTags: function(tag)\n    {\n        if (this.tag !== tag)\n        {\n            var $editor = this.editor.getElement();\n            $editor.find(tag).each(function(node)\n            {\n                var $el = this.utils.replaceToTag(node, 'span');\n                $el.addClass('redactor-convertable-' + tag);\n            }.bind(this));\n        }\n    },\n    _revertTags: function(tag)\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.find('span.redactor-convertable-' + tag).each(function(node)\n        {\n            var $el = this.utils.replaceToTag(node, tag);\n            $el.removeClass('redactor-convertable-' + tag);\n            if (this.utils.removeEmptyAttr($el, 'class')) $el.removeAttr('class');\n\n        }.bind(this));\n    },\n    _convertToStrike: function(inlines)\n    {\n        var selected = this.selection.getText().replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n\n        for (var i = 0; i < inlines.length; i++)\n        {\n            var tag = this.arrangeTag(inlines[i].tagName.toLowerCase());\n            var inline = inlines[i];\n            var $inline = $R.dom(inline);\n            var hasSameArgs = this.hasSameArgs(inline);\n\n            if (tag === this.tag)\n            {\n                if (this.tag === 'span' && this._isTextSelected(inline, selected))\n                {\n                    $inline.addClass('redactor-convertable-apply');\n                }\n                else if (hasSameArgs)\n                {\n                    this._replaceToStrike($inline);\n                }\n                else if (this.tag === 'span')\n                {\n                    $inline.addClass('redactor-unconvertable-apply');\n                }\n                else if (!hasSameArgs)\n                {\n                    $inline.addClass('redactor-convertable-apply');\n                }\n            }\n        }\n    },\n    _replaceToStrike: function($el)\n    {\n        $el.replaceWith(function()\n        {\n            return $R.dom('<strike>').append($el.contents());\n        });\n    },\n    _revertToInlines: function()\n    {\n        var nodes = [];\n        var $editor = this.editor.getElement();\n\n        if (this.tag !== 'u') $editor.find('u').unwrap();\n\n        // span convertable\n        $editor.find('.redactor-convertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            $node.find('strike').unwrap();\n\n            this._forceRemoveClass($node, 'redactor-convertable-apply');\n            nodes.push(node);\n\n        }.bind(this));\n\n        // span unconvertable\n        $editor.find('span.redactor-unconvertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            this._forceRemoveClass($node, 'redactor-unconvertable-apply');\n\n        }.bind(this));\n\n        // strike\n        $editor.find('strike').each(function(node)\n        {\n            var $node = this.utils.replaceToTag(node, this.tag);\n            nodes.push($node.get());\n\n        }.bind(this));\n\n\n        this._revertTags('u');\n        this._revertTags('del');\n\n        return nodes;\n    },\n    _normalizeBlocks: function(nodes)\n    {\n        var tags = this.opts.inlineTags;\n        var blocks = this.selection.getBlocks();\n        if (blocks)\n        {\n            for (var i = 0; i < blocks.length; i++)\n            {\n                if (blocks[i].tagName === 'PRE')\n                {\n                    var $node = $R.dom(blocks[i]);\n                    $node.find(tags.join(',')).not('.redactor-selection-marker').each(function(inline)\n                    {\n                        if (nodes.indexOf(inline) !== -1)\n                        {\n                            nodes = this.utils.removeFromArrayByValue(nodes, inline);\n                        }\n\n                        $R.dom(inline).unwrap();\n                    }.bind(this));\n                }\n            }\n        }\n\n        return nodes;\n    },\n    _clearDecoration: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.style.textDecoration === 'line-through' || node.style.textDecorationLine === 'line-through')\n            {\n                var $el = $R.dom(node);\n                $el.css('textDecorationLine', '');\n                $el.css('textDecoration', '');\n                $el.wrap('<strike>');\n            }\n        });\n    },\n    _clearEmptyStyle: function()\n    {\n        var inlines = this.getInlines();\n        for (var i = 0; i < inlines.length; i++)\n        {\n            this._clearEmptyStyleAttr(inlines[i]);\n\n            var childNodes = inlines[i].childNodes;\n            if (childNodes)\n            {\n                for (var z = 0; z < childNodes.length; z++)\n                {\n                    this._clearEmptyStyleAttr(childNodes[z]);\n                }\n            }\n        }\n    },\n    _clearEmptyStyleAttr: function(node)\n    {\n        if (node.nodeType !== 3 && this.utils.removeEmptyAttr(node, 'style'))\n        {\n            node.removeAttribute('style');\n            node.removeAttribute('data-redactor-style-cache');\n        }\n    },\n    _forceRemoveClass: function($node, classname)\n    {\n        $node.removeClass(classname);\n        if (this.utils.removeEmptyAttr($node, 'class')) $node.removeAttr('class');\n    },\n    _isTextSelected: function(node, selected)\n    {\n        var text = this.utils.removeInvisibleChars(node.textContent);\n\n        return (selected === text || selected.search(new RegExp('^' + this.utils.escapeRegExp(text) + '$')) !== -1);\n    },\n\n    getInlines: function(tags)\n    {\n        return (tags) ? this.selection.getInlines({ tags: tags, all: true }) : this.selection.getInlines({ all: true });\n    },\n    getElements: function(tags)\n    {\n        return $R.dom(this.getInlines(tags));\n    },\n    clearFormat: function()\n    {\n        this.selection.save();\n\n        var nodes = this.selection.getInlines({ all: true });\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var inline = this.selection.getInline(nodes[i]);\n            if (inline)\n            {\n                $el.unwrap();\n            }\n        }\n\n        this.selection.restore();\n    }\n});\n$R.add('service', 'autoparser', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    observe: function()\n    {\n        var $editor = this.editor.getElement();\n        var $objects = $editor.find('.redactor-autoparser-object').each(function(node)\n        {\n           var $node = $R.dom(node);\n           $node.removeClass('redactor-autoparser-object');\n           if ($node.attr('class') === '') $node.removeAttr('class');\n        });\n\n        if ($objects.length > 0)\n        {\n            $objects.each(function(node)\n            {\n                var type;\n                var $object = false;\n                var tag = node.tagName;\n\n                if (tag === 'A') type = 'link';\n                else if (tag === 'IMG') type = 'image';\n                else if (tag === 'IFRAME') type = 'video';\n\n                if (type)\n                {\n                    $object = $R.create(type + '.component', this.app, node);\n                    this.app.broadcast(type + '.inserted', $object);\n                    this.app.broadcast('autoparse', type, $object);\n                }\n\n            }.bind(this));\n        }\n    },\n    format: function(e, key)\n    {\n        if (this._isKey(key))\n        {\n            this._format(key === this.keycodes.ENTER);\n        }\n    },\n    parse: function(html)\n    {\n        var tags = ['figure', 'pre', 'iframe', 'code', 'a', 'img'];\n        var stored = [];\n        var z = 0;\n\n        // encode\n        html = this.cleaner.encodePreCode(html);\n\n        // store tags\n        for (var i = 0; i < tags.length; i++)\n        {\n            var reTags = (tags[i] === 'img') ? '<' + tags[i] + '[^>]*>' : '<' + tags[i] + '([\\\\w\\\\W]*?)</' + tags[i] + '>';\n            var matched = html.match(new RegExp(reTags, 'gi'));\n\n            if (matched !== null)\n            {\n                for (var y = 0; y < matched.length; y++)\n                {\n                    html = html.replace(matched[y], '#####replaceparse' + z + '#####');\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n        }\n\n        // images\n        if (this.opts.autoparseImages && html.match(this.opts.regex.imageurl))\n        {\n            var imagesMatches = html.match(this.opts.regex.imageurl);\n            for (var i = 0; i < imagesMatches.length; i++)\n            {\n                html = html.replace(imagesMatches[i], '<img class=\"redactor-autoparser-object\" src=\"' + imagesMatches[i] + '\">');\n            }\n        }\n\n        // video\n        if (this.opts.autoparseVideo && (html.match(this.opts.regex.youtube) || html.match(this.opts.regex.vimeo)))\n        {\n            var iframeStart = '<iframe width=\"500\" height=\"281\" src=\"';\n            var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n            var str, re;\n            if (html.match(this.opts.regex.youtube))\n            {\n                str = '//www.youtube.com/embed/$1';\n                re = this.opts.regex.youtube;\n            }\n            else if (html.match(this.opts.regex.vimeo))\n            {\n                str = '//player.vimeo.com/video/$2';\n                re = this.opts.regex.vimeo;\n            }\n\n            var $video = this.component.create('video', iframeStart + str + iframeEnd);\n\n            html = html.replace(re, $video.get().outerHTML);\n        }\n\n        // links\n        if (this.opts.autoparseLinks && html.match(this.opts.regex.url))\n        {\n            html = this._formatLinks(html);\n        }\n\n        // restore\n        html = this._restoreReplaced(stored, html);\n\n        // repeat for nested tags\n        html = this._restoreReplaced(stored, html);\n\n        return html;\n    },\n\n    // private\n    _isKey: function(key)\n    {\n        return (key === this.keycodes.ENTER || key === this.keycodes.SPACE);\n    },\n    _format: function(enter)\n    {\n        var parent = this.selection.getParent();\n        var $parent = $R.dom(parent);\n\n        var isNotFormatted = (parent && $parent.closest('figure, pre, code, img, a, iframe').length !== 0);\n        if (isNotFormatted || !this.selection.isCollapsed())\n        {\n            return;\n        }\n\n        // add split marker\n        var marker = this.utils.createInvisibleChar();\n        var range = this.selection.getRange();\n        range.insertNode(marker);\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $current = $R.dom(current);\n\n        // remove split marker\n        marker.parentNode.removeChild(marker);\n\n        if (current && current.nodeType === 3)\n        {\n            var content = current.textContent;\n            var type;\n\n            // images\n            if (this.opts.autoparseImages && content.match(this._convertToRegExp(this.opts.regex.imageurl)))\n            {\n                var isList = data.isList();\n                var matches = content.match(this.opts.regex.imageurl);\n                var el = (isList) ? undefined : '<figure><img></figure>';\n\n                var $img = this.component.create('image', el);\n                $img.setSrc(matches[0]);\n                $img.addClass('redactor-autoparser-object');\n\n                content = content.replace(matches[0], $img.get().outerHTML);\n                type = 'image';\n            }\n            // video\n            else if (this.opts.autoparseVideo && (content.match(this._convertToRegExp(this.opts.regex.youtube)) || content.match(this._convertToRegExp(this.opts.regex.vimeo))))\n            {\n                var iframeStart = '<iframe width=\"500\" height=\"281\" src=\"';\n                var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n                var str, re;\n\n                if (content.match(this.opts.regex.youtube))\n                {\n                    str = '//www.youtube.com/embed/$1';\n                    re = this.opts.regex.youtube;\n                }\n                else if (content.match(this.opts.regex.vimeo))\n                {\n                    str = '//player.vimeo.com/video/$2';\n                    re = this.opts.regex.vimeo;\n                }\n\n                var $video = this.component.create('video', iframeStart + str + iframeEnd);\n                $video.addClass('redactor-autoparser-object');\n\n                content = content.replace(re, $video.get().outerHTML);\n                type = 'video';\n            }\n            // links\n            else if (this.opts.autoparseLinks && content.match(this._convertToRegExp(this.opts.regex.url)))\n            {\n                content = this._formatLinks(content, enter);\n                type = 'link';\n            }\n\n            // replace\n            if (type)\n            {\n                if (enter)\n                {\n                    this.selection.save();\n                    $current.replaceWith(content);\n                    this.selection.restore();\n                }\n                else\n                {\n                    $current.replaceWith(content);\n                }\n\n                // object\n                var $editor = this.editor.getElement();\n                var $object = $editor.find('.redactor-autoparser-object').removeClass('redactor-autoparser-object');\n                $object = (type === 'link') ? $R.create('link.component', this.app, $object) : $object;\n\n                // caret\n                if (type === 'link')\n                {\n                    if (!enter) this.caret.setAfter($object);\n                    this.app.broadcast('link.inserted', $object);\n                }\n                else\n                {\n                    this.caret.setAfter($object);\n\n                    var $cloned = $object.clone();\n                    $object.remove();\n                    $object = this.insertion.insertHtml($cloned);\n                    $object = this.component.build($object);\n                }\n\n                // callback\n                this.app.broadcast('autoparse', type, $object);\n            }\n        }\n    },\n    _formatLinks: function(content, enter)\n    {\n        var matches = content.match(this.opts.regex.url);\n        var obj = {};\n        for (var i = 0; i < matches.length; i++)\n        {\n            if (enter && matches[i].search(/\\.$/) !== -1)\n            {\n                matches[i] = matches[i].replace(/\\.$/, '');\n            }\n\n            var href = matches[i], text = href;\n            var linkProtocol = (href.match(/(https?|ftp):\\/\\//i) !== null) ? '' : 'http://';\n            var regexB = ([\"/\", \"&\", \"=\"].indexOf(href.slice(-1)) !== -1) ? \"\" : \"\\\\b\";\n            var target = (this.opts.pasteLinkTarget !== false) ? ' target=\"' + this.opts.pasteLinkTarget + '\"' : '';\n\n            text = (text.length > this.opts.linkSize) ? text.substring(0, this.opts.linkSize) + '...' : text;\n            text = (text.search('%') === -1) ? decodeURIComponent(text) : text;\n\n            // escaping url\n            var regexp = '(' + href.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\") + regexB + ')';\n            var classstr = ' class=\"redactor-autoparser-object\"';\n\n            obj[regexp] = '<a href=\"' + linkProtocol + href.trim() + '\"' + target + classstr + '>' + text.trim() + '</a>';\n        }\n\n        // replace\n        for (var key in obj)\n        {\n            content = content.replace(new RegExp(key, 'g'), obj[key]);\n        }\n\n        return content;\n    },\n    _restoreReplaced: function(stored, html)\n    {\n        for (var i = 0; i < stored.length; i++)\n        {\n            html = html.replace('#####replaceparse' + i + '#####', stored[i]);\n        }\n\n        return html;\n    },\n    _convertToRegExp: function(str)\n    {\n        return new RegExp(String(str).replace(/^\\//, '').replace(/\\/ig$/, '').replace(/\\/gi$/, '') + '$', 'gi');\n    }\n});\n$R.add('service', 'storage', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.data = [];\n    },\n    // public\n    observeImages: function()\n    {\n        var $editor = this.editor.getElement();\n        var $images = $editor.find('[data-image]');\n\n        $images.each(this._addImage.bind(this));\n    },\n    observeFiles: function()\n    {\n        var $editor = this.editor.getElement();\n        var $files = $editor.find('[data-file]');\n\n\t\t$files.each(this._addFile.bind(this));\n    },\n\tsetStatus: function(url, status)\n\t{\n\t\tthis.data[url].status = status;\n\t},\n    getChanges: function()\n    {\n        var $editor = this.editor.getElement();\n\n        // check status\n        for (var key in this.data)\n\t\t{\n\t\t\tvar data = this.data[key];\n\t\t\tvar $el = $editor.find('[data-' + data.type + '=\"' + data.id + '\"]');\n\n\t\t\tthis.setStatus(data.id, ($el.length === 0) ? false : true);\n\t\t}\n\n        return this.data;\n    },\n\tadd: function(type, node)\n\t{\n        var $node = $R.dom(node);\n        var id = $node.attr('data-' + type);\n\n        this.data[id] = { type: type, status: true, node: $node.get(), id: $node.attr('data-' + type) };\n\t},\n\n    // private\n    _addImage: function(node)\n    {\n        this.add('image', node);\n    },\n    _addFile: function(node)\n    {\n        this.add('file', node);\n    }\n});\n$R.add('service', 'utils', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // empty\n    isEmpty: function(el)\n    {\n        var isEmpty = false;\n        el = $R.dom(el).get();\n        if (el)\n        {\n            isEmpty = (el.nodeType === 3) ? (el.textContent.trim().replace(/\\n/, '') === '') : (el.innerHTML === '');\n        }\n\n        return isEmpty;\n    },\n    isEmptyHtml: function(html, keepbr, keeplists)\n    {\n        html = this.removeInvisibleChars(html);\n        html = html.replace(/&nbsp;/gi, '');\n        html = html.replace(/<\\/?br\\s?\\/?>/g, ((keepbr) ? 'br' : ''));\n        html = html.replace(/\\s/g, '');\n        html = html.replace(/^<p>[^\\W\\w\\D\\d]*?<\\/p>$/i, '');\n        html = html.replace(/^<div>[^\\W\\w\\D\\d]*?<\\/div>$/i, '');\n\n        if (keeplists)\n        {\n            html = html.replace(/<ul(.*?[^>])>$/i, 'ul');\n            html = html.replace(/<ol(.*?[^>])>$/i, 'ol');\n        }\n\n        html = html.replace(/<hr(.*?[^>])>$/i, 'hr');\n        html = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n        html = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n        // remove empty tags\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\n        // trim\n        html = html.trim();\n\n        return html === '';\n    },\n    trimSpaces: function(html)\n    {\n        return html = this.removeInvisibleChars(html.trim());\n    },\n\n    // invisible chars\n    createInvisibleChar: function()\n    {\n        return document.createTextNode(this.opts.markerChar);\n    },\n    searchInvisibleChars: function(str)\n    {\n        return str.search(/^\\uFEFF$/g);\n    },\n    removeInvisibleChars: function(html)\n    {\n        return html.replace(/\\uFEFF/g, '');\n    },\n    trimInvisibleChars: function(direction)\n    {\n        if (!this.selection.isCollapsed()) return;\n\n        var current = this.selection.getCurrent();\n        var side = (direction === 'left') ? this.selection.getTextBeforeCaret() : this.selection.getTextAfterCaret();\n        var isSpace = (current && current.nodeType === 3 && this.searchInvisibleChars(side) === 0);\n\n        if (isSpace)\n        {\n            if (direction === 'left')\n            {\n                $R.dom(current).replaceWith(current.textContent.trim());\n            }\n            else\n            {\n                var offset = this.offset.get();\n                this.offset.set({ start: offset.start + 1, end: offset.end + 1 });\n            }\n        }\n    },\n\n    // wrapper\n    buildWrapper: function(html)\n    {\n        return $R.dom('<div>').html(html);\n    },\n    getWrapperHtml: function($wrapper)\n    {\n        var html = $wrapper.html();\n        $wrapper.remove();\n\n        return html;\n    },\n\n    // fragment\n    createTmpContainer: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (typeof html === 'string')\n        {\n            $div.html(html);\n        }\n        else\n        {\n            $div.append($R.dom(html).clone(true));\n        }\n\n        return $div.get();\n    },\n    createFragment: function(html)\n    {\n        var el = this.createTmpContainer(html);\n        var frag = document.createDocumentFragment(), node, firstNode, lastNode;\n        var nodes = [];\n        var i = 0;\n        while ((node = el.firstChild))\n        {\n            i++;\n            var n = frag.appendChild(node);\n            if (i === 1) firstNode = n;\n\n            nodes.push(n);\n            lastNode = n;\n        }\n\n        return { frag: frag, first: firstNode, last: lastNode, nodes: nodes };\n    },\n    isFragment: function(obj)\n    {\n        return (typeof obj === 'object' && obj.frag);\n    },\n    parseHtml: function(html)\n    {\n        var div = this.createTmpContainer(html);\n\n        return { html: div.innerHTML, nodes: div.childNodes };\n    },\n\n    splitNode: function(current, nodes, isList, inline)\n    {\n        nodes = (this.isFragment(nodes)) ? nodes.frag : nodes;\n\n        var element;\n        if (inline)\n        {\n            element = (this.inspector.isInlineTag(current.tagName)) ? current : this.selection.getInline(current);\n        }\n        else\n        {\n            element = (this.inspector.isBlockTag(current.tagName)) ? current : this.selection.getBlock(current);\n        }\n\n        var $element = $R.dom(element);\n\n        // replace is empty\n        if (!inline && this.isEmptyHtml(element.innerHTML, true))\n        {\n            $element.after(nodes);\n            $element.remove();\n\n            return nodes;\n        }\n\n        var tag = $element.get().tagName.toLowerCase();\n        var isEnd = this.caret.isEnd(element);\n        var isStart = this.caret.isStart(element);\n\n        if (!isEnd && !isStart)\n        {\n            var extractedContent = this.extractHtmlFromCaret(inline);\n\n            var $secondPart = $R.dom('<' + tag + ' />');\n            $secondPart = this.cloneAttributes(element, $secondPart);\n\n            $element.after($secondPart.append(extractedContent));\n        }\n\n        if (isStart)\n        {\n            return $element.before(nodes);\n        }\n        else\n        {\n            if (isList)\n            {\n                return $element.append(nodes);\n            }\n            else\n            {\n                nodes = $element.after(nodes);\n\n                var html = $element.html();\n                html = this.removeInvisibleChars(html);\n                html = html.replace(/&nbsp;/gi, '');\n\n                if (html === '') $element.remove();\n\n                return nodes;\n            }\n        }\n    },\n    extractHtmlFromCaret: function(inline, element)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            element = (element) ? element : ((inline) ? this.selection.getInline() : this.selection.getBlock());\n            if (element)\n            {\n                var clonedRange = range.cloneRange();\n                clonedRange.selectNodeContents(element);\n                clonedRange.setStart(range.endContainer, range.endOffset);\n\n                return clonedRange.extractContents();\n            }\n        }\n    },\n    createMarkup: function(el)\n    {\n        var markup = document.createElement(this.opts.markup);\n        if (this.opts.breakline) markup.setAttribute('data-redactor-tag', 'br');\n\n        var $el = $R.dom(el);\n\n        $el.after(markup);\n        this.caret.setStart(markup);\n    },\n    getNode: function(el)\n    {\n        var node = $R.dom(el).get();\n        var editor = this.editor.getElement().get();\n\n        return (typeof el === 'undefined') ? editor : ((node) ? node : false);\n    },\n    findSiblings: function(node, type)\n    {\n        node = $R.dom(node).get();\n        type = (type === 'next') ? 'nextSibling' : 'previousSibling';\n\n        while (node = node[type])\n        {\n            if ((node.nodeType === 3 && node.textContent.trim() === '') || node.tagName === 'BR')\n            {\n                continue;\n            }\n\n            return node;\n        }\n\n        return false;\n    },\n    getElementsFromHtml: function(html, selector, exclude)\n    {\n        var div = document.createElement(\"div\");\n        div.innerHTML = html;\n\n        var elems = div.querySelectorAll(selector);\n\n        // array map polyfill\n        var mapping = function(callback, thisArg)\n        {\n            if (typeof this.length !== 'number') return;\n            if (typeof callback !== 'function') return;\n\n            var newArr = [];\n            if (typeof this == 'object')\n            {\n                for (var i = 0; i < this.length; i++)\n                {\n                    if (i in this) newArr[i] = callback.call(thisArg || this, this[i], i, this);\n                    else return;\n                }\n            }\n\n            return newArr;\n        };\n\n        return mapping.call(elems, function(el)\n        {\n            var type = el.getAttribute('data-redactor-type');\n            if (exclude && type && type === exclude) {}\n            else return el.outerHTML;\n        });\n    },\n\n    // childnodes\n    getChildNodes: function(el, recursive, elements)\n    {\n        el = (el && el.nodeType && el.nodeType === 11) ? el : $R.dom(el).get();\n\n        var nodes = el.childNodes;\n        var result = [];\n        if (nodes)\n        {\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (elements === true && nodes[i].nodeType === 3) continue;\n                else if (nodes[i].nodeType === 3 && this.isEmpty(nodes[i])) continue;\n\n                result.push(nodes[i]);\n\n                if (recursive !== false)\n                {\n                    var nestedNodes = this.getChildNodes(nodes[i], elements);\n                    if (nestedNodes.length > 0)\n                    {\n                        result = result.concat(nestedNodes);\n                    }\n                }\n            }\n        }\n\n        return result;\n    },\n    getChildElements: function(el)\n    {\n        return this.getChildNodes(el, true, true);\n    },\n    getFirstNode: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false));\n    },\n    getLastNode: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false));\n    },\n    getFirstElement: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false, true));\n    },\n    getLastElement: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false, true));\n    },\n\n    // replace\n    replaceToTag: function(node, tag)\n    {\n        var $node = $R.dom(node);\n        return $node.replaceWith(function(node)\n        {\n            var $replaced = $R.dom('<' + tag + '>').append($R.dom(node).contents());\n            if (node.attributes)\n            {\n                var attrs = node.attributes;\n                for (var i = 0; i < attrs.length; i++)\n                {\n                    $replaced.attr(attrs[i].nodeName, attrs[i].value);\n                }\n            }\n\n            return $replaced;\n\n        });\n    },\n\n    // string\n    ucfirst: function(str)\n    {\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n\n    // array\n    removeFromArrayByValue: function(arr, value)\n    {\n        var a = arguments, len = a.length, ax;\n        while (len > 1 && arr.length)\n        {\n            value = a[--len];\n            while ((ax= arr.indexOf(value)) !== -1)\n            {\n                arr.splice(ax, 1);\n            }\n        }\n\n        return arr;\n    },\n\n    // attributes\n    removeEmptyAttr: function(el, attr)\n    {\n        var $el = $R.dom(el);\n\n        if (typeof $el.attr(attr) === 'undefined' || $el.attr(attr) === null) return true;\n        else if ($el.attr(attr) === '')\n        {\n            $el.removeAttr(attr);\n            return true;\n        }\n\n        return false;\n    },\n    cloneAttributes: function(elFrom, elTo)\n    {\n        elFrom = $R.dom(elFrom).get();\n        elTo = $R.dom(elTo);\n\n        var attrs = elFrom.attributes;\n        var len = attrs.length;\n        while (len--)\n        {\n            var attr = attrs[len];\n            elTo.attr(attr.name, attr.value);\n        }\n\n        return elTo;\n    },\n\n    // object\n    toParams: function(obj)\n    {\n        if (typeof obj !== 'object') return obj;\n\n        var keys = Object.keys(obj);\n        if (!keys.length) return '';\n        var result = '';\n\n        for (var i = 0; i < keys.length; i++)\n        {\n            var key = keys[i];\n            result += key + ':' + obj[key] + ';';\n        }\n\n        return result;\n    },\n    styleToObj: function(str)\n    {\n        var obj = {};\n\n        if (str)\n        {\n            var style = str.replace(/;$/, '').split(';');\n            for (var i = 0; i < style.length; i++)\n            {\n                var rule = style[i].split(':');\n                obj[rule[0].trim()] = rule[1].trim();\n            }\n        }\n\n        return obj;\n    },\n    checkProperty: function(obj)\n    {\n        var args = (arguments[1] && Array.isArray(arguments[1])) ? arguments[1] : [].slice.call(arguments, 1);\n\n        for (var i = 0; i < args.length; i++)\n        {\n            if (!obj || (typeof obj[args[i]] === 'undefined'))\n            {\n                return false;\n            }\n\n            obj = obj[args[i]];\n        }\n\n        return obj;\n    },\n\n    // data\n    extendData: function(data, obj)\n    {\n        for (var key in obj)\n        {\n            if (key === 'elements')\n            {\n                var $elms = $R.dom(obj[key]);\n                $elms.each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    if (node.tagName === 'FORM')\n                    {\n                        var serializedData = $node.serialize(true);\n                        for (var z in serializedData)\n                        {\n                            data = this._setData(data, z, serializedData[z]);\n                        }\n                    }\n                    else\n                    {\n                        var name = ($node.attr('name')) ? $node.attr('name') : $node.attr('id');\n                        data = this._setData(data, name, $node.val());\n                    }\n                }.bind(this));\n            }\n            else\n            {\n                data = this._setData(data, key, obj[key]);\n            }\n        }\n\n        return data;\n    },\n    _setData: function(data, name, value)\n    {\n        if (data instanceof FormData) data.append(name, value);\n        else data[name] = value;\n\n        return data;\n    },\n\n    // normalize\n    normalizeTextNodes: function(el)\n    {\n        el = $R.dom(el).get();\n        if (el) el.normalize();\n    },\n\n    // color\n    isRgb: function(str)\n    {\n        return (str.search(/^rgb/i) === 0);\n    },\n    rgb2hex: function(rgb)\n    {\n        rgb = rgb.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\n        return (rgb && rgb.length === 4) ? \"#\" +\n        (\"0\" + parseInt(rgb[1],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[2],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';\n    },\n    hex2long: function(val)\n    {\n        if (val.search(/^#/) !== -1 && val.length === 4)\n        {\n            val = '#' + val[1] + val[1] + val[2] + val[2] + val[3] + val[3];\n        }\n\n        return val;\n    },\n\n    // escape\n    escapeRegExp: function(s)\n    {\n        return s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n    },\n\n    // random\n    getRandomId: function()\n    {\n        var id = '';\n        var possible = 'abcdefghijklmnopqrstuvwxyz0123456789';\n\n        for (var i = 0; i < 12; i++)\n        {\n            id += possible.charAt(Math.floor(Math.random() * possible.length));\n        }\n\n        return id;\n    },\n\n    // private\n    _getFirst: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[0] : false;\n    },\n    _getLast: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[nodes.length-1] : false;\n    }\n});\n$R.add('service', 'progress', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$box = null;\n        this.$bar = null;\n    },\n\n    // public\n    show: function()\n    {\n        if (!this._is()) this._build();\n        this.$box.show();\n    },\n    hide: function()\n    {\n        if (this._is())\n        {\n            this.animate.start(this.$box, 'fadeOut', this._destroy.bind(this));\n        }\n    },\n    update: function(value)\n    {\n        this.show();\n        this.$bar.css('width', value + '%');\n    },\n\n    // private\n    _is: function()\n    {\n        return (this.$box !== null);\n    },\n    _build: function()\n    {\n        this.$bar = $R.dom('<span />');\n        this.$box = $R.dom('<div id=\"redactor-progress\" />');\n\n        this.$box.append(this.$bar);\n        this.$body.append(this.$box);\n    },\n    _destroy: function()\n    {\n        if (this._is()) this.$box.remove();\n\n        this.$box = null;\n        this.$bar = null;\n    }\n});\n$R.add('module', 'starter', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.plugin = app.plugin;\n        this.module = app.module;\n    },\n    // messages\n    onstart: function()\n    {\n        var services = ['element', 'container', 'source', 'editor', 'statusbar', 'toolbar'];\n        var modules = ['element', 'container', 'source', 'editor', 'statusbar', 'contextbar', 'input'];\n\n        this._startStop('start', this.app, services);\n        this._startStop('start', this.module, modules);\n    },\n    onstop: function()\n    {\n        var modules = ['observer', 'element', 'container', 'source', 'editor', 'contextbar'];\n\n        this._startStop('stop', this.module, modules);\n    },\n    onenable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('start', this.module, modules);\n        this._startStop('start', this.plugin, plugins);\n    },\n    ondisable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('stop', this.module, modules);\n        this._startStop('stop', this.plugin, plugins);\n    },\n\n    // private\n    _startStop: function(type, obj, arr)\n    {\n        for (var i = 0; i < arr.length; i++)\n        {\n            if (typeof obj[arr[i]] !== 'undefined')\n            {\n                this.app.callInstanceMethod(obj[arr[i]], type);\n            }\n        }\n    }\n});\n$R.add('module', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.namespace = app.namespace;\n        this.element = app.element;\n        this.rootOpts = $R.extend({}, true, $R.options, app.rootOpts);\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildModes();\n        this._buildMarkup();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        $element.removeData(this.namespace + '-uuid');\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        $element.data(this.namespace + '-uuid', this.uuid);\n    },\n    _buildModes: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline') this._redefineOptions(this.opts.modes['inline']);\n        if (type === 'div') this._redefineOptions(this.opts.modes['original']);\n\n        if (type !== 'inline')\n        {\n            if (this._isRootOption('styles') && this.rootOpts.styles) this.opts.styles = true;\n            if (this._isRootOption('source') && !this.rootOpts.source) this.opts.showSource = false;\n        }\n    },\n    _buildMarkup: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline')\n        {\n            this.opts.emptyHtml = '';\n        }\n        else if (this.opts.breakline)\n        {\n            this.opts.markup = 'div';\n            this.opts.emptyHtml = '<div data-redactor-tag=\"br\">' + this.opts.markerChar + '</div>';\n        }\n        else\n        {\n            this.opts.emptyHtml = '<' + this.opts.markup + '></' + this.opts.markup + '>';\n        }\n    },\n    _redefineOptions: function(opts)\n    {\n        for (var key in opts)\n        {\n            this.opts[key] = opts[key];\n        }\n    },\n    _isRootOption: function()\n    {\n        return (typeof this.rootOpts['styles'] !== 'undefined');\n    }\n});\n$R.add('module', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.source = app.source;\n        this.element = app.element;\n        this.component = app.component;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.placeholder = false;\n        this.events = false;\n    },\n    // messages\n    onenable: function()\n    {\n        this.enable();\n    },\n    ondisable: function()\n    {\n        this.disable();\n    },\n    onenablefocus: function()\n    {\n        this._enableFocus();\n    },\n    oncontextmenu: function(e)\n    {\n        this.component.setOnEvent(e, true);\n    },\n    onclick: function(e)\n    {\n        this.component.setOnEvent(e);\n    },\n    onkeyup: function(e)\n    {\n        var data = this.inspector.parse(e.target);\n        if (!data.isComponent())\n        {\n            this.component.clearActive();\n        }\n    },\n    onenablereadonly: function()\n    {\n        this._enableReadOnly();\n    },\n    ondisablereadonly: function()\n    {\n        this._disableReadOnly();\n    },\n    onautoparseobserve: function()\n    {\n        this.autoparser.observe();\n    },\n    onplaceholder: {\n        build: function()\n        {\n            this._buildPlaceholder();\n        },\n        toggle: function()\n        {\n            this._togglePlacehodler();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildEvents();\n        this._buildOptions();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        var classesEditor = ['redactor-in', 'redactor-in-' + this.uuid, 'redactor-structure', 'redactor-placeholder', this.opts.stylesClass];\n        var classesContainer = ['redactor-focus', 'redactor-blur', 'redactor-over', 'redactor-styles-on',\n                                'redactor-styles-off', 'redactor-toolbar-on', 'redactor-text-labeled-on', 'redactor-source-view'];\n\n        $editor.removeAttr('spellcheck');\n        $editor.removeAttr('dir');\n        $editor.removeAttr('contenteditable');\n        $editor.removeAttr('placeholder');\n        $editor.removeAttr('data-gramm_editor');\n        $editor.removeClass(classesEditor.join(' '));\n\n        $container.removeClass(classesContainer.join(' '));\n\n        this._destroyEvents();\n\n        if ($editor.get().classList.length === 0) $editor.removeAttr('class');\n    },\n    enable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.addClass('redactor-in redactor-in-' + this.uuid);\n        $editor.attr({ 'contenteditable': true });\n\n        if (this.opts.structure)\n        {\n            $editor.addClass('redactor-structure');\n        }\n\n        if (this.opts.toolbar && !this.opts.air && !this.opts.toolbarExternal)\n        {\n            $container.addClass('redactor-toolbar-on');\n        }\n\n        // prevent editing\n        this._disableBrowsersEditing();\n    },\n    disable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.removeClass('redactor-in redactor-in-' + this.uuid);\n        $editor.removeClass('redactor-structure');\n        $editor.removeAttr('contenteditable');\n\n        $container.addClass('redactor-toolbar-on');\n    },\n\n    // private\n    _build: function()\n    {\n        var $editor = this.editor.getElement();\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-blur');\n\n        if (!this.opts.grammarly)\n        {\n            $editor.attr('data-gramm_editor', false);\n        }\n\n        if (this.opts.styles)\n        {\n            $editor.addClass(this.opts.stylesClass);\n            $container.addClass('redactor-styles-on');\n        }\n        else\n        {\n            $container.addClass('redactor-styles-off');\n        }\n\n        if (this.opts.buttonsTextLabeled)\n        {\n            $container.addClass('redactor-text-labeled-on');\n        }\n\n        if (this.element.isType('textarea')) $element.before($editor);\n    },\n    _buildEvents: function()\n    {\n        this.events = $R.create('editor.events', this.app);\n    },\n    _buildOptions: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr('dir', this.opts.direction);\n\n        if (this.opts.tabindex)  $editor.attr('tabindex', this.opts.tabindex);\n        if (this.opts.minHeight) $editor.css('min-height', this.opts.minHeight);\n        if (this.opts.maxHeight) $editor.css('max-height', this.opts.maxHeight);\n        if (this.opts.maxWidth)  $editor.css({ 'max-width': this.opts.maxWidth, 'margin': 'auto' });\n    },\n    _buildAccesibility: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr({ 'aria-labelledby': 'redactor-voice-' + this.uuid, 'role': 'presentation' });\n    },\n    _buildPlaceholder: function()\n    {\n        this.placeholder = $R.create('editor.placeholder', this.app);\n    },\n    _enableFocus: function()\n    {\n        if (this.opts.showSource) this._enableFocusSource();\n        else this._enableFocusEditor();\n    },\n    _enableFocusSource: function()\n    {\n        var $source = this.source.getElement();\n\n        if (this.opts.focus)\n        {\n            $source.focus();\n            $source.get().setSelectionRange(0, 0);\n        }\n        else if (this.opts.focusEnd)\n        {\n            $source.focus();\n        }\n    },\n    _enableFocusEditor: function()\n    {\n        if (this.opts.focus)\n        {\n            setTimeout(this.editor.startFocus.bind(this.editor), 100);\n        }\n        else if (this.opts.focusEnd)\n        {\n            setTimeout(this.editor.endFocus.bind(this.editor), 100);\n        }\n    },\n    _togglePlacehodler: function()\n    {\n        if (this.placeholder) this.placeholder.toggle();\n    },\n    _disableBrowsersEditing: function()\n    {\n        try {\n            // FF fix\n            document.execCommand('enableObjectResizing', false, false);\n            document.execCommand('enableInlineTableEditing', false, false);\n            // IE prevent converting links\n            document.execCommand(\"AutoUrlDetect\", false, false);\n\n            // IE disable image resizing\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            if (el.addEventListener) el.addEventListener('mscontrolselect', function(e) { e.preventDefault(); });\n            else el.attachEvent('oncontrolselect', function(e) { e.returnValue = false; });\n\n        } catch (e) {}\n    },\n    _destroyEvents: function()\n    {\n        if (this.events)\n        {\n            this.events.destroy();\n        }\n    },\n    _enableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).removeAttr('contenteditable');\n        $editor.removeAttr('contenteditable');\n        $editor.addClass('redactor-read-only');\n\n        if (this.events) this.events.destroy();\n    },\n    _disableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).attr({ 'contenteditable': true });\n        $editor.removeClass('redactor-read-only');\n        $editor.attr({ 'contenteditable': true });\n\n        this._buildEvents();\n    },\n    _getEditables: function($editor)\n    {\n        return $editor.find('figcaption, td, th');\n    }\n});\n$R.add('class', 'editor.placeholder', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.element = app.element;\n\n        // build\n        this.build();\n    },\n    build: function()\n    {\n        var $element = this.element.getElement();\n        var $editor = this.editor.getElement();\n\n        if (this.opts.placeholder !== false || $element.attr('placeholder'))\n        {\n            var text = (this.opts.placeholder !== false) ? this.opts.placeholder : $element.attr('placeholder');\n            $editor.attr('placeholder', text);\n            this.toggle();\n        }\n    },\n    toggle: function()\n    {\n        return (this.editor.isEmpty(true)) ? this.show() : this.hide();\n    },\n    show: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.addClass('redactor-placeholder');\n    },\n    hide: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('redactor-placeholder');\n    }\n});\n$R.add('class', 'editor.events', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.uuid = app.uuid;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n        this.component = app.component;\n\n        // local\n        this.blurNamespace = '.redactor-blur.' + this.uuid;\n        this.eventsList = ['paste', 'click', 'contextmenu', 'keydown', 'keyup', 'mouseup', 'touchstart',\n                           'cut', 'copy', 'dragenter', 'dragstart', 'drop', 'dragover', 'dragleave'];\n\n        // init\n        this._init();\n    },\n    destroy: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.off('.redactor-focus');\n        this.$doc.off('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace);\n\n        // all events\n        this._loop('off');\n    },\n    focus: function(e)\n    {\n        var $container = this.container.getElement();\n\n        if (this.editor.isPasting() || $container.hasClass('redactor-focus')) return;\n\n        $container.addClass('redactor-focus');\n        $container.removeClass('redactor-blur');\n\n        this.app.broadcast('observe', e);\n        this.app.broadcast('focus', e);\n\n        this.isFocused = true;\n        this.isBlured = false;\n    },\n    blur: function(e)\n    {\n        var $container = this.container.getElement();\n        var $target = $R.dom(e.target);\n        var targets = ['.redactor-in-' + this.uuid,  '.redactor-toolbar', '.redactor-dropdown',\n        '.redactor-context-toolbar', '#redactor-modal', '#redactor-image-resizer'];\n\n        this.app.broadcast('originalblur', e);\n        if (this.app.stopBlur) return;\n\n        if (!this.app.isStarted() || this.editor.isPasting()) return;\n        if ($target.closest(targets.join(',')).length !== 0) return;\n\n        if (!this.isBlured && !$container.hasClass('redactor-blur'))\n        {\n            $container.removeClass('redactor-focus');\n            $container.addClass('redactor-blur');\n            this.app.broadcast('blur', e);\n\n            this.isFocused = false;\n            this.isBlured = true;\n        }\n    },\n    cut: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, true);\n            e.preventDefault();\n        }\n    },\n    copy: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, false);\n            e.preventDefault();\n        }\n    },\n    drop: function(e)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        this._removeOverClass();\n\n        if (this.opts.dragUpload === false)\n        {\n            e.preventDefault();\n            return;\n        }\n\n        if (this.app.isDragComponentInside())\n        {\n            var $dragComponent = $R.dom(this.app.getDragComponentInside());\n            var $component = $dragComponent.clone(true);\n            this.insertion.insertToPoint(e, $component);\n\n            $dragComponent.remove();\n\n            this.app.setDragComponentInside(false);\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n            this.app.broadcast('image.observe', e);\n\n            e.preventDefault();\n\n            return;\n        }\n        else if (this.app.isDragInside() && this.opts.input)\n        {\n            this.insertion.insertPoint(e);\n\n            var dt = e.dataTransfer;\n            var html = dt.getData('text/html');\n\n            // clear selected\n            var range = this.selection.getRange();\n            if (range)\n            {\n                var blocks = this.selection.getBlocks();\n                range.deleteContents();\n\n                // remove empty blocks\n                for (var i = 0; i < blocks.length; i++)\n                {\n                    if (blocks[i].innerHTML === '') $R.dom(blocks[i]).remove();\n                }\n            }\n\n            // paste\n            $R.create('input.paste', this.app, e, true, html, true);\n\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n\n            this.app.setDragInside(false);\n            e.preventDefault();\n\n            return;\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('paste', e, e.dataTransfer);\n        this.app.broadcast('drop', e);\n\n    },\n    dragenter: function(e)\n    {\n        e.preventDefault();\n    },\n    dragstart: function(e)\n    {\n        this.app.setDragComponentInside(false);\n        this.app.setDragInside(false);\n\n        var data = this.inspector.parse(e.target);\n        if (data.isComponent() && !data.isComponentEditable() && !data.isFigcaption())\n        {\n            this.app.setDragComponentInside(data.getComponent());\n        }\n        else if (this.selection.is() && !this.selection.isCollapsed())\n        {\n            // drag starts inside editor\n            this.app.setDragInside(true);\n            this._setDragData(e);\n        }\n\n        this.app.broadcast('dragstart', e);\n    },\n    dragover: function(e)\n    {\n        this.app.broadcast('dragover', e);\n    },\n    dragleave: function(e)\n    {\n        this.app.broadcast('dragleave', e);\n    },\n    paste: function(e)\n    {\n        this.app.broadcast('paste', e);\n    },\n    contextmenu: function(e)\n    {\n        // chrome crashes fix\n        this.editor.disableNonEditables();\n\n        setTimeout(function()\n        {\n            this.editor.enableNonEditables();\n            this.app.broadcast('contextmenu', e);\n\n        }.bind(this), 0);\n    },\n    click: function(e)\n    {\n        // triple click selection\n        if (e.detail === 3)\n        {\n            e.preventDefault();\n\n            var block = this.selection.getBlock();\n            var range = document.createRange();\n            range.selectNodeContents(block);\n            this.selection.setRange(range)\n        }\n\n        // observe bottom click\n        var $target = $R.dom(e.target);\n        if ($target.hasClass('redactor-in'))\n        {\n            var top = $target.offset().top;\n            var pad = parseFloat($target.css('padding-bottom'));\n            var height = $target.height();\n            var posHeight = top + height - pad*2;\n\n            if (posHeight < e.pageY)\n            {\n                this.app.broadcast('bottomclick', e);\n            }\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('click', e);\n    },\n    keydown: function(e)\n    {\n        this.app.broadcast('state', e);\n        var stop = this.app.broadcast('keydown', e);\n        if (stop === false)\n        {\n            return e.preventDefault();\n        }\n    },\n    keyup: function(e)\n    {\n        this.app.broadcast('keyup', e);\n    },\n    mouseup: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n    touchstart: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.on('focus.redactor-focus click.redactor-focus', this.focus.bind(this));\n        this.$doc.on('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace, this.blur.bind(this));\n\n        // all events\n        this._loop('on');\n    },\n    _removeOverClass: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('over');\n    },\n    _loop: function(func)\n    {\n        var $editor = this.editor.getElement();\n        for (var i = 0; i < this.eventsList.length; i++)\n        {\n            var event = this.eventsList[i] + '.redactor-events';\n            var method = this.eventsList[i];\n\n            $editor[func](event, this[method].bind(this));\n        }\n    },\n    _passAllToClipboard: function(e)\n    {\n        var clipboard = e.clipboardData;\n        var content = this.source.getCode();\n\n        clipboard.setData('text/html', content);\n        clipboard.setData('text/plain', content.toString().replace(/\\n$/, \"\"));\n    },\n    _passSelectionToClipboard: function(e, data, remove)\n    {\n        var clipboard = e.clipboardData;\n        var node = data.getComponent();\n        var $node = $R.dom(node);\n        var $cloned = $node.clone();\n\n        // clean\n        $cloned.find('.redactor-component-caret').remove();\n        $cloned.removeClass('redactor-component-active');\n        $cloned.removeAttr('contenteditable');\n        $cloned.removeAttr('tabindex');\n\n        // html\n        var content = $cloned.get().outerHTML;\n\n        if (remove) this.component.remove(node);\n\n        clipboard.setData('text/html', content);\n        clipboard.setData('text/plain', content.toString().replace(/\\n$/, \"\"));\n    },\n    _setDragData: function(e)\n    {\n        e = e.originalEvent || e;\n\n        var dt = e.dataTransfer;\n        dt.effectAllowed = 'move';\n        dt.setData('text/Html', this.selection.getHtml());\n    }\n});\n$R.add('module', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.element = app.element;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.after($element);\n        $container.remove();\n        $element.show();\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-box');\n        $container.attr('dir', this.opts.direction);\n\n        if (this.element.isType('inline')) $container.addClass('redactor-inline');\n\n        $element.after($container);\n        $container.append($element);\n    },\n    _buildAccesibility: function()\n    {\n        var $container = this.container.getElement();\n        var $label = $R.dom('<span />');\n\n        $label.addClass('redactor-voice-label');\n        $label.attr({ 'id': 'redactor-voice-' + this.uuid, 'aria-hidden': false });\n        $label.html(this.lang.get('accessibility-help-label'));\n\n        $container.prepend($label);\n    }\n});\n$R.add('module', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.element = app.element;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.cleaner = app.cleaner;\n        this.component = app.component;\n        this.container = app.container;\n        this.autoparser = app.autoparser;\n        this.selection = app.selection;\n\n        // local\n        this.syncedHtml = '';\n    },\n    // messages\n    onstartcode: function()\n    {\n        var sourceContent = this.source.getStartedContent();\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n\n        // autoparse\n        if (this.opts.autoparse && this.opts.autoparseStart)\n        {\n            sourceContent = this.autoparser.parse(sourceContent);\n        }\n\n        // started content\n        var startContent = this.cleaner.input(sourceContent, true, true);\n        var syncContent = this.cleaner.output(startContent);\n\n        // set content\n        $editor.html(startContent);\n        $source.val(syncContent);\n\n        this.syncedHtml = syncContent;\n        this.app.broadcast('placeholder.build');\n        this.app.broadcast('autoparseobserve');\n\n        // widget's scripts\n        this.component.executeScripts();\n    },\n    onstartcodeshow: function()\n    {\n        this.show();\n    },\n    ontrytosync: function()\n    {\n        this.sync();\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildClasses();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $source = this.source.getElement();\n\n        $element.removeClass('redactor-source redactor-source-open');\n        $source.off('input.redactor-source');\n        $source.removeAttr('data-gramm_editor');\n\n        if ($source.get().classList.length === 0) $source.removeAttr('class');\n        if (!this.source.isNameGenerated()) $element.removeAttr('name');\n        if (!this.element.isType('textarea')) $source.remove();\n\n    },\n    getCode: function()\n    {\n        return this.source.getCode();\n    },\n\n    // public\n    toggle: function()\n    {\n        if (!this.opts.source) return;\n\n        var $source = this.source.getElement();\n\n        return ($source.hasClass('redactor-source-open')) ? this.hide() : this.show();\n    },\n    show: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n\n        if (this.app.isStarted()) html = this.app.broadcast('source.open', html);\n\n        // insert markers\n        var sourceSelection = $R.create('source.selection', this.app);\n\n        var editorHtml = sourceSelection.insertMarkersToEditor();\n        editorHtml = this.cleaner.output(editorHtml, false);\n        editorHtml = editorHtml.trim();\n\n        // get height\n        var editorHeight = $editor.height();\n\n        $editor.hide();\n        $source.height(editorHeight);\n        $source.val(html.trim());\n        $source.show();\n        $source.addClass('redactor-source-open');\n        $source.on('input.redactor-source-events', this._onChangedSource.bind(this));\n        $source.on('keydown.redactor-source-events', this._onTabKey.bind(this));\n        $source.on('focus.redactor-source-events', this._onFocus.bind(this));\n\n        $container.addClass('redactor-source-view');\n\n        // offset markers\n        sourceSelection.setSelectionOffsetSource(editorHtml);\n\n        // buttons\n        setTimeout(function()\n        {\n            this._disableButtons();\n            this._setActiveSourceButton();\n\n        }.bind(this), 100);\n\n        if (this.app.isStarted()) this.app.broadcast('source.opened');\n    },\n    hide: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n\n        // insert markers\n        var sourceSelection = $R.create('source.selection', this.app);\n        html = sourceSelection.insertMarkersToSource(html);\n\n        // clean\n        html = this.cleaner.input(html, true);\n        html = (this.utils.isEmptyHtml(html)) ? this.opts.emptyHtml : html;\n        html = this.app.broadcast('source.close', html);\n\n        // buttons\n        this._enableButtons();\n        this._setInactiveSourceButton();\n\n        $source.hide();\n        $source.removeClass('redactor-source-open');\n        $source.off('.redactor-source-events');\n        $editor.show();\n        $editor.html(html);\n\n        $container.removeClass('redactor-source-view');\n\n        setTimeout(function()\n        {\n            if (sourceSelection.isOffset()) this.selection.restoreMarkers();\n            else if (sourceSelection.isOffsetEnd()) this.editor.endFocus();\n            else this.editor.startFocus();\n\n            // widget's scripts\n            this.component.executeScripts();\n\n        }.bind(this), 0);\n\n        this.app.broadcast('source.closed');\n    },\n    sync: function()\n    {\n        var self = this;\n        var $editor = this.editor.getElement();\n        var html = $editor.html();\n\n        html = this.app.broadcast('syncBefore', html);\n        html = this.cleaner.output(html);\n\n        if (this._isSync(html))\n        {\n            if (this.timeout) clearTimeout(this.timeout);\n            this.timeout = setTimeout(function() { self._syncing(html); }, 200);\n        }\n    },\n\n    // private\n    _build: function()\n    {\n        var $source = this.source.getElement();\n        var $element = this.element.getElement();\n\n        $source.hide();\n\n        if (!this.opts.grammarly)\n        {\n            $source.attr('data-gramm_editor', false);\n        }\n\n        if (!this.element.isType('textarea'))\n        {\n            $element.after($source);\n        }\n    },\n    _buildClasses: function()\n    {\n        var $source = this.source.getElement();\n\n        $source.addClass('redactor-source');\n    },\n    _syncing: function(html)\n    {\n        html = this.app.broadcast('syncing', html);\n\n        var $source = this.source.getElement();\n        $source.val(html);\n\n        this.app.broadcast('synced', html);\n        this.app.broadcast('changed', html);\n    },\n    _isSync: function(html)\n    {\n        if (this.syncedHtml !== html)\n        {\n            this.syncedHtml = html;\n            return true;\n        }\n\n        return false;\n    },\n    _onChangedSource: function()\n    {\n        var $source = this.source.getElement();\n        var html = $source.val();\n\n        this.app.broadcast('changed', html);\n        this.app.broadcast('source.changed', html);\n    },\n    _onTabKey: function(e)\n    {\n        if (e.keyCode !== 9) return true;\n\n        e.preventDefault();\n\n        var $source = this.source.getElement();\n        var el = $source.get();\n        var start = el.selectionStart;\n\n        $source.val($source.val().substring(0, start) + \"    \" + $source.val().substring(el.selectionEnd));\n        el.selectionStart = el.selectionEnd = start + 4;\n    },\n    _onFocus: function()\n    {\n        this.app.broadcast('sourcefocus');\n    },\n    _disableButtons: function()\n    {\n        this.toolbar.disableButtons();\n    },\n    _enableButtons: function()\n    {\n        this.toolbar.enableButtons();\n    },\n    _setActiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.enable();\n        $btn.setActive();\n    },\n    _setInactiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.setInactive();\n    }\n});\n$R.add('class', 'source.selection', {\n    init: function(app)\n    {\n        this.app = app;\n        this.utils = app.utils;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.marker = app.marker;\n        this.component = app.component;\n        this.selection = app.selection;\n\n        // local\n        this.markersOffset = false;\n        this.markersOffsetEnd = false;\n    },\n    insertMarkersToEditor: function()\n    {\n        var $editor = this.editor.getElement();\n        var start = this.marker.build('start');\n        var end = this.marker.build('end');\n        var component = this.component.getActive();\n        if (component)\n        {\n            this.marker.remove();\n            var $component = $R.dom(component);\n\n            $component.after(end);\n            $component.after(start);\n        }\n        else if (window.getSelection && this.selection.is())\n        {\n            this.marker.insert('both');\n        }\n\n        return this._getHtmlAndRemoveMarkers($editor);\n    },\n    setSelectionOffsetSource: function(editorHtml)\n    {\n        var start = 0;\n        var end = 0;\n        var $source = this.source.getElement();\n        if (editorHtml !== '')\n        {\n            var startMarker = this.utils.removeInvisibleChars(this.marker.buildHtml('start'));\n            var endMarker = this.utils.removeInvisibleChars(this.marker.buildHtml('end'));\n\n            start = this._strpos(editorHtml, startMarker);\n            end = this._strpos(editorHtml, endMarker) - endMarker.toString().length - 2;\n\n            if (start === false)\n            {\n                start = 0;\n                end = 0;\n            }\n        }\n\n        $source.get().setSelectionRange(start, end);\n        $source.get().scrollTop = 0;\n\n        setTimeout(function() { $source.focus(); }.bind(this), 0);\n    },\n    isOffset: function()\n    {\n        return this.markersOffset;\n    },\n    isOffsetEnd: function()\n    {\n        return this.markersOffsetEnd;\n    },\n    insertMarkersToSource: function(html)\n    {\n        var $source = this.source.getElement();\n        var markerStart = this.marker.buildHtml('start');\n        var markerEnd = this.marker.buildHtml('end');\n\n        var markerLength = markerStart.toString().length;\n        var startOffset = this._enlargeOffset(html, $source.get().selectionStart);\n        var endOffset = this._enlargeOffset(html, $source.get().selectionEnd);\n        var sizeOffset = html.length;\n\n        if (startOffset === sizeOffset)\n        {\n            this.markersOffsetEnd = true;\n        }\n        else if (startOffset !== 0 && endOffset !== 0)\n        {\n            this.markersOffset = true;\n\n            html = html.substr(0, startOffset) + markerStart + html.substr(startOffset);\n            html = html.substr(0, endOffset + markerLength) + markerEnd + html.substr(endOffset + markerLength);\n        }\n        else\n        {\n            this.markersOffset = false;\n        }\n\n        return html;\n    },\n\n    // private\n    _getHtmlAndRemoveMarkers: function($editor)\n    {\n        var html = $editor.html();\n        $editor.find('.redactor-selection-marker').remove();\n\n        return html;\n    },\n    _strpos: function(haystack, needle, offset)\n    {\n        var i = haystack.indexOf(needle, offset);\n        return i >= 0 ? i : false;\n    },\n    _enlargeOffset: function(html, offset)\n    {\n        var htmlLength = html.length;\n        var c = 0;\n\n        if (html[offset] === '>')\n        {\n            c++;\n        }\n        else\n        {\n            for(var i = offset; i <= htmlLength; i++)\n            {\n                c++;\n\n                if (html[i] === '>')\n                {\n                    break;\n                }\n                else if (html[i] === '<' || i === htmlLength)\n                {\n                    c = 0;\n                    break;\n                }\n            }\n        }\n\n        return offset + c;\n    }\n});\n$R.add('module', 'observer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.editor = app.editor;\n\n        // local\n        this.observerUnit = false;\n    },\n    // public\n    start: function()\n    {\n        if (window.MutationObserver)\n        {\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            this.observerUnit = this._build(el);\n            this.observerUnit.observe(el, {\n                 attributes: true,\n                 subtree: true,\n                 childList: true,\n                 characterData: true,\n                 characterDataOldValue: true\n            });\n        }\n    },\n    stop: function()\n    {\n        if (this.observerUnit) this.observerUnit.disconnect();\n    },\n\n    // private\n    _build: function(el)\n    {\n        var self = this;\n        return new MutationObserver(function(mutations)\n        {\n            self._observe(mutations[mutations.length-1], el);\n        });\n    },\n    _observe: function(mutation, el)\n    {\n        if (this.app.isReadOnly() || (mutation.type === 'attributes' && mutation.target === el))\n        {\n            return;\n        }\n\n        this.app.broadcast('observe');\n        this.app.broadcast('trytosync');\n        this.app.broadcast('placeholder.toggle');\n    }\n});\n$R.add('module', 'clicktoedit', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.container = app.container;\n        this.selection = app.selection;\n    },\n    // messages\n    onstartclicktoedit: function()\n    {\n        this.start();\n    },\n    onenablereadonly: function()\n    {\n        if (!this._isEnabled()) this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        if (!this._isEnabled()) this.start();\n    },\n    onstop: function()\n    {\n        this.stop();\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    stop: function()\n    {\n        if (this.buttonSave) this.buttonSave.stop();\n        if (this.buttonCancel) this.buttonCancel.stop();\n\n        this._destroy();\n        this.app.broadcast('disable');\n    },\n    enable: function()\n    {\n        this.app.broadcast('clickStart');\n\n        var isEmpty = this.editor.isEmpty();\n        if (!isEmpty) this.selection.saveMarkers();\n\n        this._setFocus();\n        this._destroy();\n        this.app.broadcast('enable');\n        this.buttonSave.enable();\n        this.buttonCancel.enable();\n\n        if (!isEmpty) this.selection.restoreMarkers();\n        if (isEmpty) this.editor.focus();\n\n        var $container = this.container.getElement();\n        $container.addClass('redactor-clicktoedit-enabled');\n    },\n    save: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.source.getCode();\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickSave', html);\n        this.app.broadcast('clickStop');\n        this._build();\n    },\n    cancel: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.saved;\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        this.saved = '';\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickCancel', html);\n        this.app.broadcast('clickStop');\n        this._build();\n    },\n\n    // private\n    _build: function()\n    {\n        // buttons\n        this.buttonSave = $R.create('clicktoedit.button', 'save', this.app, this);\n        this.buttonCancel = $R.create('clicktoedit.button', 'cancel', this.app, this);\n\n        this.buttonSave.stop();\n        this.buttonCancel.stop();\n\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.on('click.redactor-click-to-edit mouseup.redactor-click-to-edit', this.enable.bind(this));\n        $container.addClass('redactor-over');\n        $container.removeClass('redactor-clicktoedit-enabled');\n    },\n    _isEnabled: function()\n    {\n        return this.container.getElement().hasClass('redactor-clicktoedit-enabled');\n    },\n    _destroy: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.off('.redactor-click-to-edit');\n        $container.removeClass('redactor-over redactor-clicktoedit-enabled');\n    },\n    _setFocus: function()\n    {\n        this.saved = this.source.getCode();\n\n        this.buttonSave.start();\n        this.buttonCancel.start();\n    }\n});\n$R.add('class', 'clicktoedit.button', {\n    init: function(type, app, context)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.toolbar = app.toolbar;\n        this.context = context;\n\n        // local\n        this.type = type;\n        this.name = (type === 'save') ? 'clickToSave' : 'clickToCancel';\n        this.objected = false;\n        this.enabled = false;\n        this.namespace = '.redactor-click-to-edit';\n\n        // build\n        this._build();\n    },\n    enable: function()\n    {\n        if (!this.objected) return;\n\n        var data = this.opts[this.name];\n        data.api = 'module.clicktoedit.' + this.type;\n\n        this.toolbar.addButton(this.type, data);\n        this.enabled = true;\n    },\n    start: function()\n    {\n        if (this.objected) return;\n\n        this.$button.off(this.namespace);\n        this.$button.show();\n        this.$button.on('click' + this.namespace, this.context[this.type].bind(this.context));\n    },\n    stop: function()\n    {\n        if (this.objected || !this.enabled) return;\n\n        this.$button.hide();\n    },\n\n    // private\n    _build: function()\n    {\n        this.objected = (typeof this.opts[this.name] === 'object');\n\n        if (!this.objected)\n        {\n            this.$button = $R.dom(this.opts[this.name]);\n            this.enabled = true;\n        }\n    }\n});\n$R.add('module', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.element = app.element;\n        this.statusbar = app.statusbar;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        if (!this.element.isType('inline'))\n        {\n            var $statusbar = this.statusbar.getElement();\n            var $container = this.container.getElement();\n\n            $statusbar.addClass('redactor-statusbar');\n            $container.append($statusbar);\n        }\n    }\n});\n$R.add('module', 'contextbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n    },\n    // messages\n    onenablereadonly: function()\n    {\n        this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        this.start();\n    },\n    oncontextbar: {\n        close: function()\n        {\n            this.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.opts.toolbarContext)\n        {\n            var $editor = this.editor.getElement();\n\n            this._build();\n            $editor.on('click.redactor-context mouseup.redactor-context', this.open.bind(this));\n\n            if (this.opts.scrollTarget)\n            {\n                $R.dom(this.opts.scrollTarget).on('scroll.redactor-context', this.close.bind(this));\n            }\n        }\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-context');\n\n        this.$doc.off('.redactor-context');\n        this.$win.off('.redactor-context');\n\n        if (this.$contextbar) this.$contextbar.remove();\n        if (this.opts.scrollTarget)\n        {\n            $R.dom(this.opts.scrollTarget).off('.redactor-context');\n        }\n    },\n    is: function()\n    {\n        return (this.$contextbar && this.$contextbar.hasClass('open'));\n    },\n    set: function(e, node, buttons, position)\n    {\n        this.$contextbar.html('');\n        this.$el = $R.dom(node);\n\n        // buttons\n        for (var key in buttons)\n        {\n            var $btn = $R.create('contextbar.button', this.app, buttons[key]);\n            if ($btn.html() !== '')\n            {\n                this.$contextbar.append($btn);\n            }\n        }\n\n        // show\n        var pos = this._buildPosition(e, this.$el, position);\n\n        this.$contextbar.css(pos);\n        this.$contextbar.show();\n        this.$contextbar.addClass('open');\n        this.$doc.on('click.redactor-context mouseup.redactor-context', this.close.bind(this));\n        this.$win.on('resize.redactor-context', this.close.bind(this));\n    },\n    open: function(e)\n    {\n        setTimeout(function()\n        {\n            this.app.broadcast('contextbar', e, this);\n        }.bind(this), 0);\n    },\n    close: function(e)\n    {\n        if (!this.$contextbar) return;\n        if (e)\n        {\n            var $target = $R.dom(e.target);\n            if (this.$el && $target.closest(this.$el).length !== 0)\n            {\n                return;\n            }\n        }\n\n        this.$contextbar.hide();\n        this.$contextbar.removeClass('open');\n        this.$doc.off('.redactor.context');\n    },\n\n    // private\n    _build: function()\n    {\n        this.$contextbar = $R.dom('<div>');\n        this.$contextbar.attr('id', 'redactor-context-toolbar-' + this.uuid);\n        this.$contextbar.attr('dir', this.opts.direction);\n        this.$contextbar.addClass('redactor-context-toolbar');\n        this.$contextbar.hide();\n\n        this.$target.append(this.$contextbar);\n    },\n    _buildPosition: function(e, $el, position)\n    {\n        var top, left;\n        var isTarget = this.toolbar.isTarget();\n        var offset = (isTarget) ? $el.position() : $el.offset();\n        var width = $el.width();\n        var height = $el.height();\n\n        var barWidth = this.$contextbar.width();\n        var barHeight = this.$contextbar.height();\n        var docScrollTop = (isTarget) ? (this.$target.scrollTop() + this.$doc.scrollTop()) : this.$doc.scrollTop();\n\n        var targetOffset = this.$target.offset();\n        var leftFix = (isTarget) ? targetOffset.left : 0;\n        var topFix = (isTarget) ? targetOffset.top : 0;\n\n        if (!position)\n        {\n            top = (e.clientY + docScrollTop - barHeight);\n            left = (e.clientX - barWidth/2);\n        }\n        else if (position === 'top')\n        {\n            top = (offset.top - barHeight);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n        else if (position === 'bottom')\n        {\n            top = (offset.top + height);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n\n        if (left < 0) left = 0;\n\n        return { top: (top - topFix) + 'px', left: (left - leftFix) + 'px' };\n    }\n});\n$R.add('class', 'contextbar.button', {\n    mixins: ['dom'],\n    init: function(app, obj)\n    {\n        this.app = app;\n\n        // local\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n        this.attr('href', '#');\n\n        this._buildTitle();\n        this._buildMessage();\n    },\n    _buildTitle: function()\n    {\n        this.html(this.obj.title);\n    },\n    _buildMessage: function()\n    {\n        if (typeof this.obj.message !== 'undefined' || typeof this.obj.api !== 'undefined')\n        {\n            this.on('click', this._toggle.bind(this));\n        }\n    },\n    _toggle: function(e)\n    {\n        e.preventDefault();\n\n        if (this.obj.message)\n        {\n            this.app.broadcast(this.obj.message, this.obj.args);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args);\n        }\n    }\n});\n$R.add('module', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.buttons = [];\n        this.toolbarModule = false;\n    },\n    // messages\n    onsource: {\n        open: function()\n        {\n            if (!this.toolbar.isAir() && this.toolbar.isFixed())\n            {\n                this.toolbarModule.resetPosition();\n            }\n        },\n        opened: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.createSourceHelper();\n            }\n        },\n        close: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.destroySourceHelper();\n            }\n        },\n        closed: function()\n        {\n            if (this.toolbar.is() && this.opts.air)\n            {\n                this.toolbarModule.openSelected();\n            }\n        }\n    },\n    onobserve: function()\n    {\n        if (this.toolbar.is())\n        {\n            this.toolbar.observe();\n        }\n    },\n    onfocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onsourcefocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onempty: function()\n    {\n        if (this.toolbar.isFixed())\n        {\n            this.toolbarModule.resetPosition();\n        }\n    },\n    onenablereadonly: function()\n    {\n        if (this.toolbar.isAir())\n        {\n            this.toolbarModule.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.toolbar.is())\n        {\n            this._buildButtons();\n            this._initToolbar();\n            this._initButtons();\n        }\n    },\n    stop: function()\n    {\n        if (this.toolbarModule)\n        {\n            this.toolbarModule.stop();\n        }\n    },\n\n    // private\n    _buildButtons: function()\n    {\n        this.buttons = this.opts.buttons.concat();\n\n        this._buildImageButton();\n        this._buildFileButton();\n        this._buildSourceButton();\n        this._buildAdditionalButtons();\n        this._buildHiddenButtons();\n    },\n    _buildImageButton: function()\n    {\n        if (!this.opts.imageUpload) this.utils.removeFromArrayByValue(this.buttons, 'image');\n    },\n    _buildFileButton: function()\n    {\n        if (!this.opts.fileUpload) this.utils.removeFromArrayByValue(this.buttons, 'file');\n    },\n    _buildSourceButton: function()\n    {\n        if (!this.opts.source) this.utils.removeFromArrayByValue(this.buttons, 'html');\n    },\n    _buildAdditionalButtons: function()\n    {\n        // end\n        if (this.opts.buttonsAdd.length !== 0)\n        {\n            this.opts.buttonsAdd = this._removeExistButtons(this.opts.buttonsAdd);\n            this.buttons = this.buttons.concat(this.opts.buttonsAdd);\n        }\n\n        // beginning\n        if (this.opts.buttonsAddFirst.length !== 0)\n        {\n            this.opts.buttonsAddFirst = this._removeExistButtons(this.opts.buttonsAddFirst);\n            this.buttons.unshift(this.opts.buttonsAddFirst);\n        }\n\n        var index, btns;\n\n        // after\n        if (this.opts.buttonsAddAfter !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddAfter.after) + 1;\n            btns = this.opts.buttonsAddAfter.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index+i, 0, btns[i]);\n            }\n        }\n\n        // before\n        if (this.opts.buttonsAddBefore !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddBefore.before)+1;\n            btns = this.opts.buttonsAddBefore.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index-(1-i), 0, btns[i]);\n            }\n        }\n    },\n    _buildHiddenButtons: function()\n    {\n        if (this.opts.buttonsHide.length !== 0)\n        {\n            var buttons = this.opts.buttonsHide;\n            for (var i = 0; i < buttons.length; i++)\n            {\n                this.utils.removeFromArrayByValue(this.buttons, buttons[i]);\n            }\n        }\n    },\n    _removeExistButtons: function(buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            if (this.opts.buttons.indexOf(buttons[i]) !== -1)\n            {\n                this.utils.removeFromArrayByValue(buttons, buttons[i]);\n            }\n        }\n\n        return buttons;\n    },\n    _setExternalOnFocus: function()\n    {\n        if (!this.opts.air && this.opts.toolbarExternal)\n        {\n            this.toolbarModule.setExternal();\n        }\n    },\n    _initToolbar: function()\n    {\n        this.toolbarModule = (this.opts.air) ? $R.create('toolbar.air', this.app) : $R.create('toolbar.standard', this.app);\n    },\n    _initButtons: function()\n    {\n        this.toolbar.setButtons(this.buttons);\n\n        for (var i = 0; i < this.buttons.length; i++)\n        {\n            var name = this.buttons[i];\n            if ($R.buttons[name])\n            {\n                this.toolbar.addButton(name, $R.buttons[name], false, false, true);\n            }\n        }\n    }\n});\n$R.add('class', 'toolbar.air', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.clicks = 0;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-air-trigger-' + this.uuid);\n\n        this.$doc.off('.redactor-air-' + this.uuid);\n        this.$doc.off('.redactor-air-trigger-' + this.uuid);\n\n        this.toolbar.stopObservers();\n    },\n    createSourceHelper: function()\n    {\n        this.$airHelper = $R.dom('<span>');\n        this.$airHelper.addClass('redactor-air-helper');\n        this.$airHelper.html('<i class=\"re-icon-html\"></i>');\n        this.$airHelper.on('click', function(e)\n        {\n            e.preventDefault();\n            this.app.api('module.source.hide');\n\n        }.bind(this));\n\n        var $container = this.container.getElement();\n        $container.append(this.$airHelper);\n    },\n    destroySourceHelper: function()\n    {\n        if (this.$airHelper) this.$airHelper.remove();\n    },\n    openSelected: function()\n    {\n        setTimeout(function()\n        {\n            if (this._isSelection()) this._open(false);\n\n        }.bind(this), 0);\n    },\n    close: function()\n    {\n        this.$doc.off('.redactor-air-' + this.uuid);\n\n        var $toolbar = this.toolbar.getElement();\n        $toolbar.removeClass('open');\n        $toolbar.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper-air');\n        $toolbar.addClass('redactor-air');\n        //$toolbar.addClass('redactor-animate-hide');\n        $toolbar.hide();\n\n        $wrapper.append($toolbar);\n        $container.prepend($wrapper);\n\n        // open selected\n        this.openSelected();\n\n        // events\n        this.$doc.on('mouseup.redactor-air-trigger-' + this.uuid, this._open.bind(this));\n        $editor.on('keyup.redactor-air-trigger-' + this.uuid, this._openCmd.bind(this));\n    },\n    _isSelection: function()\n    {\n        return (this.selection.is() && !this.selection.isCollapsed());\n    },\n    _isOpened: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n\n        return $toolbar.hasClass('open');\n    },\n    _open: function(e)\n    {\n        var target = (e) ? e.target : false;\n        var $el = (e) ? $R.dom(e.target) : false;\n        var dataTarget = this.inspector.parse(target);\n        var isComponent = (dataTarget.isComponent() && !dataTarget.isComponentType('table'));\n        var isFigcaption = (dataTarget.isFigcaption());\n        var isModalTarget = ($el && $el.closest('.redactor-modal').length !== 0);\n        var isButtonCall = (e && $el.closest('.re-button').length !== 0);\n        var isDropdownCall = (e && $el.closest('.redactor-dropdown').length !== 0);\n\n        if (isDropdownCall || isButtonCall || isModalTarget || isFigcaption || isComponent || this.toolbar.isContextBar() || !this._isSelection())\n        {\n            return;\n        }\n\n        var pos = this.selection.getPosition();\n\n        setTimeout(function()\n        {\n            if (this.app.isReadOnly()) return;\n            if (this._isSelection()) this._doOpen(pos);\n\n        }.bind(this), 1);\n\n    },\n    _openCmd: function()\n    {\n        if (this.selection.isAll())\n        {\n            var $toolbar = this.toolbar.getElement();\n            var pos = this.selection.getPosition();\n\n            pos.top = (pos.top < 20) ? 0 : pos.top - $toolbar.height();\n            pos.height = 0;\n\n            this._doOpen(pos);\n        }\n    },\n    _doOpen: function(pos)\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $container = this.container.getElement();\n        var containerOffset = $container.offset();\n        var leftFix = 0;\n        var winWidth = this.$win.width();\n        var toolbarWidth = $toolbar.width();\n\n        if (winWidth < (pos.left + toolbarWidth))\n        {\n            var selPos = this.selection.getPosition();\n            leftFix = toolbarWidth - selPos.width;\n        }\n\n        $wrapper.css({\n            left: (pos.left - containerOffset.left - leftFix) + 'px',\n            top: (pos.top - containerOffset.top + pos.height + this.$doc.scrollTop()) + 'px'\n        });\n\n        this.app.broadcast('airOpen');\n        $toolbar.addClass('open');\n        $toolbar.show();\n\n        this.$doc.on('click.redactor-air-' + this.uuid, this._close.bind(this));\n        this.$doc.on('keydown.redactor-air-' + this.uuid, this._close.bind(this));\n        this.app.broadcast('airOpened');\n    },\n    _close: function(e)\n    {\n        var $el = (e) ? $R.dom(e.target) : false;\n        var isDropdownCall = (e && $el.closest('[data-dropdown], .redactor-dropdown-not-close').length !== 0);\n        var isButtonCall = (!isDropdownCall && e && $el.closest('.re-button').length !== 0);\n\n        if (!isButtonCall && (isDropdownCall || !this._isOpened()))\n        {\n            return;\n        }\n\n        // close\n        this.app.broadcast('airClose');\n\n        this.close();\n        this.app.broadcast('airClosed');\n    }\n});\n$R.add('class', 'toolbar.fixed', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n        this.container = app.container;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        this.$fixedTarget.off('.redactor-toolbar-' + this.uuid);\n        this.$win.off('.redactor-toolbar-' + this.uuid);\n    },\n    reset: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        $wrapper.css('height', '');\n        $toolbar.removeClass('redactor-toolbar-fixed');\n        $toolbar.css({ position: '', top: '', left: '', width: '' });\n\n        var dropdown = this.toolbar.getDropdown();\n        if (dropdown) dropdown.updatePosition();\n    },\n\n    // private\n    _init: function()\n    {\n        this.$fixedTarget = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$win;\n        this._doFixed();\n\n        if (this.toolbar.isTarget())\n        {\n            this.$win.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n            this.$win.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        }\n\n        this.$fixedTarget.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        this.$fixedTarget.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n    },\n    _doFixed: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        var $targets = $container.parents().filter(function(node)\n        {\n            return (getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        // has hidden parent\n        if ($targets.length !== 0) return;\n\n        var isHeight = ($editor.height() < 100);\n        var isEmpty = this.editor.isEmpty();\n\n        if (isHeight || isEmpty || this.editor.isSourceMode()) return;\n\n        var toolbarHeight = $toolbar.height();\n        var toleranceEnd = 60;\n        var containerOffset = $container.offset();\n        var boxOffset = containerOffset.top;\n        var boxEnd = boxOffset + $container.height() - toleranceEnd;\n        var scrollOffset = this.$fixedTarget.scrollTop() + this.opts.toolbarFixedTopOffset;\n        var top = (!this.toolbar.isTarget()) ? 0 : this.$fixedTarget.offset().top - this.$win.scrollTop();\n\n        if (scrollOffset > boxOffset && scrollOffset < boxEnd)\n        {\n            var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\n            top = (this.detector.isDesktop()) ? top : (scrollOffset - boxOffset + this.opts.toolbarFixedTopOffset);\n\n            if (this.detector.isMobile())\n            {\n                if (this.fixedScrollTimeout)\n                {\n                    clearTimeout(this.fixedScrollTimeout);\n                }\n\n                $toolbar.hide();\n                this.fixedScrollTimeout = setTimeout(function()\n                {\n                    $toolbar.show();\n                }, 250);\n            }\n\n            $wrapper.height(toolbarHeight);\n            $toolbar.addClass('redactor-toolbar-fixed');\n            $toolbar.css({\n                position: position,\n                top: (top + this.opts.toolbarFixedTopOffset) + 'px',\n                width: $container.width() + 'px'\n            });\n\n            var dropdown = this.toolbar.getDropdown();\n            if (dropdown) dropdown.updatePosition();\n\n            this.app.broadcast('toolbar.fixed');\n        }\n        else\n        {\n            this.reset();\n            this.app.broadcast('toolbar.unfixed');\n        }\n    }\n});\n$R.add('class', 'toolbar.standard', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n\n        // local\n        this.isExternalMultiple = false;\n        this.toolbarFixed = false;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        if (this.toolbarFixed) this.toolbarFixed.stop();\n        if (this.opts.toolbarExternal) this._findToolbars();\n\n        this.toolbar.stopObservers();\n    },\n    setExternal: function()\n    {\n        this._findToolbars();\n        if (this.isExternalMultiple)\n        {\n            this.$toolbars.hide();\n            var $current = this.$external.find('.redactor-toolbar-external-' + this.uuid);\n            $current.show();\n        }\n    },\n    resetPosition: function()\n    {\n        if (this.toolbarFixed) this.toolbarFixed.reset();\n    },\n\n    // private\n    _init: function()\n    {\n        this._build();\n\n        if (this.opts.toolbarExternal)\n        {\n            this._buildExternal();\n        }\n        else\n        {\n            this._buildFixed();\n\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _build: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper');\n        $toolbar.addClass('redactor-toolbar');\n        $toolbar.hide();\n        $wrapper.append($toolbar);\n\n        if (!this.opts.toolbarExternal)\n        {\n            var $container = this.container.getElement();\n            $container.prepend($wrapper);\n        }\n    },\n    _buildExternal: function()\n    {\n        this._initExternal();\n        this._findToolbars();\n\n        if (this.isExternalMultiple)\n        {\n            this._hideToolbarsExceptFirst();\n        }\n        else\n        {\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _buildFixed: function()\n    {\n        if (this.opts.toolbarFixed)\n        {\n            this.toolbarFixed = $R.create('toolbar.fixed', this.app);\n        }\n    },\n    _initExternal: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getElement();\n\n        $toolbar.addClass('redactor-toolbar-external redactor-toolbar-external-' + this.uuid);\n\n        this.$external = $R.dom(this.opts.toolbarExternal);\n        this.$external.append($wrapper);\n\n    },\n    _findToolbars: function()\n    {\n        this.$toolbars = this.$external.find('.redactor-toolbar-external');\n        this.isExternalMultiple = (this.$toolbars.length > 1);\n    },\n    _hideToolbarsExceptFirst: function()\n    {\n        this.$toolbars.hide();\n        var $first = this.$toolbars.first();\n        $first.show();\n    }\n});\n$R.add('module', 'line', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n    },\n    // messages\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('line'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.line.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n\n    },\n\n    // public\n    insert: function()\n    {\n        var line = this.component.create('line');\n        this.insertion.insertRaw(line);\n    },\n    remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'line.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        var wrapper, element;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var node = $node.get();\n\n            if (node.tagName === 'HR') element = node;\n            else if (node.tagName === 'FIGURE')\n            {\n                wrapper = node;\n                element = $node.find('hr').get();\n            }\n        }\n\n        this._buildWrapper(wrapper);\n        this._buildElement(element);\n        this._initWrapper();\n    },\n    _buildElement: function(node)\n    {\n        if (node)\n        {\n            this.$element = $R.dom(node);\n        }\n        else\n        {\n            this.$element = $R.dom('<hr>');\n            this.append(this.$element);\n        }\n    },\n    _buildWrapper: function(node)\n    {\n        node = node || '<figure>';\n\n        this.parse(node);\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'line',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'link', {\n    modals: {\n        'link':\n            '<form action=\"\"> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-url\">URL <span class=\"req\">*</span></label> \\\n                    <input type=\"text\" id=\"modal-link-url\" name=\"url\"> \\\n                </div> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-text\">## text ##</label> \\\n                    <input type=\"text\" id=\"modal-link-text\" name=\"text\"> \\\n                </div> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-link-title\">## title ##</label> \\\n                    <input type=\"text\" id=\"modal-link-title\" name=\"title\"> \\\n                </div> \\\n                <div class=\"form-item form-item-target\"> \\\n                    <label class=\"checkbox\"> \\\n                        <input type=\"checkbox\" name=\"target\"> ## link-in-new-tab ## \\\n                    </label> \\\n                </div> \\\n            </form>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.inline = app.inline;\n        this.editor = app.editor;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    // messages\n    onmodal: {\n        link: {\n            open: function($modal, $form)\n            {\n                this._setFormData($form, $modal);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            update: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._update(data);\n                }\n            },\n            insert: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._insert(data);\n                }\n            },\n            unlink: function()\n            {\n                this._unlink();\n            }\n        }\n    },\n    onbutton: {\n        link: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        link: {\n            observe: function(dropdown)\n            {\n                this._observeUnlink(dropdown);\n                this._observeEdit(dropdown);\n            }\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        if (data.isLink())\n        {\n            var node = data.getLink();\n            var $el = $R.dom(node);\n\n            var $point = $R.dom('<a>');\n            var url = $el.attr('href');\n\n            $point.text(this._truncateText(url));\n            $point.attr('href', url);\n            $point.attr('target', '_blank');\n\n            var buttons = {\n                \"link\": {\n                    title: $point\n                },\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.link.open'\n                },\n                \"unlink\": {\n                    title: this.lang.get('unlink'),\n                    api: 'module.link.unlink'\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$link = this._buildCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    update: function(data)\n    {\n        this._update(data);\n    },\n    unlink: function()\n    {\n        this._unlink();\n    },\n\n    // private\n    _observeButton: function(button)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if (data.isPre() || data.isCode())\n        {\n            button.disable();\n        }\n        else\n        {\n            button.enable();\n        }\n    },\n    _observeUnlink: function(dropdown)\n    {\n        var $item = dropdown.getItem('unlink');\n        var links = this._getLinks();\n\n        if (links.length === 0) $item.disable();\n        else                    $item.enable();\n    },\n    _observeEdit: function(dropdown)\n    {\n        var current = this._getCurrent();\n        var $item = dropdown.getItem('link');\n\n        var data = this.inspector.parse(current);\n        var title = (data.isLink()) ? this.lang.get('link-edit') : this.lang.get('link-insert');\n\n        $item.setTitle(title);\n    },\n    _unlink: function()\n    {\n        this.app.api('module.modal.close');\n\n        var elms = [];\n        var nodes = this._getLinks();\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            elms.push(this.selection.getElement(nodes[i]));\n\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $link);\n        }\n        this.selection.restore();\n\n        // normalize\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = (elms[i]) ? elms[i] : this.editor.getElement();\n            this.utils.normalizeTextNodes(el);\n        }\n\n        this._resetCurrent();\n    },\n    _update: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var nodes = this._getLinks();\n        this._setLinkData(nodes, data, 'updated');\n        this._resetCurrent();\n    },\n    _insert: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var links = this._getLinks();\n        if (!this._insertSingle(links, data))\n        {\n            this._removeInSelection(links);\n            this._insertMultiple(data);\n        }\n\n        this._resetCurrent();\n    },\n    _removeInSelection: function(links)\n    {\n        this.selection.save();\n        for (var i = 0; i < links.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, links[i]);\n            var $clonedLink = $link.clone();\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $clonedLink);\n        }\n        this.selection.restore();\n    },\n    _insertMultiple: function(data)\n    {\n        var range = this.selection.getRange();\n        if (range && this._isCurrentTextChanged(data))\n        {\n            this._deleteContents(range);\n        }\n\n        var nodes = this.inline.format({ tag: 'a' });\n\n        this._setLinkData(nodes, data, 'inserted');\n    },\n    _insertSingle: function(links, data)\n    {\n        var inline = this.selection.getInline();\n        if (links.length === 1 && (links[0].textContext === this.selection.getText()) || (inline && inline.tagName === 'A'))\n        {\n            var $link = $R.create('link.component', this.app, links[0]);\n\n            $link.setData(data);\n            this.caret.setAfter($link);\n\n            // callback\n            this.app.broadcast('link.inserted', $link);\n\n            return true;\n        }\n\n        return false;\n    },\n    _setLinkData: function(nodes, data, type)\n    {\n        data.text = (data.text.trim() === '') ? this._truncateText(data.url) : data.text;\n\n        var isTextChanged = (!this.currentText || this.currentText !== data.text);\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            var linkData = {};\n\n            if (data.text && isTextChanged) linkData.text = data.text;\n            if (data.url) linkData.url = data.url;\n            if (data.title !== undefined) linkData.title = data.title;\n            if (data.target !== undefined) linkData.target = data.target;\n\n            $link.setData(linkData);\n\n            // callback\n            this.app.broadcast('link.' + type, $link);\n        }\n\n        setTimeout(this.selection.restore.bind(this.selection), 0);\n    },\n    _deleteContents: function(range)\n    {\n        var html = this.selection.getHtml();\n        var parsed = this.utils.parseHtml(html);\n        var first = parsed.nodes[0];\n\n        if (first && first.nodeType !== 3)\n        {\n            var tag = first.tagName.toLowerCase();\n            var container = document.createElement(tag);\n\n            this.insertion.insertNode(container, 'start');\n        }\n        else\n        {\n            range.deleteContents();\n        }\n    },\n    _getModalData: function()\n    {\n        var commands;\n        if (this._isLink())\n        {\n           commands = {\n                update: { title: this.lang.get('save') },\n                unlink: { title: this.lang.get('unlink'), type: 'danger' },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n        else\n        {\n            commands = {\n                insert: { title: this.lang.get('insert') },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n\n        var modalData = {\n            name: 'link',\n            title: (this._isLink()) ? this.lang.get('link-edit') : this.lang.get('link-insert'),\n            handle: (this._isLink()) ? 'update' : 'insert',\n            commands: commands\n        };\n\n\n        return modalData;\n    },\n    _isLink: function()\n    {\n        return this.currentLink;\n    },\n    _isCurrentTextChanged: function(data)\n    {\n        return (this.currentText && this.currentText !== data.text);\n    },\n    _buildCurrent: function()\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        var $link;\n\n        if (data.isLink())\n        {\n            this.currentLink = true;\n\n            $link = data.getLink();\n            $link = $R.create('link.component', this.app, $link);\n        }\n        else\n        {\n            this.currentLink = false;\n\n            $link = $R.create('link.component', this.app);\n            var linkData = {\n                text: this.selection.getText()\n            };\n\n            $link.setData(linkData);\n        }\n\n        return $link;\n    },\n    _getCurrent: function()\n    {\n        return this.selection.getInlinesAllSelected({ tags: ['a'] })[0];\n    },\n    _getLinks: function()\n    {\n        var links = this.selection.getInlines({ all: true, tags: ['a'] });\n        var arr = [];\n        for (var i = 0; i < links.length; i++)\n        {\n            var data = this.inspector.parse(links[i]);\n            if (data.isLink())\n            {\n                arr.push(links[i]);\n            }\n        }\n\n        return arr;\n    },\n    _resetCurrent: function()\n    {\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    _truncateText: function(url)\n    {\n        return (url && url.length > this.opts.linkSize) ? url.substring(0, this.opts.linkSize) + '...' : url;\n    },\n    _validateData: function($form, data)\n    {\n        return (data.url.trim() === '') ? $form.setError('url') : true;\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('url').focus();\n    },\n    _setFormData: function($form, $modal)\n    {\n        var linkData = this.$link.getData();\n        var data = {\n            url: linkData.url,\n            text: linkData.text,\n            title: linkData.title,\n            target: (this.opts.linkTarget || linkData.target)\n        };\n\n        if (!this.opts.linkNewTab) $modal.find('.form-item-target').hide();\n        if (!this.opts.linkTitle) $modal.find('.form-item-title').hide();\n\n        $form.setData(data);\n        this.currentText = $form.getField('text').val();\n    }\n});\n$R.add('class', 'link.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.reUrl = /^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el :  this._init(el);\n    },\n\n    // public\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['url', 'text', 'target', 'title'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            this.parse($el);\n        }\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _get_target: function()\n    {\n        return (this.attr('target')) ? this.attr('target') : false;\n    },\n    _get_url: function()\n    {\n        return this.attr('href');\n    },\n    _get_title: function()\n    {\n        return this.attr('title');\n    },\n    _get_text: function()\n    {\n        return this._getContext().text();\n    },\n    _getContext: function()\n    {\n        return this._findDeepestChild(this).element;\n    },\n    _set_target: function(target)\n    {\n        if (target === false) this.removeAttr('target');\n        else if (target)\n        {\n            this.attr('target', (target === true) ? '_blank' : target);\n        }\n    },\n    _set_text: function(text)\n    {\n        this._getContext().html(text);\n    },\n    _set_title: function(title)\n    {\n        if (!title || title === '') this.removeAttr('title');\n        else this.attr('title', title);\n    },\n    _set_url: function(url)\n    {\n        if (this.opts.linkValidation)\n        {\n            url = this._cleanUrl(url);\n\n            if (this._isMailto(url))\n            {\n                url = 'mailto:' + url.replace('mailto:', '');\n            }\n            else if (this._isUrl(url) && url.search(/^(ftp|https?)/i) === -1)\n            {\n                url = 'http://' + url.replace(/(ftp|https?):\\/\\//i, '');\n            }\n        }\n\n        this.attr('href', url);\n    },\n    _isMailto: function(url)\n    {\n        return (url.search('@') !== -1 && /(ftp|https?):\\/\\//i.test(url) === false);\n    },\n    _isUrl: function(url)\n    {\n        return this.reUrl.test(url);\n    },\n    _cleanUrl: function(url)\n    {\n        return url.trim().replace(/[^\\W\\w\\D\\d+&\\'@#/%?=~_|!:,.;\\(\\)]/gi, '');\n    },\n    _findDeepestChild: function(parent)\n    {\n        var result = {depth: 0, element: parent };\n\n        parent.children().each(function(node)\n        {\n            var child = $R.dom(node);\n\n            if (node.outerHTML !== parent.html())\n            {\n                return;\n            }\n            else\n            {\n                var childResult = this._findDeepestChild(child);\n                if (childResult.depth + 1 > result.depth)\n                {\n                    result = {\n                        depth: 1 + childResult.depth,\n                        element: childResult.element\n                    };\n                }\n            }\n        }.bind(this));\n\n        return result;\n    }\n});\n$R.add('module', 'modal', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.animate = app.animate;\n        this.detector = app.detector;\n        this.selection = app.selection;\n\n        // local\n        this.$box = false;\n        this.$modal = false;\n        this.selectionMarkers = false;\n\n        // defaults\n        this.defaults = {\n            name: false,\n            url: false,\n            title: false,\n            width: '600px',\n            height: false,\n            handle: false,\n            commands: false\n        };\n    },\n    // public\n    build: function(data)\n    {\n        this._open(data);\n    },\n    close: function()\n    {\n        this._close();\n    },\n    stop: function()\n    {\n        if (this.$box)\n        {\n            this.$box.remove();\n            this.$box = false;\n            this.$modal = false;\n\n            this.$doc.off('.redactor.modal');\n            this.$win.off('.redactor.modal');\n        }\n\n        if (this.$overlay)\n        {\n            this.$overlay.remove();\n        }\n    },\n    resize: function()\n    {\n        this.$modal.setWidth(this.p.width);\n        this.$modal.updatePosition();\n    },\n\n    // private\n    _isOpened: function()\n    {\n        return (this.$modal && this.$modal.hasClass('open'));\n    },\n    _open: function(data)\n    {\n        this._buildDefaults(data);\n\n        if (this.p.url) this._openUrl();\n        else this._openTemplate();\n    },\n    _openUrl: function()\n    {\n        $R.ajax.post({\n            url: this.p.url,\n            success: this._doOpen.bind(this)\n        });\n    },\n    _openTemplate: function()\n    {\n        if (typeof $R.modals[this.p.name] !== 'undefined')\n        {\n            var template = this.lang.parse($R.modals[this.p.name]);\n            this._doOpen(template);\n        }\n    },\n    _doOpen: function(template)\n    {\n        this.stop();\n\n        if (this.selection.isCollapsed())\n        {\n            this.selection.save();\n            this.selectionMarkers = false;\n        }\n        else\n        {\n            this.selection.saveMarkers();\n            this.selectionMarkers = true;\n        }\n\n        if (!this.detector.isDesktop())\n        {\n            document.activeElement.blur();\n        }\n\n        this._createModal(template);\n\n        this._buildModalBox();\n        this._buildOverlay();\n        this._buildModal();\n        this._buildModalForm();\n        this._buildModalCommands();\n\n        this._broadcast('open');\n\n        this.$modal.updatePosition();\n        this._buildModalTabs();\n\n        this.animate.start(this.$box, 'fadeIn', this._opened.bind(this));\n        this.animate.start(this.$overlay, 'fadeIn');\n\n    },\n    _opened: function()\n    {\n        this.$modal.addClass('open');\n        this.$box.on('mousedown.redactor.modal', this._close.bind(this));\n        this.$doc.on('keyup.redactor.modal', this._handleEscape.bind(this));\n        this.$win.on('resize.redactor.modal', this.resize.bind(this));\n        this.$modal.getBody().find('input[type=text],input[type=url],input[type=email]').on('keydown.redactor.modal', this._handleEnter.bind(this));\n\n        // fix bootstrap modal focus\n        if (window.jQuery) jQuery(document).off('focusin.modal');\n\n        this._broadcast('opened');\n    },\n    _close: function(e)\n    {\n        if (!this.$box || !this._isOpened()) return;\n\n        if (e)\n        {\n            if (!this._needToClose(e.target))\n            {\n                return;\n            }\n\n            e.stopPropagation();\n            e.preventDefault();\n        }\n\n        if (this.selectionMarkers) this.selection.restoreMarkers();\n        else this.selection.restore();\n\n        this.selectionMarkers = false;\n\n        this._broadcast('close');\n\n        this.animate.start(this.$box, 'fadeOut', this._closed.bind(this));\n        this.animate.start(this.$overlay, 'fadeOut');\n    },\n    _closed: function()\n    {\n        this.$modal.removeClass('open');\n        this.$box.off('.redactor.modal');\n        this.$doc.off('.redactor.modal');\n        this.$win.off('.redactor.modal');\n\n        this._broadcast('closed');\n    },\n    _createModal: function(template)\n    {\n        this.$modal = $R.create('modal.element', this.app, template);\n    },\n    _broadcast: function(message)\n    {\n        this.app.broadcast('modal.' + message, this.$modal, this.$modalForm);\n        this.app.broadcast('modal.' + this.p.name + '.' + message, this.$modal, this.$modalForm);\n    },\n    _buildDefaults: function(data)\n    {\n         this.p = $R.extend({}, this.defaults, data);\n    },\n    _buildModalBox: function()\n    {\n        this.$box = $R.dom('<div>');\n        this.$box.attr('id', 'redactor-modal');\n        this.$box.addClass('redactor-animate-hide');\n        this.$box.html('');\n        this.$body.append(this.$box);\n    },\n    _buildOverlay: function()\n    {\n        this.$overlay = $R.dom('#redactor-overlay');\n        if (this.$overlay.length === 0)\n        {\n            this.$overlay = $R.dom('<div>');\n            this.$overlay.attr('id', 'redactor-overlay');\n            this.$overlay.addClass('redactor-animate-hide');\n            this.$body.prepend(this.$overlay);\n        }\n    },\n    _buildModal: function()\n    {\n        this.$box.append(this.$modal);\n\n        this.$modal.setTitle(this.p.title);\n        this.$modal.setHeight(this.p.height);\n        this.$modal.setWidth(this.p.width);\n    },\n    _buildModalCommands: function()\n    {\n        if (this.p.commands)\n        {\n            var commands = this.p.commands;\n            var $footer = this.$modal.getFooter();\n            for (var key in commands)\n            {\n                var $btn = $R.dom('<button>');\n\n                $btn.html(commands[key].title);\n                $btn.attr('data-command', key);\n\n                // cancel\n                if (key === 'cancel')\n                {\n                    $btn.attr('data-action', 'close');\n                    $btn.addClass('redactor-button-unstyled');\n                }\n\n                // danger\n                if (typeof commands[key].type !== 'undefined' && commands[key].type === 'danger')\n                {\n                    $btn.addClass('redactor-button-danger');\n                }\n\n                $btn.on('click', this._handleCommand.bind(this));\n\n                $footer.append($btn);\n            }\n        }\n\n    },\n    _buildModalTabs: function()\n    {\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n        var $box = $body.find('.redactor-modal-tabs');\n\n        if ($tabs.length > 1)\n        {\n            $box = ($box.length === 0) ? $R.dom('<div>') : $box.html('');\n            $box.addClass('redactor-modal-tabs');\n\n            $tabs.each(function(node, i)\n            {\n                var $node = $R.dom(node);\n                var $item = $R.dom('<a>');\n                $item.attr('href', '#');\n                $item.attr('rel', i);\n                $item.text($node.attr('data-title'));\n                $item.on('click', this._showTab.bind(this));\n\n                if (i === 0)\n                {\n                    $item.addClass('active');\n                }\n\n                $box.append($item);\n\n            }.bind(this));\n\n            $body.prepend($box);\n        }\n    },\n    _buildModalForm: function()\n    {\n        this.$modalForm = $R.create('modal.form', this.app, this.$modal.getForm());\n    },\n    _showTab: function(e)\n    {\n        e.preventDefault();\n\n        var $el = $R.dom(e.target);\n        var index = $el.attr('rel');\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n\n        $tabs.hide();\n        $tabs.eq(index).show();\n\n        $body.find('.redactor-modal-tabs a').removeClass('active');\n        $el.addClass('active');\n\n    },\n    _needToClose: function(el)\n    {\n        var $target = $R.dom(el);\n        if ($target.attr('data-action') === 'close' || this.$modal.isCloseNode(el) || $target.closest('.redactor-modal').length === 0)\n        {\n            return true;\n        }\n\n        return false;\n    },\n    _handleCommand: function(e)\n    {\n        var $btn = $R.dom(e.target).closest('button');\n        var command = $btn.attr('data-command');\n\n        if (command !== 'cancel') e.preventDefault();\n\n        this._broadcast(command);\n\n    },\n    _handleEnter: function(e)\n    {\n        if (e.which === 13)\n        {\n            if (this.p.handle)\n            {\n                e.preventDefault();\n                this._broadcast(this.p.handle);\n            }\n        }\n    },\n    _handleEscape: function(e)\n    {\n        if (e.which === 27) this._close();\n    }\n});\n$R.add('class', 'modal.element', {\n    mixins: ['dom'],\n    init: function(app, template)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$win = app.$win;\n\n        // init\n        this._init(template);\n    },\n\n    // get\n    getForm: function()\n    {\n        return this.find('form');\n    },\n    getHeader: function()\n    {\n        return this.$modalHeader;\n    },\n    getBody: function()\n    {\n        return this.$modalBody;\n    },\n    getFooter: function()\n    {\n        return this.$modalFooter;\n    },\n\n    // set\n    setTitle: function(title)\n    {\n        if (title) this.$modalHeader.html(title);\n    },\n    setWidth: function(width)\n    {\n        width = (parseInt(width) >= this.$win.width()) ? '96%' : width;\n\n        this.css('max-width', width);\n    },\n    setHeight: function(height)\n    {\n        if (height !== false) this.$modalBody.css('height', height);\n    },\n\n    // update\n    updatePosition: function()\n    {\n        var width = this.width();\n        this.css({ 'left': '50%', 'margin-left': '-' + (width/2) + 'px' });\n\n        var windowHeight = this.$win.height();\n        var height = this.height();\n        var marginTop = (windowHeight/2 - height/2);\n\n        if (height < windowHeight && marginTop !== 0)\n        {\n            this.css('margin-top', marginTop + 'px');\n        }\n    },\n\n    // is\n    isCloseNode: function(el)\n    {\n        return (el === this.$modalClose.get());\n    },\n\n    // private\n    _init: function(template)\n    {\n        this._build();\n        this._buildClose();\n        this._buildHeader();\n        this._buildBody();\n        this._buildFooter();\n        this._buildTemplate(template);\n    },\n    _build: function()\n    {\n        this.parse('<div>');\n        this.addClass('redactor-modal');\n        this.attr('dir', this.opts.direction);\n    },\n    _buildClose: function()\n    {\n        this.$modalClose = $R.dom('<span>');\n        this.$modalClose.addClass('redactor-close');\n\n        this.append(this.$modalClose);\n    },\n    _buildHeader: function()\n    {\n        this.$modalHeader = $R.dom('<div>');\n        this.$modalHeader.addClass('redactor-modal-header');\n\n        this.append(this.$modalHeader);\n    },\n    _buildBody: function()\n    {\n        this.$modalBody = $R.dom('<div>');\n        this.$modalBody.addClass('redactor-modal-body');\n\n        this.append(this.$modalBody);\n    },\n    _buildFooter: function()\n    {\n        this.$modalFooter = $R.dom('<div>');\n        this.$modalFooter.addClass('redactor-modal-footer');\n\n        this.append(this.$modalFooter);\n    },\n    _buildTemplate: function(template)\n    {\n        this.$modalBody.html(template);\n    }\n});\n$R.add('class', 'modal.form', {\n    mixins: ['dom'],\n    init: function(app, element)\n    {\n        this.app = app;\n\n        // build\n        this.build(element);\n    },\n\n    // public\n    build: function(element)\n    {\n        this.parse(element);\n    },\n    getData: function()\n    {\n        var data = {};\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            data[$node.attr('name')] = $node.val();\n        });\n\n        return data;\n    },\n    setData: function(data)\n    {\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var name = $node.attr('name');\n            if (data.hasOwnProperty(name))\n            {\n                if (node.type && node.type === 'checkbox') node.checked = data[name];\n                else $node.val(data[name]);\n            }\n        });\n    },\n    getField: function(name)\n    {\n        return this.find('[name=' + name + ']');\n    },\n    setError: function(name)\n    {\n        var $el = this.getField(name);\n\n        $el.addClass('error');\n        $el.one(this._getFieldEventName($el.get()), this._clearError);\n\n        return false;\n    },\n\n    // private\n    _clearError: function()\n    {\n        return $R.dom(this).removeClass('error');\n    },\n    _getFieldEventName: function(el)\n    {\n        return (el.tagName === 'SELECT' || el.type === 'checkbox' || el.type === 'radio') ? 'change' : 'keyup';\n    }\n});\n$R.add('module', 'block', {\n    init: function(app)\n    {\n        this.app = app;\n        this.block = app.block;\n    },\n    // public\n    format: function(args)\n    {\n        var nodes = this.block.format(args);\n\n        // callback\n        this.app.broadcast('format', 'block', nodes);\n    },\n    clearformat: function()\n    {\n        this.block.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.block.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.block.clearClass();\n    },\n    clearattr: function()\n    {\n        this.block.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.block.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.block.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.block.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.block.remove(args, tags);\n    }\n});\n$R.add('module', 'inline', {\n    init: function(app)\n    {\n        this.app = app;\n        this.inline = app.inline;\n    },\n    format: function(args)\n    {\n        var nodes = this.inline.format(args);\n\n        // callback\n        this.app.broadcast('format', 'inline', nodes);\n    },\n    clearformat: function()\n    {\n        this.inline.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.inline.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.inline.clearClass();\n    },\n    clearattr: function()\n    {\n        this.inline.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.inline.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.inline.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.inline.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.inline.remove(args, tags);\n    }\n});\n$R.add('module', 'autosave', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.source = app.source;\n    },\n    // messages\n    onsynced: function()\n    {\n        if (this.opts.autosave)\n        {\n            this._send();\n        }\n    },\n\n    // private\n    _send: function()\n    {\n        var name = (this.opts.autosaveName) ? this.opts.autosaveName : this.source.getName();\n\n        var data = {};\n        data[name] = this.source.getCode();\n        data = this.utils.extendData(data, this.opts.autosaveData);\n\n        $R.ajax.post({\n            url: this.opts.autosave,\n            data: data,\n            success: function(response)\n            {\n                this._complete(response, name, data);\n            }.bind(this)\n        });\n    },\n    _complete: function(response, name, data)\n    {\n        var callback = (response && response.error) ? 'autosaveError' : 'autosave';\n        this.app.broadcast(callback, name, data, response);\n    }\n});\n$R.add('module', 'input', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.element = app.element;\n        this.selection = app.selection;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.lastShiftKey = false;\n    },\n    // messages\n    onpaste: function(e, dataTransfer)\n    {\n        if (!this.opts.input) return;\n\n        return $R.create('input.paste', this.app, e, dataTransfer);\n    },\n    onkeydown: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shortcuts\n        var shortcut = $R.create('input.shortcut', this.app, e);\n        if (shortcut.is()) return;\n\n        // select all\n        if ((e.ctrlKey || e.metaKey) && !e.altKey && key === 65)\n        {\n            e.preventDefault();\n            return this._selectAll();\n        }\n\n        // set empty if all selected\n        var keys = [this.keycodes.ENTER, this.keycodes.SPACE, this.keycodes.BACKSPACE, this.keycodes.DELETE];\n        var isKeys = (keys.indexOf(key) !== -1);\n        var isXKey = ((e.ctrlKey || e.metaKey) && key === 88); // x\n        var isAlphaKeys = ((!e.ctrlKey && !e.metaKey) && ((key >= 48 && key <= 57) || (key >= 65 && key <= 90)));\n\n        if (this.selection.isAll() && (isXKey || (!e.ctrlKey && !e.metaKey && !e.altKey && !e.shiftKey)))\n        {\n            if (isXKey)\n            {\n                this.editor.disableNonEditables();\n                this.app.broadcast('empty');\n                return;\n            }\n\n            if (this._isArrowKey(key)) return true;\n            if (isKeys) e.preventDefault();\n\n            if (this.element.isType('inline'))\n            {\n                var $editor = this.editor.getElement();\n                $editor.html('');\n\n                this.editor.startFocus();\n            }\n            else\n            {\n                this.insertion.set(this.opts.emptyHtml);\n            }\n\n            if (isKeys) return;\n            else this.app.broadcast('empty');\n        }\n\n        // autoparse\n        if (this.opts.autoparse)\n        {\n            this.autoparser.format(e, key);\n        }\n\n        // a-z, 0-9 - non editable\n        if (isAlphaKeys)\n        {\n            // has non-editable\n            if (this.selection.hasNonEditable())\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // enter, shift/ctrl + enter\n        if (key === this.keycodes.ENTER)\n        {\n            return $R.create('input.enter', this.app, e, key);\n        }\n        // cmd + [\n        else if (e.metaKey && key === 219)\n        {\n            e.preventDefault();\n            this.app.api('module.list.outdent');\n            return;\n        }\n        // tab or cmd + ]\n        else if (key === this.keycodes.TAB || e.metaKey && key === 221)\n        {\n            return $R.create('input.tab', this.app, e, key);\n        }\n        // space\n        else if (key === this.keycodes.SPACE)\n        {\n            return $R.create('input.space', this.app, e, key, this.lastShiftKey);\n        }\n        // backspace or delete\n        else if (this._isDeleteKey(key))\n        {\n            return $R.create('input.delete', this.app, e, key);\n        }\n        else if (this._isArrowKey(key))\n        {\n            return $R.create('input.arrow', this.app, e, key);\n        }\n    },\n    onkeyup: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shift key\n        this.lastShiftKey = e.shiftKey;\n\n        // hide context toolbar\n        this.app.broadcast('contextbar.close');\n\n        // shortcode\n        var shortcode = $R.create('input.shortcode', this.app, e, key);\n        if (shortcode.is()) return;\n\n        // is empty\n        if (key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n            html = html.replace(/<br\\s?\\/?>/g, '');\n            html = html.replace(/<div><\\/div>/, '');\n\n            if (html === '')\n            {\n                e.preventDefault();\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                return;\n            }\n        }\n\n        if (this.editor.isEmpty())\n        {\n            this.app.broadcast('empty');\n        }\n    },\n\n    // public\n    start: function()\n    {\n        // extend shortcuts\n        if (this.opts.shortcutsAdd)\n        {\n            this.opts.shortcuts = $R.extend({}, true, this.opts.shortcuts, this.opts.shortcutsAdd);\n        }\n    },\n\n    // private\n    _selectAll: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var el;\n\n        if (data.isComponentType('table'))\n        {\n            el = data.getTable();\n            this.selection.setAll(el);\n            return;\n        }\n        else if (data.isComponentType('code'))\n        {\n            el = data.getComponentCodeElement();\n            this.selection.setAll(el);\n            return;\n        }\n\n        this.selection.setAll();\n    },\n    _isArrowKey: function(key)\n    {\n        return ([this.keycodes.UP, this.keycodes.DOWN, this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(key) !== -1);\n    },\n    _isDeleteKey: function(key)\n    {\n        return (key === this.keycodes.BACKSPACE || key === this.keycodes.DELETE);\n    }\n});\n$R.add('class', 'input.arrow', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.offset = app.offset;\n        this.marker = app.marker;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._isRightLeftKey() && this._isExitVariable(e)) return;\n\n        if (this._isRightDownKey())\n        {\n            if (this._isExitOnDownRight(e)) return;\n            if (this._selectComponent(e, 'End', 'next')) return;\n        }\n\n        if (this._isLeftUpKey())\n        {\n            if (this._isExitOnUpLeft(e)) return;\n            if (this._selectComponent(e, 'Start', 'prev')) return;\n        }\n\n        if (this.key === this.keycodes.LEFT) this.utils.trimInvisibleChars('left');\n        else if (this.key === this.keycodes.RIGHT) this.utils.trimInvisibleChars('right');\n\n    },\n    _isRightDownKey: function()\n    {\n        return ([this.keycodes.DOWN, this.keycodes.RIGHT].indexOf(this.key) !== -1);\n    },\n    _isLeftUpKey: function()\n    {\n        return ([this.keycodes.UP, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isRightLeftKey: function()\n    {\n        return ([this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isExitVariable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponentType('variable') && data.isComponentActive())\n        {\n            e.preventDefault();\n            var func = (this.key === this.keycodes.LEFT) ? 'setBefore' : 'setAfter';\n            this.caret[func](component);\n            return;\n        }\n    },\n    _isExitOnUpLeft: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(current);\n        var prev = block.previousElementSibling;\n        var isStart = this.caret.isStart(block);\n\n        // prev table\n        if (isStart && prev && prev.tagName === 'TABLE')\n        {\n            e.preventDefault();\n            this.caret.setEnd(prev);\n            return true;\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            var $component = $R.dom(block).closest('.redactor-component');\n            if (isStart && $component.length !== 0)\n            {\n                e.preventDefault();\n                this.caret.setEnd($component);\n                return true;\n            }\n        }\n        // exit table\n        else if (data.isTable() && isStart)\n        {\n            e.preventDefault();\n            this.caret.setEnd(block.previousElementSibling);\n            return true;\n        }\n        // component\n        else if (!data.isComponentEditable() && data.isComponent() && !data.isComponentType('variable'))\n        {\n            var component = data.getComponent();\n            if (component.previousElementSibling)\n            {\n                e.preventDefault();\n                this.component.clearActive();\n                this.caret.setEnd(component.previousElementSibling);\n                return true;\n            }\n        }\n    },\n    _isExitOnDownRight: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isEndEditor = this.caret.isEnd();\n        var block, isEnd;\n\n        // table\n        if (data.isTable())\n        {\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            var component = data.getComponent();\n            var pre = $R.dom(data.getComponentCodeElement()).closest('pre');\n\n            isEnd = this.caret.isEnd(block);\n\n            var isNext = (pre && pre.get().nextElementSibling);\n            if (isEnd && !isNext)\n            {\n                return this._exitNextElement(e, component);\n            }\n        }\n        // pre & blockquote & dl\n        else if (data.isPre() || data.isBlockquote() || data.isDl())\n        {\n            if (isEndEditor)\n            {\n                if (data.isPre()) return this._exitNextElement(e, data.getPre());\n                else if (data.isBlockquote()) return this._exitNextElement(e, data.getBlockquote());\n                else if (data.isDl()) return this._exitNextElement(e, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var $list = $R.dom(current).parents('ul, ol', $editor).last();\n            isEnd = this.caret.isEnd($list);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, $list.get());\n            }\n        }\n        // component\n        else if (data.isComponent() && !data.isComponentType('variable') && data.getTag() !== 'span')\n        {\n            this.component.clearActive();\n            return this._exitNextElement(e, data.getComponent());\n        }\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextElementSibling) this.caret.setStart(node.nextElementSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _selectComponent: function(e, caret, type)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var sibling = this.utils.findSiblings(current, type);\n        var siblingBlock = this.utils.findSiblings(block, type);\n\n        if (sibling && this.caret['is' + caret](current))\n        {\n            this._selectComponentItem(e, sibling, caret);\n        }\n        else if (siblingBlock && this.caret['is' + caret](block))\n        {\n            this._selectComponentItem(e, siblingBlock, caret);\n        }\n    },\n    _selectComponentItem: function(e, item, caret)\n    {\n        if (this.component.isNonEditable(item))\n        {\n            e.preventDefault();\n            this.caret['set' + caret](item);\n            return true;\n        }\n    }\n});\n$R.add('class', 'input.delete', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._removeActiveComponent(e)) return;\n        if (this._removeAllSelectedTable(e)) return;\n\n        // is empty\n        if (this.key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n\n            if (html === this.opts.emptyHtml)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // variable or non editable prev/next or selection\n        if (this._detectVariableOrNonEditable() || this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // collapsed\n        if (this.selection.isCollapsed())\n        {\n            // next / prev\n            if (this.key === this.keycodes.BACKSPACE) this._traverseBackspace(e);\n            else if (this.key === this.keycodes.DELETE) this._traverseDelete(e);\n        }\n\n        if (this.key === this.keycodes.BACKSPACE) this.utils.trimInvisibleChars('left');\n\n        this._removeUnwantedStyles();\n        this._removeEmptySpans();\n        this._removeSpanTagsInHeadings();\n        this._removeInlineTagsInPre();\n    },\n    _detectVariableOrNonEditable: function()\n    {\n        var block = this.selection.getBlock();\n        var isBlockStart = this.caret.isStart(block);\n        var isBlockEnd = this.caret.isEnd(block);\n        var el;\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isBlockStart)\n        {\n            el = block.previousSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isBlockEnd)\n        {\n            el = block.nextSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n\n        var current = this.selection.getCurrent();\n        var isCurrentStart = this.caret.isStart(current);\n        var isCurrentEnd = this.caret.isEnd(current);\n        var isCurrentStartSpace = (this.selection.getTextBeforeCaret().trim() === '');\n        var isCurrentEndSpace = (this.selection.getTextAfterCaret().trim() === '');\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isCurrentStart && !isCurrentStartSpace)\n        {\n            el = current.previousSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setEnd(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isCurrentEnd && !isCurrentEndSpace)\n        {\n            el = current.nextSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setStart(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n    },\n    _isVariable: function(node)\n    {\n        return ($R.dom(node).closest('[data-redactor-type=\"variable\"]').length !== 0);\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    },\n    _getBlock: function()\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n\n        block = (data.isList()) ? $R.dom(block).parents('ul, ol', $editor).last().get() : block;\n        block = (data.isDl()) ? data.getDl() : block;\n        block = (data.isTable()) ? data.getTable() : block;\n\n        return block;\n    },\n    _traverseDelete: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isEnd, $next;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // next\n        block = this._getBlock();\n        var next = this.utils.findSiblings(block, 'next');\n        if (!next) return;\n\n        isEnd = this.caret.isEnd(block);\n        var dataNext = this.inspector.parse(next);\n        var isNextBlock = (next.tagName === 'P' || next.tagName === 'DIV');\n\n        // figure/code or table\n        if (isEnd && dataNext.isComponentEditable())\n        {\n            e.preventDefault();\n            this.component.remove(next, false);\n            return;\n        }\n        // component\n        else if (isEnd && dataNext.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(next);\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // combine list\n        else if (isEnd && dataNext.isList())\n        {\n            var $currentList = $R.dom(block);\n            $next = $R.dom(next);\n\n            // current list\n            if (data.isList())\n            {\n                e.preventDefault();\n\n                $currentList.append($next);\n                $next.unwrap();\n\n                return;\n            }\n            else\n            {\n                var $first = $next.children('li').first();\n                var $lists = $first.find('ul, ol');\n\n                if ($lists.length !== 0)\n                {\n                    e.preventDefault();\n\n                    $next.prepend($lists);\n                    $lists.unwrap();\n\n                    $currentList.append($first);\n                    $first.unwrap();\n\n                    return;\n                }\n            }\n        }\n        // block\n        else if (isEnd && !data.isList() && !data.isTable() && isNextBlock && !this.utils.isEmptyHtml(block.innerHTML))\n        {\n            e.preventDefault();\n\n            var $current = $R.dom(block);\n            $next = $R.dom(next);\n\n            $current.append($next);\n            $next.unwrap();\n\n            return;\n        }\n    },\n    _traverseBackspace: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isStart, $prev, $currentList;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            if (isStart)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isStart = this.caret.isStart(block);\n\n            if (isStart && block.previousElementSibling)\n            {\n                e.preventDefault();\n                this.caret.setEnd(block.previousElementSibling);\n                return true;\n            }\n        }\n\n        // prev\n        block = this._getBlock();\n        var prev = this.utils.findSiblings(block, 'prev');\n\n        if (!prev)\n        {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n\n        isStart = this.caret.isStart(block);\n        var dataPrev = this.inspector.parse(prev);\n        var isPrevBlock = (prev.tagName === 'P' || prev.tagName === 'DIV');\n\n        // figure/code or table\n        if (isStart && dataPrev.isComponentEditable())\n        {\n            e.preventDefault();\n            this.component.remove(prev, false);\n            return;\n        }\n        // component\n        else if (isStart && dataPrev.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(prev);\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // lists\n        else if (isStart && data.isList())\n        {\n            e.preventDefault();\n\n            $currentList = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            if (dataPrev.isList())\n            {\n                $currentList.children('li').first().prepend(this.marker.build('start'));\n                $prev.append($currentList);\n                $currentList.unwrap();\n\n                this.selection.restoreMarkers();\n            }\n            else\n            {\n                var $first = $currentList.children('li').first();\n                var first = $first.get();\n                var $lists = $first.find('ul, ol');\n\n                var $newnode = this.utils.replaceToTag(first, this.opts.markup);\n                if (this.opts.breakline) $newnode.attr('data-redactor-tag', 'br');\n                $currentList.before($newnode);\n                this.caret.setStart($newnode);\n\n                if ($lists.length !== 0)\n                {\n                    $currentList.prepend($lists);\n                    $lists.unwrap();\n                }\n            }\n\n            return;\n        }\n        // block\n        else if (isStart && isPrevBlock)\n        {\n            e.preventDefault();\n\n            var textNode = this.utils.createInvisibleChar();\n            var $current = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            this.caret.setEnd($prev);\n\n            $current.prepend(textNode);\n            $prev.append($current.contents());\n            $current.remove();\n\n            return;\n        }\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            $block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _removeActiveComponent: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponent() && this.component.isActive(component))\n        {\n            e.preventDefault();\n            this.component.remove(component);\n            return true;\n        }\n    },\n    _removeAllSelectedTable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var table = data.getTable();\n        if (table && this.selection.isAll(table))\n        {\n            e.preventDefault();\n            this.component.remove(table);\n            return true;\n        }\n    },\n    _removeUnwantedStyles: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            var $tags = $editor.find('*[style]');\n            $tags.not('img, figure, iframe, [data-redactor-style-cache], [data-redactor-span]').removeAttr('style');\n\n        }, 0);\n    },\n    _removeEmptySpans: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('span').each(function(node)\n            {\n                if (node.attributes.length === 0)\n                {\n                    $R.dom(node).replaceWith(node.childNodes);\n                }\n            });\n\n        }, 0);\n    },\n    _removeSpanTagsInHeadings: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('h1, h2, h3, h4, h5, h6').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker, [data-redactor-style-cache], [data-redactor-span]').unwrap();\n                }\n            });\n\n        }, 1);\n    },\n    _removeInlineTagsInPre: function()\n    {\n        var $editor = this.editor.getElement();\n        var tags = this.opts.inlineTags;\n\n        setTimeout(function()\n        {\n            $editor.find('pre').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find(tags.join(',')).not('code, .redactor-selection-marker').unwrap();\n                }\n            });\n\n        }, 1);\n    }\n});\n$R.add('class', 'input.enter', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.editor = app.editor;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.inspector = app.inspector;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off\n        if (!this.opts.enterKey) return this._disable(e);\n\n        // callback\n        var stop = this.app.broadcast('enter', e);\n        if (stop === false) return e.preventDefault();\n\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift enter\n        if (e.ctrlKey || e.shiftKey) return this._insertBreak(e);\n\n        // enter & exit\n        if (this._isExit(e)) return;\n\n        // traverse\n        this._traverse(e);\n    },\n    _disable: function(e)\n    {\n        e.preventDefault();\n        var range = this.selection.getRange();\n        if (range && !range.collapsed) range.deleteContents();\n    },\n    _insertBreak: function(e)\n    {\n        e.preventDefault();\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if ((data.isComponent() && !data.isComponentEditable()) || data.isCode()) return;\n        else if (data.isPre()) this.insertion.insertNewline();\n        else this.insertion.insertBreakLine();\n    },\n    _isExit: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n        var isEnd = this.caret.isEnd(block);\n        var current = this.selection.getCurrent();\n        var prev = current.previousSibling;\n\n        // blockquote\n        if (data.isBlockquote())\n        {\n            var isParagraphExit = (isEnd && this._isExitableBlock(block, 'P'));\n            var isBreaklineExit = (isEnd && this._isExitableDblBreak(prev));\n\n            if (isParagraphExit || isBreaklineExit)\n            {\n                return this._exitFromElement(e, ((isBreaklineExit) ? prev : block), data.getBlockquote());\n            }\n        }\n        // pre\n        else if (!data.isComponentType('code') && data.isPre())\n        {\n            if (isEnd)\n            {\n                var html = block.innerHTML;\n                html = this.utils.removeInvisibleChars(html);\n                if (html.match(/(\\n\\n\\n)$/) !== null)\n                {\n                    $R.dom(prev.previousSibling.previousSibling).remove();\n                    return this._exitFromElement(e, prev, block);\n                }\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            if (isEnd && this._isExitableBlock(block, 'DT'))\n            {\n                return this._exitFromElement(e, block, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var list = $R.dom(current).parents('ul, ol', $editor).last();\n\n            isEnd = this.caret.isEnd(list);\n            if (isEnd && this._isExitableBlock(block, 'LI'))\n            {\n                return this._exitFromElement(e, block, list);\n            }\n        }\n        else if (data.isComponent() && data.isComponentActive() && !data.isFigcaption() && !data.isComponentEditable())\n        {\n            return this._exitFromElement(e, false, data.getComponent());\n        }\n    },\n    _isExitableDblBreak: function(prev)\n    {\n        var next = (prev) ? prev.nextSibling : false;\n        if (next)\n        {\n            var text = this.utils.removeInvisibleChars(next.textContent);\n\n            return (next.nodeType === 3 && text.trim() === '');\n        }\n    },\n    _isExitableBlock: function(block, tag)\n    {\n        return (block && block.tagName === tag && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _exitFromElement: function(e, prev, el)\n    {\n        e.preventDefault();\n        if (prev) $R.dom(prev).remove();\n        this.utils.createMarkup(el);\n\n        return true;\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextSibling) this.caret.setStart(node.nextSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var isText = this.selection.isText();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(current);\n        var blockTag = (block) ? block.tagName.toLowerCase() : false;\n\n        // pre\n        if (data.isPre())\n        {\n            e.preventDefault();\n            return this.insertion.insertNewline();\n        }\n        // blockquote\n        else if (data.isBlockquote())\n        {\n            block = this.selection.getBlock(current);\n            if (block && block.tagName === 'BLOCKQUOTE')\n            {\n                e.preventDefault();\n                return this.insertion.insertBreakLine();\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            var isEnd = this.caret.isEnd(block);\n            var isEndEditor = this.caret.isEnd();\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n            else\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            e.preventDefault();\n            return this._traverseDl(current);\n        }\n        // text\n        else if (isText || (this.opts.breakline && blockTag === 'div'))\n        {\n            e.preventDefault();\n            return this.insertion.insertBreakLine();\n        }\n        // div / p\n        else\n        {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n    },\n    _traverseDl: function(current)\n    {\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(block);\n        var tag = data.getTag();\n        var $el = $R.dom(block);\n        var next = $el.get().nextSibling || false;\n        var $next = $R.dom(next);\n        var nextDd = (next && $next.is('dd'));\n        var nextDt = (next && $next.is('dt'));\n        var isEnd = this.caret.isEnd(block);\n\n        if (tag === 'dt' && !nextDd && isEnd)\n        {\n            var dd = document.createElement('dd');\n            $el.after(dd);\n\n            this.caret.setStart(dd);\n            return;\n        }\n        else if (tag === 'dd' && !nextDt && isEnd)\n        {\n            var dt = document.createElement('dt');\n            $el.after(dt);\n\n            this.caret.setStart(dt);\n            return;\n        }\n\n        return this.insertion.insertBreakLine();\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n        else\n        {\n            if (block)\n            {\n                if (this.utils.isEmptyHtml(block.innerHTML))\n                {\n                    this._clearBlock($block, block);\n                }\n                else\n                {\n                    var first = this.utils.getFirstNode(block);\n                    if (first && first.tagName === 'BR')\n                    {\n                        $R.dom(first).remove();\n                        this.caret.setStart(block);\n                    }\n                }\n            }\n        }\n\n        if (block && this._isNeedToCleanBlockStyle(block) && this.opts.cleanOnEnter)\n        {\n            $block.removeAttr('class style');\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            $block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _clearBlock: function($block, block)\n    {\n        if (this.opts.cleanInlineOnEnter || block.innerHTML === '<br>')\n        {\n            $block.html('');\n        }\n\n        this.caret.setStart(block);\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _isNeedToCleanBlockStyle: function(block)\n    {\n        return (block.tagName === 'P' && this.utils.isEmptyHtml(block.innerHTML));\n    }\n});\n$R.add('class', 'input.paste', {\n    init: function(app, e, dataTransfer, html, point)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.pasteHtml = html;\n        this.pointInserted = point;\n        this.dataTransfer = dataTransfer;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        var clipboard = this.dataTransfer || e.clipboardData;\n        var current = this.selection.getCurrent();\n        var dataCurrent = this.inspector.parse(current);\n\n        this.dropPasted = this.dataTransfer;\n        this.isRawCode = (dataCurrent.isPre() || dataCurrent.isCode());\n\n        this.editor.enablePasting();\n        this.editor.saveScroll();\n\n        if (!this.dropPasted)\n        {\n            this.selection.saveMarkers();\n        }\n\n        if (this.isRawCode || !clipboard)\n        {\n            var text;\n            if (!this.isRawCode && !clipboard && window.clipboardData)\n            {\n                text = window.clipboardData.getData(\"text\");\n            }\n            else\n            {\n                text = clipboard.getData(\"text/plain\");\n            }\n\n            e.preventDefault();\n            this._insert(e, text);\n            return;\n        }\n        else if (this.pasteHtml)\n        {\n            e.preventDefault();\n            this._insert(e, this.pasteHtml);\n        }\n        else\n        {\n            // html / text\n            var url = clipboard.getData('URL');\n            var html = (this._isPlainText(clipboard)) ? clipboard.getData(\"text/plain\") : clipboard.getData(\"text/html\");\n\n            // safari anchor links\n            html = (!url || url === '') ? html : url;\n\n            // file\n            if (clipboard.files.length > 0 && html === '')\n            {\n                var files = [];\n                for (var i = 0; i < clipboard.files.length; i++)\n                {\n                    var file = clipboard.files[i] || clipboard.items[i].getAsFile();\n                    if (file) files.push(file);\n                }\n\n                if (files.length > 0)\n                {\n                    e.preventDefault();\n                    this._insertFiles(e, files);\n                    return;\n                }\n            }\n\n\n            e.preventDefault();\n            this._insert(e, html);\n        }\n    },\n    _isPlainText: function(clipboard)\n    {\n        var text = clipboard.getData(\"text/plain\");\n        var html = clipboard.getData(\"text/html\");\n\n        if (text && html)\n        {\n            var element = document.createElement(\"div\");\n            element.innerHTML = html;\n\n            if (element.textContent === text)\n            {\n                return !element.querySelector(\":not(meta)\");\n            }\n        }\n        else\n        {\n            return (text !== null);\n        }\n    },\n    _restoreSelection: function()\n    {\n        this.editor.restoreScroll();\n        this.editor.disablePasting();\n        if (!this.dropPasted)\n        {\n            this.selection.restoreMarkers();\n        }\n    },\n    _insert: function(e, html)\n    {\n        // pasteBefore callback\n        var returned = this.app.broadcast('pasteBefore', html);\n        html = (returned === undefined) ? html : returned;\n\n        // clean\n        html = (this.isRawCode) ? html : this.cleaner.paste(html);\n        html = (this.isRawCode) ? this.cleaner.encodePhpCode(html) : html;\n\n        // paste callback\n        returned = this.app.broadcast('pasting', html);\n        html = (returned === undefined) ? html : returned;\n\n        this._restoreSelection();\n\n        // stop input\n        if (!this.opts.input) return;\n\n        // autoparse\n        if (this.opts.autoparse && this.opts.autoparsePaste)\n        {\n            html = this.autoparser.parse(html);\n        }\n\n        var nodes = (this.dropPasted) ? this.insertion.insertToPoint(e, html, this.pointInserted) : this.insertion.insertHtml(html);\n\n        // pasted callback\n        this.app.broadcast('pasted', nodes);\n        this.app.broadcast('autoparseobserve');\n    },\n    _insertFiles: function(e, files)\n    {\n        this._restoreSelection();\n\n        // drop or clipboard\n        var isImage = (this.opts.imageTypes.indexOf(files[0].type) !== -1);\n        var isClipboard = (typeof this.dropPasted === 'undefined');\n\n        if (isImage) this.app.broadcast('dropimage', e, files, isClipboard);\n        else this.app.broadcast('dropfile', e, files, isClipboard);\n    }\n});\n$R.add('class', 'input.shortcode', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.worked = false;\n\n        // init\n        if (key === this.keycodes.SPACE) this._init();\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function()\n    {\n        var current = this.selection.getCurrent();\n        if (current && current.nodeType === 3)\n        {\n            var text = this.utils.removeInvisibleChars(current.textContent);\n            var shortcodes = this.opts.shortcodes;\n            for (var name in shortcodes)\n            {\n                var re = new RegExp('^' + this.utils.escapeRegExp(name));\n                var match = text.match(re);\n                if (match !== null)\n                {\n                    if (typeof shortcodes[name].format !== 'undefined')\n                    {\n                        return this._format(shortcodes[name].format, current, re);\n                    }\n                }\n            }\n        }\n    },\n    _format: function(tag, current, re)\n    {\n        var marker = this.marker.insert('start');\n        current = marker.previousSibling;\n\n        var text = current.textContent;\n        text = this.utils.trimSpaces(text);\n        text = text.replace(re, '');\n        current.textContent = text;\n\n        var api = (tag === 'ul' || tag === 'ol') ? 'module.list.toggle' : 'module.block.format';\n\n        this.app.api(api, tag);\n        this.selection.restoreMarkers();\n\n        this.worked = true;\n    }\n});\n$R.add('class', 'input.shortcut', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.worked = false;\n\n        // based on https://github.com/jeresig/jquery.hotkeys\n        this.hotkeys = {\n            8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n            20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n            37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n            96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n            104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n            112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n            120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n            188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n        };\n\n        this.hotkeysShiftNums = {\n            \"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n            \"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n            \".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n        };\n\n        // init\n        this._init(e);\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function(e)\n    {\n        // disable browser's hot keys for bold and italic if shortcuts off\n        if (this.opts.shortcuts === false)\n        {\n            if ((e.ctrlKey || e.metaKey) && (e.which === 66 || e.which === 73)) e.preventDefault();\n            return;\n        }\n\n        // build\n        for (var key in this.opts.shortcuts)\n        {\n            this._build(e, key, this.opts.shortcuts[key]);\n        }\n    },\n    _build: function(e, str, command)\n    {\n        var keys = str.split(',');\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (typeof keys[i] === 'string')\n            {\n                this._handler(e, keys[i].trim(), command);\n            }\n        }\n    },\n    _handler: function(e, keys, command)\n    {\n        keys = keys.toLowerCase().split(\" \");\n\n        var special = this.hotkeys[e.keyCode];\n        var character = String.fromCharCode(e.which).toLowerCase();\n        var modif = \"\", possible = {};\n        var cmdKeys = [\"alt\", \"ctrl\", \"meta\", \"shift\"];\n\n        for (var i = 0; i < cmdKeys.length; i++)\n        {\n            var specialKey = cmdKeys[i];\n            if (e[specialKey + 'Key'] && special !== specialKey)\n            {\n                modif += specialKey + '+';\n            }\n        }\n\n        if (special) possible[modif + special] = true;\n        if (character)\n        {\n            possible[modif + character] = true;\n            possible[modif + this.hotkeysShiftNums[character]] = true;\n\n            // \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n            if (modif === \"shift+\")\n            {\n                possible[this.hotkeysShiftNums[character]] = true;\n            }\n        }\n\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (possible[keys[i]])\n            {\n                e.preventDefault();\n                this.worked = true;\n\n                if (command.message)\n                {\n                    this.app.broadcast(command.message, command.args);\n                }\n                else if (command.api)\n                {\n                    this.app.api(command.api, command.args);\n                }\n\n                return;\n            }\n        }\n    }\n});\n$R.add('class', 'input.space', {\n    init: function(app, e, key, lastShiftKey)\n    {\n        this.app = app;\n        this.keycodes = app.keycodes;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n        this.lastShiftKey = lastShiftKey;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift/ctrl + space\n        if (!this.lastShiftKey && this.key === this.keycodes.SPACE && (e.ctrlKey || e.shiftKey) && !e.metaKey)\n        {\n            e.preventDefault();\n            this.insertion.insertChar('&nbsp;');\n            return;\n        }\n    }\n});\n$R.add('class', 'input.tab', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off tab\n        if (!this.opts.tabKey) return;\n\n        // callback\n        var stop = this.app.broadcast('tab', e);\n        if (stop === false) return e.preventDefault();\n\n        // traverse\n        this._traverse(e);\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        // hard tab\n        if (!data.isComponent() && e.shiftKey)\n        {\n            return this._insertHardTab(e, 4);\n        }\n\n        // list\n        if (data.isList())\n        {\n            e.preventDefault();\n            return this.app.api('module.list.indent');\n        }\n        // pre\n        if (data.isPre() || (data.isComponentType('code') && !data.isFigcaption()))\n        {\n            return this._tabCode(e);\n        }\n\n        // tab as spaces\n        if (this.opts.tabAsSpaces !== false)\n        {\n            return this._insertHardTab(e, this.opts.tabAsSpaces);\n        }\n    },\n    _insertHardTab: function(e, num)\n    {\n        e.preventDefault();\n        var node = document.createTextNode(Array(num + 1).join('\\u00a0'));\n        return this.insertion.insertNode(node, 'end');\n    },\n    _tabCode: function(e)\n    {\n        e.preventDefault();\n\n        var node = (this.opts.preSpaces) ? document.createTextNode(Array(this.opts.preSpaces + 1).join('\\u00a0')) : document.createTextNode('\\t');\n\n        return this.insertion.insertNode(node, 'end');\n    }\n});\n$R.add('module', 'upload', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.progress = app.progress;\n\n        // local\n        this.defaults = {\n            event: false,\n            element: false,\n            name: false,\n            files: false,\n            url: false,\n            data: false,\n            paramName: false\n        };\n    },\n    // public\n    build: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$el = $R.dom(this.p.element);\n\n        if (this.$el.get().tagName === 'INPUT') this._buildInput();\n        else                                    this._buildBox();\n    },\n    send: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$uploadbox = this.editor.getElement();\n        this._send(this.p.event, this.p.files);\n    },\n    complete: function(response, e)\n    {\n        this._complete(response, e);\n    },\n\n    // private\n    _buildInput: function()\n    {\n        this.box = false;\n        this.prefix = '';\n\n        this.$uploadbox = $R.dom('<div class=\"upload-box\" />');\n\n        this.$el.hide();\n        this.$el.after(this.$uploadbox);\n\n        if (this.opts.multipleUpload) this.$el.attr('multiple', 'multiple');\n        else this.$el.removeAttr('multiple');\n\n        this._buildPlaceholder();\n        this._buildEvents();\n    },\n    _buildBox: function()\n    {\n        this.box = true;\n        this.prefix = 'box-';\n\n        this.$uploadbox = this.$el;\n        this.$uploadbox.attr('ondragstart', 'return false;');\n\n        // events\n        this.$uploadbox.on('drop.redactor.upload', this._onDropBox.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _buildPlaceholder: function()\n    {\n        this.$placeholder = $R.dom('<div class=\"upload-placeholder\" />');\n        this.$placeholder.html(this.lang.get('upload-label'));\n        this.$uploadbox.append(this.$placeholder);\n    },\n    _buildEvents: function()\n    {\n        this.$el.on('change.redactor.upload', this._onChange.bind(this));\n        this.$uploadbox.on('click.redactor.upload', this._onClick.bind(this));\n        this.$uploadbox.on('drop.redactor.upload', this._onDrop.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _onClick: function(e)\n    {\n        e.preventDefault();\n        this.$el.click();\n    },\n    _onChange: function(e)\n    {\n        this._send(e, this.$el.get().files);\n    },\n    _onDrop: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n        this._send(e);\n    },\n    _onDragOver: function(e)\n    {\n        e.preventDefault();\n        this._setStatusHover();\n\n        return false;\n    },\n    _onDragLeave: function(e)\n    {\n        e.preventDefault();\n        this._removeStatusHover();\n\n        return false;\n    },\n    _onDropBox: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n        this._send(e);\n    },\n    _removeStatusHover: function()\n    {\n        this.$uploadbox.removeClass('upload-' + this.prefix + 'hover');\n    },\n    _setStatusDrop: function()\n    {\n        this.$uploadbox.addClass('upload-' + this.prefix + 'drop');\n    },\n    _setStatusHover: function()\n    {\n        this.$uploadbox.addClass('upload-' + this.prefix + 'hover');\n    },\n    _setStatusError: function()\n    {\n        this.$uploadbox.addClass('upload-' + this.prefix + 'error');\n    },\n    _setStatusSuccess: function()\n    {\n        this.$uploadbox.addClass('upload-' + this.prefix + 'success');\n    },\n    _clear: function()\n    {\n        var classes = ['drop', 'hover', 'error', 'success'];\n        for (var i = 0; i < classes.length; i++)\n        {\n            this.$uploadbox.removeClass('upload-' + this.prefix + classes[i]);\n        }\n\n        this.$uploadbox.removeAttr('ondragstart');\n    },\n    _send: function(e, files)\n    {\n        e = e.originalEvent || e;\n\n        files = (files) ? files : e.dataTransfer.files;\n\n        var data = new FormData();\n        var name = this._getUploadParam();\n\n        data = this._buildData(name, files, data);\n        data = this.utils.extendData(data, this.p.data);\n\n        var stop = this.app.broadcast('upload.start', e, data, files);\n        if (stop !== false)\n        {\n            this._sendData(data, files, e);\n        }\n    },\n    _sendData: function(data, files, e)\n    {\n        this.progress.show();\n        if (typeof this.p.url === 'function')\n        {\n            var res = this.p.url(data, files, e, this);\n            if (!(res instanceof Promise))\n            {\n                this._complete(res, e);\n            }\n        }\n        else\n        {\n            $R.ajax.post({\n                url: this.p.url,\n                data: data,\n                before: function(xhr)\n                {\n                    return this.app.broadcast('upload.beforeSend', xhr);\n\n                }.bind(this),\n                success: function(response)\n                {\n                    this._complete(response, e);\n                }.bind(this)\n            });\n        }\n    },\n    _getUploadParam: function()\n    {\n        return (this.p.paramName) ? this.p.paramName : 'file';\n    },\n    _buildData: function(name, files, data)\n    {\n        if (files.length === 1)\n        {\n            data.append(name + '[]', files[0]);\n        }\n        else if (files.length > 1 && this.opts.multipleUpload !== false)\n        {\n            for (var i = 0; i < files.length; i++)\n            {\n                data.append(name + '[]', files[i]);\n            }\n        }\n\n        return data;\n    },\n    _complete: function(response, e)\n    {\n        this._clear();\n        this.progress.hide();\n\n        if (response && response.error)\n        {\n            this._setStatusError();\n\n            this.app.broadcast('upload.' + this.p.name + '.error', response, e);\n            this.app.broadcast('upload.error', response);\n        }\n        else\n        {\n            this._setStatusSuccess();\n\n            this.app.broadcast('upload.' + this.p.name + '.complete', response, e);\n            this.app.broadcast('upload.complete', response);\n\n            setTimeout(this._clear.bind(this), 500);\n        }\n    }\n});\n$R.add('class', 'code.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n\n    // private\n   _init: function(el)\n    {\n        var $pre;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('figure');\n            if ($wrapper.length !== 0)\n            {\n                this.parse($wrapper);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n\n            $pre = this.find('pre code, pre').last();\n        }\n        else\n        {\n            $pre = $R.dom('<pre>');\n\n            this.parse('<figure>');\n            this.append($pre);\n        }\n\n        this._initElement($pre);\n        this._initWrapper();\n    },\n    _initElement: function($pre)\n    {\n        $pre.attr({\n            'tabindex': '-1',\n            'contenteditable': true\n        });\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'code',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'form', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n    },\n    // messages\n    onform: {\n        remove: function(node)\n        {\n            this._remove(node);\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('form'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.form.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'top');\n        }\n\n    },\n\n    // private\n    _remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'form.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.utils = app.utils;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('form');\n            if ($wrapper.length !== 0)\n            {\n                var $figure = this.utils.replaceToTag(el, 'figure');\n                this.parse($figure);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n        this._initWrapper();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'form',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'image', {\n    modals: {\n        'image':\n            '<div class=\"redactor-modal-tab\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>',\n        'imageedit':\n            '<div class=\"redactor-modal-group\"> \\\n                <div id=\"redactor-modal-image-preview\" class=\"redactor-modal-side\"></div> \\\n                <form action=\"\" class=\"redactor-modal-area\"> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-image-title\"> ## title ##</label> \\\n                        <input type=\"text\" id=\"modal-image-title\" name=\"title\" /> \\\n                    </div> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-image-caption\">## caption ##</label> \\\n                        <input type=\"text\" id=\"modal-image-caption\" name=\"caption\" aria-label=\"## caption ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-align\"> \\\n                        <label>## image-position ##</label> \\\n                        <select name=\"align\" aria-label=\"## image-position ##\"> \\\n                            <option value=\"none\">## none ##</option> \\\n                            <option value=\"left\">## left ##</option> \\\n                            <option value=\"center\">## center ##</option> \\\n                            <option value=\"right\">## right ##</option> \\\n                        </select> \\\n                    </div> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-image-url\">## link ##</label> \\\n                        <input type=\"text\" id=\"modal-image-url\" name=\"url\" aria-label=\"## link ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item\"> \\\n                        <label class=\"checkbox\"><input type=\"checkbox\" name=\"target\" aria-label=\"## link-in-new-tab ##\"> ## link-in-new-tab ##</label> \\\n                    </div> \\\n                </form> \\\n            </div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.justResized = false;\n    },\n    // messages\n    oninsert: function()\n    {\n        this._observeImages();\n    },\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeImages();\n\n        // resize\n        if (this.opts.imageResizable)\n        {\n            this.resizer = $R.create('image.resize', this.app);\n        }\n\n        // observe\n        this._observeImages();\n    },\n    ondropimage: function(e, files, clipboard)\n    {\n        if (!this.opts.imageUpload) return;\n\n        var options = {\n            url: this.opts.imageUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'imagedrop',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onstop: function()\n    {\n        if (this.resizer) this.resizer.stop();\n    },\n    onbottomclick: function()\n    {\n        this.insertion.insertToEnd(this.editor.getLastNode(), 'image');\n    },\n    onimageresizer: {\n        stop: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        }\n    },\n    onsource: {\n        open: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        },\n        closed: function()\n        {\n            this._observeImages();\n            if (this.resizer) this.resizer.rebuild();\n        }\n    },\n    onupload: {\n        complete: function()\n        {\n            this._observeImages();\n        },\n        image: {\n            complete: function(response)\n            {\n                this._insert(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imageedit: {\n            complete: function(response)\n            {\n                this._change(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagereplace: {\n            complete: function(response)\n            {\n                this._change(response, false);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n    onmodal: {\n        image: {\n            open: function($modal, $form)\n            {\n                this._setUpload($form);\n            }\n        },\n        imageedit: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            remove: function()\n            {\n                this._remove(this.$image);\n            },\n            save: function($modal, $form)\n            {\n                this._save($modal, $form);\n            }\n        }\n    },\n    onimage: {\n        observe: function()\n        {\n            this._observeImages();\n        },\n        resized: function()\n        {\n            this.justResized = true;\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        if (this.justResized)\n        {\n            this.justResized = false;\n            return;\n        }\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if (!data.isFigcaption() && data.isComponentType('image'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.image.open'\n                },\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.image.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons);\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$image = this._getCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _getModalData: function()\n    {\n        var modalData;\n        if (this._isImage() && this.opts.imageEditable)\n        {\n            modalData = {\n                name: 'imageedit',\n                width: '800px',\n                title: this.lang.get('edit'),\n                handle: 'save',\n                commands: {\n                    save: { title: this.lang.get('save') },\n                    remove: { title: this.lang.get('delete'), type: 'danger' },\n                    cancel: { title: this.lang.get('cancel') }\n                }\n            };\n        }\n        else\n        {\n            modalData = {\n                name: 'image',\n                title: this.lang.get('image')\n            };\n        }\n\n        return modalData;\n    },\n    _isImage: function()\n    {\n        return this.$image;\n    },\n    _getCurrent: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        return (data.isComponentType('image') && data.isComponentActive()) ? this.component.create('image', data.getComponent()) : false;\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n\n        if (Array.isArray(response))\n        {\n            var obj = {};\n            for (var i = 0; i < response.length; i++)\n            {\n                obj = $R.extend(obj, response[i]);\n            }\n\n            response = obj;\n        }\n        else if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n            var multiple = (Object.keys(response).length  > 1);\n            if (multiple)\n            {\n                this._insertMultiple(response, e);\n            }\n            else\n            {\n                this._insertSingle(response, e);\n            }\n        }\n    },\n    _insertSingle: function(response, e)\n    {\n        for (var key in response)\n        {\n            var $img = this._createImageAndStore(response[key]);\n            var inserted = (e) ? this.insertion.insertToPoint(e, $img) : this.insertion.insertHtml($img);\n\n            this._removeSpaceBeforeFigure(inserted[0]);\n\n            // set is active\n            this.component.setActive(inserted[0]);\n            this.app.broadcast('image.uploaded', inserted[0], response);\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var last;\n        for (var key in response)\n        {\n            z++;\n\n            var $img = this._createImageAndStore(response[key]);\n\n            if (z === 1)\n            {\n                inserted = (e) ? this.insertion.insertToPoint(e, $img) : this.insertion.insertHtml($img);\n            }\n            else\n            {\n                var $inserted = $R.dom(inserted[0]);\n                $inserted.after($img);\n                inserted = [$img.get()];\n\n                this.app.broadcast('image.inserted', $img);\n            }\n\n            last = inserted[0];\n\n            this._removeSpaceBeforeFigure(inserted[0]);\n            this.app.broadcast('image.uploaded', inserted[0], response);\n        }\n\n        // set last is active\n        this.component.setActive(last);\n    },\n    _createImageAndStore: function(item)\n    {\n        var $img = this.component.create('image');\n\n        $img.addClass('redactor-uploaded-figure');\n        $img.setData({\n            src: item.url,\n            id: (item.id) ? item.id : this.utils.getRandomId()\n        });\n\n        // add to storage\n        this.storage.add('image', $img.getElement());\n\n        return $img;\n    },\n    _removeSpaceBeforeFigure: function(img)\n    {\n        if (!img) return;\n\n        var prev = img.previousSibling;\n        if (prev)\n        {\n            this._removeInvisibleSpace(prev);\n            this._removeInvisibleSpace(prev.previousSibling);\n        }\n    },\n    _removeInvisibleSpace: function(el)\n    {\n        if (el && el.nodeType === 3 && this.utils.searchInvisibleChars(el.textContent) !== -1)\n        {\n            el.parentNode.removeChild(el);\n        }\n    },\n    _save: function($modal, $form)\n    {\n        var data = $form.getData();\n        var imageData = {\n            title: data.title,\n            link: { url: data.url, target: data.target }\n        };\n\n        if (this.opts.imageCaption) imageData.caption = data.caption;\n        if (this.opts.imagePosition) imageData.align = data.align;\n\n        this.$image.setData(imageData);\n        if (this.resizer) this.resizer.rebuild();\n\n        this.app.broadcast('image.changed', this.$image);\n        this.app.api('module.modal.close');\n    },\n    _change: function(response, modal)\n    {\n        if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n            var $img;\n            for (var key in response)\n            {\n                $img = $R.dom('<img>');\n                $img.attr('src', response[key].url);\n\n                this.$image.changeImage(response[key]);\n\n                this.app.broadcast('image.changed', this.$image, response);\n                this.app.broadcast('image.uploaded', this.$image, response);\n\n                break;\n            }\n\n            if (modal !== false)\n            {\n                $img.on('load', function() { this.$previewBox.html($img); }.bind(this));\n            }\n        }\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('image.uploadError', response);\n    },\n    _remove: function(node)\n    {\n        this.app.api('module.modal.close');\n        this.component.remove(node);\n    },\n    _observeImages: function()\n    {\n        var $editor = this.editor.getElement();\n        var self = this;\n        $editor.find('img').each(function(node)\n        {\n            var $node = $R.dom(node);\n\n            $node.off('.drop-to-replace');\n            $node.on('dragover.drop-to-replace dragenter.drop-to-replace', function(e)\n            {\n                e.preventDefault();\n                return;\n            });\n\n            $node.on('drop.drop-to-replace', function(e)\n            {\n                if (!self.app.isDragComponentInside())\n                {\n                    return self._setReplaceUpload(e, $node);\n                }\n            });\n        });\n    },\n    _setFormData: function($modal, $form)\n    {\n        this._buildPreview();\n        this._buildPreviewUpload();\n\n        var imageData = this.$image.getData();\n        var data = {\n            title: imageData.title\n        };\n\n        // caption\n        if (this.opts.imageCaption) data.caption = imageData.caption;\n        else $modal.find('.form-item-caption').hide();\n\n        // position\n        if (this.opts.imagePosition) data.align = imageData.align;\n        else $modal.find('.form-item-align').hide();\n\n        if (imageData.link)\n        {\n            data.url = imageData.link.url;\n            if (imageData.link.target) data.target = true;\n        }\n\n        $form.setData(data);\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _setReplaceUpload: function(e, $node)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (!this.opts.imageUpload) return;\n\n        this.$image = this.component.create('image', $node);\n\n        var options = {\n            url: this.opts.imageUpload,\n            files: e.dataTransfer.files,\n            name: 'imagereplace',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.send', options);\n\n        return;\n    },\n    _setUpload: function($form)\n    {\n        var options = {\n            url: this.opts.imageUpload,\n            element: $form.getField('file'),\n            name: 'image',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _buildPreview: function()\n    {\n        this.$preview = $R.dom('#redactor-modal-image-preview');\n\n        var imageData = this.$image.getData();\n        var $previewImg = $R.dom('<img>');\n        $previewImg.attr('src', imageData.src);\n\n        this.$previewBox = $R.dom('<div>');\n        this.$previewBox.append($previewImg);\n\n        this.$preview.html('');\n        this.$preview.append(this.$previewBox);\n    },\n    _buildPreviewUpload: function()\n    {\n        if (!this.opts.imageUpload) return;\n\n        var $desc = $R.dom('<div class=\"desc\">');\n        $desc.html(this.lang.get('upload-change-label'));\n\n        this.$preview.append($desc);\n\n        var options = {\n            url: this.opts.imageUpload,\n            element: this.$previewBox,\n            name: 'imageedit',\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    }\n});\n$R.add('class', 'image.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.selection = app.selection;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['src', 'title', 'caption', 'align', 'link', 'id'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n    changeImage: function(data)\n    {\n        this.$element.attr('src', data.url);\n    },\n\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        var $figure = $el.closest('figure');\n\n        if (el === undefined)\n        {\n            this.$element = $R.dom('<img>');\n            this.parse('<figure>');\n            this.append(this.$element);\n        }\n        else if ($figure.length === 0)\n        {\n            this.parse('<figure>');\n            this.$element = $el;\n            this.$element.wrap(this);\n        }\n        else\n        {\n            this.parse($figure);\n            this.$element = this.find('img');\n        }\n\n        this._initWrapper();\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _set_src: function(src)\n    {\n       this.$element.attr('src', src);\n    },\n    _set_id: function(id)\n    {\n       this.$element.attr('data-image', id);\n    },\n    _set_title: function(title)\n    {\n        title = title.trim().replace(/(<([^>]+)>)/ig,\"\");\n\n        if (title === '')\n        {\n            this.$element.removeAttr('alt');\n            this.$element.removeAttr('title');\n        }\n        else\n        {\n            this.$element.attr('alt', title);\n            this.$element.attr('title', title);\n        }\n\n    },\n    _set_caption: function(caption)\n    {\n        var $figcaption = this.find('figcaption');\n        if ($figcaption.length === 0)\n        {\n            $figcaption = $R.dom('<figcaption>');\n            $figcaption.attr('contenteditable', 'true');\n\n            this.append($figcaption);\n        }\n\n        if (caption === '') $figcaption.remove();\n        else $figcaption.html(caption);\n\n        return $figcaption;\n    },\n    _set_align: function(align)\n    {\n        var imageFloat = '';\n        var imageMargin = '';\n        var textAlign = '';\n        var $el = this;\n\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                $el.removeClass(positions[key]);\n            }\n\n            var alignClass = (typeof positions[align] !== 'undefined') ? positions[align] : false;\n            if (alignClass)\n            {\n                $el.addClass(alignClass);\n            }\n        }\n        else\n        {\n            switch (align)\n            {\n                case 'left':\n                    imageFloat = 'left';\n                    imageMargin = '0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin + ' 0';\n                break;\n                case 'right':\n                    imageFloat = 'right';\n                    imageMargin = '0 0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin;\n                break;\n                case 'center':\n                    textAlign = 'center';\n                break;\n            }\n\n            $el.css({ 'float': imageFloat, 'margin': imageMargin, 'text-align': textAlign });\n            $el.attr('rel', $el.attr('style'));\n        }\n    },\n    _set_link: function(data)\n    {\n        var $link = this._findLink();\n        if (data.url === '')\n        {\n            if ($link) $link.unwrap();\n\n            return;\n        }\n\n        if (!$link)\n        {\n            $link = $R.dom('<a>');\n            this.$element.wrap($link);\n        }\n\n        $link.attr('href', data.url);\n\n        if (data.target) $link.attr('target', data.target);\n        else $link.removeAttr('target');\n\n        return $link;\n    },\n    _get_src: function()\n    {\n        return this.$element.attr('src');\n    },\n    _get_id: function()\n    {\n        return this.$element.attr('data-image');\n    },\n    _get_title: function()\n    {\n        var alt = this.$element.attr('alt');\n        var title = this.$element.attr('title');\n\n        if (alt) return alt;\n        else if (title) return title;\n        else return '';\n    },\n    _get_caption: function()\n    {\n        var $figcaption = this.find('figcaption');\n\n        if ($figcaption.length === 0)\n        {\n            return '';\n        }\n        else\n        {\n            return $figcaption.html();\n        }\n    },\n    _get_align: function()\n    {\n        var align = '';\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            align = 'none';\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                if (this.hasClass(positions[key]))\n                {\n                    align = key;\n                    break;\n                }\n            }\n        }\n        else\n        {\n            align = (this.css('text-align') === 'center') ? 'center' : this.css('float');\n        }\n\n        return align;\n    },\n    _get_link: function()\n    {\n        var $link = this._findLink();\n        if ($link)\n        {\n            var target = ($link.attr('target')) ? true : false;\n\n            return {\n                url: $link.attr('href'),\n                target: target\n            };\n        }\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'image',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    },\n    _findLink: function()\n    {\n        var $link = this.find('a').filter(function(node)\n        {\n            return ($R.dom(node).closest('figcaption').length === 0);\n        });\n\n        if ($link.length !== 0)\n        {\n            return $link;\n        }\n\n        return false;\n    }\n});\n$R.add('class', 'image.resize', {\n    init: function(app)\n    {\n        this.app = app;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n\n        // init\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n        this._init();\n    },\n    // public\n    rebuild: function()\n    {\n        this._setResizerPosition();\n    },\n    hide: function()\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor.image-resize');\n\n        this.$doc.off('.redactor.image-resize');\n        this.$win.off('resize.redactor.image-resize');\n        this.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.on('click.redactor.image-resize', this._build.bind(this));\n\n        this.$win.on('resize.redactor.image-resize', this._setResizerPosition.bind(this));\n    },\n    _build: function(e)\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n\n        var data = this.inspector.parse(e.target);\n        var $editor = this.editor.getElement();\n\n        if (data.isComponentType('image'))\n        {\n            this.$resizableBox = $editor;\n            this.$resizableImage = $R.dom(data.getImageElement());\n\n            this.$resizer = $R.dom('<span>');\n            this.$resizer.attr('id', 'redactor-image-resizer');\n\n            this.$target.append(this.$resizer);\n\n            this._setResizerPosition();\n            this.$resizer.on('mousedown touchstart', this._set.bind(this));\n        }\n    },\n    _setResizerPosition: function()\n    {\n        if (this.$resizer)\n        {\n            var isTarget = this.toolbar.isTarget();\n            var targetOffset = this.$target.offset();\n            var offsetFix = 7;\n            var topOffset = (isTarget) ? (offsetFix - targetOffset.top + this.$target.scrollTop()) : offsetFix;\n            var leftOffset = (isTarget) ? (offsetFix - targetOffset.left) : offsetFix;\n            var pos = this.$resizableImage.offset();\n            var width = this.$resizableImage.width();\n            var height = this.$resizableImage.height();\n            var resizerWidth =  this.$resizer.width();\n            var resizerHeight =  this.$resizer.height();\n\n            this.$resizer.css({ top: (pos.top + height - resizerHeight + topOffset) + 'px', left: (pos.left + width - resizerWidth + leftOffset) + 'px' });\n        }\n    },\n    _set: function(e)\n    {\n        e.preventDefault();\n\n        this.resizeHandle = {\n            x : e.pageX,\n            y : e.pageY,\n            el : this.$resizableImage,\n            ratio: this.$resizableImage.width() / this.$resizableImage.height(),\n            h: this.$resizableImage.height()\n        };\n\n        e = e.originalEvent || e;\n\n        if (e.targetTouches)\n        {\n             this.resizeHandle.x = e.targetTouches[0].pageX;\n             this.resizeHandle.y = e.targetTouches[0].pageY;\n        }\n\n        this.app.broadcast('contextbar.close');\n        this.app.broadcast('image.resize', this.$resizableImage);\n        this._start();\n    },\n    _start: function()\n    {\n        this.$doc.on('mousemove.redactor.image-resize touchmove.redactor.image-resize', this._move.bind(this));\n        this.$doc.on('mouseup.redactor.image-resize touchend.redactor.image-resize', this._stop.bind(this));\n    },\n    _stop: function()\n    {\n        this.$doc.off('.redactor.image-resize');\n        this.app.broadcast('image.resized', this.$resizableImage);\n    },\n    _move: function(e)\n    {\n        e.preventDefault();\n\n        e = e.originalEvent || e;\n\n        var height = this.resizeHandle.h;\n\n        if (e.targetTouches) height += (e.targetTouches[0].pageY -  this.resizeHandle.y);\n        else height += (e.pageY -  this.resizeHandle.y);\n\n        var width = height * this.resizeHandle.ratio;\n\n        if (height < 50 || width < 100) return;\n        if (this._getResizableBoxWidth() <= width) return;\n\n        this.resizeHandle.el.attr({width: width, height: height});\n        this.resizeHandle.el.width(width);\n        this.resizeHandle.el.height(height);\n        this._setResizerPosition();\n    },\n    _getResizableBoxWidth: function()\n    {\n        var width = this.$resizableBox.width();\n        return width - parseInt(this.$resizableBox.css('padding-left')) - parseInt(this.$resizableBox.css('padding-right'));\n    }\n});\n$R.add('module', 'file', {\n    modals: {\n        'file':\n            '<div class=\"redactor-modal-tab\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-file-title\"> ## filename ## <span class=\"desc\">(## optional ##)</span></label> \\\n                    <input type=\"text\" id=\"modal-file-title\" name=\"title\" /> \\\n                </div> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n    },\n    // messages\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeFiles();\n    },\n    ondropfile: function(e, files, clipboard)\n    {\n        if (!this.opts.fileUpload) return;\n\n        var options = {\n            url: this.opts.fileUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'filedrop',\n            data: this.opts.fileData\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onmodal: {\n        file: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n                this._setUpload($form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n\n                this.$form = $form;\n            }\n        }\n    },\n    onupload: {\n        file: {\n            complete: function(response)\n            {\n                this._insert(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        filedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        if (data.isFile())\n        {\n            var node = data.getFile();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.file.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n\n    },\n\n    // public\n    open: function()\n    {\n        this._open();\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _open: function()\n    {\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    _getModalData: function()\n    {\n        var modalData = {\n            name: 'file',\n            title: this.lang.get('file')\n        };\n\n        return modalData;\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n        if (typeof response !== 'object') return;\n\n        if (Array.isArray(response))\n        {\n            var obj = {};\n            for (var i = 0; i < response.length; i++)\n            {\n                obj = $R.extend(obj, response[i]);\n            }\n\n            response = obj;\n        }\n\n        var multiple = (Object.keys(response).length  > 1);\n\n        if (multiple)\n        {\n            this._insertMultiple(response, e);\n        }\n        else\n        {\n            this._insertSingle(response, e);\n        }\n\n        this.$form = false;\n    },\n    _insertSingle: function(response, e)\n    {\n        var inserted = [];\n        for (var key in response)\n        {\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file);\n            }\n            else\n            {\n                inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n            }\n\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var $last;\n        for (var key in response)\n        {\n            z++;\n\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file, response);\n            }\n            else\n            {\n                if (z === 1)\n                {\n                    inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n                }\n                else\n                {\n                    var $inserted = $R.dom(inserted[0]);\n                    $inserted.after($file).after(' ');\n                    inserted = [$file.get()];\n\n                    this.app.broadcast('file.inserted', $file);\n                }\n            }\n\n            $last = $file;\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n\n        // set caret after last\n        if (!this.opts.fileAttachment)\n        {\n            this.caret.setAfter($last);\n        }\n    },\n    _insertAsAttachment: function($file, response)\n    {\n        var $box = $R.dom(this.opts.fileAttachment);\n        var $wrapper = $file.wrapAttachment();\n        $box.append($wrapper);\n\n        var inserted = [$wrapper.get()];\n        this.app.broadcast('file.appended', inserted[0], response);\n\n        return inserted;\n    },\n    _createFileAndStore: function(item)\n    {\n        var modalFormData = (this.$form) ? this.$form.getData() : false;\n        var name = (item.name) ? item.name : item.url;\n        var title = (!this.opts.fileAttachment && modalFormData && modalFormData.title !== '') ? modalFormData.title : this._truncateUrl(name);\n\n        var $file = this.component.create('file');\n        $file.attr('href', item.url);\n        $file.attr('data-file', (item.id) ? item.id : this.utils.getRandomId());\n        $file.attr('data-name', item.name);\n        $file.html(title);\n\n        // add to storage\n        this.storage.add('file', $file);\n\n        return $file;\n    },\n    _remove: function(node)\n    {\n        this.selection.save();\n\n        var $file = this.component.create('file', node);\n        var stop = this.app.broadcast('file.delete', $file);\n        if (stop !== false)\n        {\n            $file.unwrap();\n\n            this.selection.restore();\n\n            // callback\n            this.app.broadcast('file.deleted', $file);\n        }\n        else\n        {\n            this.selection.restore();\n        }\n    },\n    _truncateUrl: function(url)\n    {\n        return (url.search(/^http/) !== -1 && url.length > 20) ? url.substring(0, 20) + '...' : url;\n    },\n    _setUpload: function($form)\n    {\n        var options = {\n            url: this.opts.fileUpload,\n            element: $form.getField('file'),\n            name: 'file',\n            data: this.opts.fileData,\n            paramName: this.opts.fileUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _setFormData: function($modal, $form)\n    {\n        if (this.opts.fileAttachment)\n        {\n            $modal.find('.form-item-title').hide();\n        }\n        else\n        {\n            $form.setData({ title: this.selection.getText() });\n        }\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('file.uploadError', response);\n    }\n});\n$R.add('class', 'file.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    wrapAttachment: function()\n    {\n        this.$wrapper = $R.dom('<span class=\"redactor-file-item\">');\n        this.$remover = $R.dom('<span class=\"redactor-file-remover\">');\n        this.$remover.html('&times;');\n        this.$remover.on('click', this.removeAttachment.bind(this));\n\n        this.$wrapper.append(this);\n        this.$wrapper.append(this.$remover);\n\n        return this.$wrapper;\n    },\n    removeAttachment: function(e)\n    {\n        e.preventDefault();\n\n        var stop = this.app.broadcast('file.delete', this, this.$wrapper);\n        if (stop !== false)\n        {\n            this.$wrapper.remove();\n            this.app.broadcast('file.deleted', this);\n            this.app.broadcast('file.removeAttachment', this);\n        }\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            var $a = $R.dom(el).closest('a');\n            this.parse($a);\n        }\n    }\n});\n$R.add('module', 'buffer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.offset = app.offset;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.state = false;\n        this.passed = false;\n        this.keyPressed = false;\n        this.savedHtml = false;\n        this.savedOffset = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    // messages\n    onkeydown: function(e)\n    {\n        this._listen(e);\n    },\n    onsyncing: function()\n    {\n        if (!this.keyPressed)\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = false;\n    },\n    onstate: function(e, html, offset)\n    {\n        if ((e && (e.ctrlKey || e.metaKey)) || (e && (this._isUndo(e) || this._isRedo(e))))\n        {\n            return;\n        }\n\n        this.passed = false;\n        this._saveState(html, offset);\n    },\n    onenable: function()\n    {\n        this.clear();\n    },\n\n    // public\n    clear: function()\n    {\n        this.state = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    undo: function()\n    {\n        this._getUndo();\n    },\n    redo: function()\n    {\n        this._getRedo();\n    },\n    trigger: function()\n    {\n        if (this.state && this.passed === false) this._setUndo();\n    },\n\n    // private\n    _saveState: function(html, offset)\n    {\n        var $editor = this.editor.getElement();\n\n        this.state = {\n            html: html || $editor.html(),\n            offset: offset || this.offset.get()\n        };\n    },\n    _listen: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n        var cmd = ctrl || e.shiftKey || e.altKey;\n        var keys = [this.keycodes.SPACE, this.keycodes.ENTER, this.keycodes.BACKSPACE, this.keycodes.DELETE, this.keycodes.TAB,\n                    this.keycodes.LEFT, this.keycodes.RIGHT, this.keycodes.UP, this.keycodes.DOWN];\n\n        // undo\n        if (this._isUndo(e)) // z key\n        {\n            e.preventDefault();\n            this.undo();\n            return;\n        }\n        // redo\n        else if (this._isRedo(e))\n        {\n            e.preventDefault();\n            this.redo();\n            return;\n        }\n        // spec keys\n        else if (!ctrl && keys.indexOf(key) !== -1)\n        {\n            cmd = true;\n            this.trigger();\n        }\n        // cut & copy\n        else if (ctrl && (key === 88 || key === 67))\n        {\n            cmd = true;\n            this.trigger();\n        }\n\n        // empty buffer\n        if (!cmd && !this._hasUndo())\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = true;\n    },\n    _isUndo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && key === 90 && !e.shiftKey && !e.altKey);\n    },\n    _isRedo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && (key === 90 && e.shiftKey || key === 89 && !e.shiftKey) && !e.altKey);\n    },\n    _setUndo: function()\n    {\n        var last = this.undoStorage[this.undoStorage.length-1];\n        if (typeof last === 'undefined' || last[0] !== this.state.html)\n        {\n            this.undoStorage.push([this.state.html, this.state.offset]);\n            this._removeOverStorage();\n        }\n    },\n    _setRedo: function()\n    {\n        var $editor = this.editor.getElement();\n        var offset = this.offset.get();\n        var html = $editor.html();\n\n        this.redoStorage.push([html, offset]);\n        this.redoStorage = this.redoStorage.slice(0, this.opts.bufferLimit);\n    },\n    _getUndo: function()\n    {\n        if (!this._hasUndo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.undoStorage.pop();\n\n        this._setRedo();\n\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n        this.selection.restore();\n\n        this.app.broadcast('undo', buffer[0], buffer[1]);\n\n    },\n    _getRedo: function()\n    {\n        if (!this._hasRedo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.redoStorage.pop();\n\n        this._setUndo();\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n\n        this.app.broadcast('redo', buffer[0], buffer[1]);\n    },\n    _removeOverStorage: function()\n    {\n        if (this.undoStorage.length > this.opts.bufferLimit)\n        {\n            this.undoStorage = this.undoStorage.slice(0, (this.undoStorage.length - this.opts.bufferLimit));\n        }\n    },\n    _hasUndo: function()\n    {\n        return (this.undoStorage.length !== 0);\n    },\n    _hasRedo: function()\n    {\n        return (this.redoStorage.length !== 0);\n    }\n});\n$R.add('module', 'list', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.block = app.block;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n    },\n    // messages\n    onbutton: {\n        list: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        list: {\n            observe: function(dropdown)\n            {\n                this._observeDropdown(dropdown);\n            }\n        }\n    },\n\n    // public\n    toggle: function(type)\n    {\n        var nodes = this._getBlocks();\n        var block = this.selection.getBlock();\n        var $list = $R.dom(block).parents('ul, ol',  '.redactor-in').last();\n        if (nodes.length === 0 && $list.length !== 0)\n        {\n            nodes = [$list.get()];\n        }\n\n        if (block && (block.tagName === 'TD' || block.tagName === 'TH'))\n        {\n            nodes = this.block.format('div');\n        }\n\n        this.selection.saveMarkers();\n\n        nodes = (nodes.length !== 0 && this._isUnformat(type, nodes)) ? this._unformat(type, nodes) : this._format(type, nodes);\n\n        this.selection.restoreMarkers();\n\n        return nodes;\n    },\n    indent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (isIndent)\n        {\n            this.selection.saveMarkers();\n\n            $prev = $R.dom(prev);\n            var $prevChild = $prev.children('ul, ol');\n            var $list = $item.closest('ul, ol');\n\n            if ($prevChild.length !== 0)\n            {\n                $prevChild.append($item);\n            }\n            else\n            {\n                var listTag = $list.get().tagName.toLowerCase();\n                var $newList = $R.dom('<' + listTag + '>');\n\n                $newList.append($item);\n                $prev.append($newList);\n            }\n\n            this.selection.restoreMarkers();\n        }\n    },\n    outdent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n\n        if (isCollapsed && item)\n        {\n\n            var $listItem = $item.parent();\n            var $liItem = $listItem.closest('li', '.redactor-in');\n            var $prev = $item.prevElement();\n            var $next = $item.nextElement();\n            var prev = $prev.get();\n            var next = $next.get();\n            var nextItems, nextList, $newList, $nextList;\n            var isTop = (prev === false);\n            var isMiddle = (prev !== false && next !== false);\n            var isBottom = (!isTop && next === false);\n\n            this.selection.saveMarkers();\n\n            // out\n            if ($liItem.length !== 0)\n            {\n                if (isMiddle)\n                {\n                    nextItems = this._getAllNext($item.get());\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $liItem.after($item);\n                    $item.append($newList);\n                }\n                else\n                {\n                    $liItem.after($item);\n\n                    if ($listItem.children().length === 0)\n                    {\n                        $listItem.remove();\n                    }\n                    else\n                    {\n                        if (isTop) $item.append($listItem);\n                    }\n                }\n            }\n            // unformat\n            else\n            {\n                var $container =  this._createUnformatContainer($item);\n                var $childList = $container.find('ul, ol').first();\n\n                if (isTop) $listItem.before($container);\n                else if (isBottom) $listItem.after($container);\n                else if (isMiddle)\n                {\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n                    nextItems = this._getAllNext($item.get());\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $listItem.after($container);\n                    $container.after($newList);\n                }\n\n                if ($childList.length !== 0)\n                {\n                    $nextList = $container.nextElement();\n                    nextList = $nextList.get();\n                    if (nextList && nextList.tagName === $listItem.get().tagName)\n                    {\n                        $R.dom(nextList).prepend($childList);\n                        $childList.unwrap();\n                    }\n                    else\n                    {\n                        $container.after($childList);\n                    }\n                }\n\n                $item.remove();\n            }\n\n            this.selection.restoreMarkers();\n        }\n    },\n\n    // private\n    _getAllNext: function(next)\n    {\n        var nodes = [];\n\n        while (next)\n        {\n            var $next = $R.dom(next).nextElement();\n            next = $next.get();\n\n            if (next) nodes.push(next);\n            else return nodes;\n        }\n\n        return nodes;\n    },\n    _isUnformat: function(type, nodes)\n    {\n        var countLists = 0;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                var tag = nodes[i].tagName.toLowerCase();\n                if (tag === type || tag === 'figure')\n                {\n                    countLists++;\n                }\n            }\n        }\n\n        return (countLists === nodes.length);\n    },\n    _format: function(type, nodes)\n    {\n        var tags = ['p', 'div', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol'];\n        var blocks = this._uniteBlocks(nodes, tags);\n        var lists = [];\n\n        for (var key in blocks)\n        {\n            var items = blocks[key];\n            var $list = this._createList(type, blocks[key]);\n\n            for (var i = 0; i < items.length; i++)\n            {\n                var $item;\n\n                // lists\n                if (items[i].nodeType !== 3 && (items[i].tagName === 'UL' || items[i].tagName === 'OL'))\n                {\n                    var $oldList = $R.dom(items[i]);\n\n                    $item = $oldList.contents();\n                    $list.append($item);\n\n                    // old is empty\n                    if (this.utils.isEmpty($oldList)) $oldList.remove();\n                }\n                // other blocks or texts\n                else\n                {\n                    $item = this._createListItem(items[i]);\n                    this.utils.normalizeTextNodes($item);\n                    $list.append($item);\n                }\n            }\n\n            lists.push($list.get());\n        }\n\n        return lists;\n    },\n    _uniteBlocks: function(nodes, tags)\n    {\n        var z = 0;\n        var blocks = { 0: [] };\n        var lastcell = false;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var $cell = $node.closest('th, td');\n\n            if ($cell.length !== 0)\n            {\n                if ($cell.get() !== lastcell)\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n            }\n            else\n            {\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n                else\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n            }\n\n            lastcell = $cell.get();\n        }\n\n        return blocks;\n    },\n    _isUniteBlock: function(node, tags)\n    {\n        return (node.nodeType === 3 || tags.indexOf(node.tagName.toLowerCase()) !== -1);\n    },\n    _createList: function(type, blocks)\n    {\n        var last = blocks[blocks.length-1];\n        var $last = $R.dom(last);\n        var $list = $R.dom('<' + type + '>');\n        $last.after($list);\n\n        return $list;\n    },\n    _createListItem: function(item)\n    {\n        var $item = $R.dom('<li>');\n        if (item.nodeType === 3)\n        {\n            $item.append(item);\n        }\n        else\n        {\n            var $el = $R.dom(item);\n            $item.append($el.contents());\n            $el.remove();\n        }\n\n        return $item;\n    },\n    _unformat: function(type, nodes)\n    {\n        if (nodes.length === 1)\n        {\n            // one list\n            var $list = $R.dom(nodes[0]);\n            var $items = $list.find('li');\n\n            var selectedItems = this.selection.getNodes({ tags: ['li'] });\n            var block = this.selection.getBlock();\n            var $li = $R.dom(block).closest('li');\n            if (selectedItems.length === 0 && $li.length !== 0)\n            {\n                selectedItems = [$li.get()];\n            }\n\n\n            // 1) entire\n            if (selectedItems.length === $items.length)\n            {\n                return this._unformatEntire(nodes[0]);\n            }\n\n            var pos = this._getItemsPosition($items, selectedItems);\n\n            // 2) top\n            if (pos === 'Top')\n            {\n                return this._unformatAtSide('before', selectedItems, $list);\n            }\n\n            // 3) bottom\n            else if (pos === 'Bottom')\n            {\n                selectedItems.reverse();\n                return this._unformatAtSide('after', selectedItems, $list);\n            }\n\n            // 4) middle\n            else if (pos === 'Middle')\n            {\n                var $last = $R.dom(selectedItems[selectedItems.length-1]);\n\n                var ci = false;\n\n                var $parent = false;\n                var $secondList = $R.dom('<' + $list.get().tagName.toLowerCase() + '>');\n                $items.each(function(node)\n                {\n                    if (ci)\n                    {\n                        var $node = $R.dom(node);\n                        if ($node.closest('.redactor-split-item').length === 0 && ($parent === false || $node.closest($parent).length === 0))\n                        {\n                            $node.addClass('redactor-split-item');\n                        }\n\n                        $parent = $node;\n                    }\n\n                    if (node === $last.get())\n                    {\n                        ci = true;\n                    }\n                });\n\n                $items.filter('.redactor-split-item').each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    $node.removeClass('redactor-split-item');\n                    $secondList.append(node);\n                });\n\n                $list.after($secondList);\n\n                selectedItems.reverse();\n                for (var i = 0; i < selectedItems.length; i++)\n                {\n                    var $item = $R.dom(selectedItems[i]);\n                    var $container = this._createUnformatContainer($item);\n\n                    $list.after($container);\n                    $container.find('ul, ol').remove();\n                    $item.remove();\n                }\n\n\n                return;\n            }\n\n        }\n        else\n        {\n            // unformat all\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (nodes[i].nodeType !== 3 && nodes[i].tagName.toLowerCase() === type)\n                {\n                    this._unformatEntire(nodes[i]);\n                }\n            }\n        }\n    },\n    _unformatEntire: function(list)\n    {\n        var $list = $R.dom(list);\n        var $items = $list.find('li');\n        $items.each(function(node)\n        {\n            var $item = $R.dom(node);\n            var $container = this._createUnformatContainer($item);\n\n            $item.remove();\n            $list.before($container);\n\n        }.bind(this));\n\n        $list.remove();\n    },\n    _unformatAtSide: function(type, selectedItems, $list)\n    {\n        for (var i = 0; i < selectedItems.length; i++)\n        {\n            var $item = $R.dom(selectedItems[i]);\n            var $container = this._createUnformatContainer($item);\n\n            $list[type]($container);\n\n            var $innerLists = $container.find('ul, ol').first();\n            $item.append($innerLists);\n\n            $innerLists.each(function(node)\n            {\n                var $node = $R.dom(node);\n                var $parent = $node.closest('li');\n\n                if ($parent.get() === selectedItems[i])\n                {\n                    $node.unwrap();\n                    $parent.addClass('r-unwrapped');\n                }\n\n            });\n\n            if (this.utils.isEmptyHtml($item.html())) $item.remove();\n        }\n\n        // clear empty\n        $list.find('.r-unwrapped').each(function(node)\n        {\n            var $node = $R.dom(node);\n            if ($node.html().trim() === '') $node.remove();\n            else $node.removeClass('r-unwrapped');\n        });\n    },\n    _getItemsPosition: function($items, selectedItems)\n    {\n        var pos = 'Middle';\n\n        var sFirst = selectedItems[0];\n        var sLast = selectedItems[selectedItems.length-1];\n\n        var first = $items.first().get();\n        var last = $items.last().get();\n\n        if (first === sFirst && last !== sLast)\n        {\n            pos = 'Top';\n        }\n        else if (first !== sFirst && last === sLast)\n        {\n            pos = 'Bottom';\n        }\n\n        return pos;\n    },\n    _createUnformatContainer: function($item)\n    {\n        var $container = $R.dom('<' + this.opts.markup + '>');\n        if (this.opts.breakline) $container.attr('data-redactor-tag', 'br');\n\n        $container.append($item.contents());\n\n        return $container;\n    },\n    _getBlocks: function()\n    {\n        return this.selection.getBlocks({ first: true });\n    },\n    _observeButton: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isDisabled = (data.isPre() || data.isCode() || data.isFigcaption());\n\n        this._observeButtonsList(isDisabled, ['lists', 'ul', 'ol', 'outdent', 'indent']);\n\n        var itemOutdent = this.toolbar.getButton('outdent');\n        var itemIndent = this.toolbar.getButton('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeDropdown: function(dropdown)\n    {\n        var itemOutdent = dropdown.getItem('outdent');\n        var itemIndent = dropdown.getItem('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeIndent: function(itemIndent, itemOutdent)\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (itemOutdent)\n        {\n            if (item && isCollapsed) itemOutdent.enable();\n            else itemOutdent.disable();\n        }\n\n        if (itemIndent)\n        {\n            if (item && isIndent) itemIndent.enable();\n            else itemIndent.disable();\n        }\n    },\n    _observeButtonsList: function(param, buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            var button = this.toolbar.getButton(buttons[i]);\n            if (button)\n            {\n                if (param) button.disable();\n                else button.enable();\n            }\n        }\n    }\n});\n$R.add('class', 'video.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('figure');\n            if ($wrapper.length !== 0)\n            {\n                this.parse($wrapper);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n\n        this._initWrapper();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'video',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n\n\n    window.Redactor = window.$R = $R;\n\n    // Data attribute load\n    window.addEventListener('load', function()\n    {\n        $R('[data-redactor]');\n    });\n\n}());"]}