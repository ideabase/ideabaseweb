{"version":3,"sources":["RedactorOverrides.js"],"names":["imageResizeClass","$R","prototype","_setResizerPosition","this","$resizer","toolbar","isTarget","$target","offset","pos","$resizableImage","width","height","resizerWidth","resizerHeight","css","top","left","_build","e","find","remove","data","inspector","parse","target","$editor","editor","getElement","isComponentType","$resizableBox","dom","getImageElement","attr","append","on","_set","bind","rebuild","hide","off","toolbarFixedClass","_doFixed","$container","container","$toolbar","$wrapper","getWrapper","parents","filter","node","getComputedStyle","display","length","isHeight","isEmpty","isSourceMode","toolbarHeight","boxOffset","scrollOffset","$fixedTarget","scrollTop","$win","relativeTopPoint","Math","abs","position","detector","isDesktop","opts","toolbarFixedTopOffset","isMobile","fixedScrollTimeout","clearTimeout","setTimeout","show","addClass","dropdown","getDropdown","updatePosition","app","broadcast","reset"],"mappings":"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","file":"RedactorOverrides.min.js","sourcesContent":["// Adjust the positioning of image resizer\r\n// =============================================================================\r\n\r\nvar imageResizeClass = $R['classes']['image.resize'];\r\n\r\n// Position the image resizer correctly\r\nimageResizeClass.prototype._setResizerPosition = function () {\r\n    if (this.$resizer)\r\n    {\r\n        var isTarget = this.toolbar.isTarget();\r\n        var targetOffset = this.$target.offset();\r\n        var offsetFix = 7;\r\n        var topOffset = offsetFix;\r\n        var leftOffset = offsetFix;\r\n        var pos = this.$resizableImage.offset();\r\n        var width = this.$resizableImage.width();\r\n        var height = this.$resizableImage.height();\r\n        var resizerWidth =  this.$resizer.width();\r\n        var resizerHeight =  this.$resizer.height();\r\n\r\n        this.$resizer.css({ top: (pos.top + height - resizerHeight + topOffset) + 'px', left: (pos.left + width - resizerWidth + leftOffset) + 'px' });\r\n    }\r\n};\r\n\r\n// When scrolling, reposition the resizer\r\nimageResizeClass.prototype._build = function (e) {\r\n    this.$target.find('#redactor-image-resizer').remove();\r\n\r\n    var data = this.inspector.parse(e.target);\r\n    var $editor = this.editor.getElement();\r\n\r\n    if (data.isComponentType('image'))\r\n    {\r\n        this.$resizableBox = $editor;\r\n        this.$resizableImage = $R.dom(data.getImageElement());\r\n\r\n        this.$resizer = $R.dom('<span>');\r\n        this.$resizer.attr('id', 'redactor-image-resizer');\r\n\r\n        this.$target.append(this.$resizer);\r\n\r\n        this._setResizerPosition();\r\n        this.$resizer.on('mousedown touchstart', this._set.bind(this));\r\n\r\n        if (this.toolbar.isTarget()) {\r\n            this.$target.on('scroll.resizer', this.rebuild.bind(this));\r\n        } else {\r\n            $R.dom('#content-container').on('scroll.resizer', this.rebuild.bind(this));\r\n        }\r\n    }\r\n};\r\n// Stop listening to scroll\r\nimageResizeClass.prototype.hide = function () {\r\n    this.$target.find('#redactor-image-resizer').remove();\r\n    if (this.toolbar.isTarget()) {\r\n        this.$target.off('scroll.resizer', this.rebuild.bind(this));\r\n    } else {\r\n        $R.dom('#content-container').off('scroll.resizer', this.rebuild.bind(this));\r\n    }\r\n};\r\n\r\n// Adjust the positioning of fixed toolbar\r\n// =============================================================================\r\n\r\nvar toolbarFixedClass = $R['classes']['toolbar.fixed'];\r\n\r\ntoolbarFixedClass.prototype._doFixed = function() {\r\n    var $editor = this.editor.getElement();\r\n    var $container = this.container.getElement();\r\n    var $toolbar = this.toolbar.getElement();\r\n    var $wrapper = this.toolbar.getWrapper();\r\n    var $targets = $container.parents().filter(function(node)\r\n    {\r\n        return (getComputedStyle(node, null).display === 'none') ? node : false;\r\n    });\r\n\r\n    // has hidden parent\r\n    if ($targets.length !== 0) return;\r\n\r\n    var isHeight = ($editor.height() < 100);\r\n    var isEmpty = this.editor.isEmpty();\r\n\r\n    if (isHeight || isEmpty || this.editor.isSourceMode()) return;\r\n\r\n    // Fix figuring out when to pin the toolbar and when not.\r\n    var toolbarHeight = $toolbar.height();\r\n    var toleranceEnd = 100;\r\n    var containerOffset = $container.offset();\r\n    var boxOffset = containerOffset.top;\r\n    var scrollOffset = this.$fixedTarget.scrollTop();\r\n    var top = (!this.toolbar.isTarget()) ? 0 : this.$fixedTarget.offset().top - this.$win.scrollTop();\r\n    var relativeTopPoint = boxOffset - toleranceEnd;\r\n\r\n    if (relativeTopPoint < 0 && Math.abs(relativeTopPoint) < $container.height() - toleranceEnd)\r\n    {\r\n        var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\r\n        top = (this.detector.isDesktop()) ? top : (scrollOffset - boxOffset + this.opts.toolbarFixedTopOffset);\r\n\r\n        if (this.detector.isMobile())\r\n        {\r\n            if (this.fixedScrollTimeout)\r\n            {\r\n                clearTimeout(this.fixedScrollTimeout);\r\n            }\r\n\r\n            $toolbar.hide();\r\n            this.fixedScrollTimeout = setTimeout(function()\r\n            {\r\n                $toolbar.show();\r\n            }, 250);\r\n        }\r\n\r\n        $wrapper.height(toolbarHeight);\r\n        $toolbar.addClass('redactor-toolbar-fixed');\r\n        $toolbar.css({\r\n            position: position,\r\n            top: (top + this.opts.toolbarFixedTopOffset) + 'px',\r\n            width: $container.width() + 'px'\r\n        });\r\n\r\n        var dropdown = this.toolbar.getDropdown();\r\n        if (dropdown) dropdown.updatePosition();\r\n\r\n        this.app.broadcast('toolbar.fixed');\r\n    }\r\n    else\r\n    {\r\n        this.reset();\r\n        this.app.broadcast('toolbar.unfixed');\r\n    }\r\n};"]}