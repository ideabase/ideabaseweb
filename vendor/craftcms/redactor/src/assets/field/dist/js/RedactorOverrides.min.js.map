{"version":3,"sources":["RedactorOverrides.js"],"names":["imageResizeClass","$R","prototype","_setResizerPosition","this","$resizer","toolbar","isTarget","$target","offset","pos","$resizableImage","width","height","resizerWidth","resizerHeight","css","top","left","_build","e","find","remove","data","inspector","parse","target","$editor","editor","getElement","isComponentType","$resizableBox","dom","getImageElement","attr","z-index","append","on","_set","bind","rebuild","hide","off","toolbarFixedClass","_doFixed","$container","container","$toolbar","$wrapper","getWrapper","parents","filter","node","getComputedStyle","display","length","isHeight","isEmpty","isSourceMode","toolbarHeight","boxOffset","scrollOffset","$fixedTarget","scrollTop","$win","relativeTopPoint","Math","abs","position","detector","isDesktop","opts","toolbarFixedTopOffset","isMobile","fixedScrollTimeout","clearTimeout","setTimeout","show","addClass","dropdown","getDropdown","updatePosition","app","broadcast","reset"],"mappings":"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","file":"RedactorOverrides.min.js","sourcesContent":["// Adjust the positioning of image resizer\n// =============================================================================\n\nvar imageResizeClass = $R['classes']['image.resize'];\n\n// Position the image resizer correctly\nimageResizeClass.prototype._setResizerPosition = function () {\n    if (this.$resizer)\n    {\n        var isTarget = this.toolbar.isTarget();\n        var targetOffset = this.$target.offset();\n        var offsetFix = 7;\n        var topOffset = offsetFix;\n        var leftOffset = offsetFix;\n        var pos = this.$resizableImage.offset();\n        var width = this.$resizableImage.width();\n        var height = this.$resizableImage.height();\n        var resizerWidth =  this.$resizer.width();\n        var resizerHeight =  this.$resizer.height();\n\n        this.$resizer.css({ top: (pos.top + height - resizerHeight + topOffset) + 'px', left: (pos.left + width - resizerWidth + leftOffset) + 'px' });\n    }\n};\n\n// When scrolling, reposition the resizer\nimageResizeClass.prototype._build = function (e) {\n    this.$target.find('#redactor-image-resizer').remove();\n\n    var data = this.inspector.parse(e.target);\n    var $editor = this.editor.getElement();\n\n    if (data.isComponentType('image'))\n    {\n        this.$resizableBox = $editor;\n        this.$resizableImage = $R.dom(data.getImageElement());\n\n        this.$resizer = $R.dom('<span>');\n        this.$resizer.attr('id', 'redactor-image-resizer');\n        this.$resizer.css({'z-index': 100});\n\n        this.$target.append(this.$resizer);\n\n        this._setResizerPosition();\n        this.$resizer.on('mousedown touchstart', this._set.bind(this));\n\n        if (this.toolbar.isTarget()) {\n            this.$target.on('scroll.resizer', this.rebuild.bind(this));\n        } else {\n            $R.dom('#content-container').on('scroll.resizer', this.rebuild.bind(this));\n        }\n    }\n};\n// Stop listening to scroll\nimageResizeClass.prototype.hide = function () {\n    this.$target.find('#redactor-image-resizer').remove();\n    if (this.toolbar.isTarget()) {\n        this.$target.off('scroll.resizer', this.rebuild.bind(this));\n    } else {\n        $R.dom('#content-container').off('scroll.resizer', this.rebuild.bind(this));\n    }\n};\n\n// Adjust the positioning of fixed toolbar\n// =============================================================================\n\nvar toolbarFixedClass = $R['classes']['toolbar.fixed'];\n\ntoolbarFixedClass.prototype._doFixed = function() {\n    var $editor = this.editor.getElement();\n    var $container = this.container.getElement();\n    var $toolbar = this.toolbar.getElement();\n    var $wrapper = this.toolbar.getWrapper();\n    var $targets = $container.parents().filter(function(node)\n    {\n        return (getComputedStyle(node, null).display === 'none') ? node : false;\n    });\n\n    // has hidden parent\n    if ($targets.length !== 0) return;\n\n    var isHeight = ($editor.height() < 100);\n    var isEmpty = this.editor.isEmpty();\n\n    if (isHeight || isEmpty || this.editor.isSourceMode()) return;\n\n    // Fix figuring out when to pin the toolbar and when not.\n    var toolbarHeight = $toolbar.height();\n    var toleranceEnd = 100;\n    var containerOffset = $container.offset();\n    var boxOffset = containerOffset.top;\n    var scrollOffset = this.$fixedTarget.scrollTop();\n    var top = (!this.toolbar.isTarget()) ? 0 : this.$fixedTarget.offset().top - this.$win.scrollTop();\n    var relativeTopPoint = boxOffset - toleranceEnd;\n\n    if (relativeTopPoint < 0 && Math.abs(relativeTopPoint) < $container.height() - toleranceEnd)\n    {\n        var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\n        top = (this.detector.isDesktop()) ? top : (scrollOffset - boxOffset + this.opts.toolbarFixedTopOffset);\n\n        if (this.detector.isMobile())\n        {\n            if (this.fixedScrollTimeout)\n            {\n                clearTimeout(this.fixedScrollTimeout);\n            }\n\n            $toolbar.hide();\n            this.fixedScrollTimeout = setTimeout(function()\n            {\n                $toolbar.show();\n            }, 250);\n        }\n\n        $wrapper.height(toolbarHeight);\n        $toolbar.addClass('redactor-toolbar-fixed');\n        $toolbar.css({\n            position: position,\n            top: (top + this.opts.toolbarFixedTopOffset) + 'px',\n            width: $container.width() + 'px'\n        });\n\n        var dropdown = this.toolbar.getDropdown();\n        if (dropdown) dropdown.updatePosition();\n\n        this.app.broadcast('toolbar.fixed');\n    }\n    else\n    {\n        this.reset();\n        this.app.broadcast('toolbar.unfixed');\n    }\n};"]}