{"version":3,"sources":["RedactorOverrides.js"],"names":["imageResizeClass","$R","prototype","_setResizerPosition","this","$resizer","toolbar","isTarget","$target","offset","pos","$resizableImage","width","height","resizerWidth","resizerHeight","css","top","left","_build","e","find","remove","data","inspector","parse","target","$editor","editor","getElement","isComponentType","$resizableBox","dom","getImageElement","attr","append","on","_set","bind","rebuild","hide","off","toolbarFixedClass","_doFixed","$container","container","$toolbar","$wrapper","getWrapper","parents","filter","node","getComputedStyle","display","length","isHeight","isEmpty","isSourceMode","toolbarHeight","boxOffset","scrollOffset","$fixedTarget","scrollTop","$win","relativeTopPoint","Math","abs","position","detector","isDesktop","opts","toolbarFixedTopOffset","isMobile","fixedScrollTimeout","clearTimeout","setTimeout","show","addClass","dropdown","getDropdown","updatePosition","app","broadcast","reset"],"mappings":"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","file":"RedactorOverrides.min.js","sourcesContent":["// Adjust the positioning of image resizer\n// =============================================================================\n\nvar imageResizeClass = $R['classes']['image.resize'];\n\n// Position the image resizer correctly\nimageResizeClass.prototype._setResizerPosition = function () {\n    if (this.$resizer)\n    {\n        var isTarget = this.toolbar.isTarget();\n        var targetOffset = this.$target.offset();\n        var offsetFix = 7;\n        var topOffset = offsetFix;\n        var leftOffset = offsetFix;\n        var pos = this.$resizableImage.offset();\n        var width = this.$resizableImage.width();\n        var height = this.$resizableImage.height();\n        var resizerWidth =  this.$resizer.width();\n        var resizerHeight =  this.$resizer.height();\n\n        this.$resizer.css({ top: (pos.top + height - resizerHeight + topOffset) + 'px', left: (pos.left + width - resizerWidth + leftOffset) + 'px' });\n    }\n};\n\n// When scrolling, reposition the resizer\nimageResizeClass.prototype._build = function (e) {\n    this.$target.find('#redactor-image-resizer').remove();\n\n    var data = this.inspector.parse(e.target);\n    var $editor = this.editor.getElement();\n\n    if (data.isComponentType('image'))\n    {\n        this.$resizableBox = $editor;\n        this.$resizableImage = $R.dom(data.getImageElement());\n\n        this.$resizer = $R.dom('<span>');\n        this.$resizer.attr('id', 'redactor-image-resizer');\n\n        this.$target.append(this.$resizer);\n\n        this._setResizerPosition();\n        this.$resizer.on('mousedown touchstart', this._set.bind(this));\n\n        if (this.toolbar.isTarget()) {\n            this.$target.on('scroll.resizer', this.rebuild.bind(this));\n        } else {\n            $R.dom('#content-container').on('scroll.resizer', this.rebuild.bind(this));\n        }\n    }\n};\n// Stop listening to scroll\nimageResizeClass.prototype.hide = function () {\n    this.$target.find('#redactor-image-resizer').remove();\n    if (this.toolbar.isTarget()) {\n        this.$target.off('scroll.resizer', this.rebuild.bind(this));\n    } else {\n        $R.dom('#content-container').off('scroll.resizer', this.rebuild.bind(this));\n    }\n};\n\n// Adjust the positioning of fixed toolbar\n// =============================================================================\n\nvar toolbarFixedClass = $R['classes']['toolbar.fixed'];\n\ntoolbarFixedClass.prototype._doFixed = function() {\n    var $editor = this.editor.getElement();\n    var $container = this.container.getElement();\n    var $toolbar = this.toolbar.getElement();\n    var $wrapper = this.toolbar.getWrapper();\n    var $targets = $container.parents().filter(function(node)\n    {\n        return (getComputedStyle(node, null).display === 'none') ? node : false;\n    });\n\n    // has hidden parent\n    if ($targets.length !== 0) return;\n\n    var isHeight = ($editor.height() < 100);\n    var isEmpty = this.editor.isEmpty();\n\n    if (isHeight || isEmpty || this.editor.isSourceMode()) return;\n\n    // Fix figuring out when to pin the toolbar and when not.\n    var toolbarHeight = $toolbar.height();\n    var toleranceEnd = 100;\n    var containerOffset = $container.offset();\n    var boxOffset = containerOffset.top;\n    var scrollOffset = this.$fixedTarget.scrollTop();\n    var top = (!this.toolbar.isTarget()) ? 0 : this.$fixedTarget.offset().top - this.$win.scrollTop();\n    var relativeTopPoint = boxOffset - toleranceEnd;\n\n    if (relativeTopPoint < 0 && Math.abs(relativeTopPoint) < $container.height() - toleranceEnd)\n    {\n        var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\n        top = (this.detector.isDesktop()) ? top : (scrollOffset - boxOffset + this.opts.toolbarFixedTopOffset);\n\n        if (this.detector.isMobile())\n        {\n            if (this.fixedScrollTimeout)\n            {\n                clearTimeout(this.fixedScrollTimeout);\n            }\n\n            $toolbar.hide();\n            this.fixedScrollTimeout = setTimeout(function()\n            {\n                $toolbar.show();\n            }, 250);\n        }\n\n        $wrapper.height(toolbarHeight);\n        $toolbar.addClass('redactor-toolbar-fixed');\n        $toolbar.css({\n            position: position,\n            top: (top + this.opts.toolbarFixedTopOffset) + 'px',\n            width: $container.width() + 'px'\n        });\n\n        var dropdown = this.toolbar.getDropdown();\n        if (dropdown) dropdown.updatePosition();\n\n        this.app.broadcast('toolbar.fixed');\n    }\n    else\n    {\n        this.reset();\n        this.app.broadcast('toolbar.unfixed');\n    }\n};"]}