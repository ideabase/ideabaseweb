{"version":3,"sources":["CraftEntryLinks.js"],"names":["plugin","$","extend","Craft","Redactor","PluginBase","start","showModal","arguments","this","app","selection","save","modalProperty","refHandle","createElementSelectorModal","elementType","storageKey","sources","criteria","siteId","elementSiteId","onSelect","proxy","elements","length","restore","element","getText","data","url","id","text","label","api","closeOtherModals","show","setLinkOptions","linkOptions","button","toolbar","getButton","items","getDropdown","newList","counter","option","title","optionTitle","args","setDropdown","add"],"mappings":"AAAA,IAAIA,OAASC,EAAEC,OAAO,GAAIC,MAAMC,SAASC,WAAY,CAGjDC,MAAO,aAGPC,UAAW,SAAUC,WACjBC,KAAKC,IAAIC,UAAUC,OAEnB,IAAIC,EAAgB,kBAAkBL,UAAUM,UAChD,QAAmC,IAAxBL,KAAKI,GAAgC,CAC5C,IAAIC,EAAYN,UAAUM,UAC1BL,KAAKI,GAAiBV,MAAMY,2BAA2BP,UAAUQ,YAAa,CAC1EC,WAAY,wBAA0BT,UAAUQ,YAChDE,QAASV,UAAUU,QACnBC,SAAUlB,EAAEC,OAAO,CAACkB,OAAQX,KAAKY,eAAgBb,UAAUW,UAC3DG,SAAUrB,EAAEsB,MAAM,SAASC,GACvB,GAAIA,EAASC,OAAQ,CACjBhB,KAAKC,IAAIC,UAAUe,UACnB,IAAIC,EAAUH,EAAS,GACnBb,EAAYF,KAAKC,IAAIC,UAAUiB,UAC/BC,EAAO,CACHC,IAAKH,EAAQG,IAAM,IAAMhB,EAAY,IAAMa,EAAQI,GACnDC,KAAyB,EAAnBrB,EAAUc,OAAad,EAAYgB,EAAQM,OAEzDxB,KAAKC,IAAIwB,IAAI,qBAAsBL,KAExCpB,MACH0B,kBAAkB,SAItB1B,KAAKI,GAAeuB,QAI5BC,eAAgB,SAAUC,GACtB,IAAIC,EAAS9B,KAAKC,IAAI8B,QAAQC,UAAU,QAEpCC,EADWH,EAAOI,cACDD,MACjBE,EAAU,GACVC,EAAU,EAEd,IAAK,IAAIC,KAAUR,EACfQ,EAASR,EAAYQ,GACrBF,EAAQ,YAAYC,GAAY,CAC5BE,MAAOD,EAAOE,YACdd,IAAK,mCACLe,KAAM,CACFjC,YAAa8B,EAAO9B,YACpBF,UAAWgC,EAAOhC,UAClBI,QAAS4B,EAAO5B,QAChBC,SAAU2B,EAAO3B,WAK7BoB,EAAOW,YAAYjD,EAAEC,OAAO0C,EAASF,OAM1CtC,SADI+C,IAAI,SAAU,kBAAmBnD","file":"CraftEntryLinks.min.js","sourcesContent":["var plugin = $.extend({}, Craft.Redactor.PluginBase, {\r\n\r\n    // Do nothing on start.\r\n    start: function () {\r\n\r\n    },\r\n    showModal: function (arguments) {\r\n        this.app.selection.save();\r\n\r\n        var modalProperty = 'selectionModal_'+arguments.refHandle;\r\n        if (typeof this[modalProperty] === 'undefined') {\r\n            var refHandle = arguments.refHandle;\r\n            this[modalProperty] = Craft.createElementSelectorModal(arguments.elementType, {\r\n                storageKey: 'RedactorInput.LinkTo.' + arguments.elementType,\r\n                sources: arguments.sources,\r\n                criteria: $.extend({siteId: this.elementSiteId}, arguments.criteria),\r\n                onSelect: $.proxy(function(elements) {\r\n                    if (elements.length) {\r\n                        this.app.selection.restore();\r\n                        var element = elements[0],\r\n                            selection = this.app.selection.getText(),\r\n                            data = {\r\n                                url: element.url + '#' + refHandle + ':' + element.id,\r\n                                text: selection.length > 0 ? selection : element.label\r\n                            };\r\n                        this.app.api('module.link.insert', data);\r\n                    }\r\n                }, this),\r\n                closeOtherModals: false,\r\n            });\r\n        }\r\n        else {\r\n            this[modalProperty].show();\r\n        }\r\n    },\r\n\r\n    setLinkOptions: function (linkOptions) {\r\n        var button = this.app.toolbar.getButton('link'),\r\n            dropdown = button.getDropdown(),\r\n            items = dropdown.items,\r\n            newList = {},\r\n            counter = 0;\r\n\r\n        for (var option in linkOptions) {\r\n            option = linkOptions[option];\r\n            newList['custom'+(++counter)] = {\r\n                title: option.optionTitle,\r\n                api: 'plugin.craftEntryLinks.showModal',\r\n                args: {\r\n                    elementType: option.elementType,\r\n                    refHandle: option.refHandle,\r\n                    sources: option.sources,\r\n                    criteria: option.criteria\r\n                }\r\n            };\r\n        }\r\n\r\n        button.setDropdown($.extend(newList, items));\r\n    }\r\n});\r\n\r\n(function($R) {\r\n    $R.add('plugin', 'craftEntryLinks', plugin);\r\n})(Redactor);"]}